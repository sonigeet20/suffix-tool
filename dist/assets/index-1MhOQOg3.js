function im(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(e,s,i.get?i:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();function lm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var k0={exports:{}},pl={},_0={exports:{}},ve={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fs=Symbol.for("react.element"),om=Symbol.for("react.portal"),cm=Symbol.for("react.fragment"),dm=Symbol.for("react.strict_mode"),um=Symbol.for("react.profiler"),hm=Symbol.for("react.provider"),pm=Symbol.for("react.context"),fm=Symbol.for("react.forward_ref"),gm=Symbol.for("react.suspense"),mm=Symbol.for("react.memo"),xm=Symbol.for("react.lazy"),lu=Symbol.iterator;function bm(e){return e===null||typeof e!="object"?null:(e=lu&&e[lu]||e["@@iterator"],typeof e=="function"?e:null)}var w0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N0=Object.assign,j0={};function Tn(e,t,r){this.props=e,this.context=t,this.refs=j0,this.updater=r||w0}Tn.prototype.isReactComponent={};Tn.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Tn.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function S0(){}S0.prototype=Tn.prototype;function $c(e,t,r){this.props=e,this.context=t,this.refs=j0,this.updater=r||w0}var Bc=$c.prototype=new S0;Bc.constructor=$c;N0(Bc,Tn.prototype);Bc.isPureReactComponent=!0;var ou=Array.isArray,E0=Object.prototype.hasOwnProperty,zc={current:null},C0={key:!0,ref:!0,__self:!0,__source:!0};function A0(e,t,r){var n,s={},i=null,l=null;if(t!=null)for(n in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(i=""+t.key),t)E0.call(t,n)&&!C0.hasOwnProperty(n)&&(s[n]=t[n]);var o=arguments.length-2;if(o===1)s.children=r;else if(1<o){for(var c=Array(o),d=0;d<o;d++)c[d]=arguments[d+2];s.children=c}if(e&&e.defaultProps)for(n in o=e.defaultProps,o)s[n]===void 0&&(s[n]=o[n]);return{$$typeof:Fs,type:e,key:i,ref:l,props:s,_owner:zc.current}}function ym(e,t){return{$$typeof:Fs,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function qc(e){return typeof e=="object"&&e!==null&&e.$$typeof===Fs}function vm(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var cu=/\/+/g;function Ml(e,t){return typeof e=="object"&&e!==null&&e.key!=null?vm(""+e.key):t.toString(36)}function bi(e,t,r,n,s){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case Fs:case om:l=!0}}if(l)return l=e,s=s(l),e=n===""?"."+Ml(l,0):n,ou(s)?(r="",e!=null&&(r=e.replace(cu,"$&/")+"/"),bi(s,t,r,"",function(d){return d})):s!=null&&(qc(s)&&(s=ym(s,r+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(cu,"$&/")+"/")+e)),t.push(s)),1;if(l=0,n=n===""?".":n+":",ou(e))for(var o=0;o<e.length;o++){i=e[o];var c=n+Ml(i,o);l+=bi(i,t,r,c,s)}else if(c=bm(e),typeof c=="function")for(e=c.call(e),o=0;!(i=e.next()).done;)i=i.value,c=n+Ml(i,o++),l+=bi(i,t,r,c,s);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function Ys(e,t,r){if(e==null)return e;var n=[],s=0;return bi(e,n,"","",function(i){return t.call(r,i,s++)}),n}function km(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ct={current:null},yi={transition:null},_m={ReactCurrentDispatcher:Ct,ReactCurrentBatchConfig:yi,ReactCurrentOwner:zc};function T0(){throw Error("act(...) is not supported in production builds of React.")}ve.Children={map:Ys,forEach:function(e,t,r){Ys(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Ys(e,function(){t++}),t},toArray:function(e){return Ys(e,function(t){return t})||[]},only:function(e){if(!qc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ve.Component=Tn;ve.Fragment=cm;ve.Profiler=um;ve.PureComponent=$c;ve.StrictMode=dm;ve.Suspense=gm;ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_m;ve.act=T0;ve.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=N0({},e.props),s=e.key,i=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,l=zc.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(c in t)E0.call(t,c)&&!C0.hasOwnProperty(c)&&(n[c]=t[c]===void 0&&o!==void 0?o[c]:t[c])}var c=arguments.length-2;if(c===1)n.children=r;else if(1<c){o=Array(c);for(var d=0;d<c;d++)o[d]=arguments[d+2];n.children=o}return{$$typeof:Fs,type:e.type,key:s,ref:i,props:n,_owner:l}};ve.createContext=function(e){return e={$$typeof:pm,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:hm,_context:e},e.Consumer=e};ve.createElement=A0;ve.createFactory=function(e){var t=A0.bind(null,e);return t.type=e,t};ve.createRef=function(){return{current:null}};ve.forwardRef=function(e){return{$$typeof:fm,render:e}};ve.isValidElement=qc;ve.lazy=function(e){return{$$typeof:xm,_payload:{_status:-1,_result:e},_init:km}};ve.memo=function(e,t){return{$$typeof:mm,type:e,compare:t===void 0?null:t}};ve.startTransition=function(e){var t=yi.transition;yi.transition={};try{e()}finally{yi.transition=t}};ve.unstable_act=T0;ve.useCallback=function(e,t){return Ct.current.useCallback(e,t)};ve.useContext=function(e){return Ct.current.useContext(e)};ve.useDebugValue=function(){};ve.useDeferredValue=function(e){return Ct.current.useDeferredValue(e)};ve.useEffect=function(e,t){return Ct.current.useEffect(e,t)};ve.useId=function(){return Ct.current.useId()};ve.useImperativeHandle=function(e,t,r){return Ct.current.useImperativeHandle(e,t,r)};ve.useInsertionEffect=function(e,t){return Ct.current.useInsertionEffect(e,t)};ve.useLayoutEffect=function(e,t){return Ct.current.useLayoutEffect(e,t)};ve.useMemo=function(e,t){return Ct.current.useMemo(e,t)};ve.useReducer=function(e,t,r){return Ct.current.useReducer(e,t,r)};ve.useRef=function(e){return Ct.current.useRef(e)};ve.useState=function(e){return Ct.current.useState(e)};ve.useSyncExternalStore=function(e,t,r){return Ct.current.useSyncExternalStore(e,t,r)};ve.useTransition=function(){return Ct.current.useTransition()};ve.version="18.3.1";_0.exports=ve;var y=_0.exports;const R0=lm(y),wm=im({__proto__:null,default:R0},[y]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nm=y,jm=Symbol.for("react.element"),Sm=Symbol.for("react.fragment"),Em=Object.prototype.hasOwnProperty,Cm=Nm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Am={key:!0,ref:!0,__self:!0,__source:!0};function I0(e,t,r){var n,s={},i=null,l=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(l=t.ref);for(n in t)Em.call(t,n)&&!Am.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:jm,type:e,key:i,ref:l,props:s,_owner:Cm.current}}pl.Fragment=Sm;pl.jsx=I0;pl.jsxs=I0;k0.exports=pl;var a=k0.exports,So={},L0={exports:{}},Wt={},P0={exports:{}},O0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(_,D){var q=_.length;_.push(D);e:for(;0<q;){var N=q-1>>>1,B=_[N];if(0<s(B,D))_[N]=D,_[q]=B,q=N;else break e}}function r(_){return _.length===0?null:_[0]}function n(_){if(_.length===0)return null;var D=_[0],q=_.pop();if(q!==D){_[0]=q;e:for(var N=0,B=_.length,U=B>>>1;N<U;){var F=2*(N+1)-1,H=_[F],be=F+1,je=_[be];if(0>s(H,q))be<B&&0>s(je,H)?(_[N]=je,_[be]=q,N=be):(_[N]=H,_[F]=q,N=F);else if(be<B&&0>s(je,q))_[N]=je,_[be]=q,N=be;else break e}}return D}function s(_,D){var q=_.sortIndex-D.sortIndex;return q!==0?q:_.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var l=Date,o=l.now();e.unstable_now=function(){return l.now()-o}}var c=[],d=[],u=1,h=null,p=3,v=!1,g=!1,k=!1,b=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function f(_){for(var D=r(d);D!==null;){if(D.callback===null)n(d);else if(D.startTime<=_)n(d),D.sortIndex=D.expirationTime,t(c,D);else break;D=r(d)}}function j(_){if(k=!1,f(_),!g)if(r(c)!==null)g=!0,K(T);else{var D=r(d);D!==null&&V(j,D.startTime-_)}}function T(_,D){g=!1,k&&(k=!1,m(O),O=-1),v=!0;var q=p;try{for(f(D),h=r(c);h!==null&&(!(h.expirationTime>D)||_&&!pe());){var N=h.callback;if(typeof N=="function"){h.callback=null,p=h.priorityLevel;var B=N(h.expirationTime<=D);D=e.unstable_now(),typeof B=="function"?h.callback=B:h===r(c)&&n(c),f(D)}else n(c);h=r(c)}if(h!==null)var U=!0;else{var F=r(d);F!==null&&V(j,F.startTime-D),U=!1}return U}finally{h=null,p=q,v=!1}}var L=!1,C=null,O=-1,Q=5,W=-1;function pe(){return!(e.unstable_now()-W<Q)}function A(){if(C!==null){var _=e.unstable_now();W=_;var D=!0;try{D=C(!0,_)}finally{D?ne():(L=!1,C=null)}}else L=!1}var ne;if(typeof x=="function")ne=function(){x(A)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,me=te.port2;te.port1.onmessage=A,ne=function(){me.postMessage(null)}}else ne=function(){b(A,0)};function K(_){C=_,L||(L=!0,ne())}function V(_,D){O=b(function(){_(e.unstable_now())},D)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(_){_.callback=null},e.unstable_continueExecution=function(){g||v||(g=!0,K(T))},e.unstable_forceFrameRate=function(_){0>_||125<_?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<_?Math.floor(1e3/_):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(_){switch(p){case 1:case 2:case 3:var D=3;break;default:D=p}var q=p;p=D;try{return _()}finally{p=q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(_,D){switch(_){case 1:case 2:case 3:case 4:case 5:break;default:_=3}var q=p;p=_;try{return D()}finally{p=q}},e.unstable_scheduleCallback=function(_,D,q){var N=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?N+q:N):q=N,_){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=q+B,_={id:u++,callback:D,priorityLevel:_,startTime:q,expirationTime:B,sortIndex:-1},q>N?(_.sortIndex=q,t(d,_),r(c)===null&&_===r(d)&&(k?(m(O),O=-1):k=!0,V(j,q-N))):(_.sortIndex=B,t(c,_),g||v||(g=!0,K(T))),_},e.unstable_shouldYield=pe,e.unstable_wrapCallback=function(_){var D=p;return function(){var q=p;p=D;try{return _.apply(this,arguments)}finally{p=q}}}})(O0);P0.exports=O0;var Tm=P0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rm=y,Ht=Tm;function G(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var U0=new Set,us={};function Ma(e,t){kn(e,t),kn(e+"Capture",t)}function kn(e,t){for(us[e]=t,e=0;e<t.length;e++)U0.add(t[e])}var Rr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Eo=Object.prototype.hasOwnProperty,Im=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,du={},uu={};function Lm(e){return Eo.call(uu,e)?!0:Eo.call(du,e)?!1:Im.test(e)?uu[e]=!0:(du[e]=!0,!1)}function Pm(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Om(e,t,r,n){if(t===null||typeof t>"u"||Pm(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function At(e,t,r,n,s,i,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=l}var ft={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ft[e]=new At(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ft[t]=new At(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ft[e]=new At(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ft[e]=new At(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ft[e]=new At(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ft[e]=new At(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ft[e]=new At(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ft[e]=new At(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ft[e]=new At(e,5,!1,e.toLowerCase(),null,!1,!1)});var Gc=/[\-:]([a-z])/g;function Vc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Gc,Vc);ft[t]=new At(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Gc,Vc);ft[t]=new At(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Gc,Vc);ft[t]=new At(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ft[e]=new At(e,1,!1,e.toLowerCase(),null,!1,!1)});ft.xlinkHref=new At("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ft[e]=new At(e,1,!1,e.toLowerCase(),null,!0,!0)});function Hc(e,t,r,n){var s=ft.hasOwnProperty(t)?ft[t]:null;(s!==null?s.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Om(t,r,s,n)&&(r=null),n||s===null?Lm(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,n=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Or=Rm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Js=Symbol.for("react.element"),en=Symbol.for("react.portal"),tn=Symbol.for("react.fragment"),Wc=Symbol.for("react.strict_mode"),Co=Symbol.for("react.profiler"),D0=Symbol.for("react.provider"),F0=Symbol.for("react.context"),Kc=Symbol.for("react.forward_ref"),Ao=Symbol.for("react.suspense"),To=Symbol.for("react.suspense_list"),Yc=Symbol.for("react.memo"),$r=Symbol.for("react.lazy"),M0=Symbol.for("react.offscreen"),hu=Symbol.iterator;function Mn(e){return e===null||typeof e!="object"?null:(e=hu&&e[hu]||e["@@iterator"],typeof e=="function"?e:null)}var ze=Object.assign,$l;function Kn(e){if($l===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);$l=t&&t[1]||""}return`
`+$l+e}var Bl=!1;function zl(e,t){if(!e||Bl)return"";Bl=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var n=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){n=d}e.call(t.prototype)}else{try{throw Error()}catch(d){n=d}e()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=n.stack.split(`
`),l=s.length-1,o=i.length-1;1<=l&&0<=o&&s[l]!==i[o];)o--;for(;1<=l&&0<=o;l--,o--)if(s[l]!==i[o]){if(l!==1||o!==1)do if(l--,o--,0>o||s[l]!==i[o]){var c=`
`+s[l].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=l&&0<=o);break}}}finally{Bl=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Kn(e):""}function Um(e){switch(e.tag){case 5:return Kn(e.type);case 16:return Kn("Lazy");case 13:return Kn("Suspense");case 19:return Kn("SuspenseList");case 0:case 2:case 15:return e=zl(e.type,!1),e;case 11:return e=zl(e.type.render,!1),e;case 1:return e=zl(e.type,!0),e;default:return""}}function Ro(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case tn:return"Fragment";case en:return"Portal";case Co:return"Profiler";case Wc:return"StrictMode";case Ao:return"Suspense";case To:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case F0:return(e.displayName||"Context")+".Consumer";case D0:return(e._context.displayName||"Context")+".Provider";case Kc:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Yc:return t=e.displayName||null,t!==null?t:Ro(e.type)||"Memo";case $r:t=e._payload,e=e._init;try{return Ro(e(t))}catch{}}return null}function Dm(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ro(t);case 8:return t===Wc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ia(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function $0(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Fm(e){var t=$0(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(l){n=""+l,i.call(this,l)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(l){n=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Qs(e){e._valueTracker||(e._valueTracker=Fm(e))}function B0(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=$0(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function Pi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Io(e,t){var r=t.checked;return ze({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function pu(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=ia(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function z0(e,t){t=t.checked,t!=null&&Hc(e,"checked",t,!1)}function Lo(e,t){z0(e,t);var r=ia(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Po(e,t.type,r):t.hasOwnProperty("defaultValue")&&Po(e,t.type,ia(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function fu(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Po(e,t,r){(t!=="number"||Pi(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Yn=Array.isArray;function fn(e,t,r,n){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&n&&(e[r].defaultSelected=!0)}else{for(r=""+ia(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,n&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function Oo(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(G(91));return ze({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function gu(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(G(92));if(Yn(r)){if(1<r.length)throw Error(G(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:ia(r)}}function q0(e,t){var r=ia(t.value),n=ia(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function mu(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function G0(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Uo(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?G0(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Xs,V0=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Xs=Xs||document.createElement("div"),Xs.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Xs.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function hs(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Zn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Mm=["Webkit","ms","Moz","O"];Object.keys(Zn).forEach(function(e){Mm.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Zn[t]=Zn[e]})});function H0(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Zn.hasOwnProperty(e)&&Zn[e]?(""+t).trim():t+"px"}function W0(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,s=H0(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,s):e[r]=s}}var $m=ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Do(e,t){if(t){if($m[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(G(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(G(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(G(61))}if(t.style!=null&&typeof t.style!="object")throw Error(G(62))}}function Fo(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mo=null;function Jc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var $o=null,gn=null,mn=null;function xu(e){if(e=Bs(e)){if(typeof $o!="function")throw Error(G(280));var t=e.stateNode;t&&(t=bl(t),$o(e.stateNode,e.type,t))}}function K0(e){gn?mn?mn.push(e):mn=[e]:gn=e}function Y0(){if(gn){var e=gn,t=mn;if(mn=gn=null,xu(e),t)for(e=0;e<t.length;e++)xu(t[e])}}function J0(e,t){return e(t)}function Q0(){}var ql=!1;function X0(e,t,r){if(ql)return e(t,r);ql=!0;try{return J0(e,t,r)}finally{ql=!1,(gn!==null||mn!==null)&&(Q0(),Y0())}}function ps(e,t){var r=e.stateNode;if(r===null)return null;var n=bl(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(G(231,t,typeof r));return r}var Bo=!1;if(Rr)try{var $n={};Object.defineProperty($n,"passive",{get:function(){Bo=!0}}),window.addEventListener("test",$n,$n),window.removeEventListener("test",$n,$n)}catch{Bo=!1}function Bm(e,t,r,n,s,i,l,o,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(r,d)}catch(u){this.onError(u)}}var es=!1,Oi=null,Ui=!1,zo=null,zm={onError:function(e){es=!0,Oi=e}};function qm(e,t,r,n,s,i,l,o,c){es=!1,Oi=null,Bm.apply(zm,arguments)}function Gm(e,t,r,n,s,i,l,o,c){if(qm.apply(this,arguments),es){if(es){var d=Oi;es=!1,Oi=null}else throw Error(G(198));Ui||(Ui=!0,zo=d)}}function $a(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Z0(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function bu(e){if($a(e)!==e)throw Error(G(188))}function Vm(e){var t=e.alternate;if(!t){if(t=$a(e),t===null)throw Error(G(188));return t!==e?null:e}for(var r=e,n=t;;){var s=r.return;if(s===null)break;var i=s.alternate;if(i===null){if(n=s.return,n!==null){r=n;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===r)return bu(s),e;if(i===n)return bu(s),t;i=i.sibling}throw Error(G(188))}if(r.return!==n.return)r=s,n=i;else{for(var l=!1,o=s.child;o;){if(o===r){l=!0,r=s,n=i;break}if(o===n){l=!0,n=s,r=i;break}o=o.sibling}if(!l){for(o=i.child;o;){if(o===r){l=!0,r=i,n=s;break}if(o===n){l=!0,n=i,r=s;break}o=o.sibling}if(!l)throw Error(G(189))}}if(r.alternate!==n)throw Error(G(190))}if(r.tag!==3)throw Error(G(188));return r.stateNode.current===r?e:t}function ep(e){return e=Vm(e),e!==null?tp(e):null}function tp(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=tp(e);if(t!==null)return t;e=e.sibling}return null}var rp=Ht.unstable_scheduleCallback,yu=Ht.unstable_cancelCallback,Hm=Ht.unstable_shouldYield,Wm=Ht.unstable_requestPaint,Je=Ht.unstable_now,Km=Ht.unstable_getCurrentPriorityLevel,Qc=Ht.unstable_ImmediatePriority,ap=Ht.unstable_UserBlockingPriority,Di=Ht.unstable_NormalPriority,Ym=Ht.unstable_LowPriority,np=Ht.unstable_IdlePriority,fl=null,_r=null;function Jm(e){if(_r&&typeof _r.onCommitFiberRoot=="function")try{_r.onCommitFiberRoot(fl,e,void 0,(e.current.flags&128)===128)}catch{}}var ur=Math.clz32?Math.clz32:Zm,Qm=Math.log,Xm=Math.LN2;function Zm(e){return e>>>=0,e===0?32:31-(Qm(e)/Xm|0)|0}var Zs=64,ei=4194304;function Jn(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Fi(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,s=e.suspendedLanes,i=e.pingedLanes,l=r&268435455;if(l!==0){var o=l&~s;o!==0?n=Jn(o):(i&=l,i!==0&&(n=Jn(i)))}else l=r&~s,l!==0?n=Jn(l):i!==0&&(n=Jn(i));if(n===0)return 0;if(t!==0&&t!==n&&!(t&s)&&(s=n&-n,i=t&-t,s>=i||s===16&&(i&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-ur(t),s=1<<r,n|=e[r],t&=~s;return n}function ex(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tx(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,i=e.pendingLanes;0<i;){var l=31-ur(i),o=1<<l,c=s[l];c===-1?(!(o&r)||o&n)&&(s[l]=ex(o,t)):c<=t&&(e.expiredLanes|=o),i&=~o}}function qo(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function sp(){var e=Zs;return Zs<<=1,!(Zs&4194240)&&(Zs=64),e}function Gl(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Ms(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ur(t),e[t]=r}function rx(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-ur(r),i=1<<s;t[s]=0,n[s]=-1,e[s]=-1,r&=~i}}function Xc(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-ur(r),s=1<<n;s&t|e[n]&t&&(e[n]|=t),r&=~s}}var Ce=0;function ip(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var lp,Zc,op,cp,dp,Go=!1,ti=[],Jr=null,Qr=null,Xr=null,fs=new Map,gs=new Map,qr=[],ax="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vu(e,t){switch(e){case"focusin":case"focusout":Jr=null;break;case"dragenter":case"dragleave":Qr=null;break;case"mouseover":case"mouseout":Xr=null;break;case"pointerover":case"pointerout":fs.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":gs.delete(t.pointerId)}}function Bn(e,t,r,n,s,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[s]},t!==null&&(t=Bs(t),t!==null&&Zc(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function nx(e,t,r,n,s){switch(t){case"focusin":return Jr=Bn(Jr,e,t,r,n,s),!0;case"dragenter":return Qr=Bn(Qr,e,t,r,n,s),!0;case"mouseover":return Xr=Bn(Xr,e,t,r,n,s),!0;case"pointerover":var i=s.pointerId;return fs.set(i,Bn(fs.get(i)||null,e,t,r,n,s)),!0;case"gotpointercapture":return i=s.pointerId,gs.set(i,Bn(gs.get(i)||null,e,t,r,n,s)),!0}return!1}function up(e){var t=Na(e.target);if(t!==null){var r=$a(t);if(r!==null){if(t=r.tag,t===13){if(t=Z0(r),t!==null){e.blockedOn=t,dp(e.priority,function(){op(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function vi(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=Vo(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);Mo=n,r.target.dispatchEvent(n),Mo=null}else return t=Bs(r),t!==null&&Zc(t),e.blockedOn=r,!1;t.shift()}return!0}function ku(e,t,r){vi(e)&&r.delete(t)}function sx(){Go=!1,Jr!==null&&vi(Jr)&&(Jr=null),Qr!==null&&vi(Qr)&&(Qr=null),Xr!==null&&vi(Xr)&&(Xr=null),fs.forEach(ku),gs.forEach(ku)}function zn(e,t){e.blockedOn===t&&(e.blockedOn=null,Go||(Go=!0,Ht.unstable_scheduleCallback(Ht.unstable_NormalPriority,sx)))}function ms(e){function t(s){return zn(s,e)}if(0<ti.length){zn(ti[0],e);for(var r=1;r<ti.length;r++){var n=ti[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Jr!==null&&zn(Jr,e),Qr!==null&&zn(Qr,e),Xr!==null&&zn(Xr,e),fs.forEach(t),gs.forEach(t),r=0;r<qr.length;r++)n=qr[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<qr.length&&(r=qr[0],r.blockedOn===null);)up(r),r.blockedOn===null&&qr.shift()}var xn=Or.ReactCurrentBatchConfig,Mi=!0;function ix(e,t,r,n){var s=Ce,i=xn.transition;xn.transition=null;try{Ce=1,ed(e,t,r,n)}finally{Ce=s,xn.transition=i}}function lx(e,t,r,n){var s=Ce,i=xn.transition;xn.transition=null;try{Ce=4,ed(e,t,r,n)}finally{Ce=s,xn.transition=i}}function ed(e,t,r,n){if(Mi){var s=Vo(e,t,r,n);if(s===null)eo(e,t,n,$i,r),vu(e,n);else if(nx(s,e,t,r,n))n.stopPropagation();else if(vu(e,n),t&4&&-1<ax.indexOf(e)){for(;s!==null;){var i=Bs(s);if(i!==null&&lp(i),i=Vo(e,t,r,n),i===null&&eo(e,t,n,$i,r),i===s)break;s=i}s!==null&&n.stopPropagation()}else eo(e,t,n,null,r)}}var $i=null;function Vo(e,t,r,n){if($i=null,e=Jc(n),e=Na(e),e!==null)if(t=$a(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Z0(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return $i=e,null}function hp(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Km()){case Qc:return 1;case ap:return 4;case Di:case Ym:return 16;case np:return 536870912;default:return 16}default:return 16}}var Hr=null,td=null,ki=null;function pp(){if(ki)return ki;var e,t=td,r=t.length,n,s="value"in Hr?Hr.value:Hr.textContent,i=s.length;for(e=0;e<r&&t[e]===s[e];e++);var l=r-e;for(n=1;n<=l&&t[r-n]===s[i-n];n++);return ki=s.slice(e,1<n?1-n:void 0)}function _i(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function ri(){return!0}function _u(){return!1}function Kt(e){function t(r,n,s,i,l){this._reactName=r,this._targetInst=s,this.type=n,this.nativeEvent=i,this.target=l,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(r=e[o],this[o]=r?r(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ri:_u,this.isPropagationStopped=_u,this}return ze(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=ri)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=ri)},persist:function(){},isPersistent:ri}),t}var Rn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rd=Kt(Rn),$s=ze({},Rn,{view:0,detail:0}),ox=Kt($s),Vl,Hl,qn,gl=ze({},$s,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ad,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==qn&&(qn&&e.type==="mousemove"?(Vl=e.screenX-qn.screenX,Hl=e.screenY-qn.screenY):Hl=Vl=0,qn=e),Vl)},movementY:function(e){return"movementY"in e?e.movementY:Hl}}),wu=Kt(gl),cx=ze({},gl,{dataTransfer:0}),dx=Kt(cx),ux=ze({},$s,{relatedTarget:0}),Wl=Kt(ux),hx=ze({},Rn,{animationName:0,elapsedTime:0,pseudoElement:0}),px=Kt(hx),fx=ze({},Rn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),gx=Kt(fx),mx=ze({},Rn,{data:0}),Nu=Kt(mx),xx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vx(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=yx[e])?!!t[e]:!1}function ad(){return vx}var kx=ze({},$s,{key:function(e){if(e.key){var t=xx[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=_i(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?bx[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ad,charCode:function(e){return e.type==="keypress"?_i(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?_i(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),_x=Kt(kx),wx=ze({},gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ju=Kt(wx),Nx=ze({},$s,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ad}),jx=Kt(Nx),Sx=ze({},Rn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ex=Kt(Sx),Cx=ze({},gl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ax=Kt(Cx),Tx=[9,13,27,32],nd=Rr&&"CompositionEvent"in window,ts=null;Rr&&"documentMode"in document&&(ts=document.documentMode);var Rx=Rr&&"TextEvent"in window&&!ts,fp=Rr&&(!nd||ts&&8<ts&&11>=ts),Su=" ",Eu=!1;function gp(e,t){switch(e){case"keyup":return Tx.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var rn=!1;function Ix(e,t){switch(e){case"compositionend":return mp(t);case"keypress":return t.which!==32?null:(Eu=!0,Su);case"textInput":return e=t.data,e===Su&&Eu?null:e;default:return null}}function Lx(e,t){if(rn)return e==="compositionend"||!nd&&gp(e,t)?(e=pp(),ki=td=Hr=null,rn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return fp&&t.locale!=="ko"?null:t.data;default:return null}}var Px={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Px[e.type]:t==="textarea"}function xp(e,t,r,n){K0(n),t=Bi(t,"onChange"),0<t.length&&(r=new rd("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var rs=null,xs=null;function Ox(e){Cp(e,0)}function ml(e){var t=sn(e);if(B0(t))return e}function Ux(e,t){if(e==="change")return t}var bp=!1;if(Rr){var Kl;if(Rr){var Yl="oninput"in document;if(!Yl){var Au=document.createElement("div");Au.setAttribute("oninput","return;"),Yl=typeof Au.oninput=="function"}Kl=Yl}else Kl=!1;bp=Kl&&(!document.documentMode||9<document.documentMode)}function Tu(){rs&&(rs.detachEvent("onpropertychange",yp),xs=rs=null)}function yp(e){if(e.propertyName==="value"&&ml(xs)){var t=[];xp(t,xs,e,Jc(e)),X0(Ox,t)}}function Dx(e,t,r){e==="focusin"?(Tu(),rs=t,xs=r,rs.attachEvent("onpropertychange",yp)):e==="focusout"&&Tu()}function Fx(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ml(xs)}function Mx(e,t){if(e==="click")return ml(t)}function $x(e,t){if(e==="input"||e==="change")return ml(t)}function Bx(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var pr=typeof Object.is=="function"?Object.is:Bx;function bs(e,t){if(pr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!Eo.call(t,s)||!pr(e[s],t[s]))return!1}return!0}function Ru(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Iu(e,t){var r=Ru(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Ru(r)}}function vp(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?vp(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function kp(){for(var e=window,t=Pi();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Pi(e.document)}return t}function sd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function zx(e){var t=kp(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&vp(r.ownerDocument.documentElement,r)){if(n!==null&&sd(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,i=Math.min(n.start,s);n=n.end===void 0?i:Math.min(n.end,s),!e.extend&&i>n&&(s=n,n=i,i=s),s=Iu(r,i);var l=Iu(r,n);s&&l&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var qx=Rr&&"documentMode"in document&&11>=document.documentMode,an=null,Ho=null,as=null,Wo=!1;function Lu(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Wo||an==null||an!==Pi(n)||(n=an,"selectionStart"in n&&sd(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),as&&bs(as,n)||(as=n,n=Bi(Ho,"onSelect"),0<n.length&&(t=new rd("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=an)))}function ai(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var nn={animationend:ai("Animation","AnimationEnd"),animationiteration:ai("Animation","AnimationIteration"),animationstart:ai("Animation","AnimationStart"),transitionend:ai("Transition","TransitionEnd")},Jl={},_p={};Rr&&(_p=document.createElement("div").style,"AnimationEvent"in window||(delete nn.animationend.animation,delete nn.animationiteration.animation,delete nn.animationstart.animation),"TransitionEvent"in window||delete nn.transitionend.transition);function xl(e){if(Jl[e])return Jl[e];if(!nn[e])return e;var t=nn[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in _p)return Jl[e]=t[r];return e}var wp=xl("animationend"),Np=xl("animationiteration"),jp=xl("animationstart"),Sp=xl("transitionend"),Ep=new Map,Pu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function oa(e,t){Ep.set(e,t),Ma(t,[e])}for(var Ql=0;Ql<Pu.length;Ql++){var Xl=Pu[Ql],Gx=Xl.toLowerCase(),Vx=Xl[0].toUpperCase()+Xl.slice(1);oa(Gx,"on"+Vx)}oa(wp,"onAnimationEnd");oa(Np,"onAnimationIteration");oa(jp,"onAnimationStart");oa("dblclick","onDoubleClick");oa("focusin","onFocus");oa("focusout","onBlur");oa(Sp,"onTransitionEnd");kn("onMouseEnter",["mouseout","mouseover"]);kn("onMouseLeave",["mouseout","mouseover"]);kn("onPointerEnter",["pointerout","pointerover"]);kn("onPointerLeave",["pointerout","pointerover"]);Ma("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ma("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ma("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ma("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ma("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ma("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qn));function Ou(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Gm(n,t,void 0,e),e.currentTarget=null}function Cp(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],s=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var l=n.length-1;0<=l;l--){var o=n[l],c=o.instance,d=o.currentTarget;if(o=o.listener,c!==i&&s.isPropagationStopped())break e;Ou(s,o,d),i=c}else for(l=0;l<n.length;l++){if(o=n[l],c=o.instance,d=o.currentTarget,o=o.listener,c!==i&&s.isPropagationStopped())break e;Ou(s,o,d),i=c}}}if(Ui)throw e=zo,Ui=!1,zo=null,e}function Oe(e,t){var r=t[Xo];r===void 0&&(r=t[Xo]=new Set);var n=e+"__bubble";r.has(n)||(Ap(t,e,2,!1),r.add(n))}function Zl(e,t,r){var n=0;t&&(n|=4),Ap(r,e,n,t)}var ni="_reactListening"+Math.random().toString(36).slice(2);function ys(e){if(!e[ni]){e[ni]=!0,U0.forEach(function(r){r!=="selectionchange"&&(Hx.has(r)||Zl(r,!1,e),Zl(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ni]||(t[ni]=!0,Zl("selectionchange",!1,t))}}function Ap(e,t,r,n){switch(hp(t)){case 1:var s=ix;break;case 4:s=lx;break;default:s=ed}r=s.bind(null,t,r,e),s=void 0,!Bo||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),n?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function eo(e,t,r,n,s){var i=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var l=n.tag;if(l===3||l===4){var o=n.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(l===4)for(l=n.return;l!==null;){var c=l.tag;if((c===3||c===4)&&(c=l.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;l=l.return}for(;o!==null;){if(l=Na(o),l===null)return;if(c=l.tag,c===5||c===6){n=i=l;continue e}o=o.parentNode}}n=n.return}X0(function(){var d=i,u=Jc(r),h=[];e:{var p=Ep.get(e);if(p!==void 0){var v=rd,g=e;switch(e){case"keypress":if(_i(r)===0)break e;case"keydown":case"keyup":v=_x;break;case"focusin":g="focus",v=Wl;break;case"focusout":g="blur",v=Wl;break;case"beforeblur":case"afterblur":v=Wl;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":v=wu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":v=dx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":v=jx;break;case wp:case Np:case jp:v=px;break;case Sp:v=Ex;break;case"scroll":v=ox;break;case"wheel":v=Ax;break;case"copy":case"cut":case"paste":v=gx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":v=ju}var k=(t&4)!==0,b=!k&&e==="scroll",m=k?p!==null?p+"Capture":null:p;k=[];for(var x=d,f;x!==null;){f=x;var j=f.stateNode;if(f.tag===5&&j!==null&&(f=j,m!==null&&(j=ps(x,m),j!=null&&k.push(vs(x,j,f)))),b)break;x=x.return}0<k.length&&(p=new v(p,g,null,r,u),h.push({event:p,listeners:k}))}}if(!(t&7)){e:{if(p=e==="mouseover"||e==="pointerover",v=e==="mouseout"||e==="pointerout",p&&r!==Mo&&(g=r.relatedTarget||r.fromElement)&&(Na(g)||g[Ir]))break e;if((v||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,v?(g=r.relatedTarget||r.toElement,v=d,g=g?Na(g):null,g!==null&&(b=$a(g),g!==b||g.tag!==5&&g.tag!==6)&&(g=null)):(v=null,g=d),v!==g)){if(k=wu,j="onMouseLeave",m="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(k=ju,j="onPointerLeave",m="onPointerEnter",x="pointer"),b=v==null?p:sn(v),f=g==null?p:sn(g),p=new k(j,x+"leave",v,r,u),p.target=b,p.relatedTarget=f,j=null,Na(u)===d&&(k=new k(m,x+"enter",g,r,u),k.target=f,k.relatedTarget=b,j=k),b=j,v&&g)t:{for(k=v,m=g,x=0,f=k;f;f=Ba(f))x++;for(f=0,j=m;j;j=Ba(j))f++;for(;0<x-f;)k=Ba(k),x--;for(;0<f-x;)m=Ba(m),f--;for(;x--;){if(k===m||m!==null&&k===m.alternate)break t;k=Ba(k),m=Ba(m)}k=null}else k=null;v!==null&&Uu(h,p,v,k,!1),g!==null&&b!==null&&Uu(h,b,g,k,!0)}}e:{if(p=d?sn(d):window,v=p.nodeName&&p.nodeName.toLowerCase(),v==="select"||v==="input"&&p.type==="file")var T=Ux;else if(Cu(p))if(bp)T=$x;else{T=Fx;var L=Dx}else(v=p.nodeName)&&v.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(T=Mx);if(T&&(T=T(e,d))){xp(h,T,r,u);break e}L&&L(e,p,d),e==="focusout"&&(L=p._wrapperState)&&L.controlled&&p.type==="number"&&Po(p,"number",p.value)}switch(L=d?sn(d):window,e){case"focusin":(Cu(L)||L.contentEditable==="true")&&(an=L,Ho=d,as=null);break;case"focusout":as=Ho=an=null;break;case"mousedown":Wo=!0;break;case"contextmenu":case"mouseup":case"dragend":Wo=!1,Lu(h,r,u);break;case"selectionchange":if(qx)break;case"keydown":case"keyup":Lu(h,r,u)}var C;if(nd)e:{switch(e){case"compositionstart":var O="onCompositionStart";break e;case"compositionend":O="onCompositionEnd";break e;case"compositionupdate":O="onCompositionUpdate";break e}O=void 0}else rn?gp(e,r)&&(O="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(O="onCompositionStart");O&&(fp&&r.locale!=="ko"&&(rn||O!=="onCompositionStart"?O==="onCompositionEnd"&&rn&&(C=pp()):(Hr=u,td="value"in Hr?Hr.value:Hr.textContent,rn=!0)),L=Bi(d,O),0<L.length&&(O=new Nu(O,e,null,r,u),h.push({event:O,listeners:L}),C?O.data=C:(C=mp(r),C!==null&&(O.data=C)))),(C=Rx?Ix(e,r):Lx(e,r))&&(d=Bi(d,"onBeforeInput"),0<d.length&&(u=new Nu("onBeforeInput","beforeinput",null,r,u),h.push({event:u,listeners:d}),u.data=C))}Cp(h,t)})}function vs(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Bi(e,t){for(var r=t+"Capture",n=[];e!==null;){var s=e,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=ps(e,r),i!=null&&n.unshift(vs(e,i,s)),i=ps(e,t),i!=null&&n.push(vs(e,i,s))),e=e.return}return n}function Ba(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Uu(e,t,r,n,s){for(var i=t._reactName,l=[];r!==null&&r!==n;){var o=r,c=o.alternate,d=o.stateNode;if(c!==null&&c===n)break;o.tag===5&&d!==null&&(o=d,s?(c=ps(r,i),c!=null&&l.unshift(vs(r,c,o))):s||(c=ps(r,i),c!=null&&l.push(vs(r,c,o)))),r=r.return}l.length!==0&&e.push({event:t,listeners:l})}var Wx=/\r\n?/g,Kx=/\u0000|\uFFFD/g;function Du(e){return(typeof e=="string"?e:""+e).replace(Wx,`
`).replace(Kx,"")}function si(e,t,r){if(t=Du(t),Du(e)!==t&&r)throw Error(G(425))}function zi(){}var Ko=null,Yo=null;function Jo(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Qo=typeof setTimeout=="function"?setTimeout:void 0,Yx=typeof clearTimeout=="function"?clearTimeout:void 0,Fu=typeof Promise=="function"?Promise:void 0,Jx=typeof queueMicrotask=="function"?queueMicrotask:typeof Fu<"u"?function(e){return Fu.resolve(null).then(e).catch(Qx)}:Qo;function Qx(e){setTimeout(function(){throw e})}function to(e,t){var r=t,n=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(n===0){e.removeChild(s),ms(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=s}while(r);ms(t)}function Zr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Mu(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var In=Math.random().toString(36).slice(2),kr="__reactFiber$"+In,ks="__reactProps$"+In,Ir="__reactContainer$"+In,Xo="__reactEvents$"+In,Xx="__reactListeners$"+In,Zx="__reactHandles$"+In;function Na(e){var t=e[kr];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Ir]||r[kr]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Mu(e);e!==null;){if(r=e[kr])return r;e=Mu(e)}return t}e=r,r=e.parentNode}return null}function Bs(e){return e=e[kr]||e[Ir],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function sn(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(G(33))}function bl(e){return e[ks]||null}var Zo=[],ln=-1;function ca(e){return{current:e}}function Ue(e){0>ln||(e.current=Zo[ln],Zo[ln]=null,ln--)}function Le(e,t){ln++,Zo[ln]=e.current,e.current=t}var la={},_t=ca(la),Pt=ca(!1),La=la;function _n(e,t){var r=e.type.contextTypes;if(!r)return la;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in r)s[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Ot(e){return e=e.childContextTypes,e!=null}function qi(){Ue(Pt),Ue(_t)}function $u(e,t,r){if(_t.current!==la)throw Error(G(168));Le(_t,t),Le(Pt,r)}function Tp(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var s in n)if(!(s in t))throw Error(G(108,Dm(e)||"Unknown",s));return ze({},r,n)}function Gi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||la,La=_t.current,Le(_t,e),Le(Pt,Pt.current),!0}function Bu(e,t,r){var n=e.stateNode;if(!n)throw Error(G(169));r?(e=Tp(e,t,La),n.__reactInternalMemoizedMergedChildContext=e,Ue(Pt),Ue(_t),Le(_t,e)):Ue(Pt),Le(Pt,r)}var Er=null,yl=!1,ro=!1;function Rp(e){Er===null?Er=[e]:Er.push(e)}function eb(e){yl=!0,Rp(e)}function da(){if(!ro&&Er!==null){ro=!0;var e=0,t=Ce;try{var r=Er;for(Ce=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Er=null,yl=!1}catch(s){throw Er!==null&&(Er=Er.slice(e+1)),rp(Qc,da),s}finally{Ce=t,ro=!1}}return null}var on=[],cn=0,Vi=null,Hi=0,Jt=[],Qt=0,Pa=null,Cr=1,Ar="";function ba(e,t){on[cn++]=Hi,on[cn++]=Vi,Vi=e,Hi=t}function Ip(e,t,r){Jt[Qt++]=Cr,Jt[Qt++]=Ar,Jt[Qt++]=Pa,Pa=e;var n=Cr;e=Ar;var s=32-ur(n)-1;n&=~(1<<s),r+=1;var i=32-ur(t)+s;if(30<i){var l=s-s%5;i=(n&(1<<l)-1).toString(32),n>>=l,s-=l,Cr=1<<32-ur(t)+s|r<<s|n,Ar=i+e}else Cr=1<<i|r<<s|n,Ar=e}function id(e){e.return!==null&&(ba(e,1),Ip(e,1,0))}function ld(e){for(;e===Vi;)Vi=on[--cn],on[cn]=null,Hi=on[--cn],on[cn]=null;for(;e===Pa;)Pa=Jt[--Qt],Jt[Qt]=null,Ar=Jt[--Qt],Jt[Qt]=null,Cr=Jt[--Qt],Jt[Qt]=null}var Vt=null,Gt=null,Fe=!1,cr=null;function Lp(e,t){var r=Xt(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function zu(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Vt=e,Gt=Zr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Vt=e,Gt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Pa!==null?{id:Cr,overflow:Ar}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Xt(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Vt=e,Gt=null,!0):!1;default:return!1}}function ec(e){return(e.mode&1)!==0&&(e.flags&128)===0}function tc(e){if(Fe){var t=Gt;if(t){var r=t;if(!zu(e,t)){if(ec(e))throw Error(G(418));t=Zr(r.nextSibling);var n=Vt;t&&zu(e,t)?Lp(n,r):(e.flags=e.flags&-4097|2,Fe=!1,Vt=e)}}else{if(ec(e))throw Error(G(418));e.flags=e.flags&-4097|2,Fe=!1,Vt=e}}}function qu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Vt=e}function ii(e){if(e!==Vt)return!1;if(!Fe)return qu(e),Fe=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Jo(e.type,e.memoizedProps)),t&&(t=Gt)){if(ec(e))throw Pp(),Error(G(418));for(;t;)Lp(e,t),t=Zr(t.nextSibling)}if(qu(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(G(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Gt=Zr(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Gt=null}}else Gt=Vt?Zr(e.stateNode.nextSibling):null;return!0}function Pp(){for(var e=Gt;e;)e=Zr(e.nextSibling)}function wn(){Gt=Vt=null,Fe=!1}function od(e){cr===null?cr=[e]:cr.push(e)}var tb=Or.ReactCurrentBatchConfig;function Gn(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(G(309));var n=r.stateNode}if(!n)throw Error(G(147,e));var s=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(l){var o=s.refs;l===null?delete o[i]:o[i]=l},t._stringRef=i,t)}if(typeof e!="string")throw Error(G(284));if(!r._owner)throw Error(G(290,e))}return e}function li(e,t){throw e=Object.prototype.toString.call(t),Error(G(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Gu(e){var t=e._init;return t(e._payload)}function Op(e){function t(m,x){if(e){var f=m.deletions;f===null?(m.deletions=[x],m.flags|=16):f.push(x)}}function r(m,x){if(!e)return null;for(;x!==null;)t(m,x),x=x.sibling;return null}function n(m,x){for(m=new Map;x!==null;)x.key!==null?m.set(x.key,x):m.set(x.index,x),x=x.sibling;return m}function s(m,x){return m=aa(m,x),m.index=0,m.sibling=null,m}function i(m,x,f){return m.index=f,e?(f=m.alternate,f!==null?(f=f.index,f<x?(m.flags|=2,x):f):(m.flags|=2,x)):(m.flags|=1048576,x)}function l(m){return e&&m.alternate===null&&(m.flags|=2),m}function o(m,x,f,j){return x===null||x.tag!==6?(x=co(f,m.mode,j),x.return=m,x):(x=s(x,f),x.return=m,x)}function c(m,x,f,j){var T=f.type;return T===tn?u(m,x,f.props.children,j,f.key):x!==null&&(x.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===$r&&Gu(T)===x.type)?(j=s(x,f.props),j.ref=Gn(m,x,f),j.return=m,j):(j=Ai(f.type,f.key,f.props,null,m.mode,j),j.ref=Gn(m,x,f),j.return=m,j)}function d(m,x,f,j){return x===null||x.tag!==4||x.stateNode.containerInfo!==f.containerInfo||x.stateNode.implementation!==f.implementation?(x=uo(f,m.mode,j),x.return=m,x):(x=s(x,f.children||[]),x.return=m,x)}function u(m,x,f,j,T){return x===null||x.tag!==7?(x=Ra(f,m.mode,j,T),x.return=m,x):(x=s(x,f),x.return=m,x)}function h(m,x,f){if(typeof x=="string"&&x!==""||typeof x=="number")return x=co(""+x,m.mode,f),x.return=m,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Js:return f=Ai(x.type,x.key,x.props,null,m.mode,f),f.ref=Gn(m,null,x),f.return=m,f;case en:return x=uo(x,m.mode,f),x.return=m,x;case $r:var j=x._init;return h(m,j(x._payload),f)}if(Yn(x)||Mn(x))return x=Ra(x,m.mode,f,null),x.return=m,x;li(m,x)}return null}function p(m,x,f,j){var T=x!==null?x.key:null;if(typeof f=="string"&&f!==""||typeof f=="number")return T!==null?null:o(m,x,""+f,j);if(typeof f=="object"&&f!==null){switch(f.$$typeof){case Js:return f.key===T?c(m,x,f,j):null;case en:return f.key===T?d(m,x,f,j):null;case $r:return T=f._init,p(m,x,T(f._payload),j)}if(Yn(f)||Mn(f))return T!==null?null:u(m,x,f,j,null);li(m,f)}return null}function v(m,x,f,j,T){if(typeof j=="string"&&j!==""||typeof j=="number")return m=m.get(f)||null,o(x,m,""+j,T);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Js:return m=m.get(j.key===null?f:j.key)||null,c(x,m,j,T);case en:return m=m.get(j.key===null?f:j.key)||null,d(x,m,j,T);case $r:var L=j._init;return v(m,x,f,L(j._payload),T)}if(Yn(j)||Mn(j))return m=m.get(f)||null,u(x,m,j,T,null);li(x,j)}return null}function g(m,x,f,j){for(var T=null,L=null,C=x,O=x=0,Q=null;C!==null&&O<f.length;O++){C.index>O?(Q=C,C=null):Q=C.sibling;var W=p(m,C,f[O],j);if(W===null){C===null&&(C=Q);break}e&&C&&W.alternate===null&&t(m,C),x=i(W,x,O),L===null?T=W:L.sibling=W,L=W,C=Q}if(O===f.length)return r(m,C),Fe&&ba(m,O),T;if(C===null){for(;O<f.length;O++)C=h(m,f[O],j),C!==null&&(x=i(C,x,O),L===null?T=C:L.sibling=C,L=C);return Fe&&ba(m,O),T}for(C=n(m,C);O<f.length;O++)Q=v(C,m,O,f[O],j),Q!==null&&(e&&Q.alternate!==null&&C.delete(Q.key===null?O:Q.key),x=i(Q,x,O),L===null?T=Q:L.sibling=Q,L=Q);return e&&C.forEach(function(pe){return t(m,pe)}),Fe&&ba(m,O),T}function k(m,x,f,j){var T=Mn(f);if(typeof T!="function")throw Error(G(150));if(f=T.call(f),f==null)throw Error(G(151));for(var L=T=null,C=x,O=x=0,Q=null,W=f.next();C!==null&&!W.done;O++,W=f.next()){C.index>O?(Q=C,C=null):Q=C.sibling;var pe=p(m,C,W.value,j);if(pe===null){C===null&&(C=Q);break}e&&C&&pe.alternate===null&&t(m,C),x=i(pe,x,O),L===null?T=pe:L.sibling=pe,L=pe,C=Q}if(W.done)return r(m,C),Fe&&ba(m,O),T;if(C===null){for(;!W.done;O++,W=f.next())W=h(m,W.value,j),W!==null&&(x=i(W,x,O),L===null?T=W:L.sibling=W,L=W);return Fe&&ba(m,O),T}for(C=n(m,C);!W.done;O++,W=f.next())W=v(C,m,O,W.value,j),W!==null&&(e&&W.alternate!==null&&C.delete(W.key===null?O:W.key),x=i(W,x,O),L===null?T=W:L.sibling=W,L=W);return e&&C.forEach(function(A){return t(m,A)}),Fe&&ba(m,O),T}function b(m,x,f,j){if(typeof f=="object"&&f!==null&&f.type===tn&&f.key===null&&(f=f.props.children),typeof f=="object"&&f!==null){switch(f.$$typeof){case Js:e:{for(var T=f.key,L=x;L!==null;){if(L.key===T){if(T=f.type,T===tn){if(L.tag===7){r(m,L.sibling),x=s(L,f.props.children),x.return=m,m=x;break e}}else if(L.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===$r&&Gu(T)===L.type){r(m,L.sibling),x=s(L,f.props),x.ref=Gn(m,L,f),x.return=m,m=x;break e}r(m,L);break}else t(m,L);L=L.sibling}f.type===tn?(x=Ra(f.props.children,m.mode,j,f.key),x.return=m,m=x):(j=Ai(f.type,f.key,f.props,null,m.mode,j),j.ref=Gn(m,x,f),j.return=m,m=j)}return l(m);case en:e:{for(L=f.key;x!==null;){if(x.key===L)if(x.tag===4&&x.stateNode.containerInfo===f.containerInfo&&x.stateNode.implementation===f.implementation){r(m,x.sibling),x=s(x,f.children||[]),x.return=m,m=x;break e}else{r(m,x);break}else t(m,x);x=x.sibling}x=uo(f,m.mode,j),x.return=m,m=x}return l(m);case $r:return L=f._init,b(m,x,L(f._payload),j)}if(Yn(f))return g(m,x,f,j);if(Mn(f))return k(m,x,f,j);li(m,f)}return typeof f=="string"&&f!==""||typeof f=="number"?(f=""+f,x!==null&&x.tag===6?(r(m,x.sibling),x=s(x,f),x.return=m,m=x):(r(m,x),x=co(f,m.mode,j),x.return=m,m=x),l(m)):r(m,x)}return b}var Nn=Op(!0),Up=Op(!1),Wi=ca(null),Ki=null,dn=null,cd=null;function dd(){cd=dn=Ki=null}function ud(e){var t=Wi.current;Ue(Wi),e._currentValue=t}function rc(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function bn(e,t){Ki=e,cd=dn=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Lt=!0),e.firstContext=null)}function er(e){var t=e._currentValue;if(cd!==e)if(e={context:e,memoizedValue:t,next:null},dn===null){if(Ki===null)throw Error(G(308));dn=e,Ki.dependencies={lanes:0,firstContext:e}}else dn=dn.next=e;return t}var ja=null;function hd(e){ja===null?ja=[e]:ja.push(e)}function Dp(e,t,r,n){var s=t.interleaved;return s===null?(r.next=r,hd(t)):(r.next=s.next,s.next=r),t.interleaved=r,Lr(e,n)}function Lr(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Br=!1;function pd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fp(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Tr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ea(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Ne&2){var s=n.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),n.pending=t,Lr(e,r)}return s=n.interleaved,s===null?(t.next=t,hd(n)):(t.next=s.next,s.next=t),n.interleaved=t,Lr(e,r)}function wi(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Xc(e,r)}}function Vu(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var s=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var l={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?s=i=l:i=i.next=l,r=r.next}while(r!==null);i===null?s=i=t:i=i.next=t}else s=i=t;r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Yi(e,t,r,n){var s=e.updateQueue;Br=!1;var i=s.firstBaseUpdate,l=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var c=o,d=c.next;c.next=null,l===null?i=d:l.next=d,l=c;var u=e.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==l&&(o===null?u.firstBaseUpdate=d:o.next=d,u.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;l=0,u=d=c=null,o=i;do{var p=o.lane,v=o.eventTime;if((n&p)===p){u!==null&&(u=u.next={eventTime:v,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=e,k=o;switch(p=t,v=r,k.tag){case 1:if(g=k.payload,typeof g=="function"){h=g.call(v,h,p);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=k.payload,p=typeof g=="function"?g.call(v,h,p):g,p==null)break e;h=ze({},h,p);break e;case 2:Br=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,p=s.effects,p===null?s.effects=[o]:p.push(o))}else v={eventTime:v,lane:p,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(d=u=v,c=h):u=u.next=v,l|=p;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;p=o,o=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(!0);if(u===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,t=s.shared.interleaved,t!==null){s=t;do l|=s.lane,s=s.next;while(s!==t)}else i===null&&(s.shared.lanes=0);Ua|=l,e.lanes=l,e.memoizedState=h}}function Hu(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(s!==null){if(n.callback=null,n=r,typeof s!="function")throw Error(G(191,s));s.call(n)}}}var zs={},wr=ca(zs),_s=ca(zs),ws=ca(zs);function Sa(e){if(e===zs)throw Error(G(174));return e}function fd(e,t){switch(Le(ws,t),Le(_s,e),Le(wr,zs),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Uo(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Uo(t,e)}Ue(wr),Le(wr,t)}function jn(){Ue(wr),Ue(_s),Ue(ws)}function Mp(e){Sa(ws.current);var t=Sa(wr.current),r=Uo(t,e.type);t!==r&&(Le(_s,e),Le(wr,r))}function gd(e){_s.current===e&&(Ue(wr),Ue(_s))}var $e=ca(0);function Ji(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ao=[];function md(){for(var e=0;e<ao.length;e++)ao[e]._workInProgressVersionPrimary=null;ao.length=0}var Ni=Or.ReactCurrentDispatcher,no=Or.ReactCurrentBatchConfig,Oa=0,Be=null,rt=null,st=null,Qi=!1,ns=!1,Ns=0,rb=0;function xt(){throw Error(G(321))}function xd(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!pr(e[r],t[r]))return!1;return!0}function bd(e,t,r,n,s,i){if(Oa=i,Be=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ni.current=e===null||e.memoizedState===null?ib:lb,e=r(n,s),ns){i=0;do{if(ns=!1,Ns=0,25<=i)throw Error(G(301));i+=1,st=rt=null,t.updateQueue=null,Ni.current=ob,e=r(n,s)}while(ns)}if(Ni.current=Xi,t=rt!==null&&rt.next!==null,Oa=0,st=rt=Be=null,Qi=!1,t)throw Error(G(300));return e}function yd(){var e=Ns!==0;return Ns=0,e}function vr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return st===null?Be.memoizedState=st=e:st=st.next=e,st}function tr(){if(rt===null){var e=Be.alternate;e=e!==null?e.memoizedState:null}else e=rt.next;var t=st===null?Be.memoizedState:st.next;if(t!==null)st=t,rt=e;else{if(e===null)throw Error(G(310));rt=e,e={memoizedState:rt.memoizedState,baseState:rt.baseState,baseQueue:rt.baseQueue,queue:rt.queue,next:null},st===null?Be.memoizedState=st=e:st=st.next=e}return st}function js(e,t){return typeof t=="function"?t(e):t}function so(e){var t=tr(),r=t.queue;if(r===null)throw Error(G(311));r.lastRenderedReducer=e;var n=rt,s=n.baseQueue,i=r.pending;if(i!==null){if(s!==null){var l=s.next;s.next=i.next,i.next=l}n.baseQueue=s=i,r.pending=null}if(s!==null){i=s.next,n=n.baseState;var o=l=null,c=null,d=i;do{var u=d.lane;if((Oa&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(o=c=h,l=n):c=c.next=h,Be.lanes|=u,Ua|=u}d=d.next}while(d!==null&&d!==i);c===null?l=n:c.next=o,pr(n,t.memoizedState)||(Lt=!0),t.memoizedState=n,t.baseState=l,t.baseQueue=c,r.lastRenderedState=n}if(e=r.interleaved,e!==null){s=e;do i=s.lane,Be.lanes|=i,Ua|=i,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function io(e){var t=tr(),r=t.queue;if(r===null)throw Error(G(311));r.lastRenderedReducer=e;var n=r.dispatch,s=r.pending,i=t.memoizedState;if(s!==null){r.pending=null;var l=s=s.next;do i=e(i,l.action),l=l.next;while(l!==s);pr(i,t.memoizedState)||(Lt=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function $p(){}function Bp(e,t){var r=Be,n=tr(),s=t(),i=!pr(n.memoizedState,s);if(i&&(n.memoizedState=s,Lt=!0),n=n.queue,vd(Gp.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||st!==null&&st.memoizedState.tag&1){if(r.flags|=2048,Ss(9,qp.bind(null,r,n,s,t),void 0,null),it===null)throw Error(G(349));Oa&30||zp(r,t,s)}return s}function zp(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Be.updateQueue,t===null?(t={lastEffect:null,stores:null},Be.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function qp(e,t,r,n){t.value=r,t.getSnapshot=n,Vp(t)&&Hp(e)}function Gp(e,t,r){return r(function(){Vp(t)&&Hp(e)})}function Vp(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!pr(e,r)}catch{return!0}}function Hp(e){var t=Lr(e,1);t!==null&&hr(t,e,1,-1)}function Wu(e){var t=vr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:js,lastRenderedState:e},t.queue=e,e=e.dispatch=sb.bind(null,Be,e),[t.memoizedState,e]}function Ss(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Be.updateQueue,t===null?(t={lastEffect:null,stores:null},Be.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function Wp(){return tr().memoizedState}function ji(e,t,r,n){var s=vr();Be.flags|=e,s.memoizedState=Ss(1|t,r,void 0,n===void 0?null:n)}function vl(e,t,r,n){var s=tr();n=n===void 0?null:n;var i=void 0;if(rt!==null){var l=rt.memoizedState;if(i=l.destroy,n!==null&&xd(n,l.deps)){s.memoizedState=Ss(t,r,i,n);return}}Be.flags|=e,s.memoizedState=Ss(1|t,r,i,n)}function Ku(e,t){return ji(8390656,8,e,t)}function vd(e,t){return vl(2048,8,e,t)}function Kp(e,t){return vl(4,2,e,t)}function Yp(e,t){return vl(4,4,e,t)}function Jp(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Qp(e,t,r){return r=r!=null?r.concat([e]):null,vl(4,4,Jp.bind(null,t,e),r)}function kd(){}function Xp(e,t){var r=tr();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&xd(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Zp(e,t){var r=tr();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&xd(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function ef(e,t,r){return Oa&21?(pr(r,t)||(r=sp(),Be.lanes|=r,Ua|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Lt=!0),e.memoizedState=r)}function ab(e,t){var r=Ce;Ce=r!==0&&4>r?r:4,e(!0);var n=no.transition;no.transition={};try{e(!1),t()}finally{Ce=r,no.transition=n}}function tf(){return tr().memoizedState}function nb(e,t,r){var n=ra(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},rf(e))af(t,r);else if(r=Dp(e,t,r,n),r!==null){var s=Et();hr(r,e,n,s),nf(r,t,n)}}function sb(e,t,r){var n=ra(e),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(rf(e))af(t,s);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var l=t.lastRenderedState,o=i(l,r);if(s.hasEagerState=!0,s.eagerState=o,pr(o,l)){var c=t.interleaved;c===null?(s.next=s,hd(t)):(s.next=c.next,c.next=s),t.interleaved=s;return}}catch{}finally{}r=Dp(e,t,s,n),r!==null&&(s=Et(),hr(r,e,n,s),nf(r,t,n))}}function rf(e){var t=e.alternate;return e===Be||t!==null&&t===Be}function af(e,t){ns=Qi=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function nf(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Xc(e,r)}}var Xi={readContext:er,useCallback:xt,useContext:xt,useEffect:xt,useImperativeHandle:xt,useInsertionEffect:xt,useLayoutEffect:xt,useMemo:xt,useReducer:xt,useRef:xt,useState:xt,useDebugValue:xt,useDeferredValue:xt,useTransition:xt,useMutableSource:xt,useSyncExternalStore:xt,useId:xt,unstable_isNewReconciler:!1},ib={readContext:er,useCallback:function(e,t){return vr().memoizedState=[e,t===void 0?null:t],e},useContext:er,useEffect:Ku,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,ji(4194308,4,Jp.bind(null,t,e),r)},useLayoutEffect:function(e,t){return ji(4194308,4,e,t)},useInsertionEffect:function(e,t){return ji(4,2,e,t)},useMemo:function(e,t){var r=vr();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=vr();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=nb.bind(null,Be,e),[n.memoizedState,e]},useRef:function(e){var t=vr();return e={current:e},t.memoizedState=e},useState:Wu,useDebugValue:kd,useDeferredValue:function(e){return vr().memoizedState=e},useTransition:function(){var e=Wu(!1),t=e[0];return e=ab.bind(null,e[1]),vr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Be,s=vr();if(Fe){if(r===void 0)throw Error(G(407));r=r()}else{if(r=t(),it===null)throw Error(G(349));Oa&30||zp(n,t,r)}s.memoizedState=r;var i={value:r,getSnapshot:t};return s.queue=i,Ku(Gp.bind(null,n,i,e),[e]),n.flags|=2048,Ss(9,qp.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=vr(),t=it.identifierPrefix;if(Fe){var r=Ar,n=Cr;r=(n&~(1<<32-ur(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=Ns++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=rb++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},lb={readContext:er,useCallback:Xp,useContext:er,useEffect:vd,useImperativeHandle:Qp,useInsertionEffect:Kp,useLayoutEffect:Yp,useMemo:Zp,useReducer:so,useRef:Wp,useState:function(){return so(js)},useDebugValue:kd,useDeferredValue:function(e){var t=tr();return ef(t,rt.memoizedState,e)},useTransition:function(){var e=so(js)[0],t=tr().memoizedState;return[e,t]},useMutableSource:$p,useSyncExternalStore:Bp,useId:tf,unstable_isNewReconciler:!1},ob={readContext:er,useCallback:Xp,useContext:er,useEffect:vd,useImperativeHandle:Qp,useInsertionEffect:Kp,useLayoutEffect:Yp,useMemo:Zp,useReducer:io,useRef:Wp,useState:function(){return io(js)},useDebugValue:kd,useDeferredValue:function(e){var t=tr();return rt===null?t.memoizedState=e:ef(t,rt.memoizedState,e)},useTransition:function(){var e=io(js)[0],t=tr().memoizedState;return[e,t]},useMutableSource:$p,useSyncExternalStore:Bp,useId:tf,unstable_isNewReconciler:!1};function sr(e,t){if(e&&e.defaultProps){t=ze({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function ac(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:ze({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var kl={isMounted:function(e){return(e=e._reactInternals)?$a(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Et(),s=ra(e),i=Tr(n,s);i.payload=t,r!=null&&(i.callback=r),t=ea(e,i,s),t!==null&&(hr(t,e,s,n),wi(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Et(),s=ra(e),i=Tr(n,s);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=ea(e,i,s),t!==null&&(hr(t,e,s,n),wi(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Et(),n=ra(e),s=Tr(r,n);s.tag=2,t!=null&&(s.callback=t),t=ea(e,s,n),t!==null&&(hr(t,e,n,r),wi(t,e,n))}};function Yu(e,t,r,n,s,i,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,l):t.prototype&&t.prototype.isPureReactComponent?!bs(r,n)||!bs(s,i):!0}function sf(e,t,r){var n=!1,s=la,i=t.contextType;return typeof i=="object"&&i!==null?i=er(i):(s=Ot(t)?La:_t.current,n=t.contextTypes,i=(n=n!=null)?_n(e,s):la),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=kl,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=i),t}function Ju(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&kl.enqueueReplaceState(t,t.state,null)}function nc(e,t,r,n){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs={},pd(e);var i=t.contextType;typeof i=="object"&&i!==null?s.context=er(i):(i=Ot(t)?La:_t.current,s.context=_n(e,i)),s.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(ac(e,t,i,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&kl.enqueueReplaceState(s,s.state,null),Yi(e,r,s,n),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function Sn(e,t){try{var r="",n=t;do r+=Um(n),n=n.return;while(n);var s=r}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:s,digest:null}}function lo(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function sc(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var cb=typeof WeakMap=="function"?WeakMap:Map;function lf(e,t,r){r=Tr(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){el||(el=!0,gc=n),sc(e,t)},r}function of(e,t,r){r=Tr(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var s=t.value;r.payload=function(){return n(s)},r.callback=function(){sc(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){sc(e,t),typeof n!="function"&&(ta===null?ta=new Set([this]):ta.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),r}function Qu(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new cb;var s=new Set;n.set(t,s)}else s=n.get(t),s===void 0&&(s=new Set,n.set(t,s));s.has(r)||(s.add(r),e=wb.bind(null,e,t,r),t.then(e,e))}function Xu(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Zu(e,t,r,n,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Tr(-1,1),t.tag=2,ea(r,t,1))),r.lanes|=1),e)}var db=Or.ReactCurrentOwner,Lt=!1;function St(e,t,r,n){t.child=e===null?Up(t,null,r,n):Nn(t,e.child,r,n)}function eh(e,t,r,n,s){r=r.render;var i=t.ref;return bn(t,s),n=bd(e,t,r,n,i,s),r=yd(),e!==null&&!Lt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Pr(e,t,s)):(Fe&&r&&id(t),t.flags|=1,St(e,t,n,s),t.child)}function th(e,t,r,n,s){if(e===null){var i=r.type;return typeof i=="function"&&!Ad(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,cf(e,t,i,n,s)):(e=Ai(r.type,null,n,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&s)){var l=i.memoizedProps;if(r=r.compare,r=r!==null?r:bs,r(l,n)&&e.ref===t.ref)return Pr(e,t,s)}return t.flags|=1,e=aa(i,n),e.ref=t.ref,e.return=t,t.child=e}function cf(e,t,r,n,s){if(e!==null){var i=e.memoizedProps;if(bs(i,n)&&e.ref===t.ref)if(Lt=!1,t.pendingProps=n=i,(e.lanes&s)!==0)e.flags&131072&&(Lt=!0);else return t.lanes=e.lanes,Pr(e,t,s)}return ic(e,t,r,n,s)}function df(e,t,r){var n=t.pendingProps,s=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Le(hn,Bt),Bt|=r;else{if(!(r&1073741824))return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Le(hn,Bt),Bt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,Le(hn,Bt),Bt|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,Le(hn,Bt),Bt|=n;return St(e,t,s,r),t.child}function uf(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function ic(e,t,r,n,s){var i=Ot(r)?La:_t.current;return i=_n(t,i),bn(t,s),r=bd(e,t,r,n,i,s),n=yd(),e!==null&&!Lt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Pr(e,t,s)):(Fe&&n&&id(t),t.flags|=1,St(e,t,r,s),t.child)}function rh(e,t,r,n,s){if(Ot(r)){var i=!0;Gi(t)}else i=!1;if(bn(t,s),t.stateNode===null)Si(e,t),sf(t,r,n),nc(t,r,n,s),n=!0;else if(e===null){var l=t.stateNode,o=t.memoizedProps;l.props=o;var c=l.context,d=r.contextType;typeof d=="object"&&d!==null?d=er(d):(d=Ot(r)?La:_t.current,d=_n(t,d));var u=r.getDerivedStateFromProps,h=typeof u=="function"||typeof l.getSnapshotBeforeUpdate=="function";h||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==n||c!==d)&&Ju(t,l,n,d),Br=!1;var p=t.memoizedState;l.state=p,Yi(t,n,l,s),c=t.memoizedState,o!==n||p!==c||Pt.current||Br?(typeof u=="function"&&(ac(t,r,u,n),c=t.memoizedState),(o=Br||Yu(t,r,o,n,p,c,d))?(h||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),l.props=n,l.state=c,l.context=d,n=o):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{l=t.stateNode,Fp(e,t),o=t.memoizedProps,d=t.type===t.elementType?o:sr(t.type,o),l.props=d,h=t.pendingProps,p=l.context,c=r.contextType,typeof c=="object"&&c!==null?c=er(c):(c=Ot(r)?La:_t.current,c=_n(t,c));var v=r.getDerivedStateFromProps;(u=typeof v=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==h||p!==c)&&Ju(t,l,n,c),Br=!1,p=t.memoizedState,l.state=p,Yi(t,n,l,s);var g=t.memoizedState;o!==h||p!==g||Pt.current||Br?(typeof v=="function"&&(ac(t,r,v,n),g=t.memoizedState),(d=Br||Yu(t,r,d,n,p,g,c)||!1)?(u||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(n,g,c),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(n,g,c)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=g),l.props=n,l.state=g,l.context=c,n=d):(typeof l.componentDidUpdate!="function"||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),n=!1)}return lc(e,t,r,n,i,s)}function lc(e,t,r,n,s,i){uf(e,t);var l=(t.flags&128)!==0;if(!n&&!l)return s&&Bu(t,r,!1),Pr(e,t,i);n=t.stateNode,db.current=t;var o=l&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&l?(t.child=Nn(t,e.child,null,i),t.child=Nn(t,null,o,i)):St(e,t,o,i),t.memoizedState=n.state,s&&Bu(t,r,!0),t.child}function hf(e){var t=e.stateNode;t.pendingContext?$u(e,t.pendingContext,t.pendingContext!==t.context):t.context&&$u(e,t.context,!1),fd(e,t.containerInfo)}function ah(e,t,r,n,s){return wn(),od(s),t.flags|=256,St(e,t,r,n),t.child}var oc={dehydrated:null,treeContext:null,retryLane:0};function cc(e){return{baseLanes:e,cachePool:null,transitions:null}}function pf(e,t,r){var n=t.pendingProps,s=$e.current,i=!1,l=(t.flags&128)!==0,o;if((o=l)||(o=e!==null&&e.memoizedState===null?!1:(s&2)!==0),o?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),Le($e,s&1),e===null)return tc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=n.children,e=n.fallback,i?(n=t.mode,i=t.child,l={mode:"hidden",children:l},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=l):i=Nl(l,n,0,null),e=Ra(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=cc(r),t.memoizedState=oc,e):_d(t,l));if(s=e.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return ub(e,t,l,n,o,s,r);if(i){i=n.fallback,l=t.mode,s=e.child,o=s.sibling;var c={mode:"hidden",children:n.children};return!(l&1)&&t.child!==s?(n=t.child,n.childLanes=0,n.pendingProps=c,t.deletions=null):(n=aa(s,c),n.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=aa(o,i):(i=Ra(i,l,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,l=e.child.memoizedState,l=l===null?cc(r):{baseLanes:l.baseLanes|r,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=e.childLanes&~r,t.memoizedState=oc,n}return i=e.child,e=i.sibling,n=aa(i,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function _d(e,t){return t=Nl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function oi(e,t,r,n){return n!==null&&od(n),Nn(t,e.child,null,r),e=_d(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function ub(e,t,r,n,s,i,l){if(r)return t.flags&256?(t.flags&=-257,n=lo(Error(G(422))),oi(e,t,l,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,s=t.mode,n=Nl({mode:"visible",children:n.children},s,0,null),i=Ra(i,s,l,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,t.mode&1&&Nn(t,e.child,null,l),t.child.memoizedState=cc(l),t.memoizedState=oc,i);if(!(t.mode&1))return oi(e,t,l,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var o=n.dgst;return n=o,i=Error(G(419)),n=lo(i,n,void 0),oi(e,t,l,n)}if(o=(l&e.childLanes)!==0,Lt||o){if(n=it,n!==null){switch(l&-l){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|l)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Lr(e,s),hr(n,e,s,-1))}return Cd(),n=lo(Error(G(421))),oi(e,t,l,n)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=Nb.bind(null,e),s._reactRetry=t,null):(e=i.treeContext,Gt=Zr(s.nextSibling),Vt=t,Fe=!0,cr=null,e!==null&&(Jt[Qt++]=Cr,Jt[Qt++]=Ar,Jt[Qt++]=Pa,Cr=e.id,Ar=e.overflow,Pa=t),t=_d(t,n.children),t.flags|=4096,t)}function nh(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),rc(e.return,t,r)}function oo(e,t,r,n,s){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=s)}function ff(e,t,r){var n=t.pendingProps,s=n.revealOrder,i=n.tail;if(St(e,t,n.children,r),n=$e.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&nh(e,r,t);else if(e.tag===19)nh(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Le($e,n),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&Ji(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),oo(t,!1,s,r,i);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&Ji(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}oo(t,!0,r,null,i);break;case"together":oo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Si(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Pr(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Ua|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(G(153));if(t.child!==null){for(e=t.child,r=aa(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=aa(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function hb(e,t,r){switch(t.tag){case 3:hf(t),wn();break;case 5:Mp(t);break;case 1:Ot(t.type)&&Gi(t);break;case 4:fd(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;Le(Wi,n._currentValue),n._currentValue=s;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Le($e,$e.current&1),t.flags|=128,null):r&t.child.childLanes?pf(e,t,r):(Le($e,$e.current&1),e=Pr(e,t,r),e!==null?e.sibling:null);Le($e,$e.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return ff(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Le($e,$e.current),n)break;return null;case 22:case 23:return t.lanes=0,df(e,t,r)}return Pr(e,t,r)}var gf,dc,mf,xf;gf=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};dc=function(){};mf=function(e,t,r,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,Sa(wr.current);var i=null;switch(r){case"input":s=Io(e,s),n=Io(e,n),i=[];break;case"select":s=ze({},s,{value:void 0}),n=ze({},n,{value:void 0}),i=[];break;case"textarea":s=Oo(e,s),n=Oo(e,n),i=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=zi)}Do(r,n);var l;r=null;for(d in s)if(!n.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var o=s[d];for(l in o)o.hasOwnProperty(l)&&(r||(r={}),r[l]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(us.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in n){var c=n[d];if(o=s!=null?s[d]:void 0,n.hasOwnProperty(d)&&c!==o&&(c!=null||o!=null))if(d==="style")if(o){for(l in o)!o.hasOwnProperty(l)||c&&c.hasOwnProperty(l)||(r||(r={}),r[l]="");for(l in c)c.hasOwnProperty(l)&&o[l]!==c[l]&&(r||(r={}),r[l]=c[l])}else r||(i||(i=[]),i.push(d,r)),r=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,o=o?o.__html:void 0,c!=null&&o!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(us.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Oe("scroll",e),i||o===c||(i=[])):(i=i||[]).push(d,c))}r&&(i=i||[]).push("style",r);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};xf=function(e,t,r,n){r!==n&&(t.flags|=4)};function Vn(e,t){if(!Fe)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function bt(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function pb(e,t,r){var n=t.pendingProps;switch(ld(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bt(t),null;case 1:return Ot(t.type)&&qi(),bt(t),null;case 3:return n=t.stateNode,jn(),Ue(Pt),Ue(_t),md(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(ii(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,cr!==null&&(bc(cr),cr=null))),dc(e,t),bt(t),null;case 5:gd(t);var s=Sa(ws.current);if(r=t.type,e!==null&&t.stateNode!=null)mf(e,t,r,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(G(166));return bt(t),null}if(e=Sa(wr.current),ii(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[kr]=t,n[ks]=i,e=(t.mode&1)!==0,r){case"dialog":Oe("cancel",n),Oe("close",n);break;case"iframe":case"object":case"embed":Oe("load",n);break;case"video":case"audio":for(s=0;s<Qn.length;s++)Oe(Qn[s],n);break;case"source":Oe("error",n);break;case"img":case"image":case"link":Oe("error",n),Oe("load",n);break;case"details":Oe("toggle",n);break;case"input":pu(n,i),Oe("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Oe("invalid",n);break;case"textarea":gu(n,i),Oe("invalid",n)}Do(r,i),s=null;for(var l in i)if(i.hasOwnProperty(l)){var o=i[l];l==="children"?typeof o=="string"?n.textContent!==o&&(i.suppressHydrationWarning!==!0&&si(n.textContent,o,e),s=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&si(n.textContent,o,e),s=["children",""+o]):us.hasOwnProperty(l)&&o!=null&&l==="onScroll"&&Oe("scroll",n)}switch(r){case"input":Qs(n),fu(n,i,!0);break;case"textarea":Qs(n),mu(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=zi)}n=s,t.updateQueue=n,n!==null&&(t.flags|=4)}else{l=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=G0(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=l.createElement(r,{is:n.is}):(e=l.createElement(r),r==="select"&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,r),e[kr]=t,e[ks]=n,gf(e,t,!1,!1),t.stateNode=e;e:{switch(l=Fo(r,n),r){case"dialog":Oe("cancel",e),Oe("close",e),s=n;break;case"iframe":case"object":case"embed":Oe("load",e),s=n;break;case"video":case"audio":for(s=0;s<Qn.length;s++)Oe(Qn[s],e);s=n;break;case"source":Oe("error",e),s=n;break;case"img":case"image":case"link":Oe("error",e),Oe("load",e),s=n;break;case"details":Oe("toggle",e),s=n;break;case"input":pu(e,n),s=Io(e,n),Oe("invalid",e);break;case"option":s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=ze({},n,{value:void 0}),Oe("invalid",e);break;case"textarea":gu(e,n),s=Oo(e,n),Oe("invalid",e);break;default:s=n}Do(r,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var c=o[i];i==="style"?W0(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&V0(e,c)):i==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&hs(e,c):typeof c=="number"&&hs(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(us.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Oe("scroll",e):c!=null&&Hc(e,i,c,l))}switch(r){case"input":Qs(e),fu(e,n,!1);break;case"textarea":Qs(e),mu(e);break;case"option":n.value!=null&&e.setAttribute("value",""+ia(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?fn(e,!!n.multiple,i,!1):n.defaultValue!=null&&fn(e,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=zi)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return bt(t),null;case 6:if(e&&t.stateNode!=null)xf(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(G(166));if(r=Sa(ws.current),Sa(wr.current),ii(t)){if(n=t.stateNode,r=t.memoizedProps,n[kr]=t,(i=n.nodeValue!==r)&&(e=Vt,e!==null))switch(e.tag){case 3:si(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&si(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[kr]=t,t.stateNode=n}return bt(t),null;case 13:if(Ue($e),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Fe&&Gt!==null&&t.mode&1&&!(t.flags&128))Pp(),wn(),t.flags|=98560,i=!1;else if(i=ii(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(G(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(G(317));i[kr]=t}else wn(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;bt(t),i=!1}else cr!==null&&(bc(cr),cr=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||$e.current&1?at===0&&(at=3):Cd())),t.updateQueue!==null&&(t.flags|=4),bt(t),null);case 4:return jn(),dc(e,t),e===null&&ys(t.stateNode.containerInfo),bt(t),null;case 10:return ud(t.type._context),bt(t),null;case 17:return Ot(t.type)&&qi(),bt(t),null;case 19:if(Ue($e),i=t.memoizedState,i===null)return bt(t),null;if(n=(t.flags&128)!==0,l=i.rendering,l===null)if(n)Vn(i,!1);else{if(at!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=Ji(e),l!==null){for(t.flags|=128,Vn(i,!1),n=l.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,l=i.alternate,l===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,e=l.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Le($e,$e.current&1|2),t.child}e=e.sibling}i.tail!==null&&Je()>En&&(t.flags|=128,n=!0,Vn(i,!1),t.lanes=4194304)}else{if(!n)if(e=Ji(l),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Vn(i,!0),i.tail===null&&i.tailMode==="hidden"&&!l.alternate&&!Fe)return bt(t),null}else 2*Je()-i.renderingStartTime>En&&r!==1073741824&&(t.flags|=128,n=!0,Vn(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(r=i.last,r!==null?r.sibling=l:t.child=l,i.last=l)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Je(),t.sibling=null,r=$e.current,Le($e,n?r&1|2:r&1),t):(bt(t),null);case 22:case 23:return Ed(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Bt&1073741824&&(bt(t),t.subtreeFlags&6&&(t.flags|=8192)):bt(t),null;case 24:return null;case 25:return null}throw Error(G(156,t.tag))}function fb(e,t){switch(ld(t),t.tag){case 1:return Ot(t.type)&&qi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return jn(),Ue(Pt),Ue(_t),md(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return gd(t),null;case 13:if(Ue($e),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(G(340));wn()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ue($e),null;case 4:return jn(),null;case 10:return ud(t.type._context),null;case 22:case 23:return Ed(),null;case 24:return null;default:return null}}var ci=!1,vt=!1,gb=typeof WeakSet=="function"?WeakSet:Set,Z=null;function un(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){We(e,t,n)}else r.current=null}function uc(e,t,r){try{r()}catch(n){We(e,t,n)}}var sh=!1;function mb(e,t){if(Ko=Mi,e=kp(),sd(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var s=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var l=0,o=-1,c=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var v;h!==r||s!==0&&h.nodeType!==3||(o=l+s),h!==i||n!==0&&h.nodeType!==3||(c=l+n),h.nodeType===3&&(l+=h.nodeValue.length),(v=h.firstChild)!==null;)p=h,h=v;for(;;){if(h===e)break t;if(p===r&&++d===s&&(o=l),p===i&&++u===n&&(c=l),(v=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=v}r=o===-1||c===-1?null:{start:o,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(Yo={focusedElem:e,selectionRange:r},Mi=!1,Z=t;Z!==null;)if(t=Z,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Z=e;else for(;Z!==null;){t=Z;try{var g=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var k=g.memoizedProps,b=g.memoizedState,m=t.stateNode,x=m.getSnapshotBeforeUpdate(t.elementType===t.type?k:sr(t.type,k),b);m.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var f=t.stateNode.containerInfo;f.nodeType===1?f.textContent="":f.nodeType===9&&f.documentElement&&f.removeChild(f.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(G(163))}}catch(j){We(t,t.return,j)}if(e=t.sibling,e!==null){e.return=t.return,Z=e;break}Z=t.return}return g=sh,sh=!1,g}function ss(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&e)===e){var i=s.destroy;s.destroy=void 0,i!==void 0&&uc(t,r,i)}s=s.next}while(s!==n)}}function _l(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function hc(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function bf(e){var t=e.alternate;t!==null&&(e.alternate=null,bf(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[kr],delete t[ks],delete t[Xo],delete t[Xx],delete t[Zx])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function yf(e){return e.tag===5||e.tag===3||e.tag===4}function ih(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||yf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function pc(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=zi));else if(n!==4&&(e=e.child,e!==null))for(pc(e,t,r),e=e.sibling;e!==null;)pc(e,t,r),e=e.sibling}function fc(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(fc(e,t,r),e=e.sibling;e!==null;)fc(e,t,r),e=e.sibling}var ut=null,lr=!1;function Mr(e,t,r){for(r=r.child;r!==null;)vf(e,t,r),r=r.sibling}function vf(e,t,r){if(_r&&typeof _r.onCommitFiberUnmount=="function")try{_r.onCommitFiberUnmount(fl,r)}catch{}switch(r.tag){case 5:vt||un(r,t);case 6:var n=ut,s=lr;ut=null,Mr(e,t,r),ut=n,lr=s,ut!==null&&(lr?(e=ut,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):ut.removeChild(r.stateNode));break;case 18:ut!==null&&(lr?(e=ut,r=r.stateNode,e.nodeType===8?to(e.parentNode,r):e.nodeType===1&&to(e,r),ms(e)):to(ut,r.stateNode));break;case 4:n=ut,s=lr,ut=r.stateNode.containerInfo,lr=!0,Mr(e,t,r),ut=n,lr=s;break;case 0:case 11:case 14:case 15:if(!vt&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var i=s,l=i.destroy;i=i.tag,l!==void 0&&(i&2||i&4)&&uc(r,t,l),s=s.next}while(s!==n)}Mr(e,t,r);break;case 1:if(!vt&&(un(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(o){We(r,t,o)}Mr(e,t,r);break;case 21:Mr(e,t,r);break;case 22:r.mode&1?(vt=(n=vt)||r.memoizedState!==null,Mr(e,t,r),vt=n):Mr(e,t,r);break;default:Mr(e,t,r)}}function lh(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new gb),t.forEach(function(n){var s=jb.bind(null,e,n);r.has(n)||(r.add(n),n.then(s,s))})}}function rr(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var s=r[n];try{var i=e,l=t,o=l;e:for(;o!==null;){switch(o.tag){case 5:ut=o.stateNode,lr=!1;break e;case 3:ut=o.stateNode.containerInfo,lr=!0;break e;case 4:ut=o.stateNode.containerInfo,lr=!0;break e}o=o.return}if(ut===null)throw Error(G(160));vf(i,l,s),ut=null,lr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){We(s,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)kf(t,e),t=t.sibling}function kf(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(rr(t,e),br(e),n&4){try{ss(3,e,e.return),_l(3,e)}catch(k){We(e,e.return,k)}try{ss(5,e,e.return)}catch(k){We(e,e.return,k)}}break;case 1:rr(t,e),br(e),n&512&&r!==null&&un(r,r.return);break;case 5:if(rr(t,e),br(e),n&512&&r!==null&&un(r,r.return),e.flags&32){var s=e.stateNode;try{hs(s,"")}catch(k){We(e,e.return,k)}}if(n&4&&(s=e.stateNode,s!=null)){var i=e.memoizedProps,l=r!==null?r.memoizedProps:i,o=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&z0(s,i),Fo(o,l);var d=Fo(o,i);for(l=0;l<c.length;l+=2){var u=c[l],h=c[l+1];u==="style"?W0(s,h):u==="dangerouslySetInnerHTML"?V0(s,h):u==="children"?hs(s,h):Hc(s,u,h,d)}switch(o){case"input":Lo(s,i);break;case"textarea":q0(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var v=i.value;v!=null?fn(s,!!i.multiple,v,!1):p!==!!i.multiple&&(i.defaultValue!=null?fn(s,!!i.multiple,i.defaultValue,!0):fn(s,!!i.multiple,i.multiple?[]:"",!1))}s[ks]=i}catch(k){We(e,e.return,k)}}break;case 6:if(rr(t,e),br(e),n&4){if(e.stateNode===null)throw Error(G(162));s=e.stateNode,i=e.memoizedProps;try{s.nodeValue=i}catch(k){We(e,e.return,k)}}break;case 3:if(rr(t,e),br(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{ms(t.containerInfo)}catch(k){We(e,e.return,k)}break;case 4:rr(t,e),br(e);break;case 13:rr(t,e),br(e),s=e.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(jd=Je())),n&4&&lh(e);break;case 22:if(u=r!==null&&r.memoizedState!==null,e.mode&1?(vt=(d=vt)||u,rr(t,e),vt=d):rr(t,e),br(e),n&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(Z=e,u=e.child;u!==null;){for(h=Z=u;Z!==null;){switch(p=Z,v=p.child,p.tag){case 0:case 11:case 14:case 15:ss(4,p,p.return);break;case 1:un(p,p.return);var g=p.stateNode;if(typeof g.componentWillUnmount=="function"){n=p,r=p.return;try{t=n,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(k){We(n,r,k)}}break;case 5:un(p,p.return);break;case 22:if(p.memoizedState!==null){ch(h);continue}}v!==null?(v.return=p,Z=v):ch(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=h.stateNode,c=h.memoizedProps.style,l=c!=null&&c.hasOwnProperty("display")?c.display:null,o.style.display=H0("display",l))}catch(k){We(e,e.return,k)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(k){We(e,e.return,k)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:rr(t,e),br(e),n&4&&lh(e);break;case 21:break;default:rr(t,e),br(e)}}function br(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(yf(r)){var n=r;break e}r=r.return}throw Error(G(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(hs(s,""),n.flags&=-33);var i=ih(e);fc(e,i,s);break;case 3:case 4:var l=n.stateNode.containerInfo,o=ih(e);pc(e,o,l);break;default:throw Error(G(161))}}catch(c){We(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function xb(e,t,r){Z=e,_f(e)}function _f(e,t,r){for(var n=(e.mode&1)!==0;Z!==null;){var s=Z,i=s.child;if(s.tag===22&&n){var l=s.memoizedState!==null||ci;if(!l){var o=s.alternate,c=o!==null&&o.memoizedState!==null||vt;o=ci;var d=vt;if(ci=l,(vt=c)&&!d)for(Z=s;Z!==null;)l=Z,c=l.child,l.tag===22&&l.memoizedState!==null?dh(s):c!==null?(c.return=l,Z=c):dh(s);for(;i!==null;)Z=i,_f(i),i=i.sibling;Z=s,ci=o,vt=d}oh(e)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Z=i):oh(e)}}function oh(e){for(;Z!==null;){var t=Z;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:vt||_l(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!vt)if(r===null)n.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:sr(t.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&Hu(t,i,n);break;case 3:var l=t.updateQueue;if(l!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}Hu(t,l,r)}break;case 5:var o=t.stateNode;if(r===null&&t.flags&4){r=o;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&ms(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(G(163))}vt||t.flags&512&&hc(t)}catch(p){We(t,t.return,p)}}if(t===e){Z=null;break}if(r=t.sibling,r!==null){r.return=t.return,Z=r;break}Z=t.return}}function ch(e){for(;Z!==null;){var t=Z;if(t===e){Z=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Z=r;break}Z=t.return}}function dh(e){for(;Z!==null;){var t=Z;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{_l(4,t)}catch(c){We(t,r,c)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var s=t.return;try{n.componentDidMount()}catch(c){We(t,s,c)}}var i=t.return;try{hc(t)}catch(c){We(t,i,c)}break;case 5:var l=t.return;try{hc(t)}catch(c){We(t,l,c)}}}catch(c){We(t,t.return,c)}if(t===e){Z=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Z=o;break}Z=t.return}}var bb=Math.ceil,Zi=Or.ReactCurrentDispatcher,wd=Or.ReactCurrentOwner,Zt=Or.ReactCurrentBatchConfig,Ne=0,it=null,Ze=null,pt=0,Bt=0,hn=ca(0),at=0,Es=null,Ua=0,wl=0,Nd=0,is=null,It=null,jd=0,En=1/0,jr=null,el=!1,gc=null,ta=null,di=!1,Wr=null,tl=0,ls=0,mc=null,Ei=-1,Ci=0;function Et(){return Ne&6?Je():Ei!==-1?Ei:Ei=Je()}function ra(e){return e.mode&1?Ne&2&&pt!==0?pt&-pt:tb.transition!==null?(Ci===0&&(Ci=sp()),Ci):(e=Ce,e!==0||(e=window.event,e=e===void 0?16:hp(e.type)),e):1}function hr(e,t,r,n){if(50<ls)throw ls=0,mc=null,Error(G(185));Ms(e,r,n),(!(Ne&2)||e!==it)&&(e===it&&(!(Ne&2)&&(wl|=r),at===4&&Gr(e,pt)),Ut(e,n),r===1&&Ne===0&&!(t.mode&1)&&(En=Je()+500,yl&&da()))}function Ut(e,t){var r=e.callbackNode;tx(e,t);var n=Fi(e,e===it?pt:0);if(n===0)r!==null&&yu(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&yu(r),t===1)e.tag===0?eb(uh.bind(null,e)):Rp(uh.bind(null,e)),Jx(function(){!(Ne&6)&&da()}),r=null;else{switch(ip(n)){case 1:r=Qc;break;case 4:r=ap;break;case 16:r=Di;break;case 536870912:r=np;break;default:r=Di}r=Tf(r,wf.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function wf(e,t){if(Ei=-1,Ci=0,Ne&6)throw Error(G(327));var r=e.callbackNode;if(yn()&&e.callbackNode!==r)return null;var n=Fi(e,e===it?pt:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=rl(e,n);else{t=n;var s=Ne;Ne|=2;var i=jf();(it!==e||pt!==t)&&(jr=null,En=Je()+500,Ta(e,t));do try{kb();break}catch(o){Nf(e,o)}while(!0);dd(),Zi.current=i,Ne=s,Ze!==null?t=0:(it=null,pt=0,t=at)}if(t!==0){if(t===2&&(s=qo(e),s!==0&&(n=s,t=xc(e,s))),t===1)throw r=Es,Ta(e,0),Gr(e,n),Ut(e,Je()),r;if(t===6)Gr(e,n);else{if(s=e.current.alternate,!(n&30)&&!yb(s)&&(t=rl(e,n),t===2&&(i=qo(e),i!==0&&(n=i,t=xc(e,i))),t===1))throw r=Es,Ta(e,0),Gr(e,n),Ut(e,Je()),r;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(G(345));case 2:ya(e,It,jr);break;case 3:if(Gr(e,n),(n&130023424)===n&&(t=jd+500-Je(),10<t)){if(Fi(e,0)!==0)break;if(s=e.suspendedLanes,(s&n)!==n){Et(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=Qo(ya.bind(null,e,It,jr),t);break}ya(e,It,jr);break;case 4:if(Gr(e,n),(n&4194240)===n)break;for(t=e.eventTimes,s=-1;0<n;){var l=31-ur(n);i=1<<l,l=t[l],l>s&&(s=l),n&=~i}if(n=s,n=Je()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*bb(n/1960))-n,10<n){e.timeoutHandle=Qo(ya.bind(null,e,It,jr),n);break}ya(e,It,jr);break;case 5:ya(e,It,jr);break;default:throw Error(G(329))}}}return Ut(e,Je()),e.callbackNode===r?wf.bind(null,e):null}function xc(e,t){var r=is;return e.current.memoizedState.isDehydrated&&(Ta(e,t).flags|=256),e=rl(e,t),e!==2&&(t=It,It=r,t!==null&&bc(t)),e}function bc(e){It===null?It=e:It.push.apply(It,e)}function yb(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var s=r[n],i=s.getSnapshot;s=s.value;try{if(!pr(i(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Gr(e,t){for(t&=~Nd,t&=~wl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-ur(t),n=1<<r;e[r]=-1,t&=~n}}function uh(e){if(Ne&6)throw Error(G(327));yn();var t=Fi(e,0);if(!(t&1))return Ut(e,Je()),null;var r=rl(e,t);if(e.tag!==0&&r===2){var n=qo(e);n!==0&&(t=n,r=xc(e,n))}if(r===1)throw r=Es,Ta(e,0),Gr(e,t),Ut(e,Je()),r;if(r===6)throw Error(G(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ya(e,It,jr),Ut(e,Je()),null}function Sd(e,t){var r=Ne;Ne|=1;try{return e(t)}finally{Ne=r,Ne===0&&(En=Je()+500,yl&&da())}}function Da(e){Wr!==null&&Wr.tag===0&&!(Ne&6)&&yn();var t=Ne;Ne|=1;var r=Zt.transition,n=Ce;try{if(Zt.transition=null,Ce=1,e)return e()}finally{Ce=n,Zt.transition=r,Ne=t,!(Ne&6)&&da()}}function Ed(){Bt=hn.current,Ue(hn)}function Ta(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Yx(r)),Ze!==null)for(r=Ze.return;r!==null;){var n=r;switch(ld(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&qi();break;case 3:jn(),Ue(Pt),Ue(_t),md();break;case 5:gd(n);break;case 4:jn();break;case 13:Ue($e);break;case 19:Ue($e);break;case 10:ud(n.type._context);break;case 22:case 23:Ed()}r=r.return}if(it=e,Ze=e=aa(e.current,null),pt=Bt=t,at=0,Es=null,Nd=wl=Ua=0,It=is=null,ja!==null){for(t=0;t<ja.length;t++)if(r=ja[t],n=r.interleaved,n!==null){r.interleaved=null;var s=n.next,i=r.pending;if(i!==null){var l=i.next;i.next=s,n.next=l}r.pending=n}ja=null}return e}function Nf(e,t){do{var r=Ze;try{if(dd(),Ni.current=Xi,Qi){for(var n=Be.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}Qi=!1}if(Oa=0,st=rt=Be=null,ns=!1,Ns=0,wd.current=null,r===null||r.return===null){at=1,Es=t,Ze=null;break}e:{var i=e,l=r.return,o=r,c=t;if(t=pt,o.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=o,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var v=Xu(l);if(v!==null){v.flags&=-257,Zu(v,l,o,i,t),v.mode&1&&Qu(i,d,t),t=v,c=d;var g=t.updateQueue;if(g===null){var k=new Set;k.add(c),t.updateQueue=k}else g.add(c);break e}else{if(!(t&1)){Qu(i,d,t),Cd();break e}c=Error(G(426))}}else if(Fe&&o.mode&1){var b=Xu(l);if(b!==null){!(b.flags&65536)&&(b.flags|=256),Zu(b,l,o,i,t),od(Sn(c,o));break e}}i=c=Sn(c,o),at!==4&&(at=2),is===null?is=[i]:is.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var m=lf(i,c,t);Vu(i,m);break e;case 1:o=c;var x=i.type,f=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||f!==null&&typeof f.componentDidCatch=="function"&&(ta===null||!ta.has(f)))){i.flags|=65536,t&=-t,i.lanes|=t;var j=of(i,o,t);Vu(i,j);break e}}i=i.return}while(i!==null)}Ef(r)}catch(T){t=T,Ze===r&&r!==null&&(Ze=r=r.return);continue}break}while(!0)}function jf(){var e=Zi.current;return Zi.current=Xi,e===null?Xi:e}function Cd(){(at===0||at===3||at===2)&&(at=4),it===null||!(Ua&268435455)&&!(wl&268435455)||Gr(it,pt)}function rl(e,t){var r=Ne;Ne|=2;var n=jf();(it!==e||pt!==t)&&(jr=null,Ta(e,t));do try{vb();break}catch(s){Nf(e,s)}while(!0);if(dd(),Ne=r,Zi.current=n,Ze!==null)throw Error(G(261));return it=null,pt=0,at}function vb(){for(;Ze!==null;)Sf(Ze)}function kb(){for(;Ze!==null&&!Hm();)Sf(Ze)}function Sf(e){var t=Af(e.alternate,e,Bt);e.memoizedProps=e.pendingProps,t===null?Ef(e):Ze=t,wd.current=null}function Ef(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=fb(r,t),r!==null){r.flags&=32767,Ze=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{at=6,Ze=null;return}}else if(r=pb(r,t,Bt),r!==null){Ze=r;return}if(t=t.sibling,t!==null){Ze=t;return}Ze=t=e}while(t!==null);at===0&&(at=5)}function ya(e,t,r){var n=Ce,s=Zt.transition;try{Zt.transition=null,Ce=1,_b(e,t,r,n)}finally{Zt.transition=s,Ce=n}return null}function _b(e,t,r,n){do yn();while(Wr!==null);if(Ne&6)throw Error(G(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(G(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(rx(e,i),e===it&&(Ze=it=null,pt=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||di||(di=!0,Tf(Di,function(){return yn(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=Zt.transition,Zt.transition=null;var l=Ce;Ce=1;var o=Ne;Ne|=4,wd.current=null,mb(e,r),kf(r,e),zx(Yo),Mi=!!Ko,Yo=Ko=null,e.current=r,xb(r),Wm(),Ne=o,Ce=l,Zt.transition=i}else e.current=r;if(di&&(di=!1,Wr=e,tl=s),i=e.pendingLanes,i===0&&(ta=null),Jm(r.stateNode),Ut(e,Je()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],n(s.value,{componentStack:s.stack,digest:s.digest});if(el)throw el=!1,e=gc,gc=null,e;return tl&1&&e.tag!==0&&yn(),i=e.pendingLanes,i&1?e===mc?ls++:(ls=0,mc=e):ls=0,da(),null}function yn(){if(Wr!==null){var e=ip(tl),t=Zt.transition,r=Ce;try{if(Zt.transition=null,Ce=16>e?16:e,Wr===null)var n=!1;else{if(e=Wr,Wr=null,tl=0,Ne&6)throw Error(G(331));var s=Ne;for(Ne|=4,Z=e.current;Z!==null;){var i=Z,l=i.child;if(Z.flags&16){var o=i.deletions;if(o!==null){for(var c=0;c<o.length;c++){var d=o[c];for(Z=d;Z!==null;){var u=Z;switch(u.tag){case 0:case 11:case 15:ss(8,u,i)}var h=u.child;if(h!==null)h.return=u,Z=h;else for(;Z!==null;){u=Z;var p=u.sibling,v=u.return;if(bf(u),u===d){Z=null;break}if(p!==null){p.return=v,Z=p;break}Z=v}}}var g=i.alternate;if(g!==null){var k=g.child;if(k!==null){g.child=null;do{var b=k.sibling;k.sibling=null,k=b}while(k!==null)}}Z=i}}if(i.subtreeFlags&2064&&l!==null)l.return=i,Z=l;else e:for(;Z!==null;){if(i=Z,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ss(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,Z=m;break e}Z=i.return}}var x=e.current;for(Z=x;Z!==null;){l=Z;var f=l.child;if(l.subtreeFlags&2064&&f!==null)f.return=l,Z=f;else e:for(l=x;Z!==null;){if(o=Z,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:_l(9,o)}}catch(T){We(o,o.return,T)}if(o===l){Z=null;break e}var j=o.sibling;if(j!==null){j.return=o.return,Z=j;break e}Z=o.return}}if(Ne=s,da(),_r&&typeof _r.onPostCommitFiberRoot=="function")try{_r.onPostCommitFiberRoot(fl,e)}catch{}n=!0}return n}finally{Ce=r,Zt.transition=t}}return!1}function hh(e,t,r){t=Sn(r,t),t=lf(e,t,1),e=ea(e,t,1),t=Et(),e!==null&&(Ms(e,1,t),Ut(e,t))}function We(e,t,r){if(e.tag===3)hh(e,e,r);else for(;t!==null;){if(t.tag===3){hh(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(ta===null||!ta.has(n))){e=Sn(r,e),e=of(t,e,1),t=ea(t,e,1),e=Et(),t!==null&&(Ms(t,1,e),Ut(t,e));break}}t=t.return}}function wb(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=Et(),e.pingedLanes|=e.suspendedLanes&r,it===e&&(pt&r)===r&&(at===4||at===3&&(pt&130023424)===pt&&500>Je()-jd?Ta(e,0):Nd|=r),Ut(e,t)}function Cf(e,t){t===0&&(e.mode&1?(t=ei,ei<<=1,!(ei&130023424)&&(ei=4194304)):t=1);var r=Et();e=Lr(e,t),e!==null&&(Ms(e,t,r),Ut(e,r))}function Nb(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),Cf(e,r)}function jb(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(G(314))}n!==null&&n.delete(t),Cf(e,r)}var Af;Af=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Pt.current)Lt=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Lt=!1,hb(e,t,r);Lt=!!(e.flags&131072)}else Lt=!1,Fe&&t.flags&1048576&&Ip(t,Hi,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Si(e,t),e=t.pendingProps;var s=_n(t,_t.current);bn(t,r),s=bd(null,t,n,e,s,r);var i=yd();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ot(n)?(i=!0,Gi(t)):i=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,pd(t),s.updater=kl,t.stateNode=s,s._reactInternals=t,nc(t,n,e,r),t=lc(null,t,n,!0,i,r)):(t.tag=0,Fe&&i&&id(t),St(null,t,s,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Si(e,t),e=t.pendingProps,s=n._init,n=s(n._payload),t.type=n,s=t.tag=Eb(n),e=sr(n,e),s){case 0:t=ic(null,t,n,e,r);break e;case 1:t=rh(null,t,n,e,r);break e;case 11:t=eh(null,t,n,e,r);break e;case 14:t=th(null,t,n,sr(n.type,e),r);break e}throw Error(G(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:sr(n,s),ic(e,t,n,s,r);case 1:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:sr(n,s),rh(e,t,n,s,r);case 3:e:{if(hf(t),e===null)throw Error(G(387));n=t.pendingProps,i=t.memoizedState,s=i.element,Fp(e,t),Yi(t,n,null,r);var l=t.memoizedState;if(n=l.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){s=Sn(Error(G(423)),t),t=ah(e,t,n,r,s);break e}else if(n!==s){s=Sn(Error(G(424)),t),t=ah(e,t,n,r,s);break e}else for(Gt=Zr(t.stateNode.containerInfo.firstChild),Vt=t,Fe=!0,cr=null,r=Up(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(wn(),n===s){t=Pr(e,t,r);break e}St(e,t,n,r)}t=t.child}return t;case 5:return Mp(t),e===null&&tc(t),n=t.type,s=t.pendingProps,i=e!==null?e.memoizedProps:null,l=s.children,Jo(n,s)?l=null:i!==null&&Jo(n,i)&&(t.flags|=32),uf(e,t),St(e,t,l,r),t.child;case 6:return e===null&&tc(t),null;case 13:return pf(e,t,r);case 4:return fd(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Nn(t,null,n,r):St(e,t,n,r),t.child;case 11:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:sr(n,s),eh(e,t,n,s,r);case 7:return St(e,t,t.pendingProps,r),t.child;case 8:return St(e,t,t.pendingProps.children,r),t.child;case 12:return St(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,i=t.memoizedProps,l=s.value,Le(Wi,n._currentValue),n._currentValue=l,i!==null)if(pr(i.value,l)){if(i.children===s.children&&!Pt.current){t=Pr(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var o=i.dependencies;if(o!==null){l=i.child;for(var c=o.firstContext;c!==null;){if(c.context===n){if(i.tag===1){c=Tr(-1,r&-r),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=r,c=i.alternate,c!==null&&(c.lanes|=r),rc(i.return,r,t),o.lanes|=r;break}c=c.next}}else if(i.tag===10)l=i.type===t.type?null:i.child;else if(i.tag===18){if(l=i.return,l===null)throw Error(G(341));l.lanes|=r,o=l.alternate,o!==null&&(o.lanes|=r),rc(l,r,t),l=i.sibling}else l=i.child;if(l!==null)l.return=i;else for(l=i;l!==null;){if(l===t){l=null;break}if(i=l.sibling,i!==null){i.return=l.return,l=i;break}l=l.return}i=l}St(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,bn(t,r),s=er(s),n=n(s),t.flags|=1,St(e,t,n,r),t.child;case 14:return n=t.type,s=sr(n,t.pendingProps),s=sr(n.type,s),th(e,t,n,s,r);case 15:return cf(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:sr(n,s),Si(e,t),t.tag=1,Ot(n)?(e=!0,Gi(t)):e=!1,bn(t,r),sf(t,n,s),nc(t,n,s,r),lc(null,t,n,!0,e,r);case 19:return ff(e,t,r);case 22:return df(e,t,r)}throw Error(G(156,t.tag))};function Tf(e,t){return rp(e,t)}function Sb(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xt(e,t,r,n){return new Sb(e,t,r,n)}function Ad(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Eb(e){if(typeof e=="function")return Ad(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Kc)return 11;if(e===Yc)return 14}return 2}function aa(e,t){var r=e.alternate;return r===null?(r=Xt(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Ai(e,t,r,n,s,i){var l=2;if(n=e,typeof e=="function")Ad(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case tn:return Ra(r.children,s,i,t);case Wc:l=8,s|=8;break;case Co:return e=Xt(12,r,t,s|2),e.elementType=Co,e.lanes=i,e;case Ao:return e=Xt(13,r,t,s),e.elementType=Ao,e.lanes=i,e;case To:return e=Xt(19,r,t,s),e.elementType=To,e.lanes=i,e;case M0:return Nl(r,s,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case D0:l=10;break e;case F0:l=9;break e;case Kc:l=11;break e;case Yc:l=14;break e;case $r:l=16,n=null;break e}throw Error(G(130,e==null?e:typeof e,""))}return t=Xt(l,r,t,s),t.elementType=e,t.type=n,t.lanes=i,t}function Ra(e,t,r,n){return e=Xt(7,e,n,t),e.lanes=r,e}function Nl(e,t,r,n){return e=Xt(22,e,n,t),e.elementType=M0,e.lanes=r,e.stateNode={isHidden:!1},e}function co(e,t,r){return e=Xt(6,e,null,t),e.lanes=r,e}function uo(e,t,r){return t=Xt(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Cb(e,t,r,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Gl(0),this.expirationTimes=Gl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gl(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Td(e,t,r,n,s,i,l,o,c){return e=new Cb(e,t,r,o,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Xt(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},pd(i),e}function Ab(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:en,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function Rf(e){if(!e)return la;e=e._reactInternals;e:{if($a(e)!==e||e.tag!==1)throw Error(G(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ot(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(G(171))}if(e.tag===1){var r=e.type;if(Ot(r))return Tp(e,r,t)}return t}function If(e,t,r,n,s,i,l,o,c){return e=Td(r,n,!0,e,s,i,l,o,c),e.context=Rf(null),r=e.current,n=Et(),s=ra(r),i=Tr(n,s),i.callback=t??null,ea(r,i,s),e.current.lanes=s,Ms(e,s,n),Ut(e,n),e}function jl(e,t,r,n){var s=t.current,i=Et(),l=ra(s);return r=Rf(r),t.context===null?t.context=r:t.pendingContext=r,t=Tr(i,l),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=ea(s,t,l),e!==null&&(hr(e,s,l,i),wi(e,s,l)),l}function al(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function ph(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Rd(e,t){ph(e,t),(e=e.alternate)&&ph(e,t)}function Tb(){return null}var Lf=typeof reportError=="function"?reportError:function(e){console.error(e)};function Id(e){this._internalRoot=e}Sl.prototype.render=Id.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(G(409));jl(e,t,null,null)};Sl.prototype.unmount=Id.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Da(function(){jl(null,e,null,null)}),t[Ir]=null}};function Sl(e){this._internalRoot=e}Sl.prototype.unstable_scheduleHydration=function(e){if(e){var t=cp();e={blockedOn:null,target:e,priority:t};for(var r=0;r<qr.length&&t!==0&&t<qr[r].priority;r++);qr.splice(r,0,e),r===0&&up(e)}};function Ld(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function El(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function fh(){}function Rb(e,t,r,n,s){if(s){if(typeof n=="function"){var i=n;n=function(){var d=al(l);i.call(d)}}var l=If(t,n,e,0,null,!1,!1,"",fh);return e._reactRootContainer=l,e[Ir]=l.current,ys(e.nodeType===8?e.parentNode:e),Da(),l}for(;s=e.lastChild;)e.removeChild(s);if(typeof n=="function"){var o=n;n=function(){var d=al(c);o.call(d)}}var c=Td(e,0,!1,null,null,!1,!1,"",fh);return e._reactRootContainer=c,e[Ir]=c.current,ys(e.nodeType===8?e.parentNode:e),Da(function(){jl(t,c,r,n)}),c}function Cl(e,t,r,n,s){var i=r._reactRootContainer;if(i){var l=i;if(typeof s=="function"){var o=s;s=function(){var c=al(l);o.call(c)}}jl(t,l,e,s)}else l=Rb(r,t,e,s,n);return al(l)}lp=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Jn(t.pendingLanes);r!==0&&(Xc(t,r|1),Ut(t,Je()),!(Ne&6)&&(En=Je()+500,da()))}break;case 13:Da(function(){var n=Lr(e,1);if(n!==null){var s=Et();hr(n,e,1,s)}}),Rd(e,1)}};Zc=function(e){if(e.tag===13){var t=Lr(e,134217728);if(t!==null){var r=Et();hr(t,e,134217728,r)}Rd(e,134217728)}};op=function(e){if(e.tag===13){var t=ra(e),r=Lr(e,t);if(r!==null){var n=Et();hr(r,e,t,n)}Rd(e,t)}};cp=function(){return Ce};dp=function(e,t){var r=Ce;try{return Ce=e,t()}finally{Ce=r}};$o=function(e,t,r){switch(t){case"input":if(Lo(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var s=bl(n);if(!s)throw Error(G(90));B0(n),Lo(n,s)}}}break;case"textarea":q0(e,r);break;case"select":t=r.value,t!=null&&fn(e,!!r.multiple,t,!1)}};J0=Sd;Q0=Da;var Ib={usingClientEntryPoint:!1,Events:[Bs,sn,bl,K0,Y0,Sd]},Hn={findFiberByHostInstance:Na,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Lb={bundleType:Hn.bundleType,version:Hn.version,rendererPackageName:Hn.rendererPackageName,rendererConfig:Hn.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Or.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=ep(e),e===null?null:e.stateNode},findFiberByHostInstance:Hn.findFiberByHostInstance||Tb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ui=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ui.isDisabled&&ui.supportsFiber)try{fl=ui.inject(Lb),_r=ui}catch{}}Wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ib;Wt.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ld(t))throw Error(G(200));return Ab(e,t,null,r)};Wt.createRoot=function(e,t){if(!Ld(e))throw Error(G(299));var r=!1,n="",s=Lf;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=Td(e,1,!1,null,null,r,!1,n,s),e[Ir]=t.current,ys(e.nodeType===8?e.parentNode:e),new Id(t)};Wt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(G(188)):(e=Object.keys(e).join(","),Error(G(268,e)));return e=ep(t),e=e===null?null:e.stateNode,e};Wt.flushSync=function(e){return Da(e)};Wt.hydrate=function(e,t,r){if(!El(t))throw Error(G(200));return Cl(null,e,t,!0,r)};Wt.hydrateRoot=function(e,t,r){if(!Ld(e))throw Error(G(405));var n=r!=null&&r.hydratedSources||null,s=!1,i="",l=Lf;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(l=r.onRecoverableError)),t=If(t,null,e,1,r??null,s,!1,i,l),e[Ir]=t.current,ys(e),n)for(e=0;e<n.length;e++)r=n[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new Sl(t)};Wt.render=function(e,t,r){if(!El(t))throw Error(G(200));return Cl(null,e,t,!1,r)};Wt.unmountComponentAtNode=function(e){if(!El(e))throw Error(G(40));return e._reactRootContainer?(Da(function(){Cl(null,null,e,!1,function(){e._reactRootContainer=null,e[Ir]=null})}),!0):!1};Wt.unstable_batchedUpdates=Sd;Wt.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!El(r))throw Error(G(200));if(e==null||e._reactInternals===void 0)throw Error(G(38));return Cl(e,t,r,!1,n)};Wt.version="18.3.1-next-f1338f8080-20240426";function Pf(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Pf)}catch(e){console.error(e)}}Pf(),L0.exports=Wt;var Pb=L0.exports,gh=Pb;So.createRoot=gh.createRoot,So.hydrateRoot=gh.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Cs(){return Cs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Cs.apply(this,arguments)}var Kr;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Kr||(Kr={}));const mh="popstate";function Ob(e){e===void 0&&(e={});function t(n,s){let{pathname:i,search:l,hash:o}=n.location;return yc("",{pathname:i,search:l,hash:o},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:nl(s)}return Db(t,r,null,e)}function Qe(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Pd(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Ub(){return Math.random().toString(36).substr(2,8)}function xh(e,t){return{usr:e.state,key:e.key,idx:t}}function yc(e,t,r,n){return r===void 0&&(r=null),Cs({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Ln(t):t,{state:r,key:t&&t.key||n||Ub()})}function nl(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ln(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Db(e,t,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:i=!1}=n,l=s.history,o=Kr.Pop,c=null,d=u();d==null&&(d=0,l.replaceState(Cs({},l.state,{idx:d}),""));function u(){return(l.state||{idx:null}).idx}function h(){o=Kr.Pop;let b=u(),m=b==null?null:b-d;d=b,c&&c({action:o,location:k.location,delta:m})}function p(b,m){o=Kr.Push;let x=yc(k.location,b,m);d=u()+1;let f=xh(x,d),j=k.createHref(x);try{l.pushState(f,"",j)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;s.location.assign(j)}i&&c&&c({action:o,location:k.location,delta:1})}function v(b,m){o=Kr.Replace;let x=yc(k.location,b,m);d=u();let f=xh(x,d),j=k.createHref(x);l.replaceState(f,"",j),i&&c&&c({action:o,location:k.location,delta:0})}function g(b){let m=s.location.origin!=="null"?s.location.origin:s.location.href,x=typeof b=="string"?b:nl(b);return x=x.replace(/ $/,"%20"),Qe(m,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,m)}let k={get action(){return o},get location(){return e(s,l)},listen(b){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(mh,h),c=b,()=>{s.removeEventListener(mh,h),c=null}},createHref(b){return t(s,b)},createURL:g,encodeLocation(b){let m=g(b);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:p,replace:v,go(b){return l.go(b)}};return k}var bh;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(bh||(bh={}));function Fb(e,t,r){return r===void 0&&(r="/"),Mb(e,t,r)}function Mb(e,t,r,n){let s=typeof t=="string"?Ln(t):t,i=Od(s.pathname||"/",r);if(i==null)return null;let l=Of(e);$b(l);let o=null;for(let c=0;o==null&&c<l.length;++c){let d=Xb(i);o=Yb(l[c],d)}return o}function Of(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(i,l,o)=>{let c={relativePath:o===void 0?i.path||"":o,caseSensitive:i.caseSensitive===!0,childrenIndex:l,route:i};c.relativePath.startsWith("/")&&(Qe(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let d=na([n,c.relativePath]),u=r.concat(c);i.children&&i.children.length>0&&(Qe(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Of(i.children,t,u,d)),!(i.path==null&&!i.index)&&t.push({path:d,score:Wb(d,i.index),routesMeta:u})};return e.forEach((i,l)=>{var o;if(i.path===""||!((o=i.path)!=null&&o.includes("?")))s(i,l);else for(let c of Uf(i.path))s(i,l,c)}),t}function Uf(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,s=r.endsWith("?"),i=r.replace(/\?$/,"");if(n.length===0)return s?[i,""]:[i];let l=Uf(n.join("/")),o=[];return o.push(...l.map(c=>c===""?i:[i,c].join("/"))),s&&o.push(...l),o.map(c=>e.startsWith("/")&&c===""?"/":c)}function $b(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Kb(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Bb=/^:[\w-]+$/,zb=3,qb=2,Gb=1,Vb=10,Hb=-2,yh=e=>e==="*";function Wb(e,t){let r=e.split("/"),n=r.length;return r.some(yh)&&(n+=Hb),t&&(n+=qb),r.filter(s=>!yh(s)).reduce((s,i)=>s+(Bb.test(i)?zb:i===""?Gb:Vb),n)}function Kb(e,t){return e.length===t.length&&e.slice(0,-1).every((n,s)=>n===t[s])?e[e.length-1]-t[t.length-1]:0}function Yb(e,t,r){let{routesMeta:n}=e,s={},i="/",l=[];for(let o=0;o<n.length;++o){let c=n[o],d=o===n.length-1,u=i==="/"?t:t.slice(i.length)||"/",h=Jb({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),p=c.route;if(!h)return null;Object.assign(s,h.params),l.push({params:s,pathname:na([i,h.pathname]),pathnameBase:ay(na([i,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(i=na([i,h.pathnameBase]))}return l}function Jb(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=Qb(e.path,e.caseSensitive,e.end),s=t.match(r);if(!s)return null;let i=s[0],l=i.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:n.reduce((d,u,h)=>{let{paramName:p,isOptional:v}=u;if(p==="*"){let k=o[h]||"";l=i.slice(0,i.length-k.length).replace(/(.)\/+$/,"$1")}const g=o[h];return v&&!g?d[p]=void 0:d[p]=(g||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:l,pattern:e}}function Qb(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),Pd(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,o,c)=>(n.push({paramName:o,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function Xb(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Pd(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Od(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}const Zb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ey=e=>Zb.test(e);function ty(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:s=""}=typeof e=="string"?Ln(e):e,i;if(r)if(ey(r))i=r;else{if(r.includes("//")){let l=r;r=r.replace(/\/\/+/g,"/"),Pd(!1,"Pathnames cannot have embedded double slashes - normalizing "+(l+" -> "+r))}r.startsWith("/")?i=vh(r.substring(1),"/"):i=vh(r,t)}else i=t;return{pathname:i,search:ny(n),hash:sy(s)}}function vh(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function ho(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ry(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function Ud(e,t){let r=ry(e);return t?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function Dd(e,t,r,n){n===void 0&&(n=!1);let s;typeof e=="string"?s=Ln(e):(s=Cs({},e),Qe(!s.pathname||!s.pathname.includes("?"),ho("?","pathname","search",s)),Qe(!s.pathname||!s.pathname.includes("#"),ho("#","pathname","hash",s)),Qe(!s.search||!s.search.includes("#"),ho("#","search","hash",s)));let i=e===""||s.pathname==="",l=i?"/":s.pathname,o;if(l==null)o=r;else{let h=t.length-1;if(!n&&l.startsWith("..")){let p=l.split("/");for(;p[0]==="..";)p.shift(),h-=1;s.pathname=p.join("/")}o=h>=0?t[h]:"/"}let c=ty(s,o),d=l&&l!=="/"&&l.endsWith("/"),u=(i||l===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}const na=e=>e.join("/").replace(/\/\/+/g,"/"),ay=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),ny=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,sy=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function iy(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Df=["post","put","patch","delete"];new Set(Df);const ly=["get",...Df];new Set(ly);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function As(){return As=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},As.apply(this,arguments)}const Fd=y.createContext(null),oy=y.createContext(null),ua=y.createContext(null),Al=y.createContext(null),ha=y.createContext({outlet:null,matches:[],isDataRoute:!1}),Ff=y.createContext(null);function cy(e,t){let{relative:r}=t===void 0?{}:t;Pn()||Qe(!1);let{basename:n,navigator:s}=y.useContext(ua),{hash:i,pathname:l,search:o}=Bf(e,{relative:r}),c=l;return n!=="/"&&(c=l==="/"?n:na([n,l])),s.createHref({pathname:c,search:o,hash:i})}function Pn(){return y.useContext(Al)!=null}function On(){return Pn()||Qe(!1),y.useContext(Al).location}function Mf(e){y.useContext(ua).static||y.useLayoutEffect(e)}function $f(){let{isDataRoute:e}=y.useContext(ha);return e?_y():dy()}function dy(){Pn()||Qe(!1);let e=y.useContext(Fd),{basename:t,future:r,navigator:n}=y.useContext(ua),{matches:s}=y.useContext(ha),{pathname:i}=On(),l=JSON.stringify(Ud(s,r.v7_relativeSplatPath)),o=y.useRef(!1);return Mf(()=>{o.current=!0}),y.useCallback(function(d,u){if(u===void 0&&(u={}),!o.current)return;if(typeof d=="number"){n.go(d);return}let h=Dd(d,JSON.parse(l),i,u.relative==="path");e==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:na([t,h.pathname])),(u.replace?n.replace:n.push)(h,u.state,u)},[t,n,l,i,e])}function Bf(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=y.useContext(ua),{matches:s}=y.useContext(ha),{pathname:i}=On(),l=JSON.stringify(Ud(s,n.v7_relativeSplatPath));return y.useMemo(()=>Dd(e,JSON.parse(l),i,r==="path"),[e,l,i,r])}function uy(e,t){return hy(e,t)}function hy(e,t,r,n){Pn()||Qe(!1);let{navigator:s}=y.useContext(ua),{matches:i}=y.useContext(ha),l=i[i.length-1],o=l?l.params:{};l&&l.pathname;let c=l?l.pathnameBase:"/";l&&l.route;let d=On(),u;if(t){var h;let b=typeof t=="string"?Ln(t):t;c==="/"||(h=b.pathname)!=null&&h.startsWith(c)||Qe(!1),u=b}else u=d;let p=u.pathname||"/",v=p;if(c!=="/"){let b=c.replace(/^\//,"").split("/");v="/"+p.replace(/^\//,"").split("/").slice(b.length).join("/")}let g=Fb(e,{pathname:v}),k=xy(g&&g.map(b=>Object.assign({},b,{params:Object.assign({},o,b.params),pathname:na([c,s.encodeLocation?s.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?c:na([c,s.encodeLocation?s.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),i,r,n);return t&&k?y.createElement(Al.Provider,{value:{location:As({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Kr.Pop}},k):k}function py(){let e=ky(),t=iy(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return y.createElement(y.Fragment,null,y.createElement("h2",null,"Unexpected Application Error!"),y.createElement("h3",{style:{fontStyle:"italic"}},t),r?y.createElement("pre",{style:s},r):null,null)}const fy=y.createElement(py,null);class gy extends y.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?y.createElement(ha.Provider,{value:this.props.routeContext},y.createElement(Ff.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function my(e){let{routeContext:t,match:r,children:n}=e,s=y.useContext(Fd);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),y.createElement(ha.Provider,{value:t},n)}function xy(e,t,r,n){var s;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var i;if(!r)return null;if(r.errors)e=r.matches;else if((i=n)!=null&&i.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let l=e,o=(s=r)==null?void 0:s.errors;if(o!=null){let u=l.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);u>=0||Qe(!1),l=l.slice(0,Math.min(l.length,u+1))}let c=!1,d=-1;if(r&&n&&n.v7_partialHydration)for(let u=0;u<l.length;u++){let h=l[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(d=u),h.route.id){let{loaderData:p,errors:v}=r,g=h.route.loader&&p[h.route.id]===void 0&&(!v||v[h.route.id]===void 0);if(h.route.lazy||g){c=!0,d>=0?l=l.slice(0,d+1):l=[l[0]];break}}}return l.reduceRight((u,h,p)=>{let v,g=!1,k=null,b=null;r&&(v=o&&h.route.id?o[h.route.id]:void 0,k=h.route.errorElement||fy,c&&(d<0&&p===0?(wy("route-fallback"),g=!0,b=null):d===p&&(g=!0,b=h.route.hydrateFallbackElement||null)));let m=t.concat(l.slice(0,p+1)),x=()=>{let f;return v?f=k:g?f=b:h.route.Component?f=y.createElement(h.route.Component,null):h.route.element?f=h.route.element:f=u,y.createElement(my,{match:h,routeContext:{outlet:u,matches:m,isDataRoute:r!=null},children:f})};return r&&(h.route.ErrorBoundary||h.route.errorElement||p===0)?y.createElement(gy,{location:r.location,revalidation:r.revalidation,component:k,error:v,children:x(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):x()},null)}var zf=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(zf||{}),qf=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(qf||{});function by(e){let t=y.useContext(Fd);return t||Qe(!1),t}function yy(e){let t=y.useContext(oy);return t||Qe(!1),t}function vy(e){let t=y.useContext(ha);return t||Qe(!1),t}function Gf(e){let t=vy(),r=t.matches[t.matches.length-1];return r.route.id||Qe(!1),r.route.id}function ky(){var e;let t=y.useContext(Ff),r=yy(),n=Gf();return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function _y(){let{router:e}=by(zf.UseNavigateStable),t=Gf(qf.UseNavigateStable),r=y.useRef(!1);return Mf(()=>{r.current=!0}),y.useCallback(function(s,i){i===void 0&&(i={}),r.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,As({fromRouteId:t},i)))},[e,t])}const kh={};function wy(e,t,r){kh[e]||(kh[e]=!0)}function Ny(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function _h(e){let{to:t,replace:r,state:n,relative:s}=e;Pn()||Qe(!1);let{future:i,static:l}=y.useContext(ua),{matches:o}=y.useContext(ha),{pathname:c}=On(),d=$f(),u=Dd(t,Ud(o,i.v7_relativeSplatPath),c,s==="path"),h=JSON.stringify(u);return y.useEffect(()=>d(JSON.parse(h),{replace:r,state:n,relative:s}),[d,h,s,r,n]),null}function ar(e){Qe(!1)}function jy(e){let{basename:t="/",children:r=null,location:n,navigationType:s=Kr.Pop,navigator:i,static:l=!1,future:o}=e;Pn()&&Qe(!1);let c=t.replace(/^\/*/,"/"),d=y.useMemo(()=>({basename:c,navigator:i,static:l,future:As({v7_relativeSplatPath:!1},o)}),[c,o,i,l]);typeof n=="string"&&(n=Ln(n));let{pathname:u="/",search:h="",hash:p="",state:v=null,key:g="default"}=n,k=y.useMemo(()=>{let b=Od(u,c);return b==null?null:{location:{pathname:b,search:h,hash:p,state:v,key:g},navigationType:s}},[c,u,h,p,v,g,s]);return k==null?null:y.createElement(ua.Provider,{value:d},y.createElement(Al.Provider,{children:r,value:k}))}function Sy(e){let{children:t,location:r}=e;return uy(vc(t),r)}new Promise(()=>{});function vc(e,t){t===void 0&&(t=[]);let r=[];return y.Children.forEach(e,(n,s)=>{if(!y.isValidElement(n))return;let i=[...t,s];if(n.type===y.Fragment){r.push.apply(r,vc(n.props.children,i));return}n.type!==ar&&Qe(!1),!n.props.index||!n.props.children||Qe(!1);let l={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(l.children=vc(n.props.children,i)),r.push(l)}),r}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function kc(){return kc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kc.apply(this,arguments)}function Ey(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,i;for(i=0;i<n.length;i++)s=n[i],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function Cy(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Ay(e,t){return e.button===0&&(!t||t==="_self")&&!Cy(e)}const Ty=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Ry="6";try{window.__reactRouterVersion=Ry}catch{}const Iy="startTransition",wh=wm[Iy];function Ly(e){let{basename:t,children:r,future:n,window:s}=e,i=y.useRef();i.current==null&&(i.current=Ob({window:s,v5Compat:!0}));let l=i.current,[o,c]=y.useState({action:l.action,location:l.location}),{v7_startTransition:d}=n||{},u=y.useCallback(h=>{d&&wh?wh(()=>c(h)):c(h)},[c,d]);return y.useLayoutEffect(()=>l.listen(u),[l,u]),y.useEffect(()=>Ny(n),[n]),y.createElement(jy,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:l,future:n})}const Py=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Oy=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,fa=y.forwardRef(function(t,r){let{onClick:n,relative:s,reloadDocument:i,replace:l,state:o,target:c,to:d,preventScrollReset:u,viewTransition:h}=t,p=Ey(t,Ty),{basename:v}=y.useContext(ua),g,k=!1;if(typeof d=="string"&&Oy.test(d)&&(g=d,Py))try{let f=new URL(window.location.href),j=d.startsWith("//")?new URL(f.protocol+d):new URL(d),T=Od(j.pathname,v);j.origin===f.origin&&T!=null?d=T+j.search+j.hash:k=!0}catch{}let b=cy(d,{relative:s}),m=Uy(d,{replace:l,state:o,target:c,preventScrollReset:u,relative:s,viewTransition:h});function x(f){n&&n(f),f.defaultPrevented||m(f)}return y.createElement("a",kc({},p,{href:g||b,onClick:k||i?n:x,ref:r,target:c}))});var Nh;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Nh||(Nh={}));var jh;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(jh||(jh={}));function Uy(e,t){let{target:r,replace:n,state:s,preventScrollReset:i,relative:l,viewTransition:o}=t===void 0?{}:t,c=$f(),d=On(),u=Bf(e,{relative:l});return y.useCallback(h=>{if(Ay(h,r)){h.preventDefault();let p=n!==void 0?n:nl(d)===nl(u);c(e,{replace:p,state:s,preventScrollReset:i,relative:l,viewTransition:o})}},[d,c,u,n,s,r,e,i,l,o])}function Tl(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function Dy(e,t,r,n){function s(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(h){l(h)}}function c(u){try{d(n.throw(u))}catch(h){l(h)}}function d(u){u.done?i(u.value):s(u.value).then(o,c)}d((n=n.apply(e,t||[])).next())})}const Fy=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class Md extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class My extends Md{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Sh extends Md{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Eh extends Md{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var _c;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(_c||(_c={}));class $y{constructor(t,{headers:r={},customFetch:n,region:s=_c.Any}={}){this.url=t,this.headers=r,this.region=s,this.fetch=Fy(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Dy(this,arguments,void 0,function*(r,n={}){var s;let i,l;try{const{headers:o,method:c,body:d,signal:u,timeout:h}=n;let p={},{region:v}=n;v||(v=this.region);const g=new URL(`${this.url}/${r}`);v&&v!=="any"&&(p["x-region"]=v,g.searchParams.set("forceFunctionRegion",v));let k;d&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(p["Content-Type"]="application/octet-stream",k=d):typeof d=="string"?(p["Content-Type"]="text/plain",k=d):typeof FormData<"u"&&d instanceof FormData?k=d:(p["Content-Type"]="application/json",k=JSON.stringify(d)):k=d;let b=u;h&&(l=new AbortController,i=setTimeout(()=>l.abort(),h),u?(b=l.signal,u.addEventListener("abort",()=>l.abort())):b=l.signal);const m=yield this.fetch(g.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},p),this.headers),o),body:k,signal:b}).catch(T=>{throw new My(T)}),x=m.headers.get("x-relay-error");if(x&&x==="true")throw new Sh(m);if(!m.ok)throw new Eh(m);let f=((s=m.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),j;return f==="application/json"?j=yield m.json():f==="application/octet-stream"||f==="application/pdf"?j=yield m.blob():f==="text/event-stream"?j=m:f==="multipart/form-data"?j=yield m.formData():j=yield m.text(),{data:j,error:null,response:m}}catch(o){return{data:null,error:o,response:o instanceof Eh||o instanceof Sh?o.context:void 0}}finally{i&&clearTimeout(i)}})}}var By=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},zy=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let l=null,o=null,c=null,d=i.status,u=i.statusText;if(i.ok){var h,p;if(r.method!=="HEAD"){var v;const m=await i.text();m===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((v=r.headers.get("Accept"))===null||v===void 0)&&v.includes("application/vnd.pgrst.plan+text"))?o=m:o=JSON.parse(m))}const k=(h=r.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),b=(p=i.headers.get("content-range"))===null||p===void 0?void 0:p.split("/");k&&b&&b.length>1&&(c=parseInt(b[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(o)&&(o.length>1?(l={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,c=null,d=406,u="Not Acceptable"):o.length===1?o=o[0]:o=null)}else{var g;const k=await i.text();try{l=JSON.parse(k),Array.isArray(l)&&i.status===404&&(o=[],l=null,d=200,u="OK")}catch{i.status===404&&k===""?(d=204,u="No Content"):l={message:k}}if(l&&r.isMaybeSingle&&(!(l==null||(g=l.details)===null||g===void 0)&&g.includes("0 rows"))&&(l=null,d=200,u="OK"),l&&r.shouldThrowOnError)throw new By(l)}return{error:l,data:o,count:c,status:d,statusText:u}});return this.shouldThrowOnError||(s=s.catch(i=>{var l;let o="";const c=i==null?void 0:i.cause;if(c){var d,u,h,p;const g=(d=c==null?void 0:c.message)!==null&&d!==void 0?d:"",k=(u=c==null?void 0:c.code)!==null&&u!==void 0?u:"";o=`${(h=i==null?void 0:i.name)!==null&&h!==void 0?h:"FetchError"}: ${i==null?void 0:i.message}`,o+=`

Caused by: ${(p=c==null?void 0:c.name)!==null&&p!==void 0?p:"Error"}: ${g}`,k&&(o+=` (${k})`),c!=null&&c.stack&&(o+=`
${c.stack}`)}else{var v;o=(v=i==null?void 0:i.stack)!==null&&v!==void 0?v:""}return{error:{message:`${(l=i==null?void 0:i.name)!==null&&l!==void 0?l:"FetchError"}: ${i==null?void 0:i.message}`,details:o,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}},qy=class extends zy{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:s=n}={}){const i=s?`${s}.order`:"order",l=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const s=typeof n>"u"?"offset":`${n}.offset`,i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:s=!1,format:i="text"}={}){var l;const o=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),c=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${o};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const Ch=new RegExp("[,()]");var Ya=class extends qy{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&Ch.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&Ch.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let s="";n==="plain"?s="pl":n==="phrase"?s="ph":n==="websearch"&&(s="w");const i=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${s}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},Gy=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=n}select(e,t){const{head:r=!1,count:n}=t??{},s=r?"HEAD":"GET";let i=!1;const l=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",l),n&&this.headers.append("Prefer",`count=${n}`),new Ya({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var n;const s="POST";if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const i=e.reduce((l,o)=>l.concat(Object.keys(o)),[]);if(i.length>0){const l=[...new Set(i)].map(o=>`"${o}"`);this.url.searchParams.set("columns",l.join(","))}}return new Ya({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:s=!0}={}){var i;const l="POST";if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),n&&this.headers.append("Prefer",`count=${n}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(o.length>0){const c=[...new Set(o)].map(d=>`"${d}"`);this.url.searchParams.set("columns",c.join(","))}}return new Ya({method:l,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(e,{count:t}={}){var r;const n="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Ya({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:e}={}){var t;const r="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Ya({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},Vy=class Vf{constructor(t,{headers:r={},schema:n,fetch:s}={}){this.url=t,this.headers=new Headers(r),this.schemaName=n,this.fetch=s}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Gy(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new Vf(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:n=!1,get:s=!1,count:i}={}){var l;let o;const c=new URL(`${this.url}/rpc/${t}`);let d;n||s?(o=n?"HEAD":"GET",Object.entries(r).filter(([h,p])=>p!==void 0).map(([h,p])=>[h,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([h,p])=>{c.searchParams.append(h,p)})):(o="POST",d=r);const u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new Ya({method:o,url:c,headers:u,schema:this.schemaName,body:d,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}};class Hy{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const Wy="2.89.0",Ky=`realtime-js/${Wy}`,Hf="1.0.0",Yy="2.0.0",Ah=Hf,wc=1e4,Jy=1e3,Qy=100;var zr;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(zr||(zr={}));var tt;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(tt||(tt={}));var or;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(or||(or={}));var Nc;(function(e){e.websocket="websocket"})(Nc||(Nc={}));var ka;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(ka||(ka={}));class Xy{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,n;const s=(n=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(t){var r,n;const s=(n=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:{},l=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,l)}_encodeUserBroadcastPush(t,r,n){var s,i;const l=t.topic,o=(s=t.ref)!==null&&s!==void 0?s:"",c=(i=t.join_ref)!==null&&i!==void 0?i:"",d=t.payload.event,u=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},h=Object.keys(u).length===0?"":JSON.stringify(u);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`topic length ${l.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`userEvent length ${d.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`metadata length ${h.length} exceeds maximum of 255`);const p=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+o.length+l.length+d.length+h.length,v=new ArrayBuffer(this.HEADER_LENGTH+p);let g=new DataView(v),k=0;g.setUint8(k++,this.KINDS.userBroadcastPush),g.setUint8(k++,c.length),g.setUint8(k++,o.length),g.setUint8(k++,l.length),g.setUint8(k++,d.length),g.setUint8(k++,h.length),g.setUint8(k++,r),Array.from(c,m=>g.setUint8(k++,m.charCodeAt(0))),Array.from(o,m=>g.setUint8(k++,m.charCodeAt(0))),Array.from(l,m=>g.setUint8(k++,m.charCodeAt(0))),Array.from(d,m=>g.setUint8(k++,m.charCodeAt(0))),Array.from(h,m=>g.setUint8(k++,m.charCodeAt(0)));var b=new Uint8Array(v.byteLength+n.byteLength);return b.set(new Uint8Array(v),0),b.set(new Uint8Array(n),v.byteLength),b.buffer}decode(t,r){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return r(n)}if(typeof t=="string"){const n=JSON.parse(t),[s,i,l,o,c]=n;return r({join_ref:s,ref:i,topic:l,event:o,payload:c})}return r({})}_binaryDecode(t){const r=new DataView(t),n=r.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,s)}}_decodeUserBroadcast(t,r,n){const s=r.getUint8(1),i=r.getUint8(2),l=r.getUint8(3),o=r.getUint8(4);let c=this.HEADER_LENGTH+4;const d=n.decode(t.slice(c,c+s));c=c+s;const u=n.decode(t.slice(c,c+i));c=c+i;const h=n.decode(t.slice(c,c+l));c=c+l;const p=t.slice(c,t.byteLength),v=o===this.JSON_ENCODING?JSON.parse(n.decode(p)):p,g={type:this.BROADCAST_EVENT,event:u,payload:v};return l>0&&(g.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:d,event:this.BROADCAST_EVENT,payload:g}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(t,r){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([n])=>r.includes(n)))}}class Wf{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ie;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Ie||(Ie={}));const Th=(e,t,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((i,l)=>(i[l]=Zy(l,e,t,s),i),{}):{}},Zy=(e,t,r,n)=>{const s=t.find(o=>o.name===e),i=s==null?void 0:s.type,l=r[e];return i&&!n.includes(i)?Kf(i,l):jc(l)},Kf=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return av(t,r)}switch(e){case Ie.bool:return ev(t);case Ie.float4:case Ie.float8:case Ie.int2:case Ie.int4:case Ie.int8:case Ie.numeric:case Ie.oid:return tv(t);case Ie.json:case Ie.jsonb:return rv(t);case Ie.timestamp:return nv(t);case Ie.abstime:case Ie.date:case Ie.daterange:case Ie.int4range:case Ie.int8range:case Ie.money:case Ie.reltime:case Ie.text:case Ie.time:case Ie.timestamptz:case Ie.timetz:case Ie.tsrange:case Ie.tstzrange:return jc(t);default:return jc(t)}},jc=e=>e,ev=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},tv=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},rv=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},av=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let i;const l=e.slice(1,r);try{i=JSON.parse("["+l+"]")}catch{i=l?l.split(","):[]}return i.map(o=>Kf(t,o))}return e},nv=e=>typeof e=="string"?e.replace(" ","T"):e,Yf=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class po{constructor(t,r,n={},s=wc){this.channel=t,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Rh;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(Rh||(Rh={}));class os{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=os.syncState(this.state,s,i,l),this.pendingDiffs.forEach(c=>{this.state=os.syncDiff(this.state,c,i,l)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=os.syncDiff(this.state,s,i,l),o())}),this.onJoin((s,i,l)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:l})}),this.onLeave((s,i,l)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:l})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,s){const i=this.cloneDeep(t),l=this.transformState(r),o={},c={};return this.map(i,(d,u)=>{l[d]||(c[d]=u)}),this.map(l,(d,u)=>{const h=i[d];if(h){const p=u.map(b=>b.presence_ref),v=h.map(b=>b.presence_ref),g=u.filter(b=>v.indexOf(b.presence_ref)<0),k=h.filter(b=>p.indexOf(b.presence_ref)<0);g.length>0&&(o[d]=g),k.length>0&&(c[d]=k)}else o[d]=u}),this.syncDiff(i,{joins:o,leaves:c},n,s)}static syncDiff(t,r,n,s){const{joins:i,leaves:l}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(o,c)=>{var d;const u=(d=t[o])!==null&&d!==void 0?d:[];if(t[o]=this.cloneDeep(c),u.length>0){const h=t[o].map(v=>v.presence_ref),p=u.filter(v=>h.indexOf(v.presence_ref)<0);t[o].unshift(...p)}n(o,u,c)}),this.map(l,(o,c)=>{let d=t[o];if(!d)return;const u=c.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),t[o]=d,s(o,d,c),d.length===0&&delete t[o]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const s=t[n];return"metas"in s?r[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):r[n]=s,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ih;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(Ih||(Ih={}));var cs;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(cs||(cs={}));var Sr;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Sr||(Sr={}));class pn{constructor(t,r={config:{}},n){var s,i;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=tt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new po(this,or.join,this.params,this.timeout),this.rejoinTimer=new Wf(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=tt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(l=>l.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=tt.closed,this.socket._remove(this)}),this._onError(l=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,l),this.state=tt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=tt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",l=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,l),this.state=tt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(or.reply,{},(l,o)=>{this._trigger(this._replyEventName(o),l)}),this.presence=new os(this),this.broadcastEndpointURL=Yf(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==tt.closed){const{config:{broadcast:l,presence:o,private:c}}=this.params,d=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(v=>v.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[cs.PRESENCE]&&this.bindings[cs.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},p={broadcast:l,presence:Object.assign(Object.assign({},o),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(v=>t==null?void 0:t(Sr.CHANNEL_ERROR,v)),this._onClose(()=>t==null?void 0:t(Sr.CLOSED)),this.updateJoinPayload(Object.assign({config:p},h)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:v})=>{var g;if(this.socket._isManualToken()||this.socket.setAuth(),v===void 0){t==null||t(Sr.SUBSCRIBED);return}else{const k=this.bindings.postgres_changes,b=(g=k==null?void 0:k.length)!==null&&g!==void 0?g:0,m=[];for(let x=0;x<b;x++){const f=k[x],{filter:{event:j,schema:T,table:L,filter:C}}=f,O=v&&v[x];if(O&&O.event===j&&pn.isFilterValueEqual(O.schema,T)&&pn.isFilterValueEqual(O.table,L)&&pn.isFilterValueEqual(O.filter,C))m.push(Object.assign(Object.assign({},f),{id:O.id}));else{this.unsubscribe(),this.state=tt.errored,t==null||t(Sr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,t&&t(Sr.SUBSCRIBED);return}}).receive("error",v=>{this.state=tt.errored,t==null||t(Sr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Sr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===tt.joined&&t===cs.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,r,n)}async httpSend(t,r,n={}){var s;if(r==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(o.status===202)return{success:!0};let c=o.statusText;try{const d=await o.json();c=d.error||d.message||c}catch{}return Promise.reject(new Error(c))}async send(t,r={}){var n,s;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:l}=t,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:l,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=d.body)===null||s===void 0?void 0:s.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var l,o,c;const d=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(o=(l=this.params)===null||l===void 0?void 0:l.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=tt.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(or.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new po(this,or.leave,{},t),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=tt.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),l=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(i),l}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new po(this,t,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Qy){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var s,i;const l=t.toLocaleLowerCase(),{close:o,error:c,leave:d,join:u}=or;if(n&&[o,c,d,u].indexOf(l)>=0&&n!==this._joinRef())return;let p=this._onMessage(l,r,n);if(r&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(l)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(v=>{var g,k,b;return((g=v.filter)===null||g===void 0?void 0:g.event)==="*"||((b=(k=v.filter)===null||k===void 0?void 0:k.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===l}).map(v=>v.callback(p,n)):(i=this.bindings[l])===null||i===void 0||i.filter(v=>{var g,k,b,m,x,f;if(["broadcast","presence","postgres_changes"].includes(l))if("id"in v){const j=v.id,T=(g=v.filter)===null||g===void 0?void 0:g.event;return j&&((k=r.ids)===null||k===void 0?void 0:k.includes(j))&&(T==="*"||(T==null?void 0:T.toLocaleLowerCase())===((b=r.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const j=(x=(m=v==null?void 0:v.filter)===null||m===void 0?void 0:m.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return j==="*"||j===((f=r==null?void 0:r.event)===null||f===void 0?void 0:f.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===l}).map(v=>{if(typeof p=="object"&&"ids"in p){const g=p.data,{schema:k,table:b,commit_timestamp:m,type:x,errors:f}=g;p=Object.assign(Object.assign({},{schema:k,table:b,commit_timestamp:m,eventType:x,new:{},old:{},errors:f}),this._getPayloadRecords(g))}v.callback(p,n)})}_isClosed(){return this.state===tt.closed}_isJoined(){return this.state===tt.joined}_isJoining(){return this.state===tt.joining}_isLeaving(){return this.state===tt.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const s=t.toLocaleLowerCase(),i={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&pn.isEqual(s.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}static isFilterValueEqual(t,r){return(t??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(or.close,{},t)}_onError(t){this._on(or.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=tt.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=Th(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=Th(t.columns,t.old_record)),r}}const fo=()=>{},hi={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},sv=[1e3,2e3,5e3,1e4],iv=1e4,lv=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ov{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=wc,this.transport=null,this.heartbeatIntervalMs=hi.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=fo,this.ref=0,this.reconnectTimer=null,this.vsn=Ah,this.logger=fo,this.conn=null,this.sendBuffer=[],this.serializer=new Xy,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${Nc.websocket}`,this.httpEndpoint=Yf(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Hy.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case zr.connecting:return ka.Connecting;case zr.open:return ka.Open;case zr.closing:return ka.Closing;default:return ka.Closed}}isConnected(){return this.connectionState()===ka.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new pn(`realtime:${t}`,r,this);return this.channels.push(i),i}}push(t){const{topic:r,event:n,payload:s,ref:i}=t,l=()=>{this.encode(t,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${r} ${n} (${i})`,s),this.isConnected()?l():this.sendBuffer.push(l)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(Jy,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},hi.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:i,ref:l}=r,o=l?`(${l})`:"",c=i.status||"";this.log("receive",`${c} ${n} ${s} ${o}`.trim(),i),this.channels.filter(d=>d._isMember(n)).forEach(d=>d._trigger(s,i,l)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===zr.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===zr.open||this.conn.readyState===zr.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(or.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${t}${n}${s}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([lv],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r,n=!1;if(t)r=t,n=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),r=this.accessTokenValue}else r=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(s=>{const i={access_token:r,version:Ky};r&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(or.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${t} callback`,s)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Wf(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},hi.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,s,i,l,o,c,d,u,h,p,v;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:wc,this.heartbeatIntervalMs=(s=t==null?void 0:t.heartbeatIntervalMs)!==null&&s!==void 0?s:hi.HEARTBEAT_INTERVAL,this.worker=(i=t==null?void 0:t.worker)!==null&&i!==void 0?i:!1,this.accessToken=(l=t==null?void 0:t.accessToken)!==null&&l!==void 0?l:null,this.heartbeatCallback=(o=t==null?void 0:t.heartbeatCallback)!==null&&o!==void 0?o:fo,this.vsn=(c=t==null?void 0:t.vsn)!==null&&c!==void 0?c:Ah,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(d=t==null?void 0:t.reconnectAfterMs)!==null&&d!==void 0?d:g=>sv[g-1]||iv,this.vsn){case Hf:this.encode=(u=t==null?void 0:t.encode)!==null&&u!==void 0?u:(g,k)=>k(JSON.stringify(g)),this.decode=(h=t==null?void 0:t.decode)!==null&&h!==void 0?h:(g,k)=>k(JSON.parse(g));break;case Yy:this.encode=(p=t==null?void 0:t.encode)!==null&&p!==void 0?p:this.serializer.encode.bind(this.serializer),this.decode=(v=t==null?void 0:t.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var Ts=class extends Error{constructor(e,t){var r;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((r=t.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function cv(e,t,r){const n=new URL(t,e);if(r)for(const[s,i]of Object.entries(r))i!==void 0&&n.searchParams.set(s,i);return n.toString()}async function dv(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function uv(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:s,body:i,headers:l}){const o=cv(e.baseUrl,n,s),c=await dv(e.auth),d=await t(o,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...c,...l},body:i?JSON.stringify(i):void 0}),u=await d.text(),h=(d.headers.get("content-type")||"").includes("application/json"),p=h&&u?JSON.parse(u):u;if(!d.ok){const v=h?p:void 0,g=v==null?void 0:v.error;throw new Ts((g==null?void 0:g.message)??`Request failed with status ${d.status}`,{status:d.status,icebergType:g==null?void 0:g.type,icebergCode:g==null?void 0:g.code,details:v})}return{status:d.status,headers:d.headers,data:p}}}}function pi(e){return e.join("")}var hv=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:pi(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(e,t){const r={namespace:e.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${pi(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${pi(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${pi(e.namespace)}`}),!0}catch(t){if(t instanceof Ts&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(r){if(r instanceof Ts&&r.status===409)return;throw r}}};function za(e){return e.join("")}var pv=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${za(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${za(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${za(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${za(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${za(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${za(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(r){if(r instanceof Ts&&r.status===404)return!1;throw r}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof Ts&&r.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},fv=class{constructor(e){var n;let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=uv({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=(n=e.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new hv(this.client,t),this.tableOps=new pv(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},Rl=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function Me(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var gv=class extends Rl{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Sc=class extends Rl{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const $d=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),mv=()=>Response,Ec=e=>{if(Array.isArray(e))return e.map(r=>Ec(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[s]=Ec(n)}),t},xv=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},bv=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function Rs(e){"@babel/helpers - typeof";return Rs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rs(e)}function yv(e,t){if(Rs(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Rs(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vv(e){var t=yv(e,"string");return Rs(t)=="symbol"?t:t+""}function kv(e,t,r){return(t=vv(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Lh(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Lh(Object(r),!0).forEach(function(n){kv(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const go=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},_v=async(e,t,r)=>{e instanceof await mv()&&!(r!=null&&r.noResolveJson)?e.json().then(n=>{const s=e.status||500,i=(n==null?void 0:n.statusCode)||s+"";t(new gv(go(n),s,i))}).catch(n=>{t(new Sc(go(n),n))}):t(new Sc(go(e),e))},wv=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?s:(xv(n)?(s.headers=ue({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,t!=null&&t.duplex&&(s.duplex=t.duplex),ue(ue({},s),r))};async function qs(e,t,r,n,s,i){return new Promise((l,o)=>{e(r,wv(t,n,s,i)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>l(c)).catch(c=>_v(c,o,n))})}async function Is(e,t,r,n){return qs(e,"GET",t,r,n)}async function ir(e,t,r,n,s){return qs(e,"POST",t,n,s,r)}async function Cc(e,t,r,n,s){return qs(e,"PUT",t,n,s,r)}async function Nv(e,t,r,n){return qs(e,"HEAD",t,ue(ue({},r),{},{noResolveJson:!0}),n)}async function Bd(e,t,r,n,s){return qs(e,"DELETE",t,n,s,r)}var jv=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return{data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Me(t))return{data:null,error:t};throw t}}};let Jf;Jf=Symbol.toStringTag;var Sv=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Jf]="BlobDownloadBuilder",this.promise=null}asStream(){return new jv(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return{data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Me(t))return{data:null,error:t};throw t}}};const Ev={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ph={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Cv=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=$d(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,r,n){var s=this;try{let i;const l=ue(ue({},Ph),n);let o=ue(ue({},s.headers),e==="POST"&&{"x-upsert":String(l.upsert)});const c=l.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",l.cacheControl),c&&i.append("metadata",s.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",l.cacheControl),c&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(c))):(i=r,o["cache-control"]=`max-age=${l.cacheControl}`,o["content-type"]=l.contentType,c&&(o["x-metadata"]=s.toBase64(s.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!l.duplex&&(l.duplex="half")),n!=null&&n.headers&&(o=ue(ue({},o),n.headers));const d=s._removeEmptyFolders(t),u=s._getFinalPath(d),h=await(e=="PUT"?Cc:ir)(s.fetch,`${s.url}/object/${u}`,i,ue({headers:o},l!=null&&l.duplex?{duplex:l.duplex}:{}));return{data:{path:d,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(Me(i))return{data:null,error:i};throw i}}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,n){var s=this;const i=s._removeEmptyFolders(e),l=s._getFinalPath(i),o=new URL(s.url+`/object/upload/sign/${l}`);o.searchParams.set("token",t);try{let c;const d=ue({upsert:Ph.upsert},n),u=ue(ue({},s.headers),{"x-upsert":String(d.upsert)});return typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType),{data:{path:i,fullPath:(await Cc(s.fetch,o.toString(),c,{headers:u})).Key},error:null}}catch(c){if(s.shouldThrowOnError)throw c;if(Me(c))return{data:null,error:c};throw c}}async createSignedUploadUrl(e,t){var r=this;try{let n=r._getFinalPath(e);const s=ue({},r.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const i=await ir(r.fetch,`${r.url}/object/upload/sign/${n}`,{},{headers:s}),l=new URL(r.url+i.url),o=l.searchParams.get("token");if(!o)throw new Rl("No token returned by API");return{data:{signedUrl:l.toString(),path:e,token:o},error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Me(n))return{data:null,error:n};throw n}}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){var n=this;try{return{data:await ir(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Me(s))return{data:null,error:s};throw s}}async copy(e,t,r){var n=this;try{return{data:{path:(await ir(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers})).Key},error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Me(s))return{data:null,error:s};throw s}}async createSignedUrl(e,t,r){var n=this;try{let s=n._getFinalPath(e),i=await ir(n.fetch,`${n.url}/object/sign/${s}`,ue({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:n.headers});const l=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${n.url}${i.signedURL}${l}`)},{data:i,error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Me(s))return{data:null,error:s};throw s}}async createSignedUrls(e,t,r){var n=this;try{const s=await ir(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:t,paths:e},{headers:n.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(l=>ue(ue({},l),{},{signedUrl:l.signedURL?encodeURI(`${n.url}${l.signedURL}${i}`):null})),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Me(s))return{data:null,error:s};throw s}}download(e,t){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),s=n?`?${n}`:"",i=this._getFinalPath(e),l=()=>Is(this.fetch,`${this.url}/${r}/${i}${s}`,{headers:this.headers,noResolveJson:!0});return new Sv(l,this.shouldThrowOnError)}async info(e){var t=this;const r=t._getFinalPath(e);try{return{data:Ec(await Is(t.fetch,`${t.url}/object/info/${r}`,{headers:t.headers})),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Me(n))return{data:null,error:n};throw n}}async exists(e){var t=this;const r=t._getFinalPath(e);try{return await Nv(t.fetch,`${t.url}/object/${r}`,{headers:t.headers}),{data:!0,error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Me(n)&&n instanceof Sc){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],s=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&n.push(s);const i=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&n.push(l);let o=n.join("&");return o!==""&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${o}`)}}}async remove(e){var t=this;try{return{data:await Bd(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Me(r))return{data:null,error:r};throw r}}async list(e,t,r){var n=this;try{const s=ue(ue(ue({},Ev),t),{},{prefix:e||""});return{data:await ir(n.fetch,`${n.url}/object/list/${n.bucketId}`,s,{headers:n.headers},r),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Me(s))return{data:null,error:s};throw s}}async listV2(e,t){var r=this;try{const n=ue({},e);return{data:await ir(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,n,{headers:r.headers},t),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Me(n))return{data:null,error:n};throw n}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const Qf="2.89.0",Xf={"X-Client-Info":`storage-js/${Qf}`};var Av=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1;const s=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=ue(ue({},Xf),t),this.fetch=$d(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const r=t.listBucketOptionsToQueryString(e);return{data:await Is(t.fetch,`${t.url}/bucket${r}`,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Me(r))return{data:null,error:r};throw r}}async getBucket(e){var t=this;try{return{data:await Is(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Me(r))return{data:null,error:r};throw r}}async createBucket(e,t={public:!1}){var r=this;try{return{data:await ir(r.fetch,`${r.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Me(n))return{data:null,error:n};throw n}}async updateBucket(e,t){var r=this;try{return{data:await Cc(r.fetch,`${r.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Me(n))return{data:null,error:n};throw n}}async emptyBucket(e){var t=this;try{return{data:await ir(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Me(r))return{data:null,error:r};throw r}}async deleteBucket(e){var t=this;try{return{data:await Bd(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Me(r))return{data:null,error:r};throw r}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},Tv=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=ue(ue({},Xf),t),this.fetch=$d(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await ir(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Me(r))return{data:null,error:r};throw r}}async listBuckets(e){var t=this;try{const r=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&r.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&r.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&r.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&r.set("sortOrder",e.sortOrder),e!=null&&e.search&&r.set("search",e.search);const n=r.toString(),s=n?`${t.url}/bucket?${n}`:`${t.url}/bucket`;return{data:await Is(t.fetch,s,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Me(r))return{data:null,error:r};throw r}}async deleteBucket(e){var t=this;try{return{data:await Bd(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Me(r))return{data:null,error:r};throw r}}from(e){var t=this;if(!bv(e))throw new Rl("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new fv({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(r,{get(s,i){const l=s[i];return typeof l!="function"?l:async(...o)=>{try{return{data:await l.apply(s,o),error:null}}catch(c){if(n)throw c;return{data:null,error:c}}}}})}};const zd={"X-Client-Info":`storage-js/${Qf}`,"Content-Type":"application/json"};var Zf=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function zt(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}var mo=class extends Zf{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Rv=class extends Zf{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const qd=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Iv=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Oh=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Lv=async(e,t,r)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const n=e.status||500,s=e;if(typeof s.json=="function")s.json().then(i=>{const l=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||n+"";t(new mo(Oh(i),n,l))}).catch(()=>{const i=n+"";t(new mo(s.statusText||`HTTP ${n} error`,n,i))});else{const i=n+"";t(new mo(s.statusText||`HTTP ${n} error`,n,i))}}else t(new Rv(Oh(e),e))},Pv=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return n?(Iv(n)?(s.headers=ue({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,ue(ue({},s),r)):s};async function Ov(e,t,r,n,s,i){return new Promise((l,o)=>{e(r,Pv(t,n,s,i)).then(c=>{if(!c.ok)throw c;if(n!=null&&n.noResolveJson)return c;const d=c.headers.get("content-type");return!d||!d.includes("application/json")?{}:c.json()}).then(c=>l(c)).catch(c=>Lv(c,o,n))})}async function qt(e,t,r,n,s){return Ov(e,"POST",t,n,s,r)}var Uv=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=ue(ue({},zd),t),this.fetch=qd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await qt(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async getIndex(e,t){var r=this;try{return{data:await qt(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(zt(n))return{data:null,error:n};throw n}}async listIndexes(e){var t=this;try{return{data:await qt(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async deleteIndex(e,t){var r=this;try{return{data:await qt(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers})||{},error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(zt(n))return{data:null,error:n};throw n}}},Dv=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=ue(ue({},zd),t),this.fetch=qd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await qt(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async getVectors(e){var t=this;try{return{data:await qt(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async listVectors(e){var t=this;try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:await qt(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async queryVectors(e){var t=this;try{return{data:await qt(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await qt(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}},Fv=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=ue(ue({},zd),t),this.fetch=qd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await qt(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async getBucket(e){var t=this;try{return{data:await qt(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async listBuckets(e={}){var t=this;try{return{data:await qt(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async deleteBucket(e){var t=this;try{return{data:await qt(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}},Mv=class extends Fv{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new $v(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,r=this;return t().call(r,e)}async getBucket(e){var t=()=>super.getBucket,r=this;return t().call(r,e)}async listBuckets(e={}){var t=()=>super.listBuckets,r=this;return t().call(r,e)}async deleteBucket(e){var t=()=>super.deleteBucket,r=this;return t().call(r,e)}},$v=class extends Uv{constructor(e,t,r,n){super(e,t,n),this.vectorBucketName=r}async createIndex(e){var t=()=>super.createIndex,r=this;return t().call(r,ue(ue({},e),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,r=this;return t().call(r,ue(ue({},e),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,r=this;return t().call(r,r.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,r=this;return t().call(r,r.vectorBucketName,e)}index(e){return new Bv(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},Bv=class extends Dv{constructor(e,t,r,n,s){super(e,t,s),this.vectorBucketName=r,this.indexName=n}async putVectors(e){var t=()=>super.putVectors,r=this;return t().call(r,ue(ue({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(e){var t=()=>super.getVectors,r=this;return t().call(r,ue(ue({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,r=this;return t().call(r,ue(ue({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,r=this;return t().call(r,ue(ue({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,r=this;return t().call(r,ue(ue({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},zv=class extends Av{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new Cv(this.url,this.headers,e,this.fetch)}get vectors(){return new Mv(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Tv(this.url+"/iceberg",this.headers,this.fetch)}};const eg="2.89.0",Ja=30*1e3,Ac=3,xo=Ac*Ja,qv="http://localhost:9999",Gv="supabase.auth.token",Vv={"X-Client-Info":`gotrue-js/${eg}`},Tc="X-Supabase-Api-Version",tg={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Hv=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Wv=10*60*1e3;class Ls extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function ie(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class Kv extends Ls{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function Yv(e){return ie(e)&&e.name==="AuthApiError"}class _a extends Ls{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Ur extends Ls{constructor(t,r,n,s){super(t,n,s),this.name=r,this.status=n}}class $t extends Ur{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Jv(e){return ie(e)&&e.name==="AuthSessionMissingError"}class qa extends Ur{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class fi extends Ur{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class gi extends Ur{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Qv(e){return ie(e)&&e.name==="AuthImplicitGrantRedirectError"}class Uh extends Ur{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xv extends Ur{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Rc extends Ur{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function bo(e){return ie(e)&&e.name==="AuthRetryableFetchError"}class Dh extends Ur{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class Ic extends Ur{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const sl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Fh=` 	
\r=`.split(""),Zv=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Fh.length;t+=1)e[Fh[t].charCodeAt(0)]=-2;for(let t=0;t<sl.length;t+=1)e[sl[t].charCodeAt(0)]=t;return e})();function Mh(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(sl[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(sl[n]),t.queuedBits-=6}}function rg(e,t,r){const n=Zv[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function $h(e){const t=[],r=l=>{t.push(String.fromCodePoint(l))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=l=>{rk(l,n,r)};for(let l=0;l<e.length;l+=1)rg(e.charCodeAt(l),s,i);return t.join("")}function ek(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function tk(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}ek(n,t)}}function rk(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function vn(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};for(let s=0;s<e.length;s+=1)rg(e.charCodeAt(s),r,n);return new Uint8Array(t)}function ak(e){const t=[];return tk(e,r=>t.push(r)),new Uint8Array(t)}function Ea(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};return e.forEach(s=>Mh(s,r,n)),Mh(null,r,n),t.join("")}function nk(e){return Math.round(Date.now()/1e3)+e}function sk(){return Symbol("auth-callback")}const dt=()=>typeof window<"u"&&typeof document<"u",ga={tested:!1,writable:!1},ag=()=>{if(!dt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ga.tested)return ga.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),ga.tested=!0,ga.writable=!0}catch{ga.tested=!0,ga.writable=!1}return ga.writable};function ik(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,i)=>{t[i]=s})}catch{}return r.searchParams.forEach((n,s)=>{t[s]=n}),t}const ng=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),lk=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Qa=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},ma=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},ct=async(e,t)=>{await e.removeItem(t)};class Il{constructor(){this.promise=new Il.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}Il.promiseConstructor=Promise;function yo(e){const t=e.split(".");if(t.length!==3)throw new Ic("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!Hv.test(t[n]))throw new Ic("JWT not in base64url format");return{header:JSON.parse($h(t[0])),payload:JSON.parse($h(t[1])),signature:vn(t[2]),raw:{header:t[0],payload:t[1]}}}async function ok(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function ck(e,t){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const l=await e(i);if(!t(i,null,l)){n(l);return}}catch(l){if(!t(i,l)){s(l);return}}})()})}function dk(e){return("0"+e.toString(16)).substr(-2)}function uk(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let i=0;i<56;i++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(t),Array.from(t,dk).join("")}async function hk(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function pk(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await hk(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ga(e,t,r=!1){const n=uk();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await Qa(e,`${t}-code-verifier`,s);const i=await pk(n);return[i,n===i?"plain":"s256"]}const fk=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function gk(e){const t=e.headers.get(Tc);if(!t||!t.match(fk))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function mk(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function xk(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const bk=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Va(e){if(!bk.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function vo(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function yk(e,t){return new Proxy(e,{get:(r,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,s)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,n,s)}})}function Bh(e){return JSON.parse(JSON.stringify(e))}const va=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),vk=[502,503,504];async function zh(e){var t;if(!lk(e))throw new Rc(va(e),0);if(vk.includes(e.status))throw new Rc(va(e),e.status);let r;try{r=await e.json()}catch(i){throw new _a(va(i),i)}let n;const s=gk(e);if(s&&s.getTime()>=tg["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Dh(va(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new $t}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((i,l)=>i&&typeof l=="string",!0))throw new Dh(va(r),e.status,r.weak_password.reasons);throw new Kv(va(r),e.status||500,n)}const kk=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function de(e,t,r,n){var s;const i=Object.assign({},n==null?void 0:n.headers);i[Tc]||(i[Tc]=tg["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const l=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(l.redirect_to=n.redirectTo);const o=Object.keys(l).length?"?"+new URLSearchParams(l).toString():"",c=await _k(e,t,r+o,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function _k(e,t,r,n,s,i){const l=kk(t,n,s,i);let o;try{o=await e(r,Object.assign({},l))}catch(c){throw console.error(c),new Rc(va(c),0)}if(o.ok||await zh(o),n!=null&&n.noResolveJson)return o;try{return await o.json()}catch(c){await zh(c)}}function nr(e){var t;let r=null;jk(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=nk(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function qh(e){const t=nr(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Vr(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function wk(e){return{data:e,error:null}}function Nk(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i}=e,l=Tl(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i},c=Object.assign({},l);return{data:{properties:o,user:c},error:null}}function Gh(e){return e}function jk(e){return e.access_token&&e.refresh_token&&e.expires_in}const ko=["global","local","others"];class Sk{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=ng(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=ko[0]){if(ko.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ko.join(", ")}`);try{return await de(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ie(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await de(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Vr})}catch(n){if(ie(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=Tl(t,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await de(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Nk,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(ie(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await de(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Vr})}catch(r){if(ie(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,s,i,l,o,c;try{const d={nextPage:null,lastPage:0,total:0},u=await de(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Gh});if(u.error)throw u.error;const h=await u.json(),p=(l=u.headers.get("x-total-count"))!==null&&l!==void 0?l:0,v=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return v.length>0&&(v.forEach(g=>{const k=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(g.split(";")[1].split("=")[1]);d[`${b}Page`]=k}),d.total=parseInt(p)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(ie(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){Va(t);try{return await de(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Vr})}catch(r){if(ie(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){Va(t);try{return await de(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Vr})}catch(n){if(ie(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){Va(t);try{return await de(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Vr})}catch(n){if(ie(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){Va(t.userId);try{const{data:r,error:n}=await de(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(ie(r))return{data:null,error:r};throw r}}async _deleteFactor(t){Va(t.userId),Va(t.id);try{return{data:await de(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(ie(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,s,i,l,o,c;try{const d={nextPage:null,lastPage:0,total:0},u=await de(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Gh});if(u.error)throw u.error;const h=await u.json(),p=(l=u.headers.get("x-total-count"))!==null&&l!==void 0?l:0,v=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return v.length>0&&(v.forEach(g=>{const k=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(g.split(";")[1].split("=")[1]);d[`${b}Page`]=k}),d.total=parseInt(p)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(ie(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(t){try{return await de(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ie(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await de(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ie(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await de(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ie(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await de(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ie(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await de(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ie(r))return{data:null,error:r};throw r}}}function Vh(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Ha={debug:!!(globalThis&&ag()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class sg extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Ek extends sg{}async function Ck(e,t,r){Ha.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Ha.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Ha.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{Ha.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw Ha.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Ek(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Ha.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Ak(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function ig(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Tk(e){return parseInt(e,16)}function Rk(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function Ik(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:l,notBefore:o,requestId:c,resources:d,scheme:u,uri:h,version:p}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(l&&l.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${l}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const v=ig(e.address),g=u?`${u}://${n}`:n,k=e.statement?`${e.statement}
`:"",b=`${g} wants you to sign in with your Ethereum account:
${v}

${k}`;let m=`URI: ${h}
Version: ${p}
Chain ID: ${r}${l?`
Nonce: ${l}`:""}
Issued At: ${i.toISOString()}`;if(s&&(m+=`
Expiration Time: ${s.toISOString()}`),o&&(m+=`
Not Before: ${o.toISOString()}`),c&&(m+=`
Request ID: ${c}`),d){let x=`
Resources:`;for(const f of d){if(!f||typeof f!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${f}`);x+=`
- ${f}`}m+=x}return`${b}
${m}`}class Xe extends Error{constructor({message:t,code:r,cause:n,name:s}){var i;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(i=s??(n instanceof Error?n.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=r}}class il extends Xe{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function Lk({error:e,options:t}){var r,n,s;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Xe({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Xe({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Xe({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Xe({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Xe({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Xe({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return i.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new Xe({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Xe({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const l=window.location.hostname;if(lg(l)){if(i.rp.id!==l)return new Xe({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Xe({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Xe({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Xe({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Xe({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Pk({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Xe({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Xe({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(lg(n)){if(r.rpId!==n)return new Xe({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Xe({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Xe({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Xe({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class Ok{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Uk=new Ok;function Dk(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=Tl(e,["challenge","user","excludeCredentials"]),i=vn(t).buffer,l=Object.assign(Object.assign({},r),{id:vn(r.id).buffer}),o=Object.assign(Object.assign({},s),{challenge:i,user:l});if(n&&n.length>0){o.excludeCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const d=n[c];o.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:vn(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return o}function Fk(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=Tl(e,["challenge","allowCredentials"]),s=vn(t).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const o=r[l];i.allowCredentials[l]=Object.assign(Object.assign({},o),{id:vn(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return i}function Mk(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:Ea(new Uint8Array(e.response.attestationObject)),clientDataJSON:Ea(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function $k(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Ea(new Uint8Array(s.authenticatorData)),clientDataJSON:Ea(new Uint8Array(s.clientDataJSON)),signature:Ea(new Uint8Array(s.signature)),userHandle:s.userHandle?Ea(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function lg(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Hh(){var e,t;return!!(dt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function Bk(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new il("Browser returned unexpected credential type",t)}:{data:null,error:new il("Empty credential response",t)}}catch(t){return{data:null,error:Lk({error:t,options:e})}}}async function zk(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new il("Browser returned unexpected credential type",t)}:{data:null,error:new il("Empty credential response",t)}}catch(t){return{data:null,error:Pk({error:t,options:e})}}}const qk={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Gk={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ll(...e){const t=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of e)if(s)for(const i in s){const l=s[i];if(l!==void 0)if(Array.isArray(l))n[i]=l;else if(r(l))n[i]=l;else if(t(l)){const o=n[i];t(o)?n[i]=ll(o,l):n[i]=ll(l)}else n[i]=l}return n}function Vk(e,t){return ll(qk,e,t||{})}function Hk(e,t){return ll(Gk,e,t||{})}class Wk{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:s},i){try{const{data:l,error:o}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!l)return{data:null,error:o};const c=s??Uk.createNewAbortSignal();if(l.webauthn.type==="create"){const{user:d}=l.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${n}`),d.displayName||(d.displayName=d.name)}switch(l.webauthn.type){case"create":{const d=Vk(l.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:u,error:h}=await Bk({publicKey:d,signal:c});return u?{data:{factorId:t,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const d=Hk(l.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:u,error:h}=await zk(Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:t,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(l){return ie(l)?{data:null,error:l}:{data:null,error:new _a("Unexpected error in challenge",l)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!r)return{data:null,error:new Ls("rpId is required for WebAuthn authentication")};try{if(!Hh())return{data:null,error:new _a("Browser does not support WebAuthn",null)};const{data:l,error:o}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:i});if(!l)return{data:null,error:o};const{webauthn:c}=l;return this._verify({factorId:t,challengeId:l.challengeId,webauthn:{type:c.type,rpId:r,rpOrigins:n,credential_response:c.credential_response}})}catch(l){return ie(l)?{data:null,error:l}:{data:null,error:new _a("Unexpected error in authenticate",l)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!r)return{data:null,error:new Ls("rpId is required for WebAuthn registration")};try{if(!Hh())return{data:null,error:new _a("Browser does not support WebAuthn",null)};const{data:l,error:o}=await this._enroll({friendlyName:t});if(!l)return await this.client.mfa.listFactors().then(u=>{var h;return(h=u.data)===null||h===void 0?void 0:h.all.find(p=>p.factor_type==="webauthn"&&p.friendly_name===t&&p.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:o};const{data:c,error:d}=await this._challenge({factorId:l.id,friendlyName:l.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:i});return c?this._verify({factorId:l.id,challengeId:c.challengeId,webauthn:{rpId:r,rpOrigins:n,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(l){return ie(l)?{data:null,error:l}:{data:null,error:new _a("Unexpected error in register",l)}}}}Ak();const Kk={url:qv,storageKey:Gv,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Vv,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Wh(e,t,r){return await r()}const Wa={};class Ps{get jwks(){var t,r;return(r=(t=Wa[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){Wa[this.storageKey]=Object.assign(Object.assign({},Wa[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=Wa[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Wa[this.storageKey]=Object.assign(Object.assign({},Wa[this.storageKey]),{cachedAt:t})}constructor(t){var r,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},Kk),t);if(this.storageKey=i.storageKey,this.instanceID=(r=Ps.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Ps.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&dt()){const l=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(l),this.logDebugMessages&&console.trace(l)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Sk({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=ng(i.fetch),this.lock=i.lock||Wh,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&dt()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=Ck:this.lock=Wh,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Wk(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:ag()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Vh(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Vh(this.memoryStorage)),dt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l),await this._notifyAllSubscribers(l.data.event,l.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${eg}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},n="none";if(dt()&&(r=ik(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),dt()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(r,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Qv(i)){const c=(t=i.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:l,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",l,"redirect type",o),await this._saveSession(l),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",l):await this._notifyAllSubscribers("SIGNED_IN",l)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return ie(r)?this._returnResult({error:r}):this._returnResult({error:new _a("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,s;try{const i=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.captchaToken}},xform:nr}),{data:l,error:o}=i;if(o||!l)return this._returnResult({data:{user:null,session:null},error:o});const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(ie(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(t){var r,n,s;try{let i;if("email"in t){const{email:u,password:h,options:p}=t;let v=null,g=null;this.flowType==="pkce"&&([v,g]=await Ga(this.storage,this.storageKey)),i=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:u,password:h,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:v,code_challenge_method:g},xform:nr})}else if("phone"in t){const{phone:u,password:h,options:p}=t;i=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},channel:(s=p==null?void 0:p.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:nr})}else throw new fi("You must provide either an email or phone number and a password");const{data:l,error:o}=i;if(o||!l)return await ct(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(await ct(this.storage,`${this.storageKey}-code-verifier`),ie(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(t){try{let r;if("email"in t){const{email:i,password:l,options:o}=t;r=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:qh})}else if("phone"in t){const{phone:i,password:l,options:o}=t;r=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:qh})}else throw new fi("You must provide either an email or phone number and a password");const{data:n,error:s}=r;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const i=new qa;return this._returnResult({data:{user:null,session:null},error:i})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(ie(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,n,s,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,s,i,l,o,c,d,u,h,p;let v,g;if("message"in t)v=t.message,g=t.signature;else{const{chain:k,wallet:b,statement:m,options:x}=t;let f;if(dt())if(typeof b=="object")f=b;else{const Q=window;if("ethereum"in Q&&typeof Q.ethereum=="object"&&"request"in Q.ethereum&&typeof Q.ethereum.request=="function")f=Q.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");f=b}const j=new URL((r=x==null?void 0:x.url)!==null&&r!==void 0?r:window.location.href),T=await f.request({method:"eth_requestAccounts"}).then(Q=>Q).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!T||T.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const L=ig(T[0]);let C=(n=x==null?void 0:x.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!C){const Q=await f.request({method:"eth_chainId"});C=Tk(Q)}const O={domain:j.host,address:L,statement:m,uri:j.href,version:"1",chainId:C,nonce:(s=x==null?void 0:x.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(l=(i=x==null?void 0:x.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&l!==void 0?l:new Date,expirationTime:(o=x==null?void 0:x.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(c=x==null?void 0:x.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=x==null?void 0:x.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=x==null?void 0:x.signInWithEthereum)===null||u===void 0?void 0:u.resources};v=Ik(O),g=await f.request({method:"personal_sign",params:[Rk(v),L]})}try{const{data:k,error:b}=await de(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:v,signature:g},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=t.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:nr});if(b)throw b;if(!k||!k.session||!k.user){const m=new qa;return this._returnResult({data:{user:null,session:null},error:m})}return k.session&&(await this._saveSession(k.session),await this._notifyAllSubscribers("SIGNED_IN",k.session)),this._returnResult({data:Object.assign({},k),error:b})}catch(k){if(ie(k))return this._returnResult({data:{user:null,session:null},error:k});throw k}}async signInWithSolana(t){var r,n,s,i,l,o,c,d,u,h,p,v;let g,k;if("message"in t)g=t.message,k=t.signature;else{const{chain:b,wallet:m,statement:x,options:f}=t;let j;if(dt())if(typeof m=="object")j=m;else{const L=window;if("solana"in L&&typeof L.solana=="object"&&("signIn"in L.solana&&typeof L.solana.signIn=="function"||"signMessage"in L.solana&&typeof L.solana.signMessage=="function"))j=L.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(f!=null&&f.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=m}const T=new URL((r=f==null?void 0:f.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in j&&j.signIn){const L=await j.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},f==null?void 0:f.signInWithSolana),{version:"1",domain:T.host,uri:T.href}),x?{statement:x}:null));let C;if(Array.isArray(L)&&L[0]&&typeof L[0]=="object")C=L[0];else if(L&&typeof L=="object"&&"signedMessage"in L&&"signature"in L)C=L;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in C&&"signature"in C&&(typeof C.signedMessage=="string"||C.signedMessage instanceof Uint8Array)&&C.signature instanceof Uint8Array)g=typeof C.signedMessage=="string"?C.signedMessage:new TextDecoder().decode(C.signedMessage),k=C.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in j)||typeof j.signMessage!="function"||!("publicKey"in j)||typeof j!="object"||!j.publicKey||!("toBase58"in j.publicKey)||typeof j.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${T.host} wants you to sign in with your Solana account:`,j.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${T.href}`,`Issued At: ${(s=(n=f==null?void 0:f.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=f==null?void 0:f.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${f.signInWithSolana.notBefore}`]:[],...!((l=f==null?void 0:f.signInWithSolana)===null||l===void 0)&&l.expirationTime?[`Expiration Time: ${f.signInWithSolana.expirationTime}`]:[],...!((o=f==null?void 0:f.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${f.signInWithSolana.chainId}`]:[],...!((c=f==null?void 0:f.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${f.signInWithSolana.nonce}`]:[],...!((d=f==null?void 0:f.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${f.signInWithSolana.requestId}`]:[],...!((h=(u=f==null?void 0:f.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...f.signInWithSolana.resources.map(C=>`- ${C}`)]:[]].join(`
`);const L=await j.signMessage(new TextEncoder().encode(g),"utf8");if(!L||!(L instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");k=L}}try{const{data:b,error:m}=await de(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Ea(k)},!((p=t.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(v=t.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:nr});if(m)throw m;if(!b||!b.session||!b.user){const x=new qa;return this._returnResult({data:{user:null,session:null},error:x})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:m})}catch(b){if(ie(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async _exchangeCodeForSession(t){const r=await ma(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{if(!n&&this.flowType==="pkce")throw new Xv;const{data:i,error:l}=await de(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:nr});if(await ct(this.storage,`${this.storageKey}-code-verifier`),l)throw l;if(!i||!i.session||!i.user){const o=new qa;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:l})}catch(i){if(await ct(this.storage,`${this.storageKey}-code-verifier`),ie(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(t){try{const{options:r,provider:n,token:s,access_token:i,nonce:l}=t,o=await de(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:l,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:nr}),{data:c,error:d}=o;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){const u=new qa;return this._returnResult({data:{user:null,session:null},error:u})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:d})}catch(r){if(ie(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,n,s,i,l;try{if("email"in t){const{email:o,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await Ga(this.storage,this.storageKey));const{error:h}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=c==null?void 0:c.data)!==null&&r!==void 0?r:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in t){const{phone:o,options:c}=t,{data:d,error:u}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(l=c==null?void 0:c.channel)!==null&&l!==void 0?l:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u})}throw new fi("You must provide either an email or phone number.")}catch(o){if(await ct(this.storage,`${this.storageKey}-code-verifier`),ie(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(t){var r,n;try{let s,i;"options"in t&&(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo,i=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:l,error:o}=await de(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:nr});if(o)throw o;if(!l)throw new Error("An error occurred on token verification.");const c=l.session,d=l.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(s){if(ie(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(t){var r,n,s,i,l;try{let o=null,c=null;this.flowType==="pkce"&&([o,c]=await Ga(this.storage,this.storageKey));const d=await de(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=t==null?void 0:t.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:c}),headers:this.headers,xform:wk});return!((i=d.data)===null||i===void 0)&&i.url&&dt()&&!(!((l=t.options)===null||l===void 0)&&l.skipBrowserRedirect)&&window.location.assign(d.data.url),this._returnResult(d)}catch(o){if(await ct(this.storage,`${this.storageKey}-code-verifier`),ie(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new $t;const{error:s}=await de(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(t){if(ie(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:s,options:i}=t,{error:l}=await de(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:l})}else if("phone"in t){const{phone:n,type:s,options:i}=t,{data:l,error:o}=await de(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:o})}throw new fi("You must provide either an email or phone number and a type")}catch(r){if(ie(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await ma(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<xo:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const l=await ma(this.userStorage,this.storageKey+"-user");l!=null&&l.user?t.user=l.user:t.user=vo()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const l={value:this.suppressGetSessionWarning};t.user=yk(t.user,l),l.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:s,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const r=await this._acquireLock(-1,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(t){try{return t?await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Vr}):await this._useSession(async r=>{var n,s,i;const{data:l,error:o}=r;if(o)throw o;return!(!((n=l.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new $t}:await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=l.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Vr})})}catch(r){if(ie(r))return Jv(r)&&(await this._removeSession(),await ct(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new $t;const l=s.session;let o=null,c=null;this.flowType==="pkce"&&t.email!=null&&([o,c]=await Ga(this.storage,this.storageKey));const{data:d,error:u}=await de(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:c}),jwt:l.access_token,xform:Vr});if(u)throw u;return l.user=d.user,await this._saveSession(l),await this._notifyAllSubscribers("USER_UPDATED",l),this._returnResult({data:{user:l.user},error:null})})}catch(n){if(await ct(this.storage,`${this.storageKey}-code-verifier`),ie(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new $t;const r=Date.now()/1e3;let n=r,s=!0,i=null;const{payload:l}=yo(t.access_token);if(l.exp&&(n=l.exp,s=n<=r),s){const{data:o,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(t.access_token);if(c)throw c;i={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(r){if(ie(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:l,error:o}=r;if(o)throw o;t=(n=l.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new $t;const{data:s,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(ie(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!dt())throw new gi("No browser detected.");if(t.error||t.error_description||t.error_code)throw new gi(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Uh("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new gi("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Uh("No code detected.");const{data:x,error:f}=await this._exchangeCodeForSession(t.code);if(f)throw f;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:l,expires_in:o,expires_at:c,token_type:d}=t;if(!i||!o||!l||!d)throw new gi("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let p=u+h;c&&(p=parseInt(c));const v=p-u;v*1e3<=Ja&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${v}s, should have been closer to ${h}s`);const g=p-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,p,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,p,u);const{data:k,error:b}=await this._getUser(i);if(b)throw b;const m={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:p,refresh_token:l,token_type:d,user:k.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:m,redirectType:t.type},error:null})}catch(n){if(ie(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await ma(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({error:i});const l=(n=s.session)===null||n===void 0?void 0:n.access_token;if(l){const{error:o}=await this.admin.signOut(l,t);if(o&&!(Yv(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return t!=="others"&&(await this._removeSession(),await ct(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=sk(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,s;try{const{data:{session:i},error:l}=r;if(l)throw l;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Ga(this.storage,this.storageKey,!0));try{return await de(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(i){if(await ct(this.storage,`${this.storageKey}-code-verifier`),ie(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(ie(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:s}=await this._useSession(async i=>{var l,o,c,d,u;const{data:h,error:p}=i;if(p)throw p;const v=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(l=t.options)===null||l===void 0?void 0:l.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await de(this.fetch,"GET",v,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return dt()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:t.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(ie(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:i}}=r;if(s)throw s;const{options:l,provider:o,token:c,access_token:d,nonce:u}=t,h=await de(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=i==null?void 0:i.access_token)!==null&&n!==void 0?n:void 0,body:{provider:o,id_token:c,access_token:d,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:nr}),{data:p,error:v}=h;return v?this._returnResult({data:{user:null,session:null},error:v}):!p||!p.session||!p.user?this._returnResult({data:{user:null,session:null},error:new qa}):(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("USER_UPDATED",p.session)),this._returnResult({data:p,error:v}))}catch(s){if(await ct(this.storage,`${this.storageKey}-code-verifier`),ie(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,s;const{data:i,error:l}=r;if(l)throw l;return await de(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(ie(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await ck(async s=>(s>0&&await ok(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await de(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:nr})),(s,i)=>{const l=200*Math.pow(2,s);return i&&bo(i)&&Date.now()+l-n<Ja})}catch(n){if(this._debug(r,"error",n),ie(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),dt()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await ma(this.storage,this.storageKey);if(s&&this.userStorage){let l=await ma(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!l&&(l={user:s.user},await Qa(this.userStorage,this.storageKey+"-user",l)),s.user=(t=l==null?void 0:l.user)!==null&&t!==void 0?t:vo()}else if(s&&!s.user&&!s.user){const l=await ma(this.storage,this.storageKey+"-user");l&&(l!=null&&l.user)?(s.user=l.user,await ct(this.storage,this.storageKey+"-user"),await Qa(this.storage,this.storageKey,s)):s.user=vo()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const i=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<xo;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${xo}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:l}=await this._callRefreshToken(s.refresh_token);l&&(console.error(l),bo(l)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",l),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:l,error:o}=await this._getUser(s.access_token);!o&&(l!=null&&l.user)?(s.user=l.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(l){console.error("Error getting user data:",l),this._debug(n,"error getting user data, skipping SIGNED_IN notification",l)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new $t;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Il;const{data:i,error:l}=await this._refreshAccessToken(t);if(l)throw l;if(!i.session)throw new $t;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={data:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(s,"error",i),ie(i)){const l={data:null,error:i};return bo(i)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(l),l}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,r,n=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const i=[],l=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,r)}catch(c){i.push(c)}});if(await Promise.all(l),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await ct(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Qa(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const i=Bh(s);await Qa(this.storage,this.storageKey,i)}else{const s=Bh(r);await Qa(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ct(this.storage,this.storageKey),await ct(this.storage,this.storageKey+"-code-verifier"),await ct(this.storage,this.storageKey+"-user"),this.userStorage&&await ct(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&dt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Ja);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-t)/Ja);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ja}ms, refresh threshold is ${Ac} ticks`),s<=Ac&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof sg)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!dt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,l]=await Ga(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(l)}`});s.push(o.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;return i?this._returnResult({data:null,error:i}):await de(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(ie(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,s;const{data:i,error:l}=r;if(l)return this._returnResult({data:null,error:l});const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:c,error:d}=await de(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return d?this._returnResult({data:null,error:d}):(t.factorType==="totp"&&c.type==="totp"&&(!((s=c==null?void 0:c.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(r){if(ie(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({data:null,error:i});const l=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Mk(t.webauthn.credential_response):$k(t.webauthn.credential_response)})}:{code:t.code}),{data:o,error:c}=await de(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:l,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:c}))})}catch(r){if(ie(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({data:null,error:i});const l=await de(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(l.error)return l;const{data:o}=l;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Dk(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Fk(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(ie(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:n},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=yo(n.access_token);let l=null;i.aal&&(l=i.aal);let o=l;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(o="aal2");const d=i.amr||[];return{data:{currentLevel:l,nextLevel:o,currentAuthenticationMethods:d},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await de(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new $t})})}catch(r){if(ie(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new $t});const l=await de(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return l.data&&l.data.redirect_url&&dt()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(l.data.redirect_url),l})}catch(n){if(ie(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new $t});const l=await de(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return l.data&&l.data.redirect_url&&dt()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(l.data.redirect_url),l})}catch(n){if(ie(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await de(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new $t})})}catch(t){if(ie(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?(await de(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new $t})})}catch(r){if(ie(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(o=>o.kid===t);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(o=>o.kid===t),n&&this.jwks_cached_at+Wv>s)return n;const{data:i,error:l}=await de(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(l)throw l;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,n=i.keys.find(o=>o.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:v,error:g}=await this.getSession();if(g||!v.session)return this._returnResult({data:null,error:g});n=v.session.access_token}const{header:s,payload:i,signature:l,raw:{header:o,payload:c}}=yo(n);r!=null&&r.allowExpired||mk(i.exp);const d=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!d){const{error:v}=await this.getUser(n);if(v)throw v;return{data:{claims:i,header:s,signature:l},error:null}}const u=xk(s.alg),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,l,ak(`${o}.${c}`)))throw new Ic("Invalid JWT signature");return{data:{claims:i,header:s,signature:l},error:null}}catch(n){if(ie(n))return this._returnResult({data:null,error:n});throw n}}}Ps.nextInstanceID={};const Yk=Ps,Jk="2.89.0";let Xn="";typeof Deno<"u"?Xn="deno":typeof document<"u"?Xn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Xn="react-native":Xn="node";const Qk={"X-Client-Info":`supabase-js-${Xn}/${Jk}`},Xk={headers:Qk},Zk={schema:"public"},e_={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},t_={};function Os(e){"@babel/helpers - typeof";return Os=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Os(e)}function r_(e,t){if(Os(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Os(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function a_(e){var t=r_(e,"string");return Os(t)=="symbol"?t:t+""}function n_(e,t,r){return(t=a_(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kh(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function He(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Kh(Object(r),!0).forEach(function(n){n_(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const s_=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),i_=()=>Headers,l_=(e,t,r)=>{const n=s_(r),s=i_();return async(i,l)=>{var o;const c=(o=await t())!==null&&o!==void 0?o:e;let d=new s(l==null?void 0:l.headers);return d.has("apikey")||d.set("apikey",e),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),n(i,He(He({},l),{},{headers:d}))}};function o_(e){return e.endsWith("/")?e:e+"/"}function c_(e,t){var r,n;const{db:s,auth:i,realtime:l,global:o}=e,{db:c,auth:d,realtime:u,global:h}=t,p={db:He(He({},c),s),auth:He(He({},d),i),realtime:He(He({},u),l),storage:{},global:He(He(He({},h),o),{},{headers:He(He({},(r=h==null?void 0:h.headers)!==null&&r!==void 0?r:{}),(n=o==null?void 0:o.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return e.accessToken?p.accessToken=e.accessToken:delete p.accessToken,p}function d_(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(o_(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var u_=class extends Yk{constructor(e){super(e)}},h_=class{constructor(e,t,r){var n,s;this.supabaseUrl=e,this.supabaseKey=t;const i=d_(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const l=`sb-${i.hostname.split(".")[0]}-auth-token`,o={db:Zk,realtime:t_,auth:He(He({},e_),{},{storageKey:l}),global:Xk},c=c_(r??{},o);if(this.storageKey=(n=c.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(s=c.global.headers)!==null&&s!==void 0?s:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(u,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}});else{var d;this.auth=this._initSupabaseAuthClient((d=c.auth)!==null&&d!==void 0?d:{},this.headers,c.global.fetch)}this.fetch=l_(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(He({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&this.accessToken().then(u=>this.realtime.setAuth(u)).catch(u=>console.warn("Failed to set initial Realtime auth token:",u)),this.rest=new Vy(new URL("rest/v1",i).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),this.storage=new zv(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new $y(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,r;if(e.accessToken)return await e.accessToken();const{data:n}=await e.auth.getSession();return(t=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,storageKey:i,flowType:l,lock:o,debug:c,throwOnError:d},u,h){const p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new u_({url:this.authUrl.href,headers:He(He({},p),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:s,flowType:l,lock:o,debug:c,throwOnError:d,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new ov(this.realtimeUrl.href,He(He({},e),{},{params:He(He({},{apikey:this.supabaseKey}),e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const og=(e,t,r)=>new h_(e,t,r);function p_(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}p_()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const f_="https://rfhuqenntxiqurplenjn.supabase.co",g_="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmaHVxZW5udHhpcXVycGxlbmpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NjEwNDgsImV4cCI6MjA4MTUzNzA0OH0.pi_6p2H2nuPfJvdT3pHNGpk0BTI3WQKTSzsj8dxQBA8",J=og(f_,g_);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var m_={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),se=(e,t)=>{const r=y.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:o="",children:c,...d},u)=>y.createElement("svg",{ref:u,...m_,width:s,height:s,stroke:n,strokeWidth:l?Number(i)*24/Number(s):i,className:["lucide",`lucide-${x_(e)}`,o].join(" "),...d},[...t.map(([h,p])=>y.createElement(h,p)),...Array.isArray(c)?c:[c]]));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=se("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=se("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yh=se("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cg=se("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b_=se("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gd=se("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=se("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dg=se("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=se("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ug=se("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vd=se("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ol=se("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ll=se("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=se("Code2",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=se("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jh=se("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qh=se("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=se("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lc=se("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=se("FileCode",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_=se("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_=se("Files",[["path",{d:"M20 7h-3a2 2 0 0 1-2-2V2",key:"x099mo"}],["path",{d:"M9 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7l4 4v10a2 2 0 0 1-2 2Z",key:"18t6ie"}],["path",{d:"M3 7.6v12.8A1.6 1.6 0 0 0 4.6 22h9.8",key:"1nja0z"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=se("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k_=se("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=se("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __=se("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cl=se("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_=se("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N_=se("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=se("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_=se("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xh=se("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S_=se("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pg=se("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=se("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=se("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E_=se("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C_=se("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=se("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=se("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=se("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gg=se("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ti=se("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A_=se("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T_=se("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R_=se("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I_=se("Tablet",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ul=se("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zh=se("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e0=se("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=se("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L_=se("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hd=se("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t0=se("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P_=se("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O_=se("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pc=se("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=se("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=se("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),mg=y.createContext(void 0);function U_({children:e}){const[t,r]=y.useState(()=>{if(typeof window>"u")return"dark";const s=localStorage.getItem("theme");return s==="light"||s==="dark"?s:"dark"});y.useEffect(()=>{const s=window.document.documentElement;t==="dark"?(s.classList.add("dark"),s.classList.remove("light")):(s.classList.add("light"),s.classList.remove("dark")),localStorage.setItem("theme",t)},[t]);const n=()=>{r(s=>{const i=s==="light"?"dark":"light";return console.log("Theme toggled:",s,"->",i),i})};return a.jsx(mg.Provider,{value:{theme:t,toggleTheme:n},children:e})}function D_(){const e=y.useContext(mg);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e}function xg(){const[e,t]=y.useState(null),[r,n]=y.useState(!0);y.useEffect(()=>{s();const{data:{subscription:i}}=J.auth.onAuthStateChange(()=>{s()});return()=>i.unsubscribe()},[]);const s=async()=>{try{const{data:{user:i}}=await J.auth.getUser();if(!i){t(null),n(!1);return}const{data:l,error:o}=await J.from("user_profiles").select("role").eq("id",i.id).maybeSingle();o?(console.error("Supabase query error:",o),console.error("Error details:",{code:o.code,message:o.message,details:o.details,hint:o.hint}),t(null)):l?t(l.role):(console.warn("No user profile found for user:",i.id),t(null))}catch(i){console.error("Error fetching role:",i),t(null)}finally{n(!1)}};return{role:e,loading:r,isAdmin:e==="admin",isViewer:e==="viewer",refetch:s}}function F_(){const[e,t]=y.useState(""),[r,n]=y.useState(""),[s,i]=y.useState(!1),[l,o]=y.useState(null),c=async d=>{d.preventDefault(),i(!0),o(null);try{const{error:u}=await J.auth.signInWithPassword({email:e,password:r});if(u)throw u}catch(u){o(u.message||"An error occurred")}finally{i(!1)}};return a.jsx("div",{className:"min-h-screen bg-neutral-50 dark:bg-neutral-950 flex items-center justify-center p-4 transition-colors",children:a.jsxs("div",{className:"w-full max-w-md",children:[a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-xl shadow-lg border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-brand-600 p-8 text-white text-center",children:[a.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-white/20 backdrop-blur-sm rounded-lg mx-auto mb-4",children:a.jsx(sa,{size:24})}),a.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Welcome Back"}),a.jsx("p",{className:"text-white/80 text-sm",children:"Sign in to your URL tracking dashboard"})]}),a.jsxs("div",{className:"p-8",children:[a.jsxs("div",{className:"mb-6 p-3 bg-brand-500/10 dark:bg-brand-500/20 border border-brand-500/30 dark:border-brand-500/40 rounded-lg flex items-start gap-3 text-brand-700 dark:text-brand-400 text-sm",children:[a.jsx(k_,{size:18,className:"flex-shrink-0 mt-0.5"}),a.jsx("p",{children:"User accounts are created by administrators. Contact your admin if you need access."})]}),l&&a.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 dark:bg-red-500/20 border border-red-500/30 dark:border-red-500/40 rounded-lg flex items-center gap-3 text-red-700 dark:text-red-400",children:[a.jsx(Nr,{size:19,className:"flex-shrink-0"}),a.jsx("span",{className:"text-sm font-medium",children:l})]}),a.jsxs("form",{onSubmit:c,className:"space-y-5",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(hg,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),a.jsx("input",{type:"email",value:e,onChange:d=>t(d.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-white placeholder-neutral-400 dark:placeholder-neutral-500 focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 dark:focus:border-brand-500 outline-none transition-all",placeholder:"you@example.com",required:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(w_,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),a.jsx("input",{type:"password",value:r,onChange:d=>n(d.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-white placeholder-neutral-400 dark:placeholder-neutral-500 focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 dark:focus:border-brand-500 outline-none transition-all",placeholder:"Enter your password",required:!0,minLength:6})]})]}),a.jsx("button",{type:"submit",disabled:s,className:"w-full bg-brand-600 text-white py-2.5 rounded-lg font-medium hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2 mt-6",children:s?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),a.jsx("span",{children:"Signing in..."})]}):"Sign In"})]})]})]}),a.jsx("div",{className:"mt-6 text-center text-xs text-neutral-500 dark:text-neutral-400",children:a.jsx("p",{children:"Secure authentication powered by Supabase"})})]})})}function M_({offer:e,onClose:t,onSave:r}){var ru,au,nu,su,iu;const[n,s]=y.useState("settings"),[i,l]=y.useState({offer_name:(e==null?void 0:e.offer_name)||"",campaign_name:(e==null?void 0:e.campaign_name)||"",final_url:(e==null?void 0:e.final_url)||"",tracking_template:(e==null?void 0:e.tracking_template)||"",suffix_pattern:(e==null?void 0:e.suffix_pattern)||"",target_geo:(e==null?void 0:e.target_geo)||"",target_country:(e==null?void 0:e.target_country)||"",custom_referrer:(e==null?void 0:e.custom_referrer)||"",redirect_chain_step:(e==null?void 0:e.redirect_chain_step)||0,retry_limit:(e==null?void 0:e.retry_limit)??3,retry_delay_ms:(e==null?void 0:e.retry_delay_ms)??2e3,is_active:(e==null?void 0:e.is_active)??!0,tracking_urls:(e==null?void 0:e.tracking_urls)||[],tracking_url_rotation_mode:(e==null?void 0:e.tracking_url_rotation_mode)||"sequential",referrers:(e==null?void 0:e.referrers)||[],referrer_rotation_mode:(e==null?void 0:e.referrer_rotation_mode)||"sequential",param_filter:(e==null?void 0:e.param_filter)||[],param_filter_mode:(e==null?void 0:e.param_filter_mode)||"all",tracer_mode:(e==null?void 0:e.tracer_mode)||"auto",block_resources:(e==null?void 0:e.block_resources)??!0,extract_only:(e==null?void 0:e.extract_only)??!0,extract_from_location_header:(e==null?void 0:e.extract_from_location_header)??!1,location_extract_hop:(e==null?void 0:e.location_extract_hop)||null,geo_pool:(e==null?void 0:e.geo_pool)||[],geo_strategy:(e==null?void 0:e.geo_strategy)||"weighted",geo_weights:(e==null?void 0:e.geo_weights)||{},provider_id:(e==null?void 0:e.provider_id)||null,proxy_protocol:(e==null?void 0:e.proxy_protocol)||"http",device_distribution:(e==null?void 0:e.device_distribution)||[{deviceCategory:"mobile",weight:60},{deviceCategory:"desktop",weight:30},{deviceCategory:"tablet",weight:10}]}),[o,c]=y.useState(!1),[d,u]=y.useState(null),[h,p]=y.useState(i.tracking_urls||[]),[v,g]=y.useState(i.referrers||[]),[k,b]=y.useState(i.param_filter||[]),[m,x]=y.useState(""),[f,j]=y.useState(i.geo_pool||[]),[T,L]=y.useState(i.geo_strategy||"weighted"),[C,O]=y.useState(i.geo_weights||{}),[Q,W]=y.useState(""),[pe,A]=y.useState(i.device_distribution||[{deviceCategory:"mobile",weight:60},{deviceCategory:"desktop",weight:30},{deviceCategory:"tablet",weight:10}]),[ne,te]=y.useState(20),[me,K]=y.useState(6e4),[V,_]=y.useState(""),[D,q]=y.useState(!0),[N,B]=y.useState("http_only"),[U,F]=y.useState(!1),[H,be]=y.useState(null),[je,qe]=y.useState(null),[lt,fe]=y.useState(!1),[gt,wt]=y.useState(new Set),[De,nt]=y.useState(null),[M,oe]=y.useState(null),[Ge,ot]=y.useState(!1),[Dr,Yt]=y.useState(!1),[S,Y]=y.useState(""),[E,P]=y.useState("sequential"),[z,re]=y.useState([]),[le,he]=y.useState([]),[Ee,Ae]=y.useState(0),[we,ke]=y.useState(!1),[Re,Mt]=y.useState([]),[Te,I]=y.useState(!0),[ge,ce]=y.useState(!1);y.useEffect(()=>{X()},[]);const X=async()=>{try{const{data:{session:w}}=await J.auth.getSession();if(!w){I(!1);return}const{data:$,error:ae}=await J.from("proxy_providers").select("id, name, provider_type, enabled").eq("user_id",w.user.id).order("priority",{ascending:!0});!ae&&$&&Mt($);const{data:ee}=await J.from("settings").select("luna_proxy_host, luna_proxy_port, luna_proxy_username, luna_proxy_password").eq("user_id",w.user.id).maybeSingle();ee&&ee.luna_proxy_host&&ce(!0)}catch(w){console.error("Failed to fetch providers:",w)}finally{I(!1)}};y.useEffect(()=>{l(w=>({...w,tracking_urls:h,referrers:v,param_filter:k,geo_pool:f,geo_strategy:T,geo_weights:C,device_distribution:pe}))},[h,v,k,f,T,C,pe]);const et=async w=>{if(w.preventDefault(),c(!0),u(null),!i.offer_name.trim()){u("Offer name is required"),c(!1);return}if(!i.campaign_name.trim()){u("Campaign name is required"),c(!1);return}if(!i.final_url.trim()){u("Final URL is required"),c(!1);return}const $=pe.reduce((ae,ee)=>ae+ee.weight,0);if($!==100){u(`Device distribution must total 100% (currently ${$}%)`),c(!1);return}try{const{data:{user:ae}}=await J.auth.getUser();if(!ae)throw new Error("Not authenticated");const ee=Pe=>Pe.map(Ve=>({...Ve,enabled:Ve.enabled!==!1})),xe={...i,tracking_urls:ee(h),referrers:ee(v),param_filter:k,geo_pool:f,geo_strategy:T,geo_weights:C,device_distribution:pe};if(e){const{error:Pe}=await J.from("offers").update(xe).eq("id",e.id);if(Pe)throw Pe}else{const{error:Pe}=await J.from("offers").insert([{...xe,user_id:ae.id}]);if(Pe)throw Pe}r()}catch(ae){u(ae.message||"An error occurred")}finally{c(!1)}},Nt=()=>{p([...h,{url:"",weight:50,enabled:!0,label:""}])},_e=(w,$,ae)=>{const ee=[...h];ee[w]={...ee[w],[$]:ae},p(ee)},Tt=w=>{p(h.filter(($,ae)=>ae!==w))},Fr=()=>{g([...v,{url:"",weight:50,enabled:!0,label:""}])},Fn=(w,$,ae)=>{const ee=[...v];ee[w]={...ee[w],[$]:ae},g(ee)},Kg=w=>{g(v.filter(($,ae)=>ae!==w))},Xd=()=>{m&&!k.includes(m)&&(b([...k,m]),x(""))},Yg=w=>{b(k.filter($=>$!==w))},Jg=()=>{const w=`url,weight,label
https://tracker.example.com/click,70,Primary Tracker
https://backup.example.com/track,30,Backup Tracker
https://alternative.example.com/click,50,Alternative`,$=new Blob([w],{type:"text/csv"}),ae=URL.createObjectURL($),ee=document.createElement("a");ee.href=ae,ee.download="tracking-urls-template.csv",document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),URL.revokeObjectURL(ae)},Qg=()=>{const w=`url,weight,label,hops
https://google.com,50,Google Search,1;2
https://facebook.com,30,Facebook,
https://instagram.com,20,Instagram,1;2;3`,$=new Blob([w],{type:"text/csv"}),ae=URL.createObjectURL($),ee=document.createElement("a");ee.href=ae,ee.download="referrers-template.csv",document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),URL.revokeObjectURL(ae)},Xg=w=>{const $=w.split(`
`).map(xe=>xe.trim()).filter(xe=>xe.length>0),ae=[],ee=[];return $.forEach((xe,Pe)=>{const Ve=Pe+1;if(xe.toLowerCase().startsWith("url,weight,label")||xe.toLowerCase().startsWith("url,weight"))return;const mt=xe.split(",").map(Se=>Se.trim()),gr=mt[0]||"";if(!gr){ee.push(`Line ${Ve}: URL is required`);return}if(!gr.startsWith("http://")&&!gr.startsWith("https://")){ee.push(`Line ${Ve}: URL must start with http:// or https://`);return}let mr=50;if(mt[1]&&mt[1].length>0){const Se=parseInt(mt[1],10);if(isNaN(Se)||Se<1||Se>100){ee.push(`Line ${Ve}: Weight must be between 1 and 100`);return}mr=Se}const pa=mt[2]||"";ae.push({url:gr,weight:mr,enabled:!0,label:pa})}),{entries:ae,errors:ee}},Zg=w=>{const $=w.split(`
`).map(xe=>xe.trim()).filter(xe=>xe.length>0),ae=[],ee=[];return $.forEach((xe,Pe)=>{const Ve=Pe+1;if(xe.toLowerCase().startsWith("url,weight,label,hops")||xe.toLowerCase().startsWith("url,weight"))return;const mt=xe.split(",").map(Rt=>Rt.trim()),gr=mt[0]||"";if(!gr){ee.push(`Line ${Ve}: URL is required`);return}if(!gr.startsWith("http://")&&!gr.startsWith("https://")){ee.push(`Line ${Ve}: URL must start with http:// or https://`);return}let mr=50;if(mt[1]&&mt[1].length>0){const Rt=parseInt(mt[1],10);if(isNaN(Rt)||Rt<1||Rt>100){ee.push(`Line ${Ve}: Weight must be between 1 and 100`);return}mr=Rt}const pa=mt[2]||"";let Se;if(mt[3]&&mt[3].length>0){const xr=mt[3].split(";").map(jt=>jt.trim()).filter(jt=>jt.length>0).map(jt=>parseInt(jt,10));if(xr.some(jt=>isNaN(jt)||jt<1)){ee.push(`Line ${Ve}: Hops must be positive integers separated by semicolons (e.g., 1;2;3)`);return}Se=xr}ae.push({url:gr,weight:mr,enabled:!0,label:pa,hops:Se})}),{entries:ae,errors:ee}},Zd=w=>{const $=w==="url"?Xg(S):Zg(S);if(he($.errors),$.errors.length===0&&$.entries.length>0){const ae=w==="url"?h.map(xe=>xe.url.toLowerCase()):v.map(xe=>xe.url.toLowerCase()),ee=$.entries.filter(xe=>{const Pe=ae.includes(xe.url.toLowerCase());return Pe&&Ae(Ve=>Ve+1),!Pe});re(ee),ke(!0)}},eu=w=>{w==="url"?(p([...h,...z]),l($=>({...$,tracking_url_rotation_mode:E}))):(g([...v,...z]),l($=>({...$,referrer_rotation_mode:E}))),Y(""),re([]),he([]),ke(!1),ot(!1),Yt(!1),Ae(0)},Ks=()=>{Y(""),re([]),he([]),ke(!1),ot(!1),Yt(!1),Ae(0)},em=async()=>{if(!i.tracking_template&&!i.final_url){qe("Please provide a tracking template or final URL");return}F(!0),qe(null),be(null);try{const{data:{session:w}}=await J.auth.getSession();if(!w)throw new Error("Not authenticated");const $=h.filter(Se=>Se.enabled!==!1&&Se.url);let ae="";if($.length>0)if(i.tracking_url_rotation_mode==="random"){const Se=Math.floor(Math.random()*$.length);ae=$[Se].url}else if(i.tracking_url_rotation_mode==="weighted-random"){const Se=$.reduce((xr,jt)=>xr+(jt.weight||1),0);let Rt=Math.random()*Se;for(const xr of $)if(Rt-=xr.weight||1,Rt<=0){ae=xr.url;break}ae||(ae=$[0].url)}else ae=$[0].url;const ee=ae||i.tracking_template||i.final_url,xe=v.filter(Se=>Se.enabled!==!1&&Se.url);let Pe="",Ve;if(xe.length>0){let Se;if(i.referrer_rotation_mode==="random"){const Rt=Math.floor(Math.random()*xe.length);Se=xe[Rt]}else if(i.referrer_rotation_mode==="weighted-random"){const Rt=xe.reduce((jt,sm)=>jt+(sm.weight||1),0);let xr=Math.random()*Rt;for(const jt of xe)if(xr-=jt.weight||1,xr<=0){Se=jt;break}Se||(Se=xe[0])}else Se=xe[0];Se&&(Pe=Se.url,Ve=Se.hops&&Se.hops.length>0?Se.hops:void 0)}const mt={url:ae||i.tracking_template||i.final_url,proxy_protocol:i.proxy_protocol||"http",referrer:Pe||i.custom_referrer||"None",referrer_hops:Ve||[],tracer_mode:N,device_distribution:pe,geo_pool:f.length>0?f:i.target_geo?[i.target_geo]:[],geo_strategy:f.length>0?T:"single",use_proxy:D,timeout_ms:me,max_redirects:ne,user_agent:V||"Default",extract_from_location_header:i.extract_from_location_header||!1,location_extract_hop:i.location_extract_hop||null};oe(mt);const mr=await fetch("https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/trace-redirects",{method:"POST",headers:{Authorization:`Bearer ${w.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({url:ee,max_redirects:ne,timeout_ms:me,user_agent:V||void 0,use_proxy:D,target_country:i.target_geo||null,tracer_mode:N,expected_final_url:i.final_url||void 0,geo_pool:f.length>0?f:void 0,geo_strategy:f.length>0?T:void 0,geo_weights:f.length>0&&T==="weighted"?C:void 0,referrer:Pe||i.custom_referrer||void 0,referrer_hops:Ve,offer_id:(e==null?void 0:e.id)||void 0,user_id:w.user.id,proxy_protocol:i.proxy_protocol||"http",extract_from_location_header:i.extract_from_location_header||!1,location_extract_hop:i.location_extract_hop||null,device_distribution:pe})});if(!mr.ok){const Se=await mr.text();throw new Error(`API request failed: ${mr.statusText} - ${Se}`)}const pa=await mr.json();if(!pa.success)throw new Error(pa.error||"Trace failed");be(pa)}catch(w){qe(w.message||"Failed to execute trace")}finally{F(!1)}},tm=async()=>{if(De===null){alert("Please select a step first");return}if(!e){l({...i,redirect_chain_step:De}),alert("Step configuration updated! Save the offer in Settings tab to persist changes."),nt(null);return}c(!0),u(null);try{const{error:w}=await J.from("offers").update({redirect_chain_step:De}).eq("id",e.id);if(w)throw w;l({...i,redirect_chain_step:De}),alert(`Configuration saved! Now using step ${De+1} for parameter extraction.`),nt(null),r()}catch(w){u(w.message||"Failed to save configuration"),alert("Failed to save configuration: "+w.message)}finally{c(!1)}},rm=w=>{const $=new Set(gt);$.has(w)?$.delete(w):$.add(w),wt($)},tu=w=>{navigator.clipboard.writeText(w)},am=w=>w>=200&&w<300?"bg-green-100 text-green-700":w>=300&&w<400?"bg-blue-100 text-blue-700":w>=400&&w<500?"bg-orange-100 text-orange-700":w>=500?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700",nm=w=>{switch(w){case"http":return"bg-blue-100 text-blue-700";case"meta":return"bg-pink-100 text-pink-700";case"javascript":return"bg-yellow-100 text-yellow-700";case"final":return"bg-green-100 text-green-700";case"error":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return a.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center p-4 z-50",children:[a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col border border-neutral-200 dark:border-neutral-800",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200 dark:border-neutral-800",children:[a.jsx("h2",{className:"text-xl font-bold text-neutral-900 dark:text-neutral-50",children:e?"Edit Offer":"Create New Offer"}),a.jsx("button",{onClick:t,className:"text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-smooth",children:a.jsx(dr,{size:24})})]}),a.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-800",children:a.jsxs("div",{className:"flex overflow-x-auto bg-neutral-50 dark:bg-neutral-850",children:[a.jsx("button",{onClick:()=>s("settings"),className:`px-6 py-3 font-medium text-sm border-b-2 transition-smooth whitespace-nowrap ${n==="settings"?"border-brand-600 dark:border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:"Settings"}),a.jsx("button",{onClick:()=>s("rotation"),className:`px-6 py-3 font-medium text-sm border-b-2 transition-smooth whitespace-nowrap ${n==="rotation"?"border-brand-600 dark:border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:"URL & Referrer Rotation"}),a.jsx("button",{onClick:()=>s("parameters"),className:`px-6 py-3 font-medium text-sm border-b-2 transition-smooth whitespace-nowrap ${n==="parameters"?"border-brand-600 dark:border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:"Parameter Filtering"}),a.jsx("button",{onClick:()=>s("tracer"),className:`px-6 py-3 font-medium text-sm border-b-2 transition-smooth whitespace-nowrap ${n==="tracer"?"border-brand-600 dark:border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:"Redirect Tracer"})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:n==="settings"?a.jsxs("form",{onSubmit:et,className:"p-6 space-y-4",children:[d&&a.jsx("div",{className:"p-3 bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 rounded-lg text-error-700 dark:text-error-300 text-sm",children:d}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Offer Name"}),a.jsx("input",{type:"text",value:i.offer_name,onChange:w=>l({...i,offer_name:w.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Campaign Name *"}),a.jsx("input",{type:"text",value:i.campaign_name,onChange:w=>l({...i,campaign_name:w.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",placeholder:"e.g., Black Friday 2025, Spring Campaign",required:!0}),a.jsx("p",{className:"mt-1 text-sm text-neutral-500 dark:text-neutral-400",children:"Use this to group and identify related offers (searchable)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Final URL"}),a.jsx("input",{type:"url",value:i.final_url,onChange:w=>l({...i,final_url:w.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Legacy Tracking Template (fallback if no rotation URLs configured)"}),a.jsx("input",{type:"url",value:i.tracking_template,onChange:w=>l({...i,tracking_template:w.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",placeholder:"Optional"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Target Geo"}),a.jsx("input",{type:"text",value:i.target_geo,onChange:w=>l({...i,target_geo:w.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",placeholder:"e.g., US, UK"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Target Country for Proxy"}),a.jsx("input",{type:"text",value:i.target_country,onChange:w=>l({...i,target_country:w.target.value.toUpperCase()}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",placeholder:"e.g., US, GB, CA",maxLength:2}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"2-letter country code for Luna proxy geo-targeting"})]})]}),a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 space-y-4",children:[a.jsx("h4",{className:"font-semibold text-neutral-900 dark:text-neutral-50 mb-3",children:"Geo Rotation (Per-Trace)"}),a.jsx("p",{className:"text-sm text-neutral-700 dark:text-neutral-300 mb-4",children:"Configure country-level proxy rotation for each trace. Leave empty to use single target_country."}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Geo Pool"}),a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:Q,onChange:w=>W(w.target.value.toUpperCase()),onKeyPress:w=>{if(w.key==="Enter"){w.preventDefault();const $=Q.trim();$.length===2&&!f.includes($)&&(j([...f,$]),T==="weighted"&&!C[$]&&O({...C,[$]:5}),W(""))}},className:"flex-1 px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none",placeholder:"2-letter code (US, FR, etc.)",maxLength:2}),a.jsxs("button",{type:"button",onClick:()=>{const w=Q.trim();w.length===2&&!f.includes(w)&&(j([...f,w]),T==="weighted"&&!C[w]&&O({...C,[w]:5}),W(""))},className:"px-4 py-2 bg-brand-500 hover:bg-brand-600 text-white rounded-lg transition-smooth flex items-center gap-2",children:[a.jsx(Yr,{size:16})," Add"]})]}),f.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(w=>a.jsxs("div",{className:"flex items-center gap-2 bg-neutral-100 dark:bg-neutral-800 px-3 py-1 rounded-lg",children:[a.jsx("span",{className:"text-sm font-medium",children:w}),a.jsx("button",{type:"button",onClick:()=>{j(f.filter(ae=>ae!==w));const $={...C};delete $[w],O($)},className:"text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200",children:a.jsx(dr,{size:14})})]},w))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Rotation Strategy"}),a.jsxs("select",{value:T,onChange:w=>L(w.target.value),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none",children:[a.jsx("option",{value:"weighted",children:"Weighted"}),a.jsx("option",{value:"round_robin",children:"Round Robin"}),a.jsx("option",{value:"random",children:"Random"})]})]}),T==="weighted"&&f.length>0&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Weights"}),a.jsx("div",{className:"space-y-2",children:f.map(w=>a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-sm font-medium w-12",children:w}),a.jsx("input",{type:"number",value:C[w]||1,onChange:$=>O({...C,[w]:parseInt($.target.value)||1}),min:"1",className:"flex-1 px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"})]},w))}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-2",children:"Higher weight = more frequent selection"})]})]}),a.jsxs("div",{className:"bg-info-50 dark:bg-info-900/20 border border-info-200 dark:border-info-800 rounded-lg p-4 space-y-4",children:[a.jsx("h4",{className:"font-semibold text-neutral-900 dark:text-neutral-50 mb-3",children:"Device Distribution"}),a.jsx("p",{className:"text-sm text-neutral-700 dark:text-neutral-300 mb-4",children:"Configure the percentage distribution of device types for User Agent rotation. Total must equal 100%."}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Mobile %"}),a.jsx("input",{type:"number",value:((ru=pe.find(w=>w.deviceCategory==="mobile"))==null?void 0:ru.weight)||60,onChange:w=>{const $=parseInt(w.target.value)||0;A(ae=>ae.map(ee=>ee.deviceCategory==="mobile"?{...ee,weight:$}:ee))},min:"0",max:"100",className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Desktop %"}),a.jsx("input",{type:"number",value:((au=pe.find(w=>w.deviceCategory==="desktop"))==null?void 0:au.weight)||30,onChange:w=>{const $=parseInt(w.target.value)||0;A(ae=>ae.map(ee=>ee.deviceCategory==="desktop"?{...ee,weight:$}:ee))},min:"0",max:"100",className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Tablet %"}),a.jsx("input",{type:"number",value:((nu=pe.find(w=>w.deviceCategory==="tablet"))==null?void 0:nu.weight)||10,onChange:w=>{const $=parseInt(w.target.value)||0;A(ae=>ae.map(ee=>ee.deviceCategory==="tablet"?{...ee,weight:$}:ee))},min:"0",max:"100",className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:["Total: ",pe.reduce((w,$)=>w+$.weight,0),"%"]}),pe.reduce((w,$)=>w+$.weight,0)!==100&&a.jsx("span",{className:"text-sm text-warning-600 dark:text-warning-400",children:"(Must equal 100%)"})]}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"Default: Mobile 60%, Desktop 30%, Tablet 10%. Adjust for campaign-specific targeting."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Redirect Chain Step"}),a.jsx("input",{type:"number",value:i.redirect_chain_step,onChange:w=>l({...i,redirect_chain_step:parseInt(w.target.value)||0}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",min:"0"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Which step in the redirect chain to extract parameters from (0 = first step)"})]}),a.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-4 space-y-4",children:[a.jsx("h4",{className:"font-semibold text-neutral-900 dark:text-neutral-50 mb-3",children:"Retry Configuration"}),a.jsx("p",{className:"text-sm text-neutral-700 dark:text-neutral-300 mb-4",children:"Configure how many times to retry if trace/fetch fails"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Retry Limit"}),a.jsx("input",{type:"number",value:i.retry_limit,onChange:w=>l({...i,retry_limit:parseInt(w.target.value)||3}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",min:"0",max:"10"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Number of retry attempts if trace fails (0-10)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Retry Delay (ms)"}),a.jsx("input",{type:"number",value:i.retry_delay_ms,onChange:w=>l({...i,retry_delay_ms:parseInt(w.target.value)||2e3}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",min:"500",max:"10000",step:"500"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Delay between retries in milliseconds (500-10000ms)"})]})]})]}),a.jsxs("div",{className:"bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800 rounded-lg p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-brand-600 dark:bg-brand-500 text-white rounded-full flex items-center justify-center font-bold",children:"AI"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold text-neutral-900 dark:text-neutral-50 mb-1",children:"Intelligent Tracer System"}),a.jsx("p",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:"Advanced redirect tracing with automatic detection"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Tracer Mode"}),a.jsxs("select",{value:i.tracer_mode,onChange:w=>l({...i,tracer_mode:w.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",children:[a.jsx("option",{value:"auto",children:"Auto (Intelligent Detection) - Recommended"}),a.jsx("option",{value:"http_only",children:"HTTP-Only (Fast, 2-5s)"}),a.jsx("option",{value:"browser",children:"Browser (Complex, 10-30s)"}),a.jsx("option",{value:"anti_cloaking",children:"Anti-Cloaking (Advanced, 15-60s)"}),a.jsx("option",{value:"interactive",children:"Interactive (Engagement, 20-40s)"}),a.jsx("option",{value:"brightdata_browser",children:"Bright Data Browser (Premium, 5-15s)"})]}),a.jsxs("div",{className:"mt-2 space-y-1 text-xs text-neutral-600 dark:text-neutral-400",children:[a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-brand-700 dark:text-brand-400",children:"Auto:"}),a.jsx("span",{children:"Tries HTTP-only first, falls back to browser if needed. Best for most cases."})]}),a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-success-700 dark:text-success-400",children:"HTTP-Only:"}),a.jsx("span",{children:"10-50x faster, 99% less bandwidth. Good for simple redirect chains."})]}),a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-warning-700 dark:text-warning-400",children:"Browser:"}),a.jsx("span",{children:"Full JavaScript execution. Required for complex tracking (CPA networks, SPAs)."})]}),a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-brand-700 dark:text-brand-400",children:"Anti-Cloaking:"}),a.jsx("span",{children:"Stealth mode with bot detection bypass, popup tracking, and obfuscation decoding."})]}),a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-purple-700 dark:text-purple-400",children:"Interactive:"}),a.jsx("span",{children:"Anti-cloaking + realistic session engagement (scrolls, mouse moves, waits) on final URL for minimal bandwidth."})]}),a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-indigo-700 dark:text-indigo-400",children:"Bright Data Browser:"}),a.jsx("span",{children:"Premium residential proxy with full browser automation. Auto-loads API key from settings, minimal bandwidth usage."})]})]})]}),i.tracer_mode==="browser"&&a.jsxs("div",{className:"space-y-3 pt-2 border-t border-brand-200 dark:border-brand-700",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",id:"block_resources",checked:i.block_resources,onChange:w=>l({...i,block_resources:w.target.checked}),className:"w-4 h-4 text-brand-600 border-neutral-300 dark:border-neutral-700 rounded focus:ring-brand-500"}),a.jsx("label",{htmlFor:"block_resources",className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Block Resources (images, CSS, fonts) for faster tracing"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",id:"extract_only",checked:i.extract_only,onChange:w=>l({...i,extract_only:w.target.checked}),className:"w-4 h-4 text-brand-600 border-neutral-300 dark:border-neutral-700 rounded focus:ring-brand-500"}),a.jsx("label",{htmlFor:"extract_only",className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Extract Only (skip full page rendering)"})]})]}),((su=e==null?void 0:e.tracer_detection_result)==null?void 0:su.mode_used)&&a.jsxs("div",{className:"mt-3 p-3 bg-white dark:bg-neutral-850 rounded-lg border border-brand-300 dark:border-brand-700",children:[a.jsx("p",{className:"text-xs font-semibold text-neutral-700 dark:text-neutral-200 mb-1",children:"Last Auto-Detection Result:"}),a.jsxs("div",{className:"text-xs text-neutral-600 dark:text-neutral-400 space-y-1",children:[a.jsxs("p",{children:["Mode Used: ",a.jsx("span",{className:"font-semibold text-neutral-900 dark:text-neutral-50",children:e.tracer_detection_result.mode_used})]}),a.jsxs("p",{children:["Reason: ",a.jsx("span",{className:"text-neutral-700 dark:text-neutral-300",children:e.tracer_detection_result.detection_reason})]}),a.jsxs("p",{children:["Timing: ",a.jsxs("span",{className:"text-neutral-700 dark:text-neutral-300",children:[e.tracer_detection_result.timing_ms,"ms"]})]}),a.jsxs("p",{children:["Bandwidth: ",a.jsxs("span",{className:"text-neutral-700 dark:text-neutral-300",children:[e.tracer_detection_result.bandwidth_kb," KB"]})]})]})]})]}),a.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-emerald-600 dark:bg-emerald-500 text-white rounded-full flex items-center justify-center font-bold",children:""}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold text-neutral-900 dark:text-neutral-50 mb-1",children:"Location Header Extraction"}),a.jsx("p",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:"Extract parameters from location header of a specific redirect hop"})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",id:"extract_from_location_header",checked:i.extract_from_location_header,onChange:w=>l({...i,extract_from_location_header:w.target.checked}),className:"w-4 h-4 text-emerald-600 border-neutral-300 dark:border-neutral-700 rounded focus:ring-emerald-500"}),a.jsx("label",{htmlFor:"extract_from_location_header",className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Enable Location Header Parameter Extraction"})]}),i.extract_from_location_header&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Extract from Hop (optional)"}),a.jsx("input",{type:"number",value:i.location_extract_hop||"",onChange:w=>l({...i,location_extract_hop:w.target.value?parseInt(w.target.value):null}),min:"1",className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-emerald-500/20 dark:focus:ring-emerald-400/20 focus:border-emerald-500 dark:focus:border-emerald-400 outline-none transition-smooth",placeholder:"Leave empty for last redirect"}),a.jsx("p",{className:"mt-2 text-xs text-neutral-600 dark:text-neutral-400",children:i.location_extract_hop?`Will extract params from location header of hop ${i.location_extract_hop}`:"Will extract params from location header of the last redirect (recommended for most cases)"}),a.jsxs("div",{className:"mt-3 p-3 bg-emerald-100/50 dark:bg-emerald-900/30 rounded border border-emerald-200 dark:border-emerald-800",children:[a.jsxs("p",{className:"text-xs text-emerald-900 dark:text-emerald-200",children:[a.jsx("strong",{children:"Use Case:"})," When the final destination URL with complete tracking parameters (like dclid, gad_source) is embedded in the location header of an intermediate redirect, rather than the final page URL itself."]}),a.jsxs("p",{className:"text-xs text-emerald-800 dark:text-emerald-300 mt-2",children:[a.jsx("strong",{children:"Example:"})," DoubleClick redirects often have the actual landing page URL with all params in their location header."]})]})]})]}),a.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-purple-600 dark:bg-purple-500 text-white rounded-full flex items-center justify-center font-bold",children:""}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold text-neutral-900 dark:text-neutral-50 mb-1",children:"Provider Override"}),a.jsx("p",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:"Select a specific provider for this offer (overrides default rotation)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Proxy Provider"}),Te?a.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Loading providers..."}):a.jsxs("select",{value:i.provider_id||"",onChange:w=>l({...i,provider_id:w.target.value||null}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-purple-500/20 dark:focus:ring-purple-400/20 focus:border-purple-500 dark:focus:border-purple-400 outline-none transition-smooth",children:[ge?a.jsx("option",{value:"",children:"Luna Proxy (from Settings) - Default"}):a.jsx("option",{value:"",children:"No Default Provider Configured"}),Re.filter(w=>w.enabled).length>0&&a.jsxs(a.Fragment,{children:[a.jsx("option",{value:"USE_ROTATION",children:" Use Provider Rotation"}),a.jsx("optgroup",{label:"Specific Providers",children:Re.filter(w=>w.enabled).map(w=>a.jsxs("option",{value:w.id,children:[w.name," (",w.provider_type,")"]},w.id))})]})]}),a.jsx("p",{className:"mt-2 text-xs text-neutral-600 dark:text-neutral-400",children:i.provider_id?i.provider_id==="USE_ROTATION"?" Rotating between all enabled providers":" Using selected provider exclusively (no rotation)":" Using Luna from Settings (default, single provider)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Proxy Protocol"}),a.jsxs("select",{value:i.proxy_protocol||"http",onChange:w=>l({...i,proxy_protocol:w.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-purple-500/20 dark:focus:ring-purple-400/20 focus:border-purple-500 dark:focus:border-purple-400 outline-none transition-smooth",children:[a.jsx("option",{value:"http",children:"HTTP/HTTPS (Standard)"}),a.jsx("option",{value:"socks5",children:"SOCKS5 (TLS Fingerprint Bypass)"})]}),a.jsx("p",{className:"mt-2 text-xs text-neutral-600 dark:text-neutral-400",children:i.proxy_protocol==="socks5"?" SOCKS5 bypasses TLS fingerprinting (recommended for cloaking protection)":" Standard HTTP proxy (faster, but may be detected by anti-cloaking)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Legacy Custom Referrer (fallback if no rotation referrers configured)"}),a.jsx("input",{type:"text",value:i.custom_referrer,onChange:w=>l({...i,custom_referrer:w.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",placeholder:"Optional"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",id:"is_active",checked:i.is_active,onChange:w=>l({...i,is_active:w.target.checked}),className:"w-4 h-4 text-brand-600 border-neutral-300 dark:border-neutral-700 rounded focus:ring-brand-500"}),a.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Active"})]}),a.jsxs("div",{className:"flex gap-3 pt-4 border-t border-neutral-200 dark:border-neutral-800",children:[a.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 border border-neutral-300 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 rounded-lg hover:bg-neutral-50 dark:hover:bg-neutral-850 transition-smooth font-medium",children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:o,className:"flex-1 px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed transition-smooth font-medium flex items-center justify-center gap-2",children:[a.jsx(Ca,{size:18}),o?"Saving...":"Save Offer"]})]})]}):n==="rotation"?a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx("div",{className:"bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800 rounded-lg p-4",children:a.jsx("p",{className:"text-sm text-brand-900 dark:text-brand-300",children:"Configure multiple tracking URLs and referrers with weighted rotation. URLs and referrers will be selected based on the rotation mode you choose."})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Tracking URLs"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{type:"button",onClick:()=>{P(i.tracking_url_rotation_mode),ot(!0)},className:"flex items-center gap-2 px-4 py-2 bg-neutral-600 dark:bg-neutral-700 text-white rounded-lg hover:bg-neutral-700 dark:hover:bg-neutral-600 transition-smooth text-sm font-medium",children:[a.jsx(t0,{size:16}),"Bulk Addition"]}),a.jsxs("button",{type:"button",onClick:Nt,className:"flex items-center gap-2 px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth text-sm font-medium",children:[a.jsx(Yr,{size:16}),"Add URL"]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Rotation Mode"}),a.jsxs("select",{value:i.tracking_url_rotation_mode,onChange:w=>l({...i,tracking_url_rotation_mode:w.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",children:[a.jsx("option",{value:"sequential",children:"Sequential (rotates in order)"}),a.jsx("option",{value:"random",children:"Random (picks randomly)"}),a.jsx("option",{value:"weighted-random",children:"Weighted Random (probability based on weights)"})]})]}),a.jsxs("div",{className:"space-y-3",children:[h.map((w,$)=>a.jsx("div",{className:"bg-gray-50 dark:bg-dark-elevated p-4 rounded-lg border border-gray-200 dark:border-dark-border",children:a.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[a.jsxs("div",{className:"col-span-5",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-dark-text-secondary mb-1",children:"URL"}),a.jsx("input",{type:"url",value:w.url,onChange:ae=>_e($,"url",ae.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text-primary text-sm",placeholder:"https://tracker.com/click?id=123"})]}),a.jsxs("div",{className:"col-span-3",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-dark-text-secondary mb-1",children:"Label"}),a.jsx("input",{type:"text",value:w.label,onChange:ae=>_e($,"label",ae.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text-primary text-sm",placeholder:"Primary Tracker"})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-dark-text-secondary mb-1",children:"Weight"}),a.jsx("input",{type:"number",value:w.weight,onChange:ae=>_e($,"weight",parseInt(ae.target.value)||1),className:"w-full px-3 py-2 border border-gray-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text-primary text-sm",min:"1",max:"100"})]}),a.jsxs("div",{className:"col-span-2 flex items-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>_e($,"enabled",!w.enabled),className:"flex-1 px-3 py-2 text-sm font-medium rounded-lg transition-colors flex items-center justify-center gap-1",title:w.enabled?"Enabled":"Disabled",children:w.enabled?a.jsx(e0,{size:20,className:"text-green-600"}):a.jsx(Zh,{size:20,className:"text-gray-400"})}),a.jsx("button",{type:"button",onClick:()=>Tt($),className:"px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",children:a.jsx(Ds,{size:16})})]})]})},$)),h.length===0&&a.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No tracking URLs configured. Legacy tracking_template will be used as fallback."})]})]}),a.jsxs("div",{className:"border-t border-gray-200 dark:border-neutral-700 pt-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-neutral-100",children:"Referrers"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{type:"button",onClick:()=>{P(i.referrer_rotation_mode),Yt(!0)},className:"flex items-center gap-2 px-4 py-2 bg-neutral-600 dark:bg-neutral-700 text-white rounded-lg hover:bg-neutral-700 dark:hover:bg-neutral-600 transition-colors text-sm font-medium",children:[a.jsx(t0,{size:16}),"Bulk Addition"]}),a.jsxs("button",{type:"button",onClick:Fr,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[a.jsx(Yr,{size:16}),"Add Referrer"]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-neutral-300 mb-2",children:"Referrer Rotation Mode"}),a.jsxs("select",{value:i.referrer_rotation_mode,onChange:w=>l({...i,referrer_rotation_mode:w.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400",children:[a.jsx("option",{value:"sequential",children:"Sequential (rotates in order)"}),a.jsx("option",{value:"random",children:"Random (picks randomly)"}),a.jsx("option",{value:"weighted-random",children:"Weighted Random (probability based on weights)"})]})]}),a.jsxs("div",{className:"space-y-3",children:[v.map((w,$)=>{var ae;return a.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-800 p-4 rounded-lg border border-gray-200 dark:border-neutral-700",children:[a.jsxs("div",{className:"grid grid-cols-12 gap-3 mb-3",children:[a.jsxs("div",{className:"col-span-5",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-neutral-400 mb-1",children:"Referrer URL"}),a.jsx("input",{type:"url",value:w.url,onChange:ee=>Fn($,"url",ee.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 text-sm placeholder:text-gray-400 dark:placeholder:text-neutral-500",placeholder:"https://example.com/landing"})]}),a.jsxs("div",{className:"col-span-3",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-neutral-400 mb-1",children:"Label"}),a.jsx("input",{type:"text",value:w.label,onChange:ee=>Fn($,"label",ee.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 text-sm placeholder:text-gray-400 dark:placeholder:text-neutral-500",placeholder:"Landing Page 1"})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-neutral-400 mb-1",children:"Weight"}),a.jsx("input",{type:"number",value:w.weight,onChange:ee=>Fn($,"weight",parseInt(ee.target.value)||1),className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 text-sm",min:"1",max:"100"})]}),a.jsxs("div",{className:"col-span-2 flex items-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>Fn($,"enabled",!w.enabled),className:"flex-1 px-3 py-2 text-sm font-medium rounded-lg transition-colors flex items-center justify-center gap-1",title:w.enabled?"Enabled":"Disabled",children:w.enabled?a.jsx(e0,{size:20,className:"text-green-600"}):a.jsx(Zh,{size:20,className:"text-gray-400"})}),a.jsx("button",{type:"button",onClick:()=>Kg($),className:"px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",children:a.jsx(Ds,{size:16})})]})]}),a.jsxs("div",{className:"mt-2",children:[a.jsxs("label",{className:"block text-xs font-medium text-gray-600 dark:text-neutral-400 mb-1",children:["Apply to Hops (optional)",a.jsx("span",{className:"ml-1 text-gray-500 dark:text-neutral-500 font-normal",children:"- Leave empty for all hops, or specify: 1,2,3"})]}),a.jsx("input",{type:"text",value:((ae=w.hops)==null?void 0:ae.join(","))||"",onChange:ee=>{const xe=ee.target.value.trim(),Pe=xe?xe.split(",").map(Ve=>parseInt(Ve.trim())).filter(Ve=>!isNaN(Ve)&&Ve>0):[];Fn($,"hops",Pe.length>0?Pe:void 0)},className:"w-full px-3 py-2 border border-gray-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 text-sm placeholder:text-gray-400 dark:placeholder:text-neutral-500",placeholder:"e.g., 1,2,3 (empty = all hops)"})]})]},$)}),v.length===0&&a.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No referrers configured. Legacy custom_referrer will be used as fallback."})]})]})]}),a.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[a.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),a.jsxs("button",{type:"button",onClick:et,disabled:o,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center justify-center gap-2",children:[a.jsx(Ca,{size:18}),o?"Saving...":"Save Rotation Config"]})]})]}):n==="parameters"?a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:a.jsx("p",{className:"text-sm text-blue-900 dark:text-blue-300",children:"Control which parameters are included in the final suffix sent to Google. Use whitelist to only include specific parameters, or blacklist to exclude specific ones."})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-2",children:"Filter Mode"}),a.jsxs("select",{value:i.param_filter_mode,onChange:w=>l({...i,param_filter_mode:w.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-elevated text-gray-900 dark:text-dark-text-primary focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"all",children:"All Parameters (no filtering)"}),a.jsx("option",{value:"whitelist",children:"Whitelist (only include listed parameters)"}),a.jsx("option",{value:"blacklist",children:"Blacklist (exclude listed parameters)"})]})]}),i.param_filter_mode!=="all"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-2",children:"Parameter Names"}),a.jsxs("div",{className:"flex gap-2 mb-3",children:[a.jsx("input",{type:"text",value:m,onChange:w=>x(w.target.value),onKeyPress:w=>w.key==="Enter"&&(w.preventDefault(),Xd()),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-dark-border rounded-lg bg-white dark:bg-dark-elevated text-gray-900 dark:text-dark-text-primary focus:ring-2 focus:ring-blue-500",placeholder:"e.g., gclid, fbclid, utm_source"}),a.jsx("button",{type:"button",onClick:Xd,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:a.jsx(Yr,{size:18})})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.map(w=>a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 dark:bg-dark-elevated text-gray-700 dark:text-dark-text-primary rounded-lg border border-gray-300 dark:border-dark-border",children:[a.jsx("span",{className:"text-sm font-medium",children:w}),a.jsx("button",{type:"button",onClick:()=>Yg(w),className:"text-gray-500 dark:text-dark-text-secondary hover:text-red-600 dark:hover:text-red-400",children:a.jsx(dr,{size:14})})]},w)),k.length===0&&a.jsxs("p",{className:"text-sm text-gray-500 dark:text-dark-text-muted py-2",children:["No parameters in ",i.param_filter_mode," yet. Add parameter names above."]})]})]}),a.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[a.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),a.jsxs("button",{type:"button",onClick:et,disabled:o,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center justify-center gap-2",children:[a.jsx(Ca,{size:18}),o?"Saving...":"Save Parameter Config"]})]})]}):a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:a.jsx("p",{className:"text-sm text-blue-900 dark:text-blue-300",children:"Test your tracking template and configure which redirect step to extract parameters from. Global proxy settings from the Settings page will be used automatically. Make sure to save the offer after configuring the redirect chain step."})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary",children:"Tracer Method"}),a.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[a.jsx("button",{type:"button",onClick:()=>B("http_only"),className:`px-3 py-2.5 rounded-lg font-medium transition-all border-2 text-sm ${N==="http_only"?"bg-blue-600 text-white border-blue-600":"bg-white dark:bg-dark-surface text-gray-700 dark:text-dark-text-primary border-gray-300 dark:border-dark-border hover:border-blue-400"}`,children:"HTTP-Only"}),a.jsx("button",{type:"button",onClick:()=>B("browser"),className:`px-3 py-2.5 rounded-lg font-medium transition-all border-2 text-sm ${N==="browser"?"bg-blue-600 text-white border-blue-600":"bg-white dark:bg-dark-surface text-gray-700 dark:text-dark-text-primary border-gray-300 dark:border-dark-border hover:border-blue-400"}`,children:"Browser"}),a.jsx("button",{type:"button",onClick:()=>B("anti_cloaking"),className:`px-3 py-2.5 rounded-lg font-medium transition-all border-2 text-sm ${N==="anti_cloaking"?"bg-orange-600 text-white border-orange-600":"bg-white dark:bg-dark-surface text-gray-700 dark:text-dark-text-primary border-gray-300 dark:border-dark-border hover:border-orange-400"}`,children:" Anti-Cloak"}),a.jsx("button",{type:"button",onClick:()=>B("interactive"),className:`px-3 py-2.5 rounded-lg font-medium transition-all border-2 text-sm ${N==="interactive"?"bg-purple-600 text-white border-purple-600":"bg-white dark:bg-dark-surface text-gray-700 dark:text-dark-text-primary border-gray-300 dark:border-dark-border hover:border-purple-400"}`,children:" Interactive"}),a.jsx("button",{type:"button",onClick:()=>B("brightdata_browser"),className:`px-3 py-2.5 rounded-lg font-medium transition-all border-2 text-sm ${N==="brightdata_browser"?"bg-indigo-600 text-white border-indigo-600":"bg-white dark:bg-dark-surface text-gray-700 dark:text-dark-text-primary border-gray-300 dark:border-dark-border hover:border-indigo-400"}`,children:" Bright Data"})]}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-dark-text-muted mt-2",children:[N==="http_only"&&" Fast HTTP requests only - No JS execution",N==="browser"&&" Full browser rendering with JS execution & popup tracking",N==="anti_cloaking"&&" Multi-engine: HTTP + Meta + JS + Form detection with proper headers",N==="interactive"&&" Anti-cloaking + realistic session engagement (scrolls, mouse, waits)",N==="brightdata_browser"&&" Premium residential proxy with browser automation - minimal bandwidth"]})]}),a.jsxs("button",{type:"button",onClick:()=>fe(!lt),className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900",children:[lt?a.jsx(ol,{size:16}):a.jsx(Cn,{size:16}),"Advanced Settings"]}),lt&&a.jsxs("div",{className:"space-y-4 pt-2",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Redirects"}),a.jsx("input",{type:"number",value:ne,onChange:w=>te(parseInt(w.target.value)),min:"1",max:"50",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Timeout (ms)"}),a.jsx("input",{type:"number",value:me,onChange:w=>K(parseInt(w.target.value)),min:"5000",max:"60000",step:"1000",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"User Agent (Optional)"}),a.jsx("input",{type:"text",value:V,onChange:w=>_(w.target.value),placeholder:"Default Chrome UA",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",id:"use_proxy",checked:D,onChange:w=>q(w.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),a.jsx("label",{htmlFor:"use_proxy",className:"text-sm font-medium text-gray-700",children:"Use Proxy Settings (from Settings page)"})]})]}),a.jsxs("div",{className:"flex gap-3 pt-2",children:[a.jsx("button",{type:"button",onClick:em,disabled:U,className:"flex items-center gap-2 px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:U?a.jsxs(a.Fragment,{children:[a.jsx(yt,{size:18,className:"animate-spin"}),"Tracing..."]}):a.jsxs(a.Fragment,{children:[a.jsx(dl,{size:18}),"Execute Trace"]})}),H&&a.jsxs("button",{type:"button",onClick:tm,disabled:De===null,className:"flex items-center gap-2 px-6 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",children:[a.jsx(Ca,{size:18}),De!==null?`Use Step ${De+1}`:"Select a Step First"]})]})]}),M&&a.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4",children:[a.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-neutral-100 mb-3 flex items-center gap-2",children:[a.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:""}),"Active Configuration"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm",children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Protocol:"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-neutral-100 uppercase",children:M.proxy_protocol})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Mode:"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-neutral-100",children:M.tracer_mode})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Timeout:"}),a.jsxs("span",{className:"font-semibold text-gray-900 dark:text-neutral-100",children:[M.timeout_ms,"ms"]})]}),a.jsxs("div",{className:"flex items-start gap-2 col-span-1 md:col-span-2 lg:col-span-1",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Referrer:"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-neutral-100 break-all",children:M.referrer==="None"?a.jsx("span",{className:"text-gray-400 dark:text-neutral-500",children:"None"}):M.referrer})]}),((iu=M.referrer_hops)==null?void 0:iu.length)>0&&a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Ref Hops:"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-neutral-100",children:M.referrer_hops.join(", ")})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Geo:"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-neutral-100",children:M.geo_pool.length>0?a.jsxs("span",{className:"flex items-center gap-1",children:[M.geo_pool.join(", ").toUpperCase(),a.jsxs("span",{className:"text-xs text-gray-500 dark:text-neutral-500",children:["(",M.geo_strategy,")"]})]}):a.jsx("span",{className:"text-gray-400 dark:text-neutral-500",children:"None"})})]}),a.jsxs("div",{className:"flex items-start gap-2 col-span-1 md:col-span-2",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Devices:"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-neutral-100",children:M.device_distribution.map(w=>`${w.deviceCategory}: ${w.weight}%`).join(", ")})]}),M.extract_from_location_header&&a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Extract:"}),a.jsxs("span",{className:"font-semibold text-gray-900 dark:text-neutral-100",children:["Location Header ",M.location_extract_hop!==null?`(Hop ${M.location_extract_hop+1})`:""]})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Max Hops:"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-neutral-100",children:M.max_redirects})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-gray-500 dark:text-neutral-400 font-medium min-w-[100px]",children:" Proxy:"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-neutral-100",children:M.use_proxy?"Enabled":"Disabled"})]})]})]}),je&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[a.jsx(Nr,{className:"text-red-600 flex-shrink-0",size:20}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-red-900",children:"Trace Error"}),a.jsx("p",{className:"text-red-700 text-sm mt-1",children:je})]})]}),H&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{className:"font-semibold text-gray-900 dark:text-neutral-100",children:"Trace Results"}),a.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ll,{size:16,className:"text-gray-400 dark:text-neutral-500"}),a.jsxs("span",{className:"text-gray-600 dark:text-neutral-400",children:[H.total_timing_ms,"ms"]})]}),a.jsxs("span",{className:"text-gray-600 dark:text-neutral-400",children:[H.total_steps," steps"]}),H.bandwidth_bytes&&a.jsxs("span",{className:"text-gray-600 dark:text-neutral-400 text-xs font-medium",children:[" ",H.bandwidth_bytes.toLocaleString()," B"]}),H.selected_geo&&a.jsxs("span",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-xs font-semibold",children:[" ",H.selected_geo.toUpperCase()]}),H.total_popups>0&&a.jsxs("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:[H.total_popups," popups"]})]})]}),H.user_agent&&a.jsxs("div",{className:"bg-white dark:bg-neutral-850 border border-gray-200 dark:border-neutral-700 rounded-lg p-3",children:[a.jsx("div",{className:"text-xs font-semibold text-gray-600 dark:text-neutral-400 mb-2",children:"User Agent (full)"}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("code",{className:"flex-1 bg-gray-50 dark:bg-neutral-800 rounded px-3 py-2 text-xs font-mono text-gray-900 dark:text-neutral-100 break-all",children:H.user_agent}),a.jsx("button",{type:"button",onClick:()=>tu(H.user_agent||""),className:"p-2 text-gray-400 dark:text-neutral-500 hover:text-gray-600 dark:hover:text-neutral-300",children:a.jsx(ht,{size:14})})]})]}),a.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:H.chain.map((w,$)=>{const ae=gt.has($),ee=i.redirect_chain_step===$;return a.jsxs("div",{className:`border-2 rounded-lg transition-all ${De===$?"border-green-500 bg-green-50":ee?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"}`,children:[a.jsx("button",{type:"button",onClick:()=>rm($),className:"w-full p-4 text-left",children:a.jsxs("div",{className:"flex items-start justify-between gap-4",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsxs("span",{className:"font-semibold text-gray-900",children:["Step ",$+1]}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${am(w.status)}`,children:w.status||"N/A"}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${nm(w.redirect_type)}`,children:w.redirect_type}),De===$&&a.jsx("span",{className:"px-2 py-1 bg-green-600 text-white text-xs font-medium rounded",children:"SELECTED"}),ee&&a.jsx("span",{className:"px-2 py-1 bg-blue-600 text-white text-xs font-medium rounded",children:"SAVED"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(Us,{size:14,className:"text-gray-400 flex-shrink-0"}),a.jsx("span",{className:"text-gray-700 truncate font-mono text-xs",children:w.url}),a.jsx("button",{type:"button",onClick:xe=>{xe.stopPropagation(),tu(w.url)},className:"p-1 text-gray-400 hover:text-gray-600",children:a.jsx(ht,{size:12})})]}),w.error&&a.jsxs("div",{className:"mt-2 text-xs text-red-600 flex items-start gap-1",children:[a.jsx(Nr,{size:12,className:"mt-0.5 flex-shrink-0"}),a.jsx("span",{children:w.error})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",onClick:xe=>{xe.stopPropagation(),nt(De===$?null:$)},className:`px-3 py-1.5 text-xs font-medium rounded transition-colors ${De===$?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:De===$?"Selected":"Select"}),ae?a.jsx(ol,{size:20,className:"text-gray-400"}):a.jsx(Cn,{size:20,className:"text-gray-400"})]})]})}),ae&&a.jsxs("div",{className:"px-4 pb-4 space-y-3 border-t border-gray-200",children:[w.error&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-3",children:[a.jsx("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"Error"}),a.jsx("p",{className:"text-sm text-red-700",children:w.error})]}),w.params&&Object.keys(w.params).length>0&&a.jsxs("div",{children:[a.jsxs("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:["Parameters (",Object.keys(w.params).length,")"]}),a.jsx("div",{className:"bg-gray-50 rounded p-3 space-y-1 max-h-40 overflow-y-auto",children:Object.entries(w.params).map(([xe,Pe])=>a.jsxs("div",{className:"flex gap-3 text-xs font-mono",children:[a.jsxs("span",{className:"font-semibold text-gray-700 min-w-[120px]",children:[xe,":"]}),a.jsx("span",{className:"text-gray-900 break-all",children:Pe})]},xe))})]}),w.headers&&Object.keys(w.headers).length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Headers"}),a.jsx("div",{className:"bg-gray-50 rounded p-3 space-y-1 max-h-40 overflow-y-auto",children:Object.entries(w.headers).slice(0,5).map(([xe,Pe])=>a.jsxs("div",{className:"flex gap-3 text-xs font-mono",children:[a.jsxs("span",{className:"font-semibold text-gray-700 min-w-[120px]",children:[xe,":"]}),a.jsx("span",{className:"text-gray-900 break-all truncate",children:Pe})]},xe))})]})]}),$<H.chain.length-1&&a.jsx("div",{className:"flex justify-center py-2",children:a.jsx(cg,{size:20,className:"text-blue-500 transform rotate-90"})})]},$)})}),H.popup_chains&&H.popup_chains.length>0&&a.jsxs("div",{className:"p-4 bg-green-50 border-2 border-green-200 rounded-lg",children:[a.jsx("h5",{className:"font-semibold text-green-800 mb-3 flex items-center gap-2",children:a.jsxs("span",{children:[" Popup Windows Detected (",H.popup_chains.length,")"]})}),a.jsx("div",{className:"space-y-3",children:H.popup_chains.map((w,$)=>a.jsx("div",{className:"bg-white p-3 rounded border border-green-300",children:a.jsxs("div",{className:"text-sm space-y-1",children:[a.jsxs("div",{className:"font-medium text-gray-900",children:["Popup #",w.popup_index]}),a.jsxs("div",{className:"text-xs text-gray-600",children:[a.jsx("span",{className:"font-medium",children:"Opened from:"}),a.jsx("p",{className:"font-mono mt-1 break-all",children:w.opener_url})]}),a.jsxs("div",{className:"text-xs text-gray-600",children:[a.jsx("span",{className:"font-medium",children:"Popup URL:"}),a.jsx("p",{className:"font-mono mt-1 break-all text-green-700",children:w.final_url})]})]})},$))})]}),a.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[H.chain[H.chain.length-1].redirect_type==="final"?a.jsx(Ye,{className:"text-green-600",size:20}):a.jsx(Pc,{className:"text-red-600",size:20}),a.jsx("span",{className:"font-semibold text-gray-900",children:"Final Destination:"})]}),a.jsx("code",{className:"block bg-white px-3 py-2 rounded text-sm font-mono text-gray-900 break-all",children:H.final_url})]})]})]})})]}),Ge&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center p-4 z-[60]",children:a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col border border-neutral-200 dark:border-neutral-800",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200 dark:border-neutral-800",children:[a.jsx("h2",{className:"text-xl font-bold text-neutral-900 dark:text-neutral-50",children:we?"Preview Bulk URLs":"Bulk Upload Tracking URLs"}),a.jsx("button",{onClick:Ks,className:"text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-smooth",children:a.jsx(dr,{size:24})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:we?a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg p-4",children:a.jsxs("p",{className:"text-sm text-emerald-900 dark:text-emerald-300",children:[a.jsx("span",{className:"font-semibold",children:z.length})," new URLs will be added",Ee>0&&a.jsxs("span",{className:"ml-2 text-orange-700 dark:text-orange-400",children:["(",Ee," duplicates skipped)"]})]})}),a.jsx("div",{className:"border border-neutral-200 dark:border-neutral-700 rounded-lg overflow-hidden",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-850",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:"URL"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:"Weight"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:"Label"})]})}),a.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-700",children:z.map((w,$)=>a.jsxs("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-850",children:[a.jsx("td",{className:"px-4 py-3 text-sm text-neutral-900 dark:text-neutral-100 font-mono break-all",children:w.url}),a.jsx("td",{className:"px-4 py-3 text-sm text-neutral-700 dark:text-neutral-300",children:w.weight}),a.jsx("td",{className:"px-4 py-3 text-sm text-neutral-700 dark:text-neutral-300",children:w.label||"-"})]},$))})]})})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm text-brand-900 dark:text-brand-300 mb-3",children:"Upload multiple tracking URLs at once. You can paste URLs one per line or use CSV format with headers."}),a.jsxs("button",{type:"button",onClick:Jg,className:"flex items-center gap-2 px-3 py-2 bg-brand-600 dark:bg-brand-500 text-white text-sm rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth",children:[a.jsx(Qh,{size:16}),"Download CSV Template"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Rotation Mode"}),a.jsxs("select",{value:E,onChange:w=>P(w.target.value),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",children:[a.jsx("option",{value:"sequential",children:"Sequential (rotates in order)"}),a.jsx("option",{value:"random",children:"Random (picks randomly)"}),a.jsx("option",{value:"weighted-random",children:"Weighted Random (probability based on weights)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Paste URLs"}),a.jsx("textarea",{value:S,onChange:w=>Y(w.target.value),rows:12,className:"w-full px-4 py-3 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth font-mono text-sm",placeholder:`Paste one URL per line or CSV format:

url,weight,label
https://tracker.example.com/click,70,Primary
https://backup.example.com/track,30,Backup

Or simple format (weight defaults to 50):
https://tracker1.example.com
https://tracker2.example.com`}),a.jsxs("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-2",children:["CSV Format: ",a.jsx("code",{className:"bg-neutral-100 dark:bg-neutral-800 px-1 py-0.5 rounded",children:"url,weight,label"})," (weight and label are optional)"]})]}),le.length>0&&a.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm font-semibold text-yellow-900 dark:text-yellow-300 mb-2",children:"Validation Errors:"}),a.jsx("ul",{className:"text-sm text-yellow-800 dark:text-yellow-400 space-y-1",children:le.map((w,$)=>a.jsxs("li",{children:[" ",w]},$))})]})]})}),a.jsx("div",{className:"border-t border-neutral-200 dark:border-neutral-800 p-6 flex justify-end gap-3",children:we?a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",onClick:()=>ke(!1),className:"flex items-center gap-2 px-4 py-2 bg-neutral-200 dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 rounded-lg hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-smooth",children:[a.jsx(Yh,{size:16}),"Back"]}),a.jsxs("button",{type:"button",onClick:()=>eu("url"),className:"flex items-center gap-2 px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth",children:[a.jsx(Ye,{size:16}),"Confirm & Add"]})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",onClick:Ks,className:"px-4 py-2 bg-neutral-200 dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 rounded-lg hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-smooth",children:"Cancel"}),a.jsx("button",{type:"button",onClick:()=>Zd("url"),disabled:!S.trim(),className:"px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth disabled:opacity-50 disabled:cursor-not-allowed",children:"Parse & Preview"})]})})]})}),Dr&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center p-4 z-[60]",children:a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col border border-neutral-200 dark:border-neutral-800",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200 dark:border-neutral-800",children:[a.jsx("h2",{className:"text-xl font-bold text-neutral-900 dark:text-neutral-50",children:we?"Preview Bulk Referrers":"Bulk Upload Referrers"}),a.jsx("button",{onClick:Ks,className:"text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 transition-smooth",children:a.jsx(dr,{size:24})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:we?a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg p-4",children:a.jsxs("p",{className:"text-sm text-emerald-900 dark:text-emerald-300",children:[a.jsx("span",{className:"font-semibold",children:z.length})," new referrers will be added",Ee>0&&a.jsxs("span",{className:"ml-2 text-orange-700 dark:text-orange-400",children:["(",Ee," duplicates skipped)"]})]})}),a.jsx("div",{className:"border border-neutral-200 dark:border-neutral-700 rounded-lg overflow-hidden",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-850",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:"Referrer URL"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:"Weight"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:"Label"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:"Hops"})]})}),a.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-700",children:z.map((w,$)=>{const ae=w;return a.jsxs("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-850",children:[a.jsx("td",{className:"px-4 py-3 text-sm text-neutral-900 dark:text-neutral-100 font-mono break-all",children:ae.url}),a.jsx("td",{className:"px-4 py-3 text-sm text-neutral-700 dark:text-neutral-300",children:ae.weight}),a.jsx("td",{className:"px-4 py-3 text-sm text-neutral-700 dark:text-neutral-300",children:ae.label||"-"}),a.jsx("td",{className:"px-4 py-3 text-sm text-neutral-700 dark:text-neutral-300",children:ae.hops?ae.hops.join(", "):"All"})]},$)})})]})})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm text-blue-900 dark:text-blue-300 mb-3",children:"Upload multiple referrers at once. You can paste URLs one per line or use CSV format with headers."}),a.jsxs("button",{type:"button",onClick:Qg,className:"flex items-center gap-2 px-3 py-2 bg-blue-600 dark:bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-smooth",children:[a.jsx(Qh,{size:16}),"Download CSV Template"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Rotation Mode"}),a.jsxs("select",{value:E,onChange:w=>P(w.target.value),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20 focus:border-blue-500 dark:focus:border-blue-400 outline-none transition-smooth",children:[a.jsx("option",{value:"sequential",children:"Sequential (rotates in order)"}),a.jsx("option",{value:"random",children:"Random (picks randomly)"}),a.jsx("option",{value:"weighted-random",children:"Weighted Random (probability based on weights)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Paste Referrers"}),a.jsx("textarea",{value:S,onChange:w=>Y(w.target.value),rows:12,className:"w-full px-4 py-3 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20 focus:border-blue-500 dark:focus:border-blue-400 outline-none transition-smooth font-mono text-sm",placeholder:`Paste one referrer per line or CSV format:

url,weight,label,hops
https://google.com,50,Google,1;2
https://facebook.com,30,Facebook,

Or simple format (defaults: weight=50, hops=all):
https://google.com
https://facebook.com`}),a.jsxs("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-2",children:["CSV Format: ",a.jsx("code",{className:"bg-neutral-100 dark:bg-neutral-800 px-1 py-0.5 rounded",children:"url,weight,label,hops"})," (weight, label, and hops are optional)",a.jsx("br",{}),"Hops format: semicolon-separated numbers like ",a.jsx("code",{className:"bg-neutral-100 dark:bg-neutral-800 px-1 py-0.5 rounded",children:"1;2;3"})]})]}),le.length>0&&a.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm font-semibold text-yellow-900 dark:text-yellow-300 mb-2",children:"Validation Errors:"}),a.jsx("ul",{className:"text-sm text-yellow-800 dark:text-yellow-400 space-y-1",children:le.map((w,$)=>a.jsxs("li",{children:[" ",w]},$))})]})]})}),a.jsx("div",{className:"border-t border-neutral-200 dark:border-neutral-800 p-6 flex justify-end gap-3",children:we?a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",onClick:()=>ke(!1),className:"flex items-center gap-2 px-4 py-2 bg-neutral-200 dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 rounded-lg hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-smooth",children:[a.jsx(Yh,{size:16}),"Back"]}),a.jsxs("button",{type:"button",onClick:()=>eu("referrer"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-smooth",children:[a.jsx(Ye,{size:16}),"Confirm & Add"]})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",onClick:Ks,className:"px-4 py-2 bg-neutral-200 dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 rounded-lg hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-smooth",children:"Cancel"}),a.jsx("button",{type:"button",onClick:()=>Zd("referrer"),disabled:!S.trim(),className:"px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-smooth disabled:opacity-50 disabled:cursor-not-allowed",children:"Parse & Preview"})]})})]})})]})}const $_="modulepreload",B_=function(e){return"/"+e},r0={},z_=function(t,r,n){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),o=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=Promise.allSettled(r.map(c=>{if(c=B_(c),c in r0)return;r0[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":$_,d||(h.as="script"),h.crossOrigin="",h.href=c,o&&h.setAttribute("nonce",o),document.head.appendChild(h),d)return new Promise((p,v)=>{h.addEventListener("load",p),h.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return s.then(l=>{for(const o of l||[])o.status==="rejected"&&i(o.reason);return t().catch(i)})},q_={gclid:1,fbclid:2,msclkid:3,ttclid:4,clickid:5,click_id:6,utm_source:7,utm_medium:8,utm_campaign:9,utm_content:10,utm_term:11,publisher_id:12,affiliate_id:13,partner_id:14,ref:15,referrer:16,source:17};function bg(e){const t=new Map;try{let r=e;if(e.includes("?")&&(r=e.split("?")[1]),!r)return t;r.split("&").forEach(n=>{const[s,i]=n.split("=");if(s){const l=decodeURIComponent(s),o=decodeURIComponent(i||"");t.has(l)||t.set(l,[]),t.get(l).push(o)}})}catch(r){console.error("Error parsing URL:",r)}return t}function yg(e,t,r){const n=new Map;[e,t,r].filter(Boolean).forEach(d=>{bg(d||"").forEach((h,p)=>{const v=p.toLowerCase(),g=q_[v]??1e3;n.has(v)||n.set(v,{name:v,examples:[],priority:g,count:0});const k=n.get(v);k.count++,k.examples.push(...h.slice(0,2))})});const i=Array.from(n.values()).sort((d,u)=>d.priority-u.priority).slice(0,10),l={};i.forEach((d,u)=>{const h=`p${u+1}`;l[h]=d.name});const o=i.map(d=>d.name),c=Array.from(n.keys()).filter(d=>!o.includes(d));return{mapping:l,detectedParams:i,unmappedParams:c,totalParams:n.size}}function vg(e){if(e.detectedParams.length===0)return"No parameters found in provided URLs";const t=[` Detected ${e.totalParams} unique parameters`,` Mapped ${e.detectedParams.length} to p1-p10:`,""];return e.detectedParams.forEach((r,n)=>{const s=`p${n+1}`,i=r.examples.length>0?` (e.g. "${r.examples[0].substring(0,20)}${r.examples[0].length>20?"...":""}")`:"";t.push(`  ${s}: ${r.name}${i}`)}),e.unmappedParams.length>0&&(t.push(""),t.push("  Additional parameters (not mapped to p1-p10):"),e.unmappedParams.slice(0,5).forEach(r=>{t.push(`   ${r}`)}),e.unmappedParams.length>5&&t.push(`   +${e.unmappedParams.length-5} more`)),t.join(`
`)}const G_=Object.freeze(Object.defineProperty({__proto__:null,autoMapParameters:yg,extractParametersFromUrl:bg,formatAutoMapSummary:vg},Symbol.toStringTag,{value:"Module"})),Wd="https://rfhuqenntxiqurplenjn.supabase.co",kg="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmaHVxZW5udHhpcXVycGxlbmpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NjEwNDgsImV4cCI6MjA4MTUzNzA0OH0.pi_6p2H2nuPfJvdT3pHNGpk0BTI3WQKTSzsj8dxQBA8",xa=og(Wd,kg),V_=e=>`${Wd}/functions/v1/${e}`,_o=()=>Wd;function H_({offerId:e,offerName:t,finalUrl:r,trackingTemplate:n,onClose:s}){const[i,l]=y.useState(!0),[o,c]=y.useState(!1),[d,u]=y.useState(!1),[h,p]=y.useState(!1),[v,g]=y.useState(!1),[k,b]=y.useState(!1),[m,x]=y.useState(!1),[f,j]=y.useState(!1),[T,L]=y.useState(null),[C,O]=y.useState(!1),[Q,W]=y.useState(null),[pe,A]=y.useState([]),[ne,te]=y.useState(null),[me,K]=y.useState(null),[V,_]=y.useState(1),[D,q]=y.useState([]),[N,B]=y.useState({offer_id:e,offer_name:t,enabled:!1,api_key:"",api_base_url:"https://api.trackier.com",advertiser_id:"",publisher_id:"2",url1_campaign_id:"",url1_campaign_name:"Passthrough Campaign (URL 1)",url2_campaign_id:"",url2_campaign_name:"Final Campaign (URL 2)",url2_destination_url:r,url2_last_suffix:"",google_ads_template:"",final_url:r,suffix_pattern:"?clickid={clickid}",use_proxy:!0,tracer_mode:"http_only",max_redirects:20,timeout_ms:45e3,update_interval_seconds:1,sub_id_mapping:{p1:"gclid",p2:"fbclid",p3:"msclkid",p4:"ttclid",p5:"clickid",p6:"utm_source",p7:"utm_medium",p8:"utm_campaign",p9:"custom1",p10:"custom2",erid:"erid",app_name:"app_name",app_id:"app_id",cr_name:"cr_name"}}),[U,F]=y.useState(null),[H,be]=y.useState(!1);y.useEffect(()=>{je()},[e]),y.useEffect(()=>{if(!H||!N.id)return;const E=setInterval(()=>{je()},1e4);return()=>clearInterval(E)},[H,N.id]);const je=async()=>{try{l(!0),te(null);let E=null;try{E=await qe()}catch(re){console.warn("Could not load API key from settings:",re)}const{data:P,error:z}=await xa.from("trackier_offers").select("*").eq("offer_id",e).single();if(z&&z.code!=="PGRST116")throw z;if(P){const re={...N,...P,api_key:P.api_key||E||N.api_key,sub_id_mapping:P.sub_id_mapping||N.sub_id_mapping,update_interval_seconds:P.update_interval_seconds&&P.update_interval_seconds>=1?P.update_interval_seconds:1};B(re),console.log("Loading config, additional_pairs:",P.additional_pairs),P.additional_pairs&&Array.isArray(P.additional_pairs)&&P.additional_pairs.length>0&&(console.log("Setting pairsData with",P.additional_pairs.length,"pairs"),q(P.additional_pairs)),await lt(P.id)}else E&&B(re=>({...re,api_key:E}))}catch(E){console.error("Error loading Trackier config:",E),te(E.message)}finally{l(!1)}},qe=async()=>{try{const{data:{user:E}}=await xa.auth.getUser();if(!E)return null;const{data:P,error:z}=await xa.from("settings").select("trackier_api_key").eq("user_id",E.id).maybeSingle();if(z){if(z.code==="42703")return console.warn("trackier_api_key column not yet created - apply migration first"),null;throw z}return(P==null?void 0:P.trackier_api_key)||null}catch(E){return console.error("Error loading Trackier API key from settings:",(E==null?void 0:E.message)||E),null}},lt=async E=>{try{const{data:P,error:z}=await xa.rpc("get_trackier_stats",{offer_id_param:E});!z&&P&&F(P)}catch(P){console.error("Error loading stats:",P)}},fe=E=>{try{return E?E.includes("://")?new URL(E).searchParams:E.startsWith("?")?new URLSearchParams(E.slice(1)):E.includes("?")?new URLSearchParams(E.split("?")[1]):new URLSearchParams:new URLSearchParams}catch(P){return console.error("Error parsing URL for params:",P),new URLSearchParams}},gt=E=>{const P=Array.from(fe(E).keys());return P.length?`?${P.slice(0,10).map(re=>`${re}={${re}}`).join("&")}`:null},wt=async E=>{try{x(!0),te(null);const P=E||N.suffix_pattern,z=yg(N.final_url,N.url2_destination_url,P);B(le=>({...le,suffix_pattern:P,sub_id_mapping:z.mapping}));const re=vg(z);L(re),K(` Auto-mapped ${z.detectedParams.length} parameters!`),setTimeout(()=>{K(null)},5e3)}catch(P){console.error("Error auto-mapping parameters:",P),te(`Failed to auto-map: ${P.message}`)}finally{x(!1)}},De=async()=>{await wt()},nt=async()=>{const E=gt(N.url2_destination_url||N.final_url||"");if(!E){te("No query parameters found in Final URL to build a suffix pattern.");return}await wt(E)},M=async()=>{try{b(!0),te(null),K(null);const E=await qe();if(!E){te("No Trackier API key found in Settings.");return}B(P=>({...P,api_key:E})),K("Loaded Trackier API key from Settings")}catch(E){te(E.message||"Failed to load API key from Settings")}finally{b(!1)}},oe=async()=>{var E;try{O(!0),te(null),K(null),W(null);const P=n||r;if(console.log("[TrackierSetup] Trace URL:",P),console.log("[TrackierSetup] Source:",n?"tracking_template":"final_url"),!P)throw new Error("No tracking URL available to trace. Make sure the offer has a Tracking Template or Final URL configured.");const z={offer_name:N.offer_name};console.log("[TrackierSetup] Sending trace request with offer_name:",N.offer_name);const re=V_("trackier-trace-once");console.log("[TrackierSetup] Edge function URL:",re);const le=await fetch(re,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${kg}`},body:JSON.stringify(z)});if(!le.ok){const Ee=await le.text();console.error("[TrackierSetup] Trace error response:",Ee);const Ae=(E=le.headers.get("content-type"))!=null&&E.includes("application/json")?await le.json():{error:Ee};throw new Error(Ae.error||"Trace failed")}const he=await le.json();if(!he.success)throw new Error(he.error||"Trace failed");if(W(he.query_params),he.query_params&&Object.keys(he.query_params).length>0){const Ae=`?${Object.keys(he.query_params).slice(0,10).map(Te=>`${Te}={${Te}}`).join("&")}`;B(Te=>({...Te,suffix_pattern:Ae,url2_destination_url:he.resolved_final_url}));const{autoMapParameters:we,formatAutoMapSummary:ke}=await z_(async()=>{const{autoMapParameters:Te,formatAutoMapSummary:I}=await Promise.resolve().then(()=>G_);return{autoMapParameters:Te,formatAutoMapSummary:I}},void 0),Re=we(he.resolved_final_url,he.resolved_final_url,Ae);B(Te=>({...Te,sub_id_mapping:Re.mapping}));const Mt=ke(Re);L(Mt),K(` Traced URL and auto-mapped ${Re.detectedParams.length} parameters!`),setTimeout(()=>{K(null)},5e3)}else K(" Trace completed - no query parameters found to map")}catch(P){console.error("Error running trace:",P),te(`Failed to trace URL: ${P.message}`)}finally{O(!1)}},Ge=async()=>{try{if(c(!0),te(null),K(null),!N.api_key)throw new Error("API Key is required");if(!N.url1_campaign_id)throw new Error("URL 1 Campaign ID is required");if(!N.url2_campaign_id)throw new Error("URL 2 Campaign ID is required");const E=parseInt(String(N.update_interval_seconds))||1;if(E<1)throw new Error("Update interval must be at least 1 second");console.log("Validating update_interval_seconds:",N.update_interval_seconds,"-> normalized to:",E);const z=`https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/trackier-webhook?token=${N.id}&campaign_id={campaign_id}&click_id={click_id}`,re=N.publisher_id||"2",le=N.sub_id_mapping||{},he={};Object.entries(le).forEach(([ce,X])=>{X&&(he[X]=ce)});const Ee=Object.entries(he).map(([ce,X])=>`${ce}={${X}}`).join("&"),Ae=N.final_url.includes("?")?"&":"?",we=Ee?`${N.final_url}${Ae}${Ee}`:N.final_url,ke=`https://nebula.gotrackier.com/click?campaign_id=${N.url2_campaign_id}&pub_id=${re}&force_transparent=true&url=${encodeURIComponent(we)}&lpurl={lpurl}`,Re=encodeURIComponent(ke),Mt=`https://nebula.gotrackier.com/click?campaign_id=${N.url1_campaign_id}&pub_id=${re}&force_transparent=true&url=${Re}`,Te=D.map((ce,X)=>({...ce,pair_index:ce.pair_index||X+1,enabled:ce.enabled!==void 0?ce.enabled:!0})),I={...N,google_ads_template:Mt,webhook_url:z,url1_campaign_id_real:N.url1_campaign_id_real||N.url1_campaign_id,url2_campaign_id_real:N.url2_campaign_id_real||N.url2_campaign_id,update_interval_seconds:E,additional_pairs:Te.length>0?Te:null};console.log("Saving config with pairsData:",D.length,"pairs"),console.log("configToSave.additional_pairs:",I.additional_pairs),console.log("configToSave.update_interval_seconds:",I.update_interval_seconds,"type:",typeof I.update_interval_seconds),console.log("config.id:",N.id,"(will",N.id?"UPDATE":"INSERT",")");let ge;if(N.id){console.log("Updating existing offer with id:",N.id);const{data:ce,error:X}=await xa.from("trackier_offers").update(I).eq("id",N.id).select().single();if(X)throw X;ge=ce}else{console.log("Inserting new offer");const{data:ce,error:X}=await xa.from("trackier_offers").insert(I).select().single();if(X)throw X;ge=ce}B(ge),ge.additional_pairs&&Array.isArray(ge.additional_pairs)&&ge.additional_pairs.length>0&&q(ge.additional_pairs),K("Configuration saved successfully! Each pair uses offer ID + pair index for webhook routing.")}catch(E){console.error("Error saving config:",E),te(E.message)}finally{c(!1)}},ot=async()=>{var E;try{if(u(!0),te(null),K(null),!N.id)throw new Error("Please save the configuration first");const P=`${_o()}/functions/v1/trackier-trigger/${N.id}`,z=await fetch(P,{method:"POST"});if(!z.ok){const le=await z.json();throw new Error(le.error||"Test failed")}const re=await z.json();K(`Test successful! Update completed in ${(E=re.result)==null?void 0:E.duration_ms}ms`),await je()}catch(P){console.error("Error testing webhook:",P),te(P.message)}finally{u(!1)}},Dr=async()=>{try{if(j(!0),te(null),K(null),!N.id)throw new Error("Please save configuration first");if(!N.sub_id_mapping||Object.keys(N.sub_id_mapping).length===0)throw new Error('Please configure parameter mapping (p1-p10) first. Run "Trace & Auto-Map" or "Auto-Map" to generate mappings.');const E=N.publisher_id||"2",P={};Object.entries(N.sub_id_mapping).forEach(([Te,I])=>{I&&(P[I]=Te)});const z=Object.entries(P).map(([Te,I])=>`${Te}={${I}}`).join("&"),re=N.final_url.includes("?")?"&":"?",le=z?`${N.final_url}${re}${z}`:N.final_url,he=`https://nebula.gotrackier.com/click?campaign_id=${N.url2_campaign_id}&pub_id=${E}&force_transparent=true&url=${encodeURIComponent(le)}&lpurl={lpurl}`,Ee=encodeURIComponent(he),Ae=`https://nebula.gotrackier.com/click?campaign_id=${N.url1_campaign_id}&pub_id=${E}&force_transparent=true&url=${Ee}`;let we=D;D&&D.length>0&&(we=D.map((Te,I)=>{const ge=`https://nebula.gotrackier.com/click?campaign_id=${Te.url2_campaign_id}&pub_id=${E}&force_transparent=true&url=${encodeURIComponent(le)}&lpurl={lpurl}`,ce=encodeURIComponent(ge),X=`https://nebula.gotrackier.com/click?campaign_id=${Te.url1_campaign_id}&pub_id=${E}&force_transparent=true&url=${ce}`,{webhook_token:et,webhook_url:Nt,..._e}=Te;return{..._e,google_ads_template:X,pair_index:Te.pair_index||I+1}}),q(we));const ke={...N,google_ads_template:Ae,additional_pairs:we.length>0?we:N.additional_pairs},{data:Re,error:Mt}=await xa.from("trackier_offers").update(ke).eq("id",N.id).select().single();if(Mt)throw Mt;B(Re),K(" Templates updated successfully with current parameter mappings!")}catch(E){console.error("Error updating templates:",E),te(E.message)}finally{j(!1)}},Yt=async()=>{var E;try{if(g(!0),te(null),K(null),!N.api_key)throw new Error("Please enter your Trackier API key first");const P=`${_o()}/functions/v1/trackier-validate-credentials`,z=await fetch(P,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:N.api_key,apiBaseUrl:N.api_base_url})});if(!z.ok){const le=await z.json();throw new Error(le.error||"Validation failed")}const re=await z.json();K(` Credentials valid! Found ${((E=re.advertisers)==null?void 0:E.length)||0} advertisers.`),re.advertisers&&re.advertisers.length>0&&(A(re.advertisers),N.advertiser_id||B(le=>({...le,advertiser_id:re.advertisers[0].id.toString()})))}catch(P){console.error("Error validating credentials:",P),te(P.message)}finally{g(!1)}},S=async()=>{var E,P,z,re,le;try{if(p(!0),te(null),K(null),!N.api_key)throw new Error("Please enter your Trackier API key first");const he="http://url-tracker-proxy-alb-1426409269.us-east-1.elb.amazonaws.com:3000/api/trackier-webhook",Ee=`${_o()}/functions/v1/trackier-create-campaigns`,Ae=await fetch(Ee,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:N.api_key,apiBaseUrl:N.api_base_url,advertiserId:N.advertiser_id,offerName:t,finalUrl:N.final_url,webhookUrl:he,campaign_count:V})});if(!Ae.ok){const Te=await Ae.json();throw new Error(Te.error||"Failed to create campaigns")}const we=await Ae.json();q(we.pairs||[we.primary_pair]);const ke=we.primary_pair||we.pairs[0];B({...N,url1_campaign_id:ke.url1_campaign_id,url1_campaign_id_real:ke.url1_campaign_id_real,url1_campaign_name:ke.url1_campaign_name||((P=(E=we.campaigns)==null?void 0:E.url1)==null?void 0:P.name),url1_tracking_url:ke.url1_tracking_url,url2_campaign_id:ke.url2_campaign_id,url2_campaign_id_real:ke.url2_campaign_id_real,url2_campaign_name:ke.url2_campaign_name||((re=(z=we.campaigns)==null?void 0:z.url2)==null?void 0:re.name),url2_tracking_url:ke.url2_tracking_url,url2_destination_url:ke.url2_destination_url||N.final_url,webhook_url:ke.webhook_url,google_ads_template:ke.google_ads_template});const Re=((le=we.pairs)==null?void 0:le.length)||1,Mt=Re*2;K(` Created ${Re} campaign pairs (${Mt} campaigns total)!  Configure S2S Push URL in Trackier dashboard for each URL1 campaign!`)}catch(he){console.error("Error creating campaigns:",he),te(he.message)}finally{p(!1)}},Y=(E,P)=>{navigator.clipboard.writeText(E),K(`${P} copied to clipboard!`),setTimeout(()=>K(null),2e3)};return i?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-8",children:a.jsx("p",{className:"text-gray-900 dark:text-white",children:"Loading Trackier configuration..."})})}):a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto",children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl m-4 max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-6",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Trackier Dual-URL Setup"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:"Configure automatic suffix updates via Trackier webhooks"}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Offer: ",a.jsx("strong",{className:"dark:text-white",children:t})]})]}),a.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),N.id&&a.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-300 rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"text-3xl",children:""}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-gray-600 uppercase",children:"Webhooks Received"}),a.jsx("p",{className:"text-3xl font-bold text-green-700",children:N.webhook_count||0})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-xs text-gray-600",children:"Last Updated"}),a.jsx("p",{className:"text-sm font-medium text-gray-800",children:N.url2_last_updated_at?new Date(N.url2_last_updated_at).toLocaleTimeString():"Never"}),a.jsxs("div",{className:"flex gap-2 mt-2",children:[a.jsx("button",{onClick:()=>je(),className:"text-xs text-blue-600 dark:text-blue-300 hover:text-blue-800 underline",children:" Refresh"}),a.jsx("button",{onClick:()=>be(!H),className:`text-xs ${H?"text-green-600":"text-gray-600"} hover:text-green-800 dark:text-green-200 underline`,children:H?" Auto":" Auto"})]})]})]}),(N.webhook_count||0)===0&&a.jsx("p",{className:"mt-2 text-xs text-orange-700 bg-orange-50 p-2 rounded",children:" No webhooks received yet. Make sure S2S Push URL is configured in Trackier Dashboard."})]}),ne&&a.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg",children:a.jsx("p",{className:"text-red-800 dark:text-red-200 text-sm",children:ne})}),me&&a.jsx("div",{className:"mb-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg",children:a.jsx("p",{className:"text-green-800 dark:text-green-200 text-sm",children:me})}),N.id&&U&&a.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",children:[a.jsx("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Statistics"}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-blue-600 dark:text-blue-300",children:"Webhooks"}),a.jsx("p",{className:"text-blue-900 dark:text-blue-100 font-bold",children:U.webhook_count||0})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-blue-600 dark:text-blue-300",children:"Updates"}),a.jsx("p",{className:"text-blue-900 dark:text-blue-100 font-bold",children:U.update_count||0})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-blue-600 dark:text-blue-300",children:"Success Rate"}),a.jsx("p",{className:"text-blue-900 dark:text-blue-100 font-bold",children:U.success_rate?`${U.success_rate.toFixed(1)}%`:"N/A"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-blue-600 dark:text-blue-300",children:"Avg Duration"}),a.jsx("p",{className:"text-blue-900 dark:text-blue-100 font-bold",children:U.avg_trace_duration?`${(U.avg_trace_duration/1e3).toFixed(1)}s`:"N/A"})]})]}),N.url2_last_updated_at&&a.jsxs("p",{className:"text-xs text-blue-700 mt-2",children:["Last updated: ",new Date(N.url2_last_updated_at).toLocaleString()]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Enable Trackier Integration"}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Turn on automatic suffix updates via webhooks"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",className:"sr-only peer",checked:N.enabled,onChange:E=>B({...N,enabled:E.target.checked})}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:border-gray-600 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white border-b dark:border-gray-600 pb-2",children:"Trackier API Configuration"}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["API Key ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"password",value:N.api_key,onChange:E=>B({...N,api_key:E.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",placeholder:"Your Trackier API key"}),a.jsx("button",{onClick:Yt,disabled:v||!N.api_key,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium whitespace-nowrap",children:v?"Validating...":"Validate"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{type:"button",onClick:M,disabled:k,className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:k?"Loading from Settings...":"Load API Key from Settings"}),a.jsx("p",{className:"text-xs text-gray-500 flex-1 self-center",children:"Prefills your Trackier key from Settings to avoid retyping."})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API Base URL"}),a.jsx("input",{type:"text",value:N.api_base_url,onChange:E=>B({...N,api_base_url:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Advertiser ",a.jsx("span",{className:"text-red-500",children:"*"})]}),pe.length>0?a.jsxs("select",{value:N.advertiser_id,onChange:E=>B({...N,advertiser_id:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Select an advertiser"}),pe.map(E=>a.jsxs("option",{value:E.id,children:[E.name," (ID: ",E.id,")"]},E.id))]}):a.jsxs("div",{children:[a.jsx("input",{type:"text",value:N.advertiser_id,onChange:E=>B({...N,advertiser_id:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter advertiser ID or validate credentials to load list"}),a.jsx("p",{className:"text-xs text-gray-600 mt-1",children:'Click "Validate" above to load your advertisers'})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Publisher ID"}),a.jsx("input",{type:"text",value:N.publisher_id||"2",onChange:E=>B({...N,publisher_id:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",placeholder:"2"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Publisher ID used in both URL 1 and URL 2 tracking links"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white border-b dark:border-gray-600 pb-2",children:"Campaign Configuration"}),a.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-300 font-semibold mb-2",children:" Auto-Create Campaign Pairs"}),a.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-400 mb-3",children:"Create multiple campaign pairs (URL1 + URL2) for A/B testing or different traffic sources. Each pair uses the offer ID + pair index for webhook routing (no unique tokens needed)."}),a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("label",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Number of Pairs:"}),a.jsx("input",{type:"number",min:"1",max:"20",value:V,onChange:E=>_(Math.max(1,Math.min(20,parseInt(E.target.value)||1))),className:"w-20 px-2 py-1 border border-blue-300 dark:border-blue-600 rounded dark:bg-gray-700 dark:text-white text-center",disabled:h}),a.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:["(",V*2," campaigns + ",V," templates)"]})]})]}),a.jsx("button",{onClick:S,disabled:h||!N.api_key,className:"ml-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium whitespace-nowrap",children:h?"Creating...":`Create ${V} Pair${V>1?"s":""}`})]})}),a.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:a.jsxs("p",{className:"text-sm text-yellow-800",children:[a.jsx("strong",{children:"Manual Setup:"})," Or enter existing campaign IDs if you've already created them manually."]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["URL 1 Campaign ID ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:N.url1_campaign_id,onChange:E=>B({...N,url1_campaign_id:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",placeholder:"abc123"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Passthrough campaign (triggers webhook)"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["URL 2 Campaign ID ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:N.url2_campaign_id,onChange:E=>B({...N,url2_campaign_id:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",placeholder:"xyz789"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Final campaign (gets updated suffix)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Update Interval (seconds)"}),a.jsx("input",{type:"number",value:N.update_interval_seconds,onChange:E=>{const P=parseInt(E.target.value),z=!isNaN(P)&&P>=1?P:1;B({...N,update_interval_seconds:z})},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",min:"1",step:"1"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Update interval in seconds (minimum 1 second)"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white border-b dark:border-gray-600 pb-2",children:"Tracer Configuration"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Final URL"}),a.jsx("input",{type:"text",value:N.final_url,onChange:E=>B({...N,final_url:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tracer Mode"}),a.jsxs("select",{value:N.tracer_mode,onChange:E=>B({...N,tracer_mode:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"http_only",children:"HTTP Only (Fast)"}),a.jsx("option",{value:"browser",children:"Browser (Full Rendering)"}),a.jsx("option",{value:"anti_cloaking",children:"Anti-Cloaking (Stealth)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max Redirects"}),a.jsx("input",{type:"number",value:N.max_redirects,onChange:E=>B({...N,max_redirects:parseInt(E.target.value)||20}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",min:"5",max:"50"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Suffix Pattern"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("input",{type:"text",value:N.suffix_pattern,onChange:E=>B({...N,suffix_pattern:E.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500",placeholder:"?clickid={clickid}"}),a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsx("button",{type:"button",onClick:nt,className:"px-3 py-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 text-blue-700 rounded-md text-sm hover:bg-blue-100",children:"Auto-build from Final URL"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Builds a suffix pattern from query params and auto-maps p1-p10."})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"Pattern to extract from final URL"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white border-b dark:border-gray-600 pb-2 flex-1",children:"Parameter Mapping (p1-p10)"}),a.jsxs("div",{className:"flex gap-2 flex-wrap",children:[a.jsx("button",{onClick:oe,disabled:C||!N.url2_destination_url,className:"px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg hover:from-cyan-600 hover:to-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all text-sm font-medium whitespace-nowrap",children:C?" Tracing...":" Run Trace & Auto-Map"}),a.jsx("button",{onClick:De,disabled:m||!N.final_url,className:"ml-2 px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-lg hover:from-indigo-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all text-sm font-medium whitespace-nowrap",children:m?" Auto-Mapping...":" Auto-Map from URLs"})]})]}),Q&&a.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",children:[a.jsx("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:" Traced URL Parameters:"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:Object.entries(Q).map(([E,P])=>a.jsxs("div",{className:"bg-white dark:bg-gray-700 p-2 rounded border border-blue-100 dark:border-blue-800",children:[a.jsx("code",{className:"text-blue-600 dark:text-blue-300",children:E}),a.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:" = "}),a.jsxs("code",{className:"text-gray-600 dark:text-gray-300",children:[String(P).substring(0,15),"..."]})]},E))})]}),T&&a.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg",children:a.jsx("p",{className:"text-sm text-green-800 dark:text-green-200 whitespace-pre-wrap font-mono text-xs",children:T})}),a.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-700 rounded-lg",children:[a.jsxs("p",{className:"text-sm text-purple-800 dark:text-purple-200 mb-2",children:[a.jsx("strong",{children:"Map tracked parameters to Trackier's p1-p10 fields:"})," Define which URL parameters should be passed through Trackier's sub_id fields. For example, map ",a.jsx("code",{className:"bg-purple-100 dark:bg-purple-800 px-1 rounded",children:"gclid"})," to",a.jsx("code",{className:"bg-purple-100 dark:bg-purple-800 px-1 rounded",children:"p1"}),", so Trackier receives it as ",a.jsx("code",{className:"bg-purple-100 dark:bg-purple-800 px-1 rounded",children:"p1=gclid_value"}),"."]}),a.jsx("p",{className:"text-xs text-purple-700 dark:text-purple-300",children:"These mappings control how parameters flow through URL 1  URL 2 in your Trackier campaigns."}),a.jsxs("p",{className:"text-xs text-purple-600 dark:text-purple-400 mt-2",children:[" ",a.jsx("strong",{children:"Tip:"}),' Click "Run Trace & Auto-Map" to trace your URL and automatically detect parameters, or "Auto-Map from URLs" to use existing final URL.']})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[[1,2,3,4,5,6,7,8,9,10].map(E=>{var z;const P=`p${E}`;return a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap w-12",children:[P,":"]}),a.jsx("input",{type:"text",value:((z=N.sub_id_mapping)==null?void 0:z[P])||"",onChange:re=>B({...N,sub_id_mapping:{...N.sub_id_mapping,[P]:re.target.value}}),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"param_name"})]},P)}),["erid","app_name","app_id","cr_name"].map(E=>{var P;return a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap w-12",children:[E,":"]}),a.jsx("input",{type:"text",value:((P=N.sub_id_mapping)==null?void 0:P[E])||"",onChange:z=>B({...N,sub_id_mapping:{...N.sub_id_mapping,[E]:z.target.value}}),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"param_name"})]},E)})]}),a.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200",children:a.jsxs("p",{className:"text-xs text-gray-700 dark:text-gray-300",children:[a.jsx("strong",{children:"Example:"}),' If p1 maps to "gclid" and traced URL has ',a.jsx("code",{className:"bg-gray-200 px-1",children:"gclid=xyz789"}),", Trackier will receive ",a.jsx("code",{className:"bg-green-100 px-1",children:"p1=gclid=xyz789"})," and can pass it to your destination URL."]})}),a.jsx("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:a.jsxs("p",{className:"text-xs text-blue-700",children:[a.jsx("strong",{children:" Tip:"})," Leave unused fields empty. Trackier supports p1-p10 parameters: gclid, fbclid, msclkid, ttclid, clickid, utm_source, utm_medium, utm_campaign, custom1-2."]})})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white border-b dark:border-gray-600 pb-2",children:"Macro Mapping (Advanced)"}),a.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",children:[a.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200 mb-2",children:[a.jsx("strong",{children:"How it works:"})," When a traced suffix is found (e.g., ",a.jsx("code",{className:"bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"clickid=abc123"}),"), the actual value is replaced with Trackier macros (e.g., ",a.jsxs("code",{className:"bg-blue-100 dark:bg-blue-800 px-1 rounded",children:["clickid=","{clickid}"]}),"). Trackier then resolves these macros on each click with fresh tracking IDs."]}),a.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"This ensures every click gets a unique tracking ID from Trackier, not a static value from the traced URL."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsx("div",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:"URL Parameter"}),a.jsx("div",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase",children:"Trackier Macro"}),a.jsx("div",{className:"col-span-2 border-t border-gray-200"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 dark:text-gray-200 px-2 py-1 rounded text-sm",children:"clickid"})}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded text-sm text-green-800 dark:text-green-200",children:"{clickid}"}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"Trackier's unique click ID"})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 dark:text-gray-200 px-2 py-1 rounded text-sm",children:"gclid"})}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded text-sm text-green-800 dark:text-green-200",children:"{gclid}"}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"Google Click ID"})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 dark:text-gray-200 px-2 py-1 rounded text-sm",children:"fbclid"})}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded text-sm text-green-800 dark:text-green-200",children:"{fbclid}"}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"Facebook Click ID"})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 dark:text-gray-200 px-2 py-1 rounded text-sm",children:"campaign"})}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded text-sm text-green-800 dark:text-green-200",children:"{campaign_id}"}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"Trackier campaign ID"})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 dark:text-gray-200 px-2 py-1 rounded text-sm",children:"source"})}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded text-sm text-green-800 dark:text-green-200",children:"{source}"}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"Traffic source"})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 dark:text-gray-200 px-2 py-1 rounded text-sm",children:"publisher"})}),a.jsxs("div",{children:[a.jsx("code",{className:"bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded text-sm text-green-800 dark:text-green-200",children:"{publisher_id}"}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"Publisher/Affiliate ID"})]})]}),a.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:a.jsxs("p",{className:"text-xs text-gray-700 dark:text-gray-300",children:[a.jsx("strong",{children:"Example:"})," If traced URL has ",a.jsx("code",{className:"bg-gray-200 dark:bg-gray-600 px-1",children:"clickid=abc123&gclid=xyz789"}),", it becomes ",a.jsxs("code",{className:"bg-green-100 dark:bg-green-900/30 dark:text-green-200 px-1",children:["clickid=","{clickid}","&gclid=","{gclid}"]})," in Trackier. When users click, Trackier replaces ",a.jsx("code",{className:"bg-gray-200 px-1",children:"{clickid}"})," with a fresh unique ID."]})})]}),N.url1_campaign_id&&N.id&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white border-b dark:border-gray-600 pb-2",children:"Google Ads Setup"}),N.webhook_url&&a.jsx("div",{className:"p-4 bg-orange-50 border-2 border-orange-400 rounded-lg",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0 text-2xl",children:""}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-bold text-orange-900 mb-2",children:"IMPORTANT: Configure S2S Push URL in Trackier Dashboard"}),a.jsx("p",{className:"text-xs text-orange-800 mb-3",children:"The Trackier API doesn't allow automatic webhook configuration. You must manually set the S2S Push URL in your Trackier dashboard:"}),a.jsxs("ol",{className:"text-xs text-orange-800 mb-3 list-decimal list-inside space-y-1",children:[a.jsx("li",{children:"Go to Trackier Dashboard  Campaigns"}),a.jsxs("li",{children:["Edit the URL 1 campaign: ",a.jsx("strong",{children:N.url1_campaign_name||N.url1_campaign_id})]}),a.jsx("li",{children:'Scroll to "Server Side Clicks" section'}),a.jsx("li",{children:'Enable "Server Side Clicks" toggle'}),a.jsx("li",{children:'Paste the S2S Push URL below into the "S2S Push URL" field'}),a.jsx("li",{children:"Save the campaign"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-semibold text-orange-900 mb-1",children:"S2S Push URL (Copy this):"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:N.webhook_url,readOnly:!0,className:"flex-1 px-3 py-2 border border-orange-300 dark:border-orange-700 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm font-mono"}),a.jsx("button",{onClick:()=>Y(N.webhook_url||"","S2S Push URL"),className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 text-sm font-medium",children:"Copy URL"})]})]})]})]})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tracking Template"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:N.google_ads_template,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-sm font-mono"}),a.jsx("button",{onClick:()=>Y(N.google_ads_template,"Template"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm",children:"Copy"})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Use this as your Google Ads tracking template. Set it once - never change it!"})]}),N.url2_last_suffix&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Current Suffix (URL 2 - Primary Pair)"}),a.jsx("textarea",{value:N.url2_last_suffix,readOnly:!0,rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-xs font-mono"})]})]}),D.length>0&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white border-b dark:border-gray-600 pb-2",children:["Campaign Pairs (",D.length,")"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:D.map((E,P)=>{var z,re;return a.jsxs("div",{className:"p-4 border dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white",children:["Pair ",E.pair_index," ",E.pair_name&&`- ${E.pair_name}`]}),a.jsx("span",{className:`px-2 py-1 text-xs rounded ${E.enabled!==!1?"bg-green-100 text-green-800":"bg-gray-200 text-gray-600"}`,children:E.enabled!==!1?" Enabled":" Disabled"})]}),a.jsxs("div",{className:"space-y-2 text-xs",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"URL1:"}),a.jsx("span",{className:"ml-2 text-gray-900 dark:text-white font-mono",children:E.url1_campaign_id})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"URL2:"}),a.jsx("span",{className:"ml-2 text-gray-900 dark:text-white font-mono",children:E.url2_campaign_id})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"Webhook URL:"}),a.jsx("div",{className:"ml-2 text-purple-600 dark:text-purple-400 font-mono text-[10px] break-all",children:N.id&&E.pair_index?`${(z=N.webhook_url)==null?void 0:z.split("?")[0]}?token=${N.id}&pair_index=${E.pair_index}&campaign_id={campaign_id}&click_id={click_id}`:"Save configuration first"})]}),E.webhook_count!==void 0&&a.jsxs("div",{className:"pt-2 border-t dark:border-gray-600",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Webhooks:"}),a.jsx("span",{className:"font-semibold text-green-600",children:E.webhook_count||0})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Updates:"}),a.jsx("span",{className:"font-semibold text-blue-600",children:E.update_count||0})]})]}),E.google_ads_template&&a.jsxs("div",{className:"pt-2 border-t dark:border-gray-600",children:[a.jsxs("label",{className:"block font-medium text-gray-600 dark:text-gray-400 mb-1",children:["Template: ",a.jsx("span",{className:"text-xs text-gray-500",children:"(URL1  URL2  final_url)"})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("input",{type:"text",value:E.google_ads_template,readOnly:!0,className:"flex-1 px-2 py-1 border dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-[10px]"}),a.jsx("button",{onClick:()=>Y(E.google_ads_template,`Pair ${E.pair_index} Template`),className:"px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-[10px]",children:"Copy"})]})]}),N.id&&N.webhook_url&&a.jsxs("div",{className:"pt-2",children:[a.jsx("label",{className:"block font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Webhook:"}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("input",{type:"text",value:`${((re=N.webhook_url)==null?void 0:re.split("?")[0])||N.webhook_url}?token=${N.id}&pair_index=${E.pair_index}&campaign_id={campaign_id}&click_id={click_id}`,readOnly:!0,className:"flex-1 px-2 py-1 border dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-[10px]"}),a.jsx("button",{onClick:()=>{var he;const le=((he=N.webhook_url)==null?void 0:he.split("?")[0])||N.webhook_url||"";Y(`${le}?token=${N.id}&pair_index=${E.pair_index}&campaign_id={campaign_id}&click_id={click_id}`,`Pair ${E.pair_index} Webhook`)},className:"px-2 py-1 bg-orange-600 text-white rounded hover:bg-orange-700 text-[10px]",children:"Copy"})]})]})]})]},P)})}),a.jsx("button",{onClick:()=>{var Ee;const E=((Ee=N.webhook_url)==null?void 0:Ee.split("?")[0])||"https://[your-project].supabase.co/functions/v1/trackier-webhook",P=D.map(Ae=>{const we=`${E}?token=${N.id}&pair_index=${Ae.pair_index}&campaign_id={campaign_id}&click_id={click_id}`;return`Pair ${Ae.pair_index},${Ae.url1_campaign_id},${Ae.url2_campaign_id},${N.id},${Ae.pair_index},"${we}","${Ae.google_ads_template}"`}).join(`
`),z=`Pair,URL1_Campaign,URL2_Campaign,Offer_ID,Pair_Index,Webhook_URL,Google_Ads_Template
`,re=new Blob([z+P],{type:"text/csv"}),le=window.URL.createObjectURL(re),he=document.createElement("a");he.href=le,he.download=`trackier-pairs-${t.replace(/\s+/g,"-")}.csv`,he.click(),K(" Exported all pairs to CSV")},className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-medium",children:" Export All Templates to CSV"})]}),a.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[a.jsx("button",{onClick:Ge,disabled:o,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:o?"Saving...":N.id?"Update Configuration":"Create Configuration"}),N.id&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:Dr,disabled:f||!N.sub_id_mapping||Object.keys(N.sub_id_mapping||{}).length===0,className:"px-6 py-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",title:!N.sub_id_mapping||Object.keys(N.sub_id_mapping||{}).length===0?"Please configure parameter mappings first":"Regenerate templates with current mappings",children:f?" Updating...":" Update Templates"}),a.jsx("button",{onClick:ot,disabled:d||!N.enabled,className:"px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:d?"Testing...":"Test Update"})]}),a.jsx("button",{onClick:s,className:"px-6 py-3 bg-gray-200 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-300 font-medium",children:"Close"})]})]}),a.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"How It Works"}),a.jsxs("ol",{className:"text-xs text-gray-600 space-y-1 list-decimal list-inside",children:[a.jsx("li",{children:"Create 2 campaigns in Trackier (URL 1 and URL 2)"}),a.jsx("li",{children:"Configure URL 1 to redirect to URL 2"}),a.jsx("li",{children:"Set URL 1 to fire webhook to your server"}),a.jsx("li",{children:"Use the generated Google Ads template in your campaigns"}),a.jsx("li",{children:"When clicks come in: URL 1  Webhook  Background trace  Update URL 2"}),a.jsx("li",{children:"Users get instant redirects (URL 2 always has fresh suffix pre-loaded)"})]})]})]})})})}const W_={US:"",GB:"",CA:"",AU:"",DE:"",FR:"",IT:"",ES:"",NL:"",SE:"",NO:"",DK:"",FI:"",PL:"",BR:"",MX:"",AR:"",CL:"",JP:"",KR:"",CN:"",IN:"",SG:"",MY:"",TH:"",ID:"",PH:"",VN:"",NZ:"",ZA:"",AE:"",SA:""};function K_({offerName:e}){const[t,r]=y.useState([]),[n,s]=y.useState(!0),[i,l]=y.useState(null),[o,c]=y.useState(null),d=y.useRef(null);y.useEffect(()=>(u(),d.current=setInterval(()=>{u()},1e4),()=>{d.current&&clearInterval(d.current)}),[e]);const u=async()=>{try{s(!0),l(null);const{data:b,error:m}=await J.from("gclid_click_mapping").select("id, gclid, tracking_url, tracking_trace_status, tracking_trace_hops, tracking_trace_proxy_ip, tracking_trace_final_url, trace_selected_geo, final_url_params, created_at").eq("offer_name",e).order("created_at",{ascending:!1}).limit(50);if(m)throw m;r(b||[])}catch(b){console.error("Error loading GCLID traces:",b),l(b.message)}finally{s(!1)}},h=b=>!b||b==="pending"?"bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400":b==="completed"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":b==="failed"||b==="error"?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":"bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400",p=(b,m)=>b?b.length<=m?b:b.substring(0,m)+"...":"-",v=b=>{const m=new Date,x=new Date(b),f=m.getTime()-x.getTime(),j=Math.floor(f/1e3),T=Math.floor(j/60),L=Math.floor(T/60),C=Math.floor(L/24);return j<60?`${j}s ago`:T<60?`${T}m ago`:L<24?`${L}h ago`:`${C}d ago`},g=b=>b&&W_[b.toUpperCase()]||"",k=b=>{c(o===b?null:b)};return n&&t.length===0?a.jsxs("div",{className:"p-8 text-center bg-neutral-50 dark:bg-neutral-800/50 rounded-lg",children:[a.jsx(yt,{className:"w-6 h-6 animate-spin mx-auto mb-2 text-neutral-400"}),a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Loading GCLID traces..."})]}):i?a.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg",children:a.jsxs("p",{className:"text-sm",children:["Error loading traces: ",i]})}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:" GCLID Trace Monitor"}),a.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"(Auto-refresh every 10s)"})]}),a.jsxs("button",{onClick:u,disabled:n,className:"px-3 py-1.5 bg-brand-600 hover:bg-brand-700 disabled:bg-neutral-400 text-white rounded-lg text-sm transition-colors flex items-center gap-2",children:[a.jsx(yt,{className:`w-4 h-4 ${n?"animate-spin":""}`}),"Refresh"]})]}),t.length===0?a.jsxs("div",{className:"p-8 text-center bg-neutral-50 dark:bg-neutral-800/50 rounded-lg",children:[a.jsx(Ll,{className:"w-8 h-8 mx-auto mb-2 text-neutral-400"}),a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"No GCLID traces recorded yet"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-500 mt-1",children:"Traces will appear here when tracking URLs are accessed with GCLID parameters"})]}):a.jsx("div",{className:"border border-neutral-200 dark:border-neutral-800 rounded-lg overflow-hidden",children:a.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800/50 sticky top-0 z-10",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300 font-medium",children:"GCLID"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300 font-medium",children:"Tracking URL"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300 font-medium",children:"Status"}),a.jsx("th",{className:"px-3 py-2 text-center text-neutral-700 dark:text-neutral-300 font-medium",children:"Hops"}),a.jsx("th",{className:"px-3 py-2 text-center text-neutral-700 dark:text-neutral-300 font-medium",children:"Geo"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300 font-medium",children:"Proxy IP"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300 font-medium",children:"Final URL"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300 font-medium",children:"Final Params"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300 font-medium",children:"Created"}),a.jsx("th",{className:"px-3 py-2 text-center text-neutral-700 dark:text-neutral-300 font-medium"})]})}),a.jsx("tbody",{children:t.map(b=>a.jsxs(a.Fragment,{children:[a.jsxs("tr",{className:"border-t border-neutral-200 dark:border-neutral-800 hover:bg-neutral-50 dark:hover:bg-neutral-800/30",children:[a.jsx("td",{className:"px-3 py-2 font-mono text-xs text-neutral-600 dark:text-neutral-400",children:p(b.gclid,20)}),a.jsx("td",{className:"px-3 py-2 text-xs text-neutral-600 dark:text-neutral-400 max-w-xs",title:b.tracking_url||"",children:p(b.tracking_url,50)}),a.jsx("td",{className:"px-3 py-2",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${h(b.tracking_trace_status)}`,children:b.tracking_trace_status||"pending"})}),a.jsx("td",{className:"px-3 py-2 text-center text-neutral-600 dark:text-neutral-400",children:b.tracking_trace_hops||0}),a.jsx("td",{className:"px-3 py-2 text-center text-sm",children:b.trace_selected_geo?a.jsxs("span",{title:b.trace_selected_geo,children:[g(b.trace_selected_geo)," ",b.trace_selected_geo]}):a.jsx("span",{className:"text-neutral-400",children:"-"})}),a.jsx("td",{className:"px-3 py-2 font-mono text-xs text-neutral-600 dark:text-neutral-400",children:b.tracking_trace_proxy_ip||"-"}),a.jsx("td",{className:"px-3 py-2 text-xs text-neutral-600 dark:text-neutral-400 max-w-xs",title:b.tracking_trace_final_url||"",children:p(b.tracking_trace_final_url,40)}),a.jsx("td",{className:"px-3 py-2 text-xs text-neutral-600 dark:text-neutral-400 max-w-xs font-mono",title:b.final_url_params||"",children:p(b.final_url_params,30)}),a.jsx("td",{className:"px-3 py-2 text-xs text-neutral-500 dark:text-neutral-500 whitespace-nowrap",children:v(b.created_at)}),a.jsx("td",{className:"px-3 py-2 text-center",children:a.jsx("button",{onClick:()=>k(b.id),className:"text-neutral-500 hover:text-brand-600 dark:text-neutral-400 dark:hover:text-brand-400",children:a.jsx(Us,{className:"w-4 h-4"})})})]},b.id),o===b.id&&a.jsx("tr",{className:"bg-neutral-50 dark:bg-neutral-800/50 border-t border-neutral-200 dark:border-neutral-800",children:a.jsx("td",{colSpan:10,className:"px-3 py-4",children:a.jsxs("div",{className:"space-y-3 text-xs",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-semibold text-neutral-700 dark:text-neutral-300",children:"Full GCLID:"}),a.jsx("div",{className:"mt-1 p-2 bg-white dark:bg-neutral-900 rounded border border-neutral-200 dark:border-neutral-700 font-mono break-all",children:b.gclid})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-semibold text-neutral-700 dark:text-neutral-300",children:"Full Tracking URL:"}),a.jsx("div",{className:"mt-1 p-2 bg-white dark:bg-neutral-900 rounded border border-neutral-200 dark:border-neutral-700 break-all",children:b.tracking_url})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-semibold text-neutral-700 dark:text-neutral-300",children:"Full Final URL:"}),a.jsx("div",{className:"mt-1 p-2 bg-white dark:bg-neutral-900 rounded border border-neutral-200 dark:border-neutral-700 break-all",children:b.tracking_trace_final_url||"N/A"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-semibold text-neutral-700 dark:text-neutral-300",children:"Final URL Parameters:"}),a.jsx("div",{className:"mt-1 p-2 bg-white dark:bg-neutral-900 rounded border border-neutral-200 dark:border-neutral-700 font-mono break-all",children:b.final_url_params||"N/A"})]})]})})})]}))})]})})}),t.length>0&&a.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-500 dark:text-neutral-400 px-2",children:[a.jsxs("span",{children:["Showing ",t.length," most recent traces (last 50 auto-kept)"]}),a.jsxs("span",{children:["Completed: ",t.filter(b=>b.tracking_trace_status==="completed").length," | Failed: ",t.filter(b=>b.tracking_trace_status==="failed"||b.tracking_trace_status==="error").length," | Pending: ",t.filter(b=>!b.tracking_trace_status||b.tracking_trace_status==="pending").length]})]})]})}function Y_({offerName:e,onClose:t}){var he,Ee,Ae,we,ke,Re,Mt,Te;const[r,n]=y.useState({enabled:!1,max_traces_per_day:void 0,apply_filters:!1,single_geo_targets:["US","GB","ES","DE","FR","IT","CA","AU"],multi_geo_targets:["US,GB,ES","US,GB,DE","US,CA,AU"]}),[s,i]=y.useState([]),[l,o]=y.useState(""),[c,d]=y.useState(""),[u,h]=y.useState(null),[p,v]=y.useState([]),[g,k]=y.useState([]),[b,m]=y.useState(null),[x,f]=y.useState(""),[j,T]=y.useState(!1),[L,C]=y.useState(!0),[O,Q]=y.useState(!1),[W,pe]=y.useState(!1),[A,ne]=y.useState(null),[te,me]=y.useState(5),[K,V]=y.useState(3),[_,D]=y.useState(null),[q,N]=y.useState(null),[B,U]=y.useState([]),[F,H]=y.useState(!1),[be,je]=y.useState([]),[qe,lt]=y.useState(!1),[fe,gt]=y.useState(null),[wt,De]=y.useState(!1),[nt,M]=y.useState("config");y.useEffect(()=>{oe()},[e]),y.useEffect(()=>{Y(),r.silent_fetch_enabled&&(Yt(),S());const I=setInterval(()=>{Y(),r.silent_fetch_enabled&&(Yt(),S())},15e3);return()=>clearInterval(I)},[r.silent_fetch_enabled,e]),y.useEffect(()=>{if(l&&c){const I=encodeURIComponent(c);f(`https://${l}/click?offer_name=${e}&force_transparent=true&meta_refresh=true&debug_delay_ms=3000&redirect_url=${I}`)}else l&&!c&&f(`https://${l}/click?offer_name=${e}&force_transparent=true&meta_refresh=true&debug_delay_ms=3000&redirect_url={lpurl}`)},[l,e,c]);const oe=async()=>{try{C(!0),ne(null);const{data:I,error:ge}=await J.from("settings").select("tracking_domains, google_ads_enabled").single();if(ge)throw ge;const ce=(I==null?void 0:I.tracking_domains)||[];i(ce),ce.length>0&&!l&&o(ce[0]);const{data:X,error:et}=await J.from("offers").select("google_ads_config, final_url, target_country, geo_pool").eq("offer_name",e).single();if(et)throw et;X!=null&&X.google_ads_config&&n(X.google_ads_config),X!=null&&X.final_url&&d(X.final_url),X!=null&&X.target_country&&h(X.target_country),X!=null&&X.geo_pool&&Array.isArray(X.geo_pool)&&v(X.geo_pool),await ot(),await Dr(),await Ge(),await Y()}catch(I){console.error("Error loading data:",I),ne(I.message)}finally{C(!1)}},Ge=async()=>{try{De(!0);const{data:I,error:ge}=await J.rpc("get_click_stats_by_category",{p_offer_name:e,p_days:7});if(ge)throw ge;I&&I.length>0&&gt(I[0])}catch(I){console.error("Error loading click analytics:",I)}finally{De(!1)}},ot=async()=>{try{const{data:I,error:ge}=await J.rpc("get_bucket_stats",{p_offer_name:e});if(ge)throw ge;k(I||[])}catch(I){console.error("Error loading bucket stats:",I)}},Dr=async()=>{try{const I=new Date().toISOString().split("T")[0],{data:ge,error:ce}=await J.from("google_ads_click_stats").select("*").eq("offer_name",e).eq("click_date",I).single();if(ce&&ce.code!=="PGRST116")throw ce;m(ge)}catch(I){console.error("Error loading click stats:",I)}},Yt=async()=>{try{const{error:I}=await J.rpc("get_silent_fetch_stats",{p_offer_name:e,p_days:7});if(I&&I.code!=="PGRST116")throw I}catch(I){console.error("Error loading silent fetch stats:",I)}},S=async()=>{try{lt(!0);const{data:I,error:ge}=await J.from("google_ads_silent_fetch_stats").select("*").eq("offer_name",e).order("created_at",{ascending:!1}).limit(50);if(ge)throw ge;const ce=(I||[]).map(X=>{let et="Real User",Nt="";return X.user_agent&&(X.user_agent.includes("Googlebot")||X.user_agent.includes("AdsBot-Google")||X.user_agent.includes("Google-Adwords-Instant")?(et="Google Bot",Nt="User agent contains Googlebot/AdsBot"):(X.user_agent.includes("bingbot")||X.user_agent.includes("BingPreview"))&&(et="Bing Bot",Nt="User agent contains bingbot")),X.client_ip&&(X.client_ip.startsWith("66.249.")||X.client_ip.startsWith("66.102.")||X.client_ip.startsWith("64.233."))&&(et="Google Bot",Nt="IP is from Google bot range"),X.client_ip&&(X.client_ip.startsWith("172.")||X.client_ip.startsWith("10.")||X.client_ip.startsWith("192.168."))&&(et="Internal/Test",Nt="Private IP address"),{...X,ipType:et,reason:Nt}});je(ce)}catch(I){console.error("Error loading silent fetch clicks:",I)}finally{lt(!1)}},Y=async()=>{try{H(!0);const{data:I,error:ge}=await J.from("google_ads_click_events").select("*").eq("offer_name",e).order("created_at",{ascending:!1}).limit(50);if(ge)throw ge;const ce=(I||[]).map(_e=>{let Tt="Real User",Fr="";return _e.user_agent&&(_e.user_agent.includes("Googlebot")||_e.user_agent.includes("AdsBot-Google")||_e.user_agent.includes("Google-Adwords-Instant")?(Tt="Google Bot",Fr="User agent contains Googlebot/AdsBot"):_e.user_agent.includes("bingbot")||_e.user_agent.includes("BingPreview")?(Tt="Bing Bot",Fr="User agent contains bingbot"):_e.user_agent.includes("Wheregoes.com")&&(Tt="Redirect Checker",Fr="Wheregoes redirect checker")),_e.user_ip&&(_e.user_ip.startsWith("66.249.")||_e.user_ip.startsWith("66.102.")||_e.user_ip.startsWith("64.233."))&&(Tt="Google Bot",Fr="IP is from Google bot range"),_e.user_ip&&(_e.user_ip.startsWith("172.")||_e.user_ip.startsWith("10.")||_e.user_ip.startsWith("192.168."))&&(Tt="Internal/Test",Fr="Private IP address"),{..._e,ipType:Tt,reason:Fr}});U(ce);const X=ce.reduce((_e,Tt)=>(_e[Tt.ipType]=(_e[Tt.ipType]||0)+1,_e),{}),et=ce.reduce((_e,Tt)=>(_e[Tt.user_ip]=(_e[Tt.user_ip]||0)+1,_e),{}),Nt=Object.entries(et).filter(([,_e])=>_e>5);gt({total:ce.length,summary:X,repeatedIps:Nt.length,cookiesWorking:Nt.length===0})}catch(I){console.error("Error loading recent clicks:",I)}finally{H(!1)}},E=async()=>{try{pe(!0),ne(null);const{error:I}=await J.from("offers").update({google_ads_config:r}).eq("offer_name",e);if(I)throw I;r.enabled&&g.length===0&&await P(!0),alert("Google Ads configuration saved successfully!")}catch(I){console.error("Error saving config:",I),ne(I.message)}finally{pe(!1)}},P=async(I=!1)=>{try{Q(!0),ne(null),D({status:"starting"});const ge=setInterval(async()=>{await ot()},2e3);N(ge);let ce,X;u?(ce=[u],X=[]):p&&p.length>0?(ce=p,X=r.multi_geo_targets||[]):(ce=r.single_geo_targets||[],X=r.multi_geo_targets||[]);const et=await fetch("https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/fill-geo-buckets",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmaHVxZW5udHhpcXVycGxlbmpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NjEwNDgsImV4cCI6MjA4MTUzNzA0OH0.pi_6p2H2nuPfJvdT3pHNGpk0BTI3WQKTSzsj8dxQBA8","Content-Type":"application/json"},body:JSON.stringify({offer_name:e,single_geo_targets:ce,multi_geo_targets:X,single_geo_count:te,multi_geo_count:K,force:!1})});if(ge&&clearInterval(ge),N(null),!et.ok){const _e=await et.text();throw new Error(_e)}const Nt=await et.json();D(Nt),I||alert(`Buckets filled! Generated: ${Nt.total_generated}, Failed: ${Nt.total_failed}`),await ot()}catch(ge){console.error("Error filling buckets:",ge),q&&clearInterval(q),N(null),I||ne(ge.message)}finally{Q(!1)}},z=()=>{navigator.clipboard.writeText(x),T(!0),setTimeout(()=>T(!1),2e3)},re=()=>{const I=x.replace("{lpurl}","https://example.com");window.open(I,"_blank")},le=()=>{if(!r.silent_fetch_enabled){alert("Silent fetch mode is not enabled!");return}const ce=`<!DOCTYPE html>
<html>
<head>
  <meta name="referrer" content="no-referrer">
  <title>Silent Fetch Test</title>
  <script>
    // Client-side silent fetch - ensures cookies are set in user's browser
    (function() {
      var trackingUrl = "${r.silent_fetch_url||"https://example.com"}";
      var landingUrl = "${c||"https://example.com"}";
      
      console.log('Starting silent fetch test...');
      console.log('Tracking URL:', trackingUrl);
      console.log('Landing URL:', landingUrl);
      
      // Fire tracking URL silently (cookies will be set in user's browser)
      fetch(trackingUrl, {
        method: 'GET',
        mode: 'no-cors', // Bypass CORS, don't need response
        credentials: 'include' // Include cookies
      }).then(function() {
        console.log('Silent fetch completed successfully');
      }).catch(function(err) {
        console.log('Silent fetch error (expected):', err);
      });
      
      // Redirect to landing page after 100ms (gives time for fetch to start)
      setTimeout(function() {
        console.log('Redirecting to landing page...');
        // window.location.href = landingUrl; // Uncomment to actually redirect
        alert('Silent fetch test completed! Check browser console (F12) for logs. Redirect would go to: ' + landingUrl);
      }, 100);
    })();
  <\/script>
</head>
<body>
  <p>Silent Fetch Test in Progress... (Check browser console)</p>
</body>
</html>`,X=window.open("","_blank","width=600,height=400");X&&(X.document.write(ce),X.document.close())};return L?a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white dark:bg-neutral-900 rounded-lg p-8 max-w-4xl w-full mx-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-2 border-brand-500 border-t-transparent mx-auto"}),a.jsx("p",{className:"mt-4 text-neutral-600 dark:text-neutral-400",children:"Loading Google Ads configuration..."})]})})}):a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg max-w-5xl w-full my-8 flex flex-col max-h-[90vh]",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200 dark:border-neutral-800",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-white",children:"Google Ads Click Tracker"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:e})]}),a.jsx("button",{onClick:t,className:"p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-lg transition-colors",children:a.jsx(dr,{className:"w-5 h-5 text-neutral-500"})})]}),a.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-800",children:a.jsxs("div",{className:"flex overflow-x-auto bg-neutral-50 dark:bg-neutral-850",children:[a.jsx("button",{onClick:()=>M("config"),className:`px-6 py-3 font-medium text-sm border-b-2 transition-smooth whitespace-nowrap ${nt==="config"?"border-brand-600 dark:border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:"Configuration"}),a.jsx("button",{onClick:()=>M("clicks"),className:`px-6 py-3 font-medium text-sm border-b-2 transition-smooth whitespace-nowrap ${nt==="clicks"?"border-brand-600 dark:border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:"Click Events"}),a.jsx("button",{onClick:()=>M("traces"),className:`px-6 py-3 font-medium text-sm border-b-2 transition-smooth whitespace-nowrap ${nt==="traces"?"border-brand-600 dark:border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:"GCLID Traces"})]})}),a.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto flex-1",children:[A&&a.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg",children:[a.jsx(Nr,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("p",{className:"text-sm",children:A})]}),nt==="config"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center justify-between p-4 bg-neutral-50 dark:bg-neutral-800/50 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-neutral-900 dark:text-white",children:"Enable Google Ads Tracking"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:"Generate tracking URLs with geo-bucketed suffixes"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:r.enabled,onChange:I=>n({...r,enabled:I.target.checked}),className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-neutral-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-brand-300 dark:peer-focus:ring-brand-800 rounded-full peer dark:bg-neutral-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-neutral-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-neutral-600 peer-checked:bg-brand-600"})]})]}),r.enabled&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Tracking Domain"}),s.length===0?a.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400 rounded-lg text-sm",children:"No tracking domains configured. Add domains in Settings  tracking_domains"}):a.jsx("select",{value:l,onChange:I=>o(I.target.value),className:"w-full px-3 py-2 bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent text-neutral-900 dark:text-white",children:s.map(I=>a.jsx("option",{value:I,children:I},I))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Final URL (Landing Page) *"}),a.jsx("input",{type:"url",value:c,onChange:I=>d(I.target.value),placeholder:"e.g., https://surfshark.com/",className:"w-full px-3 py-2 bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent text-neutral-900 dark:text-white"}),a.jsx("p",{className:"mt-2 text-xs text-neutral-500 dark:text-neutral-400",children:"Enter the final landing page URL where users will be redirected (from your Offers tab)"})]}),x&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Google Ads Final URL Template"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:x,readOnly:!0,className:"flex-1 px-3 py-2 bg-neutral-50 dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 rounded-lg font-mono text-sm text-neutral-900 dark:text-white"}),a.jsxs("button",{onClick:z,className:"px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[j?a.jsx(dg,{className:"w-4 h-4"}):a.jsx(ht,{className:"w-4 h-4"}),j?"Copied!":"Copy"]}),a.jsx("button",{onClick:re,className:"px-4 py-2 bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 text-neutral-900 dark:text-white rounded-lg transition-colors",children:a.jsx(Us,{className:"w-4 h-4"})})]}),a.jsxs("p",{className:"mt-2 text-xs text-neutral-500 dark:text-neutral-400",children:["Use this URL in Google Ads as your Final URL. The ","{lpurl}"," parameter will be automatically replaced."]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Max Traces Per Day (optional)"}),a.jsx("input",{type:"number",value:r.max_traces_per_day||"",onChange:I=>n({...r,max_traces_per_day:I.target.value?parseInt(I.target.value):void 0}),placeholder:"Unlimited",className:"w-full px-3 py-2 bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent text-neutral-900 dark:text-white"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"GCLID Network Parameter"}),a.jsx("input",{type:"text",value:r.gclid_param_token||"",onChange:I=>n({...r,gclid_param_token:I.target.value}),placeholder:"e.g., xcust, subid, aff_sub",className:"w-full px-3 py-2 bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent text-neutral-900 dark:text-white"}),a.jsx("p",{className:"mt-1 text-xs text-neutral-500 dark:text-neutral-400",children:'Parameter name that will hold the GCLID value in tracking URLs (e.g., "xcust" for Skimlinks)'})]})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[a.jsx("div",{children:a.jsxs("label",{className:"flex items-center gap-2 p-4 bg-neutral-50 dark:bg-neutral-800/50 rounded-lg cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:r.apply_filters||!1,onChange:I=>n({...r,apply_filters:I.target.checked}),className:"w-4 h-4 text-brand-600 bg-neutral-100 border-neutral-300 rounded focus:ring-brand-500 dark:focus:ring-brand-600 dark:ring-offset-neutral-900 focus:ring-2 dark:bg-neutral-700 dark:border-neutral-600"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:"Apply Filters"}),a.jsx("div",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:"Bot/IP/geo filtering"})]})]})}),r.apply_filters&&a.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:[a.jsxs("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:["Repeat IP Window (days)",a.jsx("span",{className:"ml-2 text-xs text-neutral-500 dark:text-neutral-400",children:"If same IP returns within this period, they get clean redirect (no suffix)"})]}),a.jsx("input",{type:"number",min:"0",value:((he=r.filtering)==null?void 0:he.repeat_ip_window_days)||7,onChange:I=>{const ge=parseInt(I.target.value)||0;n({...r,filtering:{...r.filtering||{},enabled:!0,repeat_ip_window_days:ge}})},className:"w-32 px-3 py-2 bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent text-neutral-900 dark:text-white"}),a.jsx("div",{className:"mt-2 text-xs text-neutral-600 dark:text-neutral-400",children:"Set to 0 to disable repeat IP blocking. Default: 7 days"})]}),a.jsxs("div",{className:"p-4 border border-neutral-200 dark:border-neutral-800 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[a.jsx("input",{type:"checkbox",checked:r.silent_fetch_enabled||!1,onChange:I=>n({...r,silent_fetch_enabled:I.target.checked}),className:"w-4 h-4 text-brand-600 bg-neutral-100 border-neutral-300 rounded focus:ring-brand-500"}),a.jsx("div",{children:a.jsx("span",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:"Enable Silent Fetch Mode"})})]}),a.jsx("p",{className:"text-xs text-neutral-600 dark:text-neutral-400 ml-6",children:"Silently hit tracking URL in background via client-side fetch. Cookies are set in user's browser. Bypasses bucket system entirely."})]}),r.silent_fetch_enabled&&a.jsx("span",{className:"px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full font-medium whitespace-nowrap",children:"Active"})]}),r.silent_fetch_enabled&&a.jsxs("div",{className:"mt-4 ml-6 space-y-4 border-l-2 border-blue-200 dark:border-blue-800 pl-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Tracking URL"}),a.jsx("input",{type:"url",value:r.silent_fetch_url||"",onChange:I=>n({...r,silent_fetch_url:I.target.value}),placeholder:"Leave empty to use offer URL",className:"w-full px-3 py-2 bg-white dark:bg-neutral-900 border border-neutral-300 dark:border-neutral-700 rounded-lg text-sm text-neutral-900 dark:text-white focus:ring-2 focus:ring-brand-500"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"If empty, will use offer URL from settings. The URL will be hit with user's IP and country headers."})]}),a.jsxs("button",{onClick:le,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[a.jsx(Us,{className:"w-4 h-4"}),"Test Silent Fetch"]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:r.block_datacenters??!0,onChange:I=>n({...r,block_datacenters:I.target.checked}),className:"w-4 h-4 rounded border-neutral-300"}),a.jsx("span",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:" Block Datacenters"})]}),a.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:((Ee=r.filtering)==null?void 0:Ee.block_vpn_proxy)!==!1,onChange:I=>{n({...r,filtering:{...r.filtering||{},enabled:!0,block_vpn_proxy:I.target.checked}})},className:"w-4 h-4 rounded border-neutral-300"}),a.jsx("span",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:" Block VPN/Proxy"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:" IP Blacklist (comma-separated)"}),a.jsx("textarea",{value:((we=(Ae=r.filtering)==null?void 0:Ae.ip_blacklist)==null?void 0:we.join(", "))||"",onChange:I=>{const ge=I.target.value.split(",").map(ce=>ce.trim()).filter(ce=>ce);n({...r,filtering:{...r.filtering||{},enabled:!0,ip_blacklist:ge}})},placeholder:"10.0.0.1, 192.168.1.100",className:"w-full px-3 py-2 bg-white dark:bg-neutral-900 border border-neutral-300 dark:border-neutral-700 rounded-lg text-sm text-neutral-900 dark:text-white",rows:2})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:" Blocked Countries (comma-separated codes, e.g., RU,CN,KP)"}),a.jsx("input",{type:"text",value:((Re=(ke=r.filtering)==null?void 0:ke.blocked_countries)==null?void 0:Re.join(", "))||"",onChange:I=>{const ge=I.target.value.split(",").map(ce=>ce.trim().toUpperCase()).filter(ce=>ce);n({...r,filtering:{...r.filtering||{},enabled:!0,blocked_countries:ge}})},placeholder:"RU, CN, KP",className:"w-full px-3 py-2 bg-white dark:bg-neutral-900 border border-neutral-300 dark:border-neutral-700 rounded-lg text-sm text-neutral-900 dark:text-white"})]})]})]}),b&&a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:b.clicks_today}),a.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Total Clicks Today"})]}),a.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:b.suffixes_served}),a.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"With Suffix"})]}),a.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:b.transparent_clicks}),a.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Transparent"})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Click Analytics (7 Days)"}),a.jsx("button",{onClick:Ge,disabled:wt,className:"px-3 py-1.5 bg-neutral-600 hover:bg-neutral-700 disabled:bg-neutral-400 text-white rounded-lg text-sm transition-colors flex items-center gap-2",children:a.jsx(yt,{className:`w-4 h-4 ${wt?"animate-spin":""}`})})]}),wt?a.jsxs("div",{className:"p-8 text-center bg-neutral-50 dark:bg-neutral-800/50 rounded-lg",children:[a.jsx(yt,{className:"w-6 h-6 animate-spin mx-auto mb-2 text-neutral-400"}),a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Loading..."})]}):fe?a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:fe.real_users}),a.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-1",children:"Real Users"}),a.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-500",children:[fe.real_user_percentage,"% of total"]})]}),a.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[a.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:fe.google_bots}),a.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-1",children:"Google Bots"}),a.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-500",children:[fe.google_bot_percentage,"% of total"]})]}),a.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800",children:[a.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:fe.total_clicks}),a.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-1",children:"Total Clicks"}),a.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-500",children:"Last 7 days"})]}),a.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:[a.jsx("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:fe.invalid_clicks}),a.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-1",children:"Invalid/Lost Clicks"}),a.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-500",children:[(fe.invalid_clicks/fe.total_clicks*100).toFixed(1),"% of total"]})]})]}):a.jsx("div",{className:"p-8 text-center bg-neutral-50 dark:bg-neutral-800/50 rounded-lg",children:a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"No analytics data available"})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:" Recent Click Events (Regular Redirects)"}),a.jsx("button",{onClick:Y,disabled:F,className:"px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 disabled:bg-neutral-400 text-white rounded transition-colors flex items-center gap-1",children:F?a.jsxs(a.Fragment,{children:[a.jsx(yt,{className:"w-3 h-3 animate-spin"}),"Loading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(yt,{className:"w-3 h-3"}),"Refresh"]})})]}),fe&&a.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4",children:[a.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[a.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:fe.total}),a.jsx("div",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:"Total Clicks"})]}),a.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[a.jsx("div",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:((Mt=fe.summary)==null?void 0:Mt["Real User"])||0}),a.jsx("div",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:"Real Users"})]}),a.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[a.jsx("div",{className:"text-xl font-bold text-yellow-600 dark:text-yellow-400",children:((Te=fe.summary)==null?void 0:Te["Google Bot"])||0}),a.jsx("div",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:"Google Bots"})]}),a.jsxs("div",{className:`p-3 rounded-lg ${fe.cookiesWorking?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[a.jsx("div",{className:`text-xl font-bold ${fe.cookiesWorking?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:fe.cookiesWorking?"":""}),a.jsx("div",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:"Cookies"})]})]}),B.length===0?a.jsx("div",{className:"p-8 text-center bg-neutral-50 dark:bg-neutral-800/50 rounded-lg",children:a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"No clicks yet"})}):a.jsx("div",{className:"border border-neutral-200 dark:border-neutral-800 rounded-lg overflow-hidden",children:a.jsx("div",{className:"max-h-96 overflow-y-auto",children:a.jsxs("table",{className:"w-full text-xs",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800/50 sticky top-0 z-10",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300",children:"Time"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300",children:"Type"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300",children:"IP"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300",children:"Country"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300",children:"User Agent"}),a.jsx("th",{className:"px-3 py-2 text-left text-neutral-700 dark:text-neutral-300",children:"Referrer"})]})}),a.jsx("tbody",{children:B.map((I,ge)=>{var ce,X;return a.jsxs("tr",{className:"border-t border-neutral-200 dark:border-neutral-800 hover:bg-neutral-50 dark:hover:bg-neutral-800/30",children:[a.jsx("td",{className:"px-3 py-2 text-neutral-600 dark:text-neutral-400 whitespace-nowrap",children:new Date(I.created_at).toLocaleString()}),a.jsx("td",{className:"px-3 py-2",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${I.ipType==="Real User"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":I.ipType==="Google Bot"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400":"bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400"}`,children:I.ipType})}),a.jsxs("td",{className:"px-3 py-2 font-mono text-neutral-600 dark:text-neutral-400",children:[(ce=I.user_ip)==null?void 0:ce.substring(0,20),((X=I.user_ip)==null?void 0:X.length)>20&&"..."]}),a.jsx("td",{className:"px-3 py-2 text-neutral-600 dark:text-neutral-400",children:I.target_country||"-"}),a.jsx("td",{className:"px-3 py-2 text-neutral-600 dark:text-neutral-400 max-w-xs truncate",title:I.user_agent,children:I.user_agent||"(not logged)"}),a.jsx("td",{className:"px-3 py-2 text-neutral-600 dark:text-neutral-400",children:I.referrer||"(none)"})]},ge)})})]})})})]}),r.silent_fetch_enabled&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:" Silent Fetch Events (Client-Side Cookie Drops)"}),a.jsxs("button",{onClick:S,disabled:qe,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg text-sm transition-colors flex items-center gap-2",children:[a.jsx(yt,{className:`w-4 h-4 ${qe?"animate-spin":""}`}),"Refresh"]})]}),qe?a.jsxs("div",{className:"p-8 text-center bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[a.jsx(yt,{className:"w-6 h-6 animate-spin mx-auto mb-2 text-blue-400"}),a.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"Loading silent fetch events..."})]}):be.length===0?a.jsxs("div",{className:"p-8 text-center bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[a.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"No silent fetch events recorded yet"}),a.jsx("p",{className:"text-xs text-neutral-600 dark:text-neutral-400 mt-2",children:"These are client-side fetches that drop cookies without redirect"})]}):a.jsx("div",{className:"border border-blue-200 dark:border-blue-800 rounded-lg overflow-hidden",children:a.jsx("div",{className:"max-h-96 overflow-y-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-blue-50 dark:bg-blue-900/30 sticky top-0",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left text-blue-700 dark:text-blue-300",children:"Time"}),a.jsx("th",{className:"px-3 py-2 text-left text-blue-700 dark:text-blue-300",children:"Type"}),a.jsx("th",{className:"px-3 py-2 text-left text-blue-700 dark:text-blue-300",children:"IP"}),a.jsx("th",{className:"px-3 py-2 text-left text-blue-700 dark:text-blue-300",children:"Country"}),a.jsx("th",{className:"px-3 py-2 text-left text-blue-700 dark:text-blue-300",children:"User Agent"}),a.jsx("th",{className:"px-3 py-2 text-left text-blue-700 dark:text-blue-300",children:"Referrer"})]})}),a.jsx("tbody",{children:be.map((I,ge)=>{var ce,X;return a.jsxs("tr",{className:"border-t border-blue-200 dark:border-blue-800 hover:bg-blue-50 dark:hover:bg-blue-900/20",children:[a.jsx("td",{className:"px-3 py-2 text-neutral-600 dark:text-neutral-400 whitespace-nowrap",children:new Date(I.created_at).toLocaleString()}),a.jsx("td",{className:"px-3 py-2",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${I.ipType==="Real User"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":I.ipType==="Google Bot"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400":"bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400"}`,children:I.ipType})}),a.jsxs("td",{className:"px-3 py-2 font-mono text-neutral-600 dark:text-neutral-400",children:[(ce=I.client_ip)==null?void 0:ce.substring(0,20),((X=I.client_ip)==null?void 0:X.length)>20&&"..."]}),a.jsx("td",{className:"px-3 py-2 text-neutral-600 dark:text-neutral-400",children:I.client_country||"-"}),a.jsx("td",{className:"px-3 py-2 text-neutral-600 dark:text-neutral-400 max-w-xs truncate",title:I.user_agent,children:I.user_agent||"(not logged)"}),a.jsx("td",{className:"px-3 py-2 text-neutral-600 dark:text-neutral-400",children:I.referrer||"(none)"})]},ge)})})]})})})]}),!r.silent_fetch_enabled&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Geo Suffix Buckets"}),a.jsx("button",{onClick:()=>P(!1),disabled:O,className:"px-3 py-1.5 bg-brand-600 hover:bg-brand-700 disabled:bg-neutral-400 text-white rounded-lg text-sm transition-colors flex items-center gap-2",children:O?a.jsxs(a.Fragment,{children:[a.jsx(yt,{className:"w-4 h-4 animate-spin"}),"Filling..."]}):a.jsxs(a.Fragment,{children:[a.jsx(dl,{className:"w-4 h-4"}),"Fill Buckets"]})})]}),a.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg mb-4",children:a.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:[" ",a.jsx("strong",{children:"Note:"})," Each suffix takes ~10-15 seconds to generate. Start with small counts (5-10) to avoid timeouts."]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-neutral-50 dark:bg-neutral-800/50 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Single Geo Count"}),a.jsx("input",{type:"number",min:"1",max:"100",value:te,onChange:I=>me(parseInt(I.target.value)||30),disabled:O,className:"w-full px-3 py-2 bg-white dark:bg-neutral-900 border border-neutral-300 dark:border-neutral-700 rounded-lg text-neutral-900 dark:text-white text-sm disabled:opacity-50"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Suffixes per single geo"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Multi Geo Count"}),a.jsx("input",{type:"number",min:"0",max:"100",value:K,onChange:I=>V(parseInt(I.target.value)||0),disabled:O,className:"w-full px-3 py-2 bg-white dark:bg-neutral-900 border border-neutral-300 dark:border-neutral-700 rounded-lg text-neutral-900 dark:text-white text-sm disabled:opacity-50"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Suffixes per multi geo (0 to skip)"})]})]}),O&&_&&a.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-300 mb-3",children:" Filling in progress..."}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Generated"}),a.jsx("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:_.total_generated||0})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Failed"}),a.jsx("p",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:_.total_failed||0})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Duration"}),a.jsx("p",{className:"text-lg font-bold text-neutral-600 dark:text-neutral-400",children:_.duration_ms?`${(_.duration_ms/1e3).toFixed(1)}s`:"--"})]})]})]}),g.length===0?a.jsx("div",{className:"p-8 text-center bg-neutral-50 dark:bg-neutral-800/50 rounded-lg",children:a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:'No buckets yet. Click "Fill Buckets" to start.'})}):a.jsx("div",{className:"border border-neutral-200 dark:border-neutral-800 rounded-lg overflow-hidden",children:a.jsx("div",{className:"max-h-80 overflow-y-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800/50 sticky top-0 z-10",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-neutral-700 dark:text-neutral-300",children:"Country"}),a.jsx("th",{className:"px-4 py-2 text-right text-neutral-700 dark:text-neutral-300",children:"Total"}),a.jsx("th",{className:"px-4 py-2 text-right text-neutral-700 dark:text-neutral-300",children:"Available"}),a.jsx("th",{className:"px-4 py-2 text-right text-neutral-700 dark:text-neutral-300",children:"Used"}),a.jsx("th",{className:"px-4 py-2 text-right text-neutral-700 dark:text-neutral-300",children:"Status"})]})}),a.jsx("tbody",{children:g.map(I=>a.jsxs("tr",{className:"border-t border-neutral-200 dark:border-neutral-800",children:[a.jsx("td",{className:"px-4 py-2 font-medium text-neutral-900 dark:text-white",children:I.target_country}),a.jsx("td",{className:"px-4 py-2 text-right text-neutral-600 dark:text-neutral-400",children:I.total_suffixes}),a.jsx("td",{className:"px-4 py-2 text-right",children:a.jsx("span",{className:I.available_suffixes<5?"text-red-600 dark:text-red-400 font-medium":"text-green-600 dark:text-green-400",children:I.available_suffixes})}),a.jsx("td",{className:"px-4 py-2 text-right text-neutral-600 dark:text-neutral-400",children:I.used_suffixes}),a.jsx("td",{className:"px-4 py-2 text-right",children:I.available_suffixes<5?a.jsx("span",{className:"px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded text-xs",children:"Low"}):a.jsx("span",{className:"px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded text-xs",children:"OK"})})]},I.target_country))})]})})})]})]})]}),nt==="clicks"&&a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:a.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"This tab shows click analytics, recent click events, and silent fetch statistics for monitoring user interactions."})}),a.jsx("div",{className:"text-center py-8 text-neutral-600 dark:text-neutral-400",children:"Click events and analytics section - Coming soon"})]}),nt==="traces"&&a.jsx(K_,{offerName:e})]}),nt==="config"&&a.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-neutral-200 dark:border-neutral-800",children:[a.jsx("button",{onClick:t,className:"px-6 py-2 bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 text-neutral-900 dark:text-white rounded-lg transition-colors",children:"Cancel"}),a.jsx("button",{onClick:E,disabled:W,className:"px-6 py-2 bg-brand-600 hover:bg-brand-700 disabled:bg-neutral-400 text-white rounded-lg transition-colors flex items-center gap-2",children:W?a.jsxs(a.Fragment,{children:[a.jsx(yt,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):"Save Configuration"})]})]})})}function _g({value:e,onChange:t,placeholder:r="Search...",className:n=""}){return a.jsxs("div",{className:`relative group ${n}`,children:[a.jsx(fg,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 dark:text-neutral-500 transition-colors group-focus-within:text-brand-500 dark:group-focus-within:text-brand-400",size:16}),a.jsx("input",{type:"text",value:e,onChange:s=>t(s.target.value),className:"w-full pl-9 pr-9 py-2 border border-neutral-200 dark:border-neutral-800 rounded-lg bg-white dark:bg-neutral-900 text-neutral-900 dark:text-neutral-50 placeholder-neutral-400 dark:placeholder-neutral-500 text-sm focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth hover:border-neutral-300 dark:hover:border-neutral-700",placeholder:r}),e&&a.jsx("button",{onClick:()=>t(""),className:"absolute right-2.5 top-1/2 -translate-y-1/2 p-0.5 text-neutral-400 dark:text-neutral-500 hover:text-neutral-600 dark:hover:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded transition-smooth","aria-label":"Clear search",children:a.jsx(dr,{size:14})})]})}function Oc({label:e,options:t,value:r,onChange:n}){const[s,i]=y.useState(!1),l=y.useRef(null);y.useEffect(()=>{function c(d){l.current&&!l.current.contains(d.target)&&i(!1)}return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]);const o=t.find(c=>c.value===r);return a.jsxs("div",{className:"relative",ref:l,children:[a.jsxs("button",{onClick:()=>i(!s),className:"flex items-center gap-2 px-3 py-2 border border-neutral-200 dark:border-neutral-800 rounded-lg bg-white dark:bg-neutral-900 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-850 hover:border-neutral-300 dark:hover:border-neutral-700 transition-smooth text-sm",children:[a.jsxs("span",{className:"font-medium text-xs",children:[e,":"]}),a.jsx("span",{className:"text-xs",children:(o==null?void 0:o.label)||"All"}),a.jsx(Cn,{size:14,className:`transition-smooth ml-auto ${s?"rotate-180":""}`})]}),s&&a.jsx("div",{className:"absolute top-full left-0 mt-2 w-48 bg-white/95 dark:bg-neutral-900/95 backdrop-blur-xl border border-neutral-200 dark:border-neutral-800 rounded-lg shadow-lg z-50 max-h-64 overflow-y-auto animate-slide-down",children:t.map((c,d)=>a.jsxs("button",{onClick:()=>{n(c.value),i(!1)},style:{animationDelay:`${d*30}ms`},className:"w-full flex items-center justify-between px-3 py-2 text-left text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-smooth first:rounded-t-lg last:rounded-b-lg",children:[a.jsx("span",{className:"text-xs",children:c.label}),r===c.value&&a.jsx(dg,{size:14,className:"text-brand-600 dark:text-brand-400"})]},c.value))})]})}function wg({currentPage:e,totalPages:t,onPageChange:r,itemsPerPage:n,onItemsPerPageChange:s,totalItems:i}){const l=(e-1)*n+1,o=Math.min(e*n,i),c=()=>{const d=[];if(t>7)if(e<=4){for(let h=1;h<=5;h++)d.push(h);d.push("..."),d.push(t)}else if(e>=t-3){d.push(1),d.push("...");for(let h=t-4;h<=t;h++)d.push(h)}else{d.push(1),d.push("...");for(let h=e-1;h<=e+1;h++)d.push(h);d.push("..."),d.push(t)}else for(let h=1;h<=t;h++)d.push(h);return d};return a.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 px-4 py-3 bg-white dark:bg-dark-surface border-t border-gray-200 dark:border-dark-border rounded-b-lg",children:[a.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-dark-text-secondary",children:[a.jsxs("div",{children:["Showing ",l," to ",o," of ",i," results"]}),a.jsxs("select",{value:n,onChange:d=>s(Number(d.target.value)),className:"px-2 py-1 border border-gray-300 dark:border-dark-border rounded bg-white dark:bg-dark-elevated text-gray-900 dark:text-dark-text-primary text-sm outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:10,children:"10 per page"}),a.jsx("option",{value:25,children:"25 per page"}),a.jsx("option",{value:50,children:"50 per page"}),a.jsx("option",{value:100,children:"100 per page"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>r(e-1),disabled:e===1,className:"p-2 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-elevated text-gray-600 dark:text-dark-text-secondary hover:bg-gray-50 dark:hover:bg-dark-border disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a.jsx(ug,{size:18})}),a.jsx("div",{className:"flex gap-1",children:c().map((d,u)=>a.jsx("button",{onClick:()=>typeof d=="number"&&r(d),disabled:d==="...",className:`min-w-[40px] px-3 py-2 rounded-lg text-sm font-medium transition-colors ${d===e?"bg-blue-600 text-white":d==="..."?"text-gray-400 dark:text-gray-500 cursor-default":"border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-elevated text-gray-600 dark:text-dark-text-secondary hover:bg-gray-50 dark:hover:bg-dark-border"}`,children:d},u))}),a.jsx("button",{onClick:()=>r(e+1),disabled:e===t,className:"p-2 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-elevated text-gray-600 dark:text-dark-text-secondary hover:bg-gray-50 dark:hover:bg-dark-border disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a.jsx(Vd,{size:18})})]})]})}function J_(){const[e,t]=y.useState([]),[r,n]=y.useState(!0),[s,i]=y.useState(!1),[l,o]=y.useState(),[c,d]=y.useState(),[u,h]=y.useState(),[p,v]=y.useState(null),[g,k]=y.useState(new Set),[b,m]=y.useState(""),[x,f]=y.useState("all"),[j,T]=y.useState(1),[L,C]=y.useState(25);y.useEffect(()=>{O()},[]);const O=async()=>{n(!0);const{data:F,error:H}=await J.from("offers").select("*").order("created_at",{ascending:!1});!H&&F&&t(F),n(!1)},Q=async F=>{if(!confirm("Are you sure you want to delete this offer?"))return;const{error:H}=await J.from("offers").delete().eq("id",F);H||O()},W=F=>{o(F),i(!0)},pe=async F=>{try{const{id:H,created_at:be,updated_at:je,...qe}=F,lt={...qe,offer_name:`${F.offer_name} (Copy)`},{error:fe}=await J.from("offers").insert([lt]);fe?alert("Failed to duplicate offer: "+fe.message):O()}catch{alert("An error occurred while duplicating the offer")}},A=()=>{i(!1),o(void 0)},ne=()=>{O(),A()},te=F=>`https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/get-suffix?offer_name=${encodeURIComponent(F)}`,me=async(F,H)=>{await navigator.clipboard.writeText(H),v(F),setTimeout(()=>v(null),2e3)},K=F=>{const H=new Set(g);H.has(F)?H.delete(F):H.add(F),k(H)},V=F=>F?new Date(F).toLocaleString():"Never",_=e.filter(F=>{const H=b.toLowerCase(),be=F.offer_name.toLowerCase().includes(H)||F.final_url.toLowerCase().includes(H)||(F.campaign_name||"").toLowerCase().includes(H),je=x==="all"||x==="active"&&F.is_active||x==="inactive"&&!F.is_active;return be&&je}),D=Math.ceil(_.length/L),q=(j-1)*L,N=q+L,B=_.slice(q,N);y.useEffect(()=>{T(1)},[b,x]);const U=[{value:"all",label:"All Status"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}];return r?a.jsx("div",{className:"text-center py-12 text-neutral-500 dark:text-neutral-400",children:"Loading offers..."}):a.jsxs("div",{className:"space-y-5",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-50",children:"Your Offers"}),a.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400 mt-0.5",children:"Manage your URL tracking offers"})]}),a.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-4 py-2 bg-brand-600 text-white rounded-md hover:bg-brand-700 transition-smooth font-medium text-sm h-9",children:[a.jsx(Yr,{size:18}),"New Offer"]})]}),e.length>0&&a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsx(_g,{value:b,onChange:m,placeholder:"Search offers by name or URL...",className:"flex-1"}),a.jsx(Oc,{label:"Status",options:U,value:x,onChange:f})]}),e.length>0&&a.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["Showing ",a.jsx("span",{className:"font-medium text-neutral-900 dark:text-neutral-50",children:_.length})," of"," ",a.jsx("span",{className:"font-medium text-neutral-900 dark:text-neutral-50",children:e.length})," offers"]}),e.length===0?a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg border border-neutral-200 dark:border-neutral-800 p-12 text-center",children:[a.jsx(sa,{className:"mx-auto text-neutral-400 dark:text-neutral-600 mb-4",size:40}),a.jsx("h3",{className:"text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-1.5",children:"No offers yet"}),a.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400 mb-5",children:"Create your first offer to start tracking URLs"}),a.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-brand-600 text-white rounded-md hover:bg-brand-700 transition-smooth font-medium text-sm h-9",children:[a.jsx(Yr,{size:18}),"Create First Offer"]})]}):_.length===0?a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg border border-neutral-200 dark:border-neutral-800 p-12 text-center",children:[a.jsx(sa,{className:"mx-auto text-neutral-400 dark:text-neutral-600 mb-4",size:40}),a.jsx("h3",{className:"text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-1.5",children:"No offers found"}),a.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400 mb-5",children:"No offers match your current filters. Try adjusting your search or filters."}),a.jsx("button",{onClick:()=>{m(""),f("all")},className:"inline-flex items-center gap-2 px-4 py-2 bg-brand-600 text-white rounded-md hover:bg-brand-700 transition-smooth font-medium text-sm h-9",children:"Clear Filters"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid gap-4",children:B.map(F=>{const H=te(F.offer_name);return a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg border border-neutral-200 dark:border-neutral-800 p-5 hover:border-neutral-300 dark:hover:border-neutral-700 transition-smooth shadow-xs dark:shadow-none",children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2.5 mb-1.5",children:[a.jsx("h3",{className:"text-base font-semibold text-neutral-900 dark:text-neutral-50 truncate",children:F.offer_name}),F.is_active?a.jsx("span",{className:"px-2 py-0.5 bg-success-100 text-success-700 dark:bg-success-500/20 dark:text-success-400 text-xs font-medium rounded-md flex-shrink-0",children:"Active"}):a.jsx("span",{className:"px-2 py-0.5 bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400 text-xs font-medium rounded-md flex-shrink-0",children:"Inactive"})]}),F.campaign_name&&a.jsx("div",{className:"mb-2",children:a.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 border border-purple-200 dark:border-purple-800/50",children:[" ",F.campaign_name]})}),F.tracer_mode&&a.jsx("div",{className:"mb-2",children:a.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${F.tracer_mode==="http_only"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border border-green-200 dark:border-green-800/50":F.tracer_mode==="browser"?"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300 border border-orange-200 dark:border-orange-800/50":F.tracer_mode==="anti_cloaking"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 border border-blue-200 dark:border-blue-800/50":F.tracer_mode==="interactive"?"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 border border-purple-200 dark:border-purple-800/50":F.tracer_mode==="brightdata_browser"?"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-300 border border-indigo-200 dark:border-indigo-800/50":"bg-brand-100 dark:bg-brand-900/30 text-brand-800 dark:text-brand-300 border border-brand-200 dark:border-brand-800/50"}`,children:[" ",F.tracer_mode==="http_only"?"HTTP Only":F.tracer_mode==="browser"?"Browser":F.tracer_mode==="anti_cloaking"?"Anti-Cloaking":F.tracer_mode==="interactive"?"Interactive":F.tracer_mode==="brightdata_browser"?"Bright Data":"Auto"]})}),a.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-neutral-500 dark:text-neutral-400",children:[a.jsx(Us,{size:12}),a.jsx("a",{href:F.final_url,target:"_blank",rel:"noopener noreferrer",className:"hover:text-brand-600 dark:hover:text-brand-400 truncate transition-colors",children:F.final_url})]})]}),a.jsxs("div",{className:"flex gap-1 flex-shrink-0 ml-3",children:[a.jsx("button",{onClick:()=>h(F),className:"p-1.5 text-neutral-500 hover:text-blue-600 dark:text-neutral-400 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-500/10 rounded-md transition-smooth",title:"Google Ads Configuration",children:a.jsx(j_,{size:16})}),a.jsx("button",{onClick:()=>d(F),className:"p-1.5 text-neutral-500 hover:text-blue-600 dark:text-neutral-400 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-500/10 rounded-md transition-smooth",title:"Trackier Dual-URL Setup",children:a.jsx(O_,{size:16})}),a.jsx("button",{onClick:()=>pe(F),className:"p-1.5 text-neutral-500 hover:text-purple-600 dark:text-neutral-400 dark:hover:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-500/10 rounded-md transition-smooth",title:"Duplicate Offer",children:a.jsx(v_,{size:16})}),a.jsx("button",{onClick:()=>W(F),className:"p-1.5 text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-md transition-smooth",title:"Edit Offer",children:a.jsx(T_,{size:16})}),a.jsx("button",{onClick:()=>Q(F.id),className:"p-1.5 text-neutral-500 hover:text-error-600 dark:text-neutral-400 dark:hover:text-error-400 hover:bg-error-50 dark:hover:bg-error-500/10 rounded-md transition-smooth",title:"Delete Offer",children:a.jsx(Ds,{size:16})})]})]}),a.jsxs("div",{className:"space-y-2 text-xs",children:[F.tracking_template&&a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-neutral-500 dark:text-neutral-400 font-medium min-w-[120px] flex-shrink-0",children:"Tracking Template:"}),a.jsx("span",{className:"text-neutral-700 dark:text-neutral-300 truncate text-xs",children:F.tracking_template})]}),F.target_geo&&a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-neutral-500 dark:text-neutral-400 font-medium min-w-[120px] flex-shrink-0",children:"Target Geo:"}),a.jsx("span",{className:"text-neutral-700 dark:text-neutral-300 text-xs",children:F.target_geo})]}),a.jsxs("div",{className:"flex items-start gap-2 pt-2.5 border-t border-neutral-200 dark:border-neutral-800",children:[a.jsx("span",{className:"text-neutral-500 dark:text-neutral-400 font-medium min-w-[120px] flex-shrink-0",children:"API Endpoint:"}),a.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-0",children:[a.jsx("code",{className:"flex-1 bg-brand-50 dark:bg-brand-500/10 px-2 py-1 rounded text-brand-700 dark:text-brand-400 font-mono text-xs truncate",children:H}),a.jsx("button",{onClick:()=>me(F.id,H),className:"p-1 text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded transition-smooth flex-shrink-0",title:"Copy to clipboard",children:p===F.id?a.jsx(Ye,{size:14,className:"text-success-600 dark:text-success-400"}):a.jsx(ht,{size:14})})]})]}),F.tracking_template&&a.jsxs("div",{className:"mt-2.5 pt-2.5 border-t border-neutral-200 dark:border-neutral-800",children:[a.jsxs("button",{onClick:()=>K(F.id),className:"w-full flex items-center justify-between p-2 hover:bg-neutral-50 dark:hover:bg-neutral-850 rounded-md transition-smooth",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-300 font-medium text-xs",children:"Redirect Chain Trace"}),F.last_trace_date&&a.jsxs("span",{className:"text-xs text-neutral-400 dark:text-neutral-500",children:["(Last traced: ",V(F.last_trace_date),")"]})]}),g.has(F.id)?a.jsx(ol,{size:14,className:"text-neutral-400 dark:text-neutral-500"}):a.jsx(Cn,{size:14,className:"text-neutral-400 dark:text-neutral-500"})]}),g.has(F.id)&&a.jsx("div",{className:"mt-2 bg-neutral-50 dark:bg-neutral-925 rounded-md p-3 animate-slide-down",children:!F.last_traced_chain||F.last_traced_chain.length===0?a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 italic",children:"No trace data yet. Call the get-suffix API to trace the redirect chain."}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("span",{className:"text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:"Redirect Chain Steps:"}),a.jsxs("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["(",F.last_traced_chain.length," ",F.last_traced_chain.length===1?"step":"steps",")"]})]}),F.last_traced_chain.map((be,je)=>a.jsxs("div",{className:`relative pl-5 pb-2 ${je<F.last_traced_chain.length-1?"border-l-2 border-brand-300 dark:border-brand-500/30":""}`,children:[a.jsx("div",{className:"absolute left-0 top-0 -ml-1 w-2 h-2 rounded-full bg-brand-500 dark:bg-brand-400"}),a.jsxs("div",{className:"bg-white dark:bg-neutral-850 rounded-md p-2.5 border border-neutral-200 dark:border-neutral-800",children:[a.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1.5",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsxs("span",{className:"text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:["Step ",je+1]}),je===F.redirect_chain_step&&a.jsx("span",{className:"px-1.5 py-0.5 bg-success-100 text-success-700 dark:bg-success-500/20 dark:text-success-400 text-xs font-medium rounded-md",children:"Params Extracted"})]}),a.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[a.jsx("span",{className:`px-1.5 py-0.5 text-xs font-medium rounded-md ${be.status>=200&&be.status<300?"bg-success-100 text-success-700 dark:bg-success-500/20 dark:text-success-400":be.status>=300&&be.status<400?"bg-brand-100 text-brand-700 dark:bg-brand-500/20 dark:text-brand-400":"bg-error-100 text-error-700 dark:bg-error-500/20 dark:text-error-400"}`,children:be.status}),a.jsx("span",{className:"px-1.5 py-0.5 bg-neutral-100 text-neutral-700 dark:bg-neutral-800 dark:text-neutral-300 text-xs font-medium rounded-md",children:be.redirect_type})]})]}),a.jsx("div",{className:"text-xs text-neutral-600 dark:text-neutral-400 break-all mb-1",children:be.url}),be.params&&Object.keys(be.params).length>0&&a.jsxs("div",{className:"mt-2 pt-2 border-t border-neutral-200 dark:border-neutral-800",children:[a.jsx("span",{className:"text-xs font-semibold text-neutral-700 dark:text-neutral-300",children:"Parameters:"}),a.jsx("div",{className:"mt-1 space-y-0.5",children:Object.entries(be.params).map(([qe,lt])=>a.jsxs("div",{className:"flex gap-2 text-xs",children:[a.jsxs("span",{className:"font-medium text-neutral-500 dark:text-neutral-400",children:[qe,":"]}),a.jsx("span",{className:"text-neutral-700 dark:text-neutral-300",children:lt})]},qe))})]})]}),je<F.last_traced_chain.length-1&&a.jsx("div",{className:"absolute left-0 bottom-0 -ml-1",children:a.jsx(cg,{size:12,className:"text-brand-500 dark:text-brand-400 transform rotate-90"})})]},je))]})})]})]})]},F.id)})}),_.length>0&&a.jsx(wg,{currentPage:j,totalPages:D,onPageChange:T,itemsPerPage:L,onItemsPerPageChange:C,totalItems:_.length})]}),s&&a.jsx(M_,{offer:l,onClose:A,onSave:ne}),c&&a.jsx(H_,{offerId:c.id,offerName:c.offer_name,finalUrl:c.final_url,trackingTemplate:c.tracking_template,onClose:()=>d(void 0)}),u&&a.jsx(Y_,{offerName:u.offer_name,onClose:()=>h(void 0)})]})}const Q_={brightdata:{name:"Bright Data",host:"brd.superproxy.io",port:22225,username:"brd-customer-YOUR_ID-zone-ZONE_NAME",api_endpoint_example:"https://brightdata.com/api/v2/zone/ips",curl_example:'curl -x brd.superproxy.io:22225 -U "brd-customer-{id}-zone-{zone}-country-{country}:{pass}" https://lumtest.com/myip.json'},brightdata_browser:{name:"Bright Data Browser API",host:"api.brightdata.com",port:443,username:"",api_endpoint_example:"https://api.brightdata.com/v2/scrape",curl_example:`curl -H "Authorization: Bearer YOUR_API_KEY" -H "Content-Type: application/json" -d '{"url":"https://example.com","format":"raw","country":"us"}' https://api.brightdata.com/v2/scrape`},oxylabs:{name:"Oxylabs",host:"pr.oxylabs.io",port:7777,username:"customer-USERNAME-cc-COUNTRY",api_endpoint_example:"https://api.oxylabs.io/v1/queries",curl_example:'curl -x pr.oxylabs.io:7777 -U "customer-{username}-cc-{country}:{pass}" https://ip.oxylabs.io/location'},smartproxy:{name:"Smartproxy",host:"gate.smartproxy.com",port:7e3,username:"user-USERNAME-country-COUNTRY",api_endpoint_example:"https://api.smartproxy.com/v2/stats",curl_example:'curl -x gate.smartproxy.com:7000 -U "user-{username}-country-{country}:{pass}" https://ip.smartproxy.com/json'},luna:{name:"Luna Proxy",host:"customer-USERNAME.proxy.lunaproxy.com",port:12233,username:"username",api_endpoint_example:"",curl_example:""},custom:{name:"Custom Provider",host:"",port:8080,username:"",api_endpoint_example:"https://api.example.com/endpoint",curl_example:'curl -x proxy.example.com:port -U "user-{customer_id}-country-{country}:pass" https://ipapi.co/json/'}};function X_({provider:e,onClose:t,onSuccess:r}){const[n,s]=y.useState({name:"",provider_type:"custom",host:"",port:8080,username:"",password:"",api_key:"",api_endpoint_example:"",curl_example:"",priority:50,enabled:!0}),[i,l]=y.useState(!1),[o,c]=y.useState(null);y.useEffect(()=>{e&&s({...e,api_key:e.api_key||"",api_endpoint_example:e.api_endpoint_example||"",curl_example:e.curl_example||""})},[e]);const d=h=>{const p=Q_[h];p&&s({...n,provider_type:h,name:n.name||p.name,host:p.host,port:p.port,username:p.username,api_endpoint_example:p.api_endpoint_example,curl_example:p.curl_example})},u=async h=>{h.preventDefault(),c(null),l(!0);try{const{data:{session:p}}=await J.auth.getSession();if(!p)throw new Error("Not authenticated");const v="https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/proxy-providers",g=e?"PUT":"POST",k=e?{id:e.id,...n}:n,b=await fetch(v,{method:g,headers:{Authorization:`Bearer ${p.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(k)}),m=await b.json();if(!b.ok)throw new Error(m.error||"Failed to save provider");r()}catch(p){c(p.message||"Failed to save provider")}finally{l(!1)}};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"sticky top-0 bg-white dark:bg-neutral-900 border-b border-gray-200 dark:border-neutral-700 px-6 py-4 flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-neutral-100",children:e?"Edit Provider":"Add New Provider"}),a.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded-lg transition-colors",children:a.jsx(dr,{size:20})})]}),a.jsxs("form",{onSubmit:u,className:"p-6 space-y-6",children:[o&&a.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[a.jsx(Nr,{size:18}),a.jsx("span",{children:o})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Provider Type"}),a.jsxs("select",{value:n.provider_type,onChange:h=>{s({...n,provider_type:h.target.value}),d(h.target.value)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",required:!0,children:[a.jsx("option",{value:"custom",children:"Custom"}),a.jsx("option",{value:"brightdata",children:"Bright Data (Residential Proxy)"}),a.jsx("option",{value:"brightdata_browser",children:"Bright Data Browser API"}),a.jsx("option",{value:"oxylabs",children:"Oxylabs"}),a.jsx("option",{value:"smartproxy",children:"Smartproxy"}),a.jsx("option",{value:"luna",children:"Luna Proxy"})]}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Select a provider type to auto-fill common configurations"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Provider Name"}),a.jsx("input",{type:"text",value:n.name,onChange:h=>s({...n,name:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"My Proxy Provider",required:!0})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proxy Host"}),a.jsx("input",{type:"text",value:n.host,onChange:h=>s({...n,host:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none font-mono text-sm",placeholder:"proxy.example.com",required:n.provider_type!=="brightdata_browser"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Port"}),a.jsx("input",{type:"number",value:n.port,onChange:h=>s({...n,port:parseInt(h.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",placeholder:"8080",required:n.provider_type!=="brightdata_browser"})]})]}),n.provider_type==="brightdata_browser"&&a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bright Data Browser API Key"}),a.jsx("input",{type:"password",value:n.api_key||"",onChange:h=>s({...n,api_key:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none font-mono text-sm",placeholder:"Your Browser API Key",required:!0}),a.jsx("p",{className:"mt-2 text-sm text-gray-600",children:" Browser API uses REST API instead of proxy. Get your API key from Bright Data dashboard."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Username ",n.provider_type==="brightdata_browser"&&a.jsx("span",{className:"text-gray-500",children:"(not required for Browser API)"})]}),a.jsx("input",{type:"text",value:n.username,onChange:h=>s({...n,username:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none font-mono text-sm",placeholder:"username",required:n.provider_type!=="brightdata_browser"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Password ",n.provider_type==="brightdata_browser"&&a.jsx("span",{className:"text-gray-500",children:"(not required for Browser API)"})]}),a.jsx("input",{type:"password",value:n.password,onChange:h=>s({...n,password:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none font-mono text-sm",placeholder:"password",required:n.provider_type!=="brightdata_browser"})]})]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-3",children:"Documentation References (Optional)"}),a.jsx("p",{className:"text-xs text-blue-800 mb-3",children:"These fields are for your reference only and help document the provider's API format. They are not used in actual requests."}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Endpoint Example"}),a.jsx("input",{type:"text",value:n.api_endpoint_example,onChange:h=>s({...n,api_endpoint_example:h.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none font-mono text-xs",placeholder:"https://api.provider.com/endpoint"}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Example API endpoint to understand provider's API format"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"cURL Example"}),a.jsx("textarea",{value:n.curl_example,onChange:h=>s({...n,curl_example:h.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none font-mono text-xs",placeholder:'curl -x proxy:port -U "user-{country}:pass" https://ipapi.co/json/'}),a.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Example cURL command showing format with placeholders like ","{country}",", ","{session}"]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority (1-100)"}),a.jsx("input",{type:"number",min:"1",max:"100",value:n.priority,onChange:h=>s({...n,priority:parseInt(h.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",required:!0}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Higher priority providers are preferred in rotation"})]}),a.jsxs("div",{className:"flex items-center pt-6",children:[a.jsx("input",{type:"checkbox",id:"enabled",checked:n.enabled,onChange:h=>s({...n,enabled:h.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),a.jsx("label",{htmlFor:"enabled",className:"ml-2 text-sm font-medium text-gray-700",children:"Enable provider"})]})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:i,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center justify-center gap-2",children:[a.jsx(Ca,{size:18}),i?"Saving...":"Save Provider"]})]})]})]})})}function Z_({provider:e,onClose:t}){const[r,n]=y.useState(!1),[s,i]=y.useState(!1),[l,o]=y.useState(null),[c,d]=y.useState(null),[u,h]=y.useState("US"),[p,v]=y.useState(3),g=[{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"},{code:"CA",name:"Canada"},{code:"DE",name:"Germany"},{code:"FR",name:"France"},{code:"ES",name:"Spain"},{code:"IT",name:"Italy"},{code:"AU",name:"Australia"},{code:"JP",name:"Japan"},{code:"BR",name:"Brazil"}],k=async()=>{n(!0),o(null);try{const{data:{session:f}}=await J.auth.getSession();if(!f)throw new Error("Not authenticated");const L=await(await fetch("https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/proxy-providers/test",{method:"POST",headers:{Authorization:`Bearer ${f.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({host:e.host,port:e.port,username:e.username,password:e.password,provider_type:e.provider_type,test_type:"basic"})})).json();o(L),i(L.success)}catch(f){o({success:!1,status:"failed",response_time_ms:0,error:f.message})}finally{n(!1)}},b=async()=>{if(!s){alert("Please run and pass the basic test first");return}n(!0),d(null);try{const{data:{session:f}}=await J.auth.getSession();if(!f)throw new Error("Not authenticated");const L=await(await fetch("https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/proxy-providers/test",{method:"POST",headers:{Authorization:`Bearer ${f.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({host:e.host,port:e.port,username:e.username,password:e.password,provider_type:e.provider_type,test_type:"geo",target_country:u,num_requests:p})})).json();d(L)}catch(f){alert(`Test failed: ${f.message}`)}finally{n(!1)}},m=f=>f==="match"||f==="connected"?a.jsx(Ye,{className:"text-green-600",size:18}):f==="mismatch"?a.jsx(Nr,{className:"text-yellow-600",size:18}):a.jsx(Pc,{className:"text-red-600",size:18}),x=f=>f==="match"||f==="connected"?"bg-green-50 border-green-200 text-green-700":f==="mismatch"?"bg-yellow-50 border-yellow-200 text-yellow-700":"bg-red-50 border-red-200 text-red-700";return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"sticky top-0 bg-white dark:bg-neutral-900 border-b border-gray-200 dark:border-neutral-700 px-6 py-4 flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-neutral-100",children:"Test Provider Connection"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mt-1",children:e.name})]}),a.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded-lg transition-colors",children:a.jsx(dr,{size:20})})]}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Basic Connectivity Test"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Verify that the proxy is reachable and credentials are valid"})]}),a.jsx("button",{onClick:k,disabled:r,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center gap-2",children:r&&!l?a.jsxs(a.Fragment,{children:[a.jsx(cl,{className:"animate-spin",size:18}),"Testing..."]}):a.jsxs(a.Fragment,{children:[a.jsx(ul,{size:18}),"Run Basic Test"]})})]}),l&&a.jsxs("div",{className:`p-4 rounded-lg border ${x(l.status)}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[m(l.status),a.jsx("span",{className:"font-semibold",children:l.success?"Connection Successful":"Connection Failed"})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Status:"}),a.jsx("span",{className:"font-medium",children:l.status})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Response Time:"}),a.jsxs("span",{className:"font-medium",children:[l.response_time_ms,"ms"]})]}),l.ip_address&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"IP Address:"}),a.jsx("span",{className:"font-mono font-medium",children:l.ip_address})]}),l.error&&a.jsxs("div",{className:"mt-2 pt-2 border-t border-current",children:[a.jsx("span",{className:"font-medium",children:"Error:"})," ",l.error]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Geo-Targeting Validation Test"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Verify that the proxy correctly targets the specified country"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Country"}),a.jsx("select",{value:u,onChange:f=>h(f.target.value),disabled:r||!s,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none disabled:opacity-50",children:g.map(f=>a.jsxs("option",{value:f.code,children:[f.name," (",f.code,")"]},f.code))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Requests"}),a.jsxs("select",{value:p,onChange:f=>v(parseInt(f.target.value)),disabled:r||!s,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none disabled:opacity-50",children:[a.jsx("option",{value:1,children:"1 request"}),a.jsx("option",{value:3,children:"3 requests"}),a.jsx("option",{value:5,children:"5 requests"})]})]})]}),a.jsx("button",{onClick:b,disabled:r||!s,className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center justify-center gap-2",children:r&&s?a.jsxs(a.Fragment,{children:[a.jsx(cl,{className:"animate-spin",size:18}),"Running Test..."]}):a.jsxs(a.Fragment,{children:[a.jsx(ul,{size:18}),"Run Geo-Targeting Test"]})}),!s&&a.jsx("p",{className:"mt-2 text-sm text-gray-500 text-center",children:"Complete the basic test first to enable geo-targeting test"}),c&&a.jsxs("div",{className:"mt-6 space-y-4",children:[a.jsxs("div",{className:`p-4 rounded-lg border ${c.success_rate===100?"bg-green-50 border-green-200":c.success_rate>=80?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.success_rate===100?a.jsx(Ye,{className:"text-green-600",size:20}):c.success_rate>=80?a.jsx(Nr,{className:"text-yellow-600",size:20}):a.jsx(Pc,{className:"text-red-600",size:20}),a.jsxs("span",{className:"font-semibold",children:[c.successful_requests,"/",c.total_requests," requests successful (",c.success_rate,"%)"]})]}),a.jsx("p",{className:"text-sm",children:c.summary})]}),a.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"#"}),a.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Requested"}),a.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Actual"}),a.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"IP"}),a.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Time"}),a.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Status"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:c.results.map(f=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-2",children:f.request_number}),a.jsx("td",{className:"px-4 py-2 font-medium",children:f.requested_country}),a.jsx("td",{className:"px-4 py-2 font-medium",children:f.actual_country}),a.jsx("td",{className:"px-4 py-2 font-mono text-xs",children:f.ip_address}),a.jsxs("td",{className:"px-4 py-2",children:[f.response_time_ms,"ms"]}),a.jsx("td",{className:"px-4 py-2",children:a.jsxs("span",{className:`inline-flex items-center gap-1 text-xs px-2 py-1 rounded ${f.status==="match"?"bg-green-100 text-green-700":f.status==="mismatch"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[m(f.status),f.status]})})]},f.request_number))})]})})]})]})]}),a.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4",children:a.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"Close"})})]})})}function ew({rotationMode:e,failoverEnabled:t,onRotationModeChange:r,onFailoverEnabledChange:n}){const[s,i]=y.useState([]),[l,o]=y.useState(!0),[c,d]=y.useState(!1),[u,h]=y.useState(!1),[p,v]=y.useState(null),[g,k]=y.useState(null),[b,m]=y.useState(null);y.useEffect(()=>{x()},[]);const x=async()=>{o(!0);try{const{data:{session:C}}=await J.auth.getSession();if(!C)return;const W=await(await fetch("https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/proxy-providers",{headers:{Authorization:`Bearer ${C.access_token}`,"Content-Type":"application/json"}})).json();W.providers&&i(W.providers)}catch(C){m({type:"error",text:C.message||"Failed to fetch providers"})}finally{o(!1)}},f=async C=>{try{const{data:{session:O}}=await J.auth.getSession();if(!O)return;if((await fetch("https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/proxy-providers",{method:"PUT",headers:{Authorization:`Bearer ${O.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:C.id,enabled:!C.enabled})})).ok)m({type:"success",text:`Provider ${C.enabled?"disabled":"enabled"} successfully`}),x();else throw new Error("Failed to toggle provider")}catch(O){m({type:"error",text:O.message||"Failed to toggle provider"})}},j=async C=>{if(confirm("Are you sure you want to delete this provider?"))try{const{data:{session:O}}=await J.auth.getSession();if(!O)return;if((await fetch("https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/proxy-providers",{method:"DELETE",headers:{Authorization:`Bearer ${O.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:C})})).ok)m({type:"success",text:"Provider deleted successfully"}),x();else throw new Error("Failed to delete provider")}catch(O){m({type:"error",text:O.message||"Failed to delete provider"})}},T=C=>{const O=C.success_count+C.failure_count;return O===0?0:Math.round(C.success_count/O*100)},L=C=>C>=90?"text-success-600 dark:text-success-400 bg-success-50 dark:bg-success-900/30":C>=70?"text-warning-600 dark:text-warning-400 bg-warning-50 dark:bg-warning-900/30":"text-error-600 dark:text-error-400 bg-error-50 dark:bg-error-900/30";return a.jsxs("div",{className:"space-y-5",children:[b&&a.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-2 ${b.type==="success"?"bg-success-50 dark:bg-success-900/20 border border-success-200 dark:border-success-800 text-success-700 dark:text-success-300":"bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 text-error-700 dark:text-error-300"}`,children:[a.jsx(Nr,{size:18}),a.jsx("span",{className:"text-sm",children:b.text})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-base font-semibold text-neutral-900 dark:text-neutral-50",children:"Additional Proxy Providers"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:"Add multiple providers for rotation and redundancy. Luna proxy is always used as fallback."})]}),a.jsxs("button",{onClick:()=>{v(null),d(!0)},className:"px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth font-medium flex items-center gap-2 text-sm",children:[a.jsx(Yr,{size:18}),"Add Provider"]})]}),l?a.jsx("div",{className:"text-center py-8 text-neutral-500 dark:text-neutral-400",children:"Loading providers..."}):s.length===0?a.jsx("div",{className:"text-center py-8 text-neutral-500 dark:text-neutral-400 text-sm",children:"No additional providers configured. Luna proxy will be used as the only provider."}):a.jsx("div",{className:"space-y-4",children:s.map(C=>{const O=T(C);return a.jsx("div",{className:"border border-neutral-200 dark:border-neutral-800 rounded-lg p-4 hover:bg-neutral-50 dark:hover:bg-neutral-850 transition-smooth",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h4",{className:"font-semibold text-neutral-900 dark:text-neutral-50",children:C.name}),a.jsx("span",{className:"text-xs px-2 py-1 bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 rounded",children:C.provider_type}),a.jsxs("span",{className:`text-xs px-2 py-1 rounded ${L(O)}`,children:[O,"% success"]}),C.enabled?a.jsx("span",{className:"text-xs px-2 py-1 bg-success-100 dark:bg-success-900/30 text-success-700 dark:text-success-400 rounded",children:"Enabled"}):a.jsx("span",{className:"text-xs px-2 py-1 bg-neutral-100 dark:bg-neutral-800 text-neutral-500 dark:text-neutral-400 rounded",children:"Disabled"})]}),a.jsxs("div",{className:"mt-2 text-sm text-neutral-600 dark:text-neutral-400 space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Host:"})," ",C.host,":",C.port]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Priority:"})," ",C.priority]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Stats:"})," ",C.success_count," success,"," ",C.failure_count," failures"]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{k(C),h(!0)},className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Test connection",children:a.jsx(ul,{size:18})}),a.jsx("button",{onClick:()=>f(C),className:`p-2 rounded-lg transition-colors ${C.enabled?"text-yellow-600 hover:bg-yellow-50":"text-gray-600 hover:bg-gray-100"}`,title:C.enabled?"Disable":"Enable",children:C.enabled?a.jsx(E_,{size:18}):a.jsx(C_,{size:18})}),a.jsx("button",{onClick:()=>{v(C),d(!0)},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit",children:a.jsx(pg,{size:18})}),a.jsx("button",{onClick:()=>j(C.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:a.jsx(Ds,{size:18})})]})]})},C.id)})})]}),s.length>0&&a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Proxy Rotation Settings"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rotation Mode"}),a.jsxs("select",{value:e||"sequential",onChange:C=>r(C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[a.jsx("option",{value:"sequential",children:"Sequential (priority order)"}),a.jsx("option",{value:"random",children:"Random (pick randomly)"}),a.jsx("option",{value:"weighted",children:"Weighted (probability by priority)"}),a.jsx("option",{value:"failover",children:"Failover (primary until failure)"})]}),a.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[e==="sequential"&&"Providers are used in priority order, highest first",e==="random"&&"A random provider is selected for each request",e==="weighted"&&"Higher priority providers are more likely to be selected",e==="failover"&&"Primary provider used until failure, then next"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",id:"failoverEnabled",checked:t??!0,onChange:C=>n(C.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),a.jsx("label",{htmlFor:"failoverEnabled",className:"text-sm font-medium text-gray-700",children:"Enable automatic failover to next provider on error"})]})]})]}),c&&a.jsx(X_,{provider:p,onClose:()=>{d(!1),v(null)},onSuccess:()=>{d(!1),v(null),x(),m({type:"success",text:p?"Provider updated successfully":"Provider added successfully"})}}),u&&g&&a.jsx(Z_,{provider:g,onClose:()=>{h(!1),k(null)}})]})}function tw(){const[e,t]=y.useState([]),[r,n]=y.useState(!0),[s,i]=y.useState(""),[l,o]=y.useState("viewer"),[c,d]=y.useState(!1),[u,h]=y.useState(null);y.useEffect(()=>{p()},[]);const p=async()=>{n(!0);const{data:m,error:x}=await J.from("user_profiles").select("*").order("created_at",{ascending:!1});!x&&m&&t(m),n(!1)},v=async m=>{m.preventDefault(),d(!0),h(null);try{const{error:x}=await J.rpc("admin_create_user_invite",{user_email:s,user_role:l});if(x)throw x;h({type:"success",text:`Invitation created! The user can now sign up with email: ${s}`}),i(""),o("viewer")}catch(x){h({type:"error",text:x.message||"Failed to create invitation"})}finally{d(!1)}},g=async(m,x)=>{try{const{error:f}=await J.from("user_profiles").update({role:x,updated_at:new Date().toISOString()}).eq("id",m);if(f)throw f;h({type:"success",text:"User role updated successfully!"}),p()}catch(f){h({type:"error",text:f.message||"Failed to update role"})}},k=e.filter(m=>m.role==="admin").length,b=e.filter(m=>m.role==="viewer").length;return a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 p-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[a.jsx(Ti,{className:"text-brand-600 dark:text-brand-400",size:24}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-50",children:"User Management"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:"Manage user accounts and roles"})]})]}),u&&a.jsxs("div",{className:`mb-6 p-4 rounded-lg flex items-center gap-2 ${u.type==="success"?"bg-success-50 dark:bg-success-900/20 border border-success-200 dark:border-success-800 text-success-700 dark:text-success-300":"bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 text-error-700 dark:text-error-300"}`,children:[u.type==="success"?a.jsx(Ye,{size:18}):a.jsx(Nr,{size:18}),a.jsx("span",{className:"text-sm",children:u.text})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-brand-50 to-brand-100 dark:from-brand-900/20 dark:to-brand-800/20 rounded-lg p-4 border border-brand-200 dark:border-brand-800",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Ti,{className:"text-brand-600 dark:text-brand-400",size:20}),a.jsx("h3",{className:"text-sm font-semibold text-brand-900 dark:text-brand-300",children:"Total Admins"})]}),a.jsx("p",{className:"text-3xl font-bold text-brand-700 dark:text-brand-400",children:k})]}),a.jsxs("div",{className:"bg-gradient-to-br from-success-50 to-success-100 dark:from-success-900/20 dark:to-success-800/20 rounded-lg p-4 border border-success-200 dark:border-success-800",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Lc,{className:"text-success-600 dark:text-success-400",size:20}),a.jsx("h3",{className:"text-sm font-semibold text-success-900 dark:text-success-300",children:"Total Viewers"})]}),a.jsx("p",{className:"text-3xl font-bold text-success-700 dark:text-success-400",children:b})]})]}),a.jsxs("form",{onSubmit:v,className:"mb-6 p-4 bg-neutral-50 dark:bg-neutral-850 rounded-lg border border-neutral-200 dark:border-neutral-800",children:[a.jsx("h3",{className:"text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-4",children:"Create New User"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Email Address"}),a.jsx("input",{type:"email",value:s,onChange:m=>i(m.target.value),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth placeholder-neutral-400 dark:placeholder-neutral-500",placeholder:"user@example.com",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Role"}),a.jsxs("select",{value:l,onChange:m=>o(m.target.value),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",children:[a.jsx("option",{value:"viewer",children:"Viewer"}),a.jsx("option",{value:"admin",children:"Admin"})]})]})]}),a.jsx("button",{type:"submit",disabled:c,className:"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed transition-smooth font-medium",children:c?a.jsxs(a.Fragment,{children:[a.jsx(cl,{size:18,className:"animate-spin"}),"Creating..."]}):a.jsxs(a.Fragment,{children:[a.jsx(P_,{size:18}),"Create User Account"]})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-4",children:"All Users"}),r?a.jsxs("div",{className:"text-center py-8 text-neutral-500 dark:text-neutral-400",children:[a.jsx(cl,{size:24,className:"animate-spin mx-auto mb-2"}),"Loading users..."]}):a.jsx("div",{className:"space-y-2",children:e.map(m=>a.jsxs("div",{className:"flex items-center justify-between p-4 bg-neutral-50 dark:bg-neutral-850 rounded-lg border border-neutral-200 dark:border-neutral-800",children:[a.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[a.jsx("div",{className:`p-2 rounded-lg ${m.role==="admin"?"bg-brand-100 dark:bg-brand-900/30 text-brand-600 dark:text-brand-400":"bg-success-100 dark:bg-success-900/30 text-success-600 dark:text-success-400"}`,children:m.role==="admin"?a.jsx(Ti,{size:20}):a.jsx(Lc,{size:20})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(hg,{size:14,className:"text-neutral-400 dark:text-neutral-500"}),a.jsx("span",{className:"font-medium text-neutral-900 dark:text-neutral-50",children:m.email})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-neutral-500 dark:text-neutral-400",children:[a.jsx(Gd,{size:12}),a.jsxs("span",{children:["Joined ",new Date(m.created_at).toLocaleDateString()]})]})]})]}),a.jsx("div",{children:a.jsxs("select",{value:m.role,onChange:x=>g(m.id,x.target.value),className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 text-sm outline-none focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 transition-smooth",children:[a.jsx("option",{value:"admin",children:"Admin"}),a.jsx("option",{value:"viewer",children:"Viewer"})]})})]},m.id))})]})]})})}function rw(){const{isAdmin:e}=xg(),[t,r]=y.useState({trackier_api_key:"",aws_proxy_url:"",luna_proxy_host:"",luna_proxy_port:"",luna_proxy_username:"",luna_proxy_password:"",ip_cooldown_seconds:60,proxy_rotation_mode:"sequential",proxy_failover_enabled:!0}),[n,s]=y.useState(!0),[i,l]=y.useState(!1),[o,c]=y.useState(!1),[d,u]=y.useState(null);y.useEffect(()=>{e?h():s(!1)},[e]);const h=async()=>{s(!0);const{data:{user:g}}=await J.auth.getUser();if(!g){s(!1);return}const{data:k,error:b}=await J.from("settings").select("*").eq("user_id",g.id).maybeSingle();!b&&k&&r({...k,trackier_api_key:k.trackier_api_key||"",luna_proxy_port:k.luna_proxy_port?String(k.luna_proxy_port):"",ip_cooldown_seconds:k.ip_cooldown_seconds??60,proxy_rotation_mode:k.proxy_rotation_mode??"sequential",proxy_failover_enabled:k.proxy_failover_enabled??!0}),s(!1)},p=async g=>{g.preventDefault(),l(!0),u(null);try{const{data:{user:k}}=await J.auth.getUser();if(!k)throw new Error("Not authenticated");const b={trackier_api_key:t.trackier_api_key||null,aws_proxy_url:t.aws_proxy_url||null,luna_proxy_host:t.luna_proxy_host,luna_proxy_port:t.luna_proxy_port?parseInt(t.luna_proxy_port):null,luna_proxy_username:t.luna_proxy_username,luna_proxy_password:t.luna_proxy_password,ip_cooldown_seconds:t.ip_cooldown_seconds,proxy_rotation_mode:t.proxy_rotation_mode,proxy_failover_enabled:t.proxy_failover_enabled};if(t.id){const{error:m}=await J.from("settings").update(b).eq("id",t.id);if(m)throw m}else{const{error:m}=await J.from("settings").insert([{user_id:k.id,...b}]);if(m)throw m}u({type:"success",text:"Proxy settings saved successfully!"}),await h()}catch(k){u({type:"error",text:k.message||"Failed to save settings"})}finally{l(!1)}},v=async()=>{c(!0),u(null);try{const{data:{session:g}}=await J.auth.getSession();if(!g)throw new Error("Not authenticated");const m=await(await fetch("https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/test-proxy",{method:"GET",headers:{Authorization:`Bearer ${g.access_token}`,"Content-Type":"application/json"}})).json();m.success?m.proxy_working?u({type:"success",text:"Proxy is working correctly!"}):u({type:"error",text:"Proxy not working - IPs are the same!"}):u({type:"error",text:m.error||"Failed to test proxy"})}catch(g){u({type:"error",text:g.message||"Failed to test proxy"})}finally{c(!1)}};return n?a.jsx("div",{className:"text-center py-12 text-neutral-500 dark:text-neutral-400",children:"Loading settings..."}):e?a.jsxs("div",{className:"space-y-5",children:[a.jsx(tw,{}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 p-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[a.jsx(Za,{className:"text-brand-600 dark:text-brand-400",size:24}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-50",children:"Luna Proxy Settings"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:"Configure Luna Proxy API or Residential Proxy for all offers"})]})]}),d&&a.jsxs("div",{className:`mb-6 p-4 rounded-lg flex items-center gap-2 ${d.type==="success"?"bg-success-50 dark:bg-success-900/20 border border-success-200 dark:border-success-800 text-success-700 dark:text-success-300":"bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 text-error-700 dark:text-error-300"}`,children:[d.type==="success"?a.jsx(Ye,{size:18}):a.jsx(Nr,{size:18}),a.jsx("span",{className:"text-sm",children:d.text})]}),a.jsxs("form",{onSubmit:p,className:"space-y-6",children:[a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 p-4 rounded-lg border border-neutral-200 dark:border-neutral-800",children:[a.jsx("h3",{className:"text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3",children:"Trackier Integration"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Trackier API Key"}),a.jsx("input",{type:"password",value:t.trackier_api_key,onChange:g=>r({...t,trackier_api_key:g.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth font-mono text-sm placeholder-neutral-400 dark:placeholder-neutral-500",placeholder:"sk_live_..."}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Stored securely per user. Used to prefill Trackier setup screens so you do not need to paste it every time."})]})]}),a.jsxs("div",{className:"bg-brand-50 dark:bg-brand-900/20 p-4 rounded-lg border border-brand-200 dark:border-brand-800/50",children:[a.jsx("h3",{className:"text-sm font-semibold text-brand-900 dark:text-brand-300 mb-3",children:"AWS Proxy Service (Recommended for Luna Residential)"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"AWS Proxy Service URL"}),a.jsx("input",{type:"text",value:t.aws_proxy_url,onChange:g=>r({...t,aws_proxy_url:g.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth font-mono text-sm placeholder-neutral-400 dark:placeholder-neutral-500",placeholder:"http://your-ec2-instance:3000"}),a.jsx("p",{className:"mt-2 text-sm text-neutral-600 dark:text-neutral-400",children:"Use your AWS EC2 proxy service that handles Luna residential proxy routing. If set, this will be used instead of direct Luna API calls."})]})]}),a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 p-4 rounded-lg border border-neutral-200 dark:border-neutral-800",children:[a.jsx("h3",{className:"text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3",children:"Luna Residential Proxy Credentials"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Proxy Host"}),a.jsx("input",{type:"text",value:t.luna_proxy_host,onChange:g=>r({...t,luna_proxy_host:g.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth font-mono text-xs placeholder-neutral-400 dark:placeholder-neutral-500",placeholder:"customer-USERNAME.proxy.lunaproxy.com"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Port"}),a.jsx("input",{type:"text",value:t.luna_proxy_port,onChange:g=>r({...t,luna_proxy_port:g.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth font-mono text-sm placeholder-neutral-400 dark:placeholder-neutral-500",placeholder:"12233"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Username"}),a.jsx("input",{type:"text",value:t.luna_proxy_username,onChange:g=>r({...t,luna_proxy_username:g.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth font-mono text-sm placeholder-neutral-400 dark:placeholder-neutral-500",placeholder:"username"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Password"}),a.jsx("input",{type:"password",value:t.luna_proxy_password,onChange:g=>r({...t,luna_proxy_password:g.target.value}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth font-mono text-sm placeholder-neutral-400 dark:placeholder-neutral-500",placeholder:"password"})]})]}),a.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Get residential proxy credentials from Luna Proxy dashboard  Residential Proxy section"}),a.jsx("div",{className:"mt-2 p-3 bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800/50 rounded-lg",children:a.jsxs("p",{className:"text-xs text-brand-800 dark:text-brand-300",children:[a.jsx("strong",{children:"Setup:"})," Use these credentials with the AWS Proxy Service above for the best performance and cost savings. These credentials are charged per GB of traffic (much cheaper than per-request pricing)."]})})]})]}),a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 p-4 rounded-lg border border-neutral-200 dark:border-neutral-800",children:[a.jsx("h3",{className:"text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3",children:"IP Pool Configuration"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"IP Cooldown Duration (seconds)"}),a.jsx("input",{type:"number",min:"10",max:"300",value:t.ip_cooldown_seconds??60,onChange:g=>r({...t,ip_cooldown_seconds:parseInt(g.target.value)||60}),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth placeholder-neutral-400 dark:placeholder-neutral-500",placeholder:"60"}),a.jsx("p",{className:"mt-2 text-sm text-neutral-600 dark:text-neutral-400",children:"Time before an IP can be reused from the pool (default: 60 seconds, range: 10-300)"})]})]}),a.jsxs("div",{className:"pt-4 flex gap-3",children:[a.jsxs("button",{type:"submit",disabled:i,className:"flex-1 px-4 py-2.5 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed transition-smooth font-medium flex items-center justify-center gap-2 text-sm",children:[a.jsx(Ca,{size:18}),i?"Saving...":"Save Settings"]}),a.jsxs("button",{type:"button",onClick:v,disabled:o||!t.luna_proxy_host,className:"px-4 py-2.5 bg-success-600 dark:bg-success-500 text-white rounded-lg hover:bg-success-700 dark:hover:bg-success-600 disabled:opacity-50 disabled:cursor-not-allowed transition-smooth font-medium flex items-center justify-center gap-2 text-sm",children:[a.jsx(ul,{size:18}),o?"Testing...":"Test Proxy"]})]})]}),a.jsx("div",{className:"mt-6",children:a.jsx(ew,{rotationMode:t.proxy_rotation_mode,failoverEnabled:t.proxy_failover_enabled,onRotationModeChange:g=>{r({...t,proxy_rotation_mode:g}),p(new Event("submit"))},onFailoverEnabledChange:g=>{r({...t,proxy_failover_enabled:g}),p(new Event("submit"))}})})]})]}):a.jsx("div",{className:"text-center py-12 text-neutral-500 dark:text-neutral-400",children:"Only admins can access settings."})}function a0(){const[e,t]=y.useState([]),[r,n]=y.useState(new Set),[s,i]=y.useState({}),[l,o]=y.useState(!0),[c,d]=y.useState(""),[u,h]=y.useState("all"),[p,v]=y.useState("all"),[g,k]=y.useState(1),[b,m]=y.useState(10);y.useEffect(()=>{x()},[]);const x=async()=>{o(!0);try{const{data:V,error:_}=await J.from("offers").select("*").order("created_at",{ascending:!1});if(_)throw _;const D=await Promise.all((V||[]).map(async q=>{const{data:N}=await J.from("offer_statistics").select("*").eq("offer_id",q.id).maybeSingle(),{data:B}=await J.from("suffix_requests").select("*").eq("offer_id",q.id).order("requested_at",{ascending:!1}).limit(10),{data:U}=await J.from("url_traces").select("*").eq("offer_id",q.id).order("visited_at",{ascending:!1}).limit(100);return{offer:q,stats:N||null,recentRequests:B||[],urlTraces:U||[]}}));t(D)}catch(V){console.error("Error fetching data:",V)}finally{o(!1)}},f=V=>{const _=new Set(r);_.has(V)?_.delete(V):_.add(V),n(_)},j=V=>V.toLocaleString(),T=V=>new Date(V).toLocaleString(),L=V=>{if(!V)return"bg-gray-400";const _=new Date,D=new Date(V),N=(_.getTime()-D.getTime())/(1e3*60*60);return N<1?"bg-green-500":N<24?"bg-yellow-500":"bg-gray-400"},C=V=>{if(!V)return"Never";const _=new Date,D=new Date(V),q=_.getTime()-D.getTime(),N=Math.floor(q/(1e3*60)),B=Math.floor(q/(1e3*60*60)),U=Math.floor(q/(1e3*60*60*24));return N<1?"Just now":N<60?`${N}m ago`:B<24?`${B}h ago`:`${U}d ago`},O=e.filter(({offer:V,stats:_})=>{const D=c.toLowerCase(),q=V.offer_name.toLowerCase().includes(D)||(V.campaign_name||"").toLowerCase().includes(D),N=u==="all"||u==="active"&&V.is_active||u==="inactive"&&!V.is_active;let B=!0;if(p!=="all"&&(_!=null&&_.last_request_at)){const U=new Date,F=new Date(_.last_request_at),H=(U.getTime()-F.getTime())/(1e3*60*60);p==="active-1h"?B=H<1:p==="active-24h"?B=H<24:p==="idle"&&(B=H>=24)}else p==="idle"?B=!(_!=null&&_.last_request_at):p!=="all"&&(B=!1);return q&&N&&B}),Q=[{value:"all",label:"All Status"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],W=[{value:"all",label:"All Activity"},{value:"active-1h",label:"Active (Last Hour)"},{value:"active-24h",label:"Active (Last 24h)"},{value:"idle",label:"Idle (24h+)"}],pe=O.reduce((V,_)=>{var D;return V+(((D=_.stats)==null?void 0:D.total_suffix_requests)||0)},0),A=O.reduce((V,_)=>{var D;return V+(((D=_.stats)==null?void 0:D.total_tracking_hits)||0)},0),ne=Math.ceil(O.length/b),te=(g-1)*b,me=te+b,K=O.slice(te,me);return y.useEffect(()=>{k(1)},[c,u,p]),l?a.jsx("div",{className:"space-y-5",children:a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 p-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(wa,{className:"text-brand-600 dark:text-brand-400",size:24}),a.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-50",children:"Analytics Dashboard"})]}),a.jsx("div",{className:"text-center py-8 text-neutral-500 dark:text-neutral-400",children:"Loading analytics..."})]})}):a.jsx("div",{className:"space-y-5",children:a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(wa,{className:"text-brand-600 dark:text-brand-400",size:24}),a.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-50",children:"Analytics Dashboard"})]}),a.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-3 py-2 text-sm text-brand-600 dark:text-brand-400 hover:bg-brand-50 dark:hover:bg-brand-900/20 rounded-lg transition-smooth font-medium",children:[a.jsx(yt,{size:16}),"Refresh"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-brand-50 to-brand-100 dark:from-brand-900/20 dark:to-brand-800/20 rounded-lg p-4 border border-brand-200 dark:border-brand-800/50",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Hd,{className:"text-brand-600 dark:text-brand-400",size:20}),a.jsx("h3",{className:"text-sm font-semibold text-brand-900 dark:text-brand-100",children:"Total Offers"})]}),a.jsx("p",{className:"text-3xl font-bold text-brand-700 dark:text-brand-300",children:j(O.length)})]}),a.jsxs("div",{className:"bg-gradient-to-br from-success-50 to-success-100 dark:from-success-900/20 dark:to-success-800/20 rounded-lg p-4 border border-success-200 dark:border-success-800/50",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(sa,{className:"text-success-600 dark:text-success-400",size:20}),a.jsx("h3",{className:"text-sm font-semibold text-success-900 dark:text-success-100",children:"Total Suffix Requests"})]}),a.jsx("p",{className:"text-3xl font-bold text-success-700 dark:text-success-300",children:j(pe)})]}),a.jsxs("div",{className:"bg-gradient-to-br from-warning-50 to-warning-100 dark:from-warning-900/20 dark:to-warning-800/20 rounded-lg p-4 border border-warning-200 dark:border-warning-800/50",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(wa,{className:"text-warning-600 dark:text-warning-400",size:20}),a.jsx("h3",{className:"text-sm font-semibold text-warning-900 dark:text-warning-100",children:"Total Tracking Hits"})]}),a.jsx("p",{className:"text-3xl font-bold text-warning-700 dark:text-warning-300",children:j(A)})]})]}),e.length>0&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[a.jsx(_g,{value:c,onChange:d,placeholder:"Search offers by name...",className:"flex-1"}),a.jsx(Oc,{label:"Status",options:Q,value:u,onChange:h}),a.jsx(Oc,{label:"Activity",options:W,value:p,onChange:v})]}),a.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["Showing ",a.jsx("span",{className:"font-medium text-neutral-900 dark:text-neutral-50",children:O.length})," of"," ",a.jsx("span",{className:"font-medium text-neutral-900 dark:text-neutral-50",children:e.length})," offers"]})]}),e.length===0?a.jsx("div",{className:"text-center py-12 bg-neutral-50 dark:bg-neutral-925 rounded-lg border-2 border-dashed border-neutral-300 dark:border-neutral-800",children:a.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm",children:"No offers yet. Create your first offer to start tracking analytics."})}):O.length===0?a.jsxs("div",{className:"text-center py-12 bg-neutral-50 dark:bg-neutral-925 rounded-lg border-2 border-dashed border-neutral-300 dark:border-neutral-800",children:[a.jsx(wa,{className:"mx-auto text-neutral-400 dark:text-neutral-600 mb-4",size:48}),a.jsx("h3",{className:"text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-2",children:"No offers found"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-5",children:"No offers match your current filters. Try adjusting your search or filters."}),a.jsx("button",{onClick:()=>{d(""),h("all"),v("all")},className:"inline-flex items-center gap-2 px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth font-medium text-sm",children:"Clear Filters"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-base font-semibold text-neutral-900 dark:text-neutral-50 mb-4",children:"Offers Overview"}),K.map(({offer:V,stats:_,recentRequests:D,urlTraces:q})=>{const N=r.has(V.id),B=s[V.id]||"suffix";return a.jsxs("div",{className:"border border-neutral-200 dark:border-neutral-800 rounded-lg overflow-hidden hover:shadow-sm dark:hover:shadow-none transition-smooth shadow-xs dark:shadow-none",children:[a.jsx("button",{onClick:()=>f(V.id),className:"w-full bg-white dark:bg-neutral-900 hover:bg-neutral-50 dark:hover:bg-neutral-850 transition-smooth",children:a.jsxs("div",{className:"p-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[a.jsx("div",{className:`w-3 h-3 rounded-full ${L((_==null?void 0:_.last_request_at)||null)}`}),a.jsxs("div",{className:"text-left flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[a.jsx("h4",{className:"text-base font-semibold text-neutral-900 dark:text-neutral-50",children:V.offer_name}),V.is_active?a.jsx("span",{className:"px-2 py-0.5 bg-success-100 dark:bg-success-900/30 text-success-700 dark:text-success-400 text-xs font-medium rounded",children:"Active"}):a.jsx("span",{className:"px-2 py-0.5 bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400 text-xs font-medium rounded",children:"Inactive"})]}),V.campaign_name&&a.jsx("div",{className:"mb-2",children:a.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 border border-purple-200 dark:border-purple-800/50",children:[" ",V.campaign_name]})}),a.jsxs("div",{className:"flex items-center gap-6 mt-2 text-sm text-neutral-600 dark:text-neutral-400",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(sa,{size:14}),a.jsx("span",{className:"font-medium text-neutral-900 dark:text-neutral-200",children:j((_==null?void 0:_.total_suffix_requests)||0)}),a.jsx("span",{className:"text-neutral-500 dark:text-neutral-500",children:"suffix requests"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(wa,{size:14}),a.jsx("span",{className:"font-medium text-neutral-900 dark:text-neutral-200",children:j((_==null?void 0:_.total_tracking_hits)||0)}),a.jsx("span",{className:"text-neutral-500 dark:text-neutral-500",children:"tracking hits"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Ll,{size:14}),a.jsxs("span",{className:"text-neutral-500 dark:text-neutral-500",children:["Last: ",C((_==null?void 0:_.last_request_at)||null)]})]})]})]})]}),a.jsx("div",{className:"text-neutral-400 dark:text-neutral-500",children:N?a.jsx(ol,{size:20}):a.jsx(Cn,{size:20})})]})}),N&&a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-925 border-t border-neutral-200 dark:border-neutral-800 p-4 animate-slide-down",children:[a.jsxs("div",{className:"flex gap-2 mb-4 border-b border-neutral-300 dark:border-neutral-700",children:[a.jsxs("button",{onClick:()=>i({...s,[V.id]:"suffix"}),className:`px-4 py-2 text-sm font-medium transition-smooth ${B==="suffix"?"border-b-2 border-brand-600 dark:border-brand-400 text-brand-600 dark:text-brand-400":"text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:["Suffix Requests (",D.length,")"]}),a.jsxs("button",{onClick:()=>i({...s,[V.id]:"traces"}),className:`px-4 py-2 text-sm font-medium transition-smooth ${B==="traces"?"border-b-2 border-brand-600 dark:border-brand-400 text-brand-600 dark:text-brand-400":"text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:["URL Traces (",q.length,")"]})]}),B==="suffix"&&a.jsxs(a.Fragment,{children:[a.jsx("h5",{className:"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3",children:"Last 10 Suffix Requests"}),D.length===0?a.jsx("div",{className:"text-center py-6 text-neutral-500 dark:text-neutral-400 text-sm",children:"No suffix requests yet for this offer"}):a.jsx("div",{className:"space-y-3",children:D.map(U=>a.jsxs("div",{className:"bg-white dark:bg-neutral-850 rounded-lg p-3 border border-neutral-200 dark:border-neutral-800",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-500 dark:text-neutral-400",children:[a.jsx(Gd,{size:12}),T(U.requested_at)]}),a.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Za,{size:12,className:U.proxy_ip?"text-brand-500 dark:text-brand-400":"text-neutral-400 dark:text-neutral-500"}),a.jsx("span",{className:U.proxy_ip?"text-brand-700 dark:text-brand-300 font-semibold":"text-neutral-500 dark:text-neutral-400",children:U.proxy_ip||U.ip_address||"N/A"})]}),U.bandwidth_bytes&&a.jsxs("span",{className:"text-neutral-600 dark:text-neutral-400 font-medium",children:[" ",U.bandwidth_bytes.toLocaleString()," B"]})]})]}),U.params&&Object.keys(U.params).length>0?a.jsxs("div",{children:[a.jsx("span",{className:"text-xs font-semibold text-neutral-600 dark:text-neutral-400 mb-1 block",children:"Parameters:"}),a.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-900 rounded p-2 space-y-1 border border-neutral-200 dark:border-neutral-800",children:Object.entries(U.params).map(([F,H])=>a.jsxs("div",{className:"flex gap-2 text-xs",children:[a.jsxs("span",{className:"font-semibold text-neutral-700 dark:text-neutral-300 font-mono",children:[F,":"]}),a.jsx("span",{className:"text-neutral-900 dark:text-neutral-100 font-mono break-all",children:String(H)})]},F))})]}):a.jsxs("div",{children:[a.jsx("span",{className:"text-xs font-semibold text-neutral-600 dark:text-neutral-400 mb-1 block",children:"Suffix:"}),a.jsx("code",{className:"px-2 py-1 bg-neutral-50 dark:bg-neutral-900 text-neutral-800 dark:text-neutral-200 rounded text-xs font-mono border border-neutral-200 dark:border-neutral-800",children:U.suffix_returned||"(empty)"})]})]},U.id))})]}),B==="traces"&&a.jsxs(a.Fragment,{children:[a.jsx("h5",{className:"text-sm font-semibold text-neutral-700 dark:text-neutral-300 mb-3",children:"URL Tracking Hits (Last 100)"}),q.length===0?a.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400 text-center py-4",children:"No tracking hits recorded yet"}):a.jsx("div",{className:"space-y-3",children:q.map(U=>{const F=be=>{switch(be.toLowerCase()){case"mobile":return a.jsx(A_,{size:16});case"tablet":return a.jsx(I_,{size:16});case"bot":return a.jsx(b_,{size:16});default:return a.jsx(Xh,{size:16})}},H=be=>{switch(be.toLowerCase()){case"mobile":return"bg-brand-100 dark:bg-brand-900/30 text-brand-700 dark:text-brand-300";case"tablet":return"bg-warning-100 dark:bg-warning-900/30 text-warning-700 dark:text-warning-300";case"bot":return"bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300";default:return"bg-success-100 dark:bg-success-900/30 text-success-700 dark:text-success-300"}};return a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 rounded-lg p-4 border border-neutral-200 dark:border-neutral-800",children:[a.jsx("div",{className:"flex items-start justify-between mb-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium flex items-center gap-1 ${H(U.device_type)}`,children:[F(U.device_type),U.device_type]}),a.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:new Date(U.visited_at).toLocaleString()})]})}),a.jsxs("div",{className:"space-y-2 text-sm",children:[U.proxy_ip&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Za,{size:14,className:"text-brand-500 dark:text-brand-400"}),a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400 font-semibold",children:"Proxy IP:"}),a.jsx("span",{className:"font-mono text-brand-700 dark:text-brand-300",children:U.proxy_ip})]}),U.user_agent&&a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(Xh,{size:14,className:"text-neutral-400 dark:text-neutral-500 mt-0.5"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400 text-xs font-semibold",children:"User Agent:"}),a.jsx("p",{className:"font-mono text-xs text-neutral-900 dark:text-neutral-100 break-all mt-1",children:U.user_agent})]})]}),(U.geo_country||U.geo_city||U.geo_region)&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Za,{size:14,className:"text-success-500 dark:text-success-400"}),a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400 font-semibold",children:"Proxy Location:"}),a.jsx("span",{className:"text-neutral-900 dark:text-neutral-100",children:[U.geo_city,U.geo_region,U.geo_country].filter(Boolean).join(", ")})]}),!U.proxy_ip&&U.visitor_ip&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Za,{size:14,className:"text-neutral-400 dark:text-neutral-500"}),a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"Visitor IP:"}),a.jsx("span",{className:"font-mono text-neutral-900 dark:text-neutral-100",children:U.visitor_ip})]}),!U.geo_country&&U.country&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Za,{size:14,className:"text-neutral-400 dark:text-neutral-500"}),a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"Location:"}),a.jsxs("span",{className:"text-neutral-900 dark:text-neutral-100",children:[U.city?`${U.city}, `:"",U.country]})]}),U.referrer&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(sa,{size:14,className:"text-neutral-400 dark:text-neutral-500"}),a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"Referrer:"}),a.jsx("span",{className:"font-mono text-neutral-900 dark:text-neutral-100 truncate",children:U.referrer})]}),U.query_params&&Object.keys(U.query_params).length>0&&a.jsxs("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400 text-xs font-semibold mb-1 block",children:"Query Parameters:"}),a.jsx("div",{className:"bg-white dark:bg-neutral-900 rounded p-2 space-y-1 border border-neutral-200 dark:border-neutral-800",children:Object.entries(U.query_params).map(([be,je])=>a.jsxs("div",{className:"flex gap-2 text-xs font-mono",children:[a.jsxs("span",{className:"font-semibold text-neutral-700 dark:text-neutral-300",children:[be,":"]}),a.jsx("span",{className:"text-neutral-900 dark:text-neutral-100 break-all",children:String(je)})]},be))})]})]})]},U.id)})})]})]})]},V.id)})]}),O.length>0&&a.jsx(wg,{currentPage:g,totalPages:ne,onPageChange:k,itemsPerPage:b,onItemsPerPageChange:m,totalItems:O.length})]})]})})}function aw(){var De,nt;const[e,t]=y.useState(null),r="https://rfhuqenntxiqurplenjn.supabase.co",[n,s]=y.useState("https://amzn.to/3BxQqXv"),[i,l]=y.useState("http_only"),[o,c]=y.useState(!1),[d,u]=y.useState(null),[h,p]=y.useState("OFFER_NAME"),[v,g]=y.useState(""),[k,b]=y.useState(1800),[m,x]=y.useState(!1),[f,j]=y.useState(!1),[T,L]=y.useState(""),[C,O]=y.useState(!1),[Q,W]=y.useState(""),[pe,A]=y.useState(!1),[ne,te]=y.useState([]),[me,K]=y.useState(""),V=(M,oe)=>{navigator.clipboard.writeText(M),t(oe),setTimeout(()=>t(null),2e3)},_=async()=>{try{if(O(!0),W(""),!h||!v){W("Offer name and account id are required");return}const M=await fetch(`${r}/functions/v1/schedule-script-execution?action=get_config`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({offer_name:h,account_id:v})}),oe=await M.json();M.ok&&(oe!=null&&oe.config)?(x(!!oe.config.is_paused),j(!!oe.config.auto_schedule),b(oe.config.min_interval_seconds??1800),L(oe.config.next_earliest_run_at||""),W("Loaded current config")):W((oe==null?void 0:oe.error)||"Failed to load config")}catch(M){W((M==null?void 0:M.message)||"Error loading config")}finally{O(!1)}},D=async()=>{try{if(O(!0),W(""),!h||!v){W("Offer name and account id are required");return}const M={offer_name:h,account_id:v,is_paused:m,auto_schedule:f,min_interval_seconds:Number(k)},oe=await fetch(`${r}/functions/v1/schedule-script-execution?action=update_config`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)}),Ge=await oe.json();oe.ok?W("Saved configuration"):W((Ge==null?void 0:Ge.error)||"Failed to save")}catch(M){W((M==null?void 0:M.message)||"Error saving config")}finally{O(!1)}},q=async()=>{try{if(A(!0),K(""),te([]),!h||!v){K("Offer name and account id are required");return}const M=await fetch(`${r}/functions/v1/schedule-script-execution?action=list_executions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({offer_name:h,account_id:v})}),oe=await M.json();M.ok&&(oe!=null&&oe.executions)?(te(oe.executions),K(`Loaded ${oe.executions.length} runs`)):K((oe==null?void 0:oe.error)||"Failed to load runs")}catch(M){K((M==null?void 0:M.message)||"Error loading runs")}finally{A(!1)}},N=async()=>{c(!0),u(null);try{const{data:{user:M}}=await J.auth.getUser(),{data:{session:oe}}=await J.auth.getSession();if(!M||!oe){alert("Please log in to test the tracer");return}let Ge=6e4;i==="anti_cloaking"?Ge=9e4:i==="interactive"?Ge=12e4:i==="brightdata_browser"&&(Ge=9e4);const ot={url:n,max_redirects:20,timeout_ms:Ge,user_agent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",tracer_mode:i};i==="brightdata_browser"&&(ot.user_id=M.id);const Yt=await(await fetch(`${r}/functions/v1/trace-redirects`,{method:"POST",headers:{Authorization:`Bearer ${oe.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(ot)})).json();u(Yt)}catch(M){u({success:!1,error:M.message})}finally{c(!1)}},B=`// ============================================
// RATE CONTROL CONFIGURATION
// ============================================
// Adjust DELAY_MS to control API call speed:
// - 0 = No delay (fastest, use for testing)
// - 1000 = 1 second delay (60 calls/minute)
// - 2000 = 2 second delay (30 calls/minute)
// - 5000 = 5 second delay (12 calls/minute)
var DELAY_MS = 1000;

// Replace 'OFFER_NAME' with your actual offer name
var OFFER_NAME = 'OFFER_NAME';

// ============================================
// MAIN FUNCTION
// ============================================
function getTrackingUrl() {
  // Add delay to control API call rate
  if (DELAY_MS > 0) {
    Utilities.sleep(DELAY_MS);
  }

  var url = '${r}/functions/v1/get-suffix?offer_name=' + encodeURIComponent(OFFER_NAME);

  var options = {
    'method': 'get',
    'muteHttpExceptions': true
  };

  try {
    var response = UrlFetchApp.fetch(url, options);
    var json = JSON.parse(response.getContentText());

    if (json.success && json.suffix) {
      return json.final_url + '?' + json.suffix;
    }
  } catch (e) {
    Logger.log('Error fetching URL: ' + e.toString());
  }

  return '';
}

function main() {
  var trackingUrl = getTrackingUrl();
  Logger.log('Tracking URL: ' + trackingUrl);

  // Use this URL in your ad customizers
  return trackingUrl;
}`,U=`// ============================================
// ADAPTIVE INTERVAL CONFIGURATION (V2)
// ============================================
// Dynamic delay based on yesterday's landing page frequency
// Automatically fetched from API endpoint
// V2: Script collects and sends its own landing page data
var CURRENT_INTERVAL_MS = 5000; // Default fallback (will be overridden by API)
var ACCOUNT_ID = ''; // Will be set at startup

// Configuration for interval calculation
var SUPABASE_URL = '${r}';
var OFFER_NAME = 'OFFER_NAME';
var DEFAULT_INTERVAL_MS = 5000;
var MIN_INTERVAL_MS = 1000;     // Minimum speed (never go below)
var MAX_INTERVAL_MS = 30000;    // Maximum speed (never go above)

// ============================================
// RATIO CONFIGURATION (V2+ DYNAMIC SLOWDOWN)
// ============================================
var TARGET_REPEAT_RATIO = 5;    // Target repeats per landing page (speedup)
var MIN_REPEAT_RATIO = 1.0;     // Minimum repeats per landing page (slowdown trigger)

// ============================================
// CALL BUDGET CONFIGURATION
// ============================================
// Max daily API calls = yesterday's clicks  this multiplier
// Example: 100 clicks  10 = 1000 max calls per day
// Database override (per account+offer) takes highest priority
var CALL_BUDGET_MULTIPLIER = 10;

// ============================================
// ACCOUNT ID HELPER
// ============================================
function getAccountId() {
  try {
    return AdsApp.currentAccount().getCustomerId();
  } catch (error) {
    Logger.log(' [ACCOUNT] Failed to get account ID: ' + error);
    return 'unknown';
  }
}

// ============================================
// GET YESTERDAY'S LANDING PAGES WITH CLICKS (NO REPORTS)
// ============================================
// Collects yesterday's landing page data using FINAL_URL_REPORT (working approach)
// Returns {url: clicks} for API calculation
function getYesterdayLandingPages() {
  try {
    Logger.log('[GOOGLE ADS] Collecting yesterday landing pages via FINAL_URL_REPORT...');
    
    var query = 'SELECT EffectiveFinalUrl, Clicks ' +
                'FROM FINAL_URL_REPORT ' +
                'DURING YESTERDAY';
    
    var report = AdsApp.report(query);
    var rows = report.rows();
    
    var landingPages = {};
    var totalClicks = 0;
    var processedRows = 0;
    
    while (rows.hasNext()) {
      var row = rows.next();
      var url = row['EffectiveFinalUrl'] || '';
      var clicks = parseInt(row['Clicks'], 10) || 0;
      
      if (url && clicks > 0) {
        landingPages[url] = (landingPages[url] || 0) + clicks;
        totalClicks += clicks;
        processedRows++;
      }
    }
    
    var uniquePages = Object.keys(landingPages).length;
    Logger.log('[REPORT] Yesterday results:');
    Logger.log('  Rows processed: ' + processedRows);
    Logger.log('  Unique landing pages: ' + uniquePages);
    Logger.log('  Total clicks: ' + totalClicks);
    
    // Log each landing page and its click count
    for (var url in landingPages) {
      Logger.log('  [LP] URL: ' + url + ' -> ' + landingPages[url] + ' clicks');
    }

    if (uniquePages > 0 && totalClicks > 0) {
      Logger.log('  Sending landing_page_counts to API');
      return landingPages;
    }
    return null;
  } catch (error) {
    Logger.log(' [REPORT] Failed to collect yesterday data: ' + error);
    return null;
  }
}

// ============================================
// FETCH RECOMMENDED INTERVAL (STARTUP)
// ============================================
function fetchRecommendedInterval() {
  Logger.log('[ADAPTIVE] Fetching recommended interval for offer: ' + OFFER_NAME);
  Logger.log('[ADAPTIVE] Account ID: ' + ACCOUNT_ID);
  
  try {
    // Get yesterday's landing page data (for click count)
    var yesterdayData = getYesterdayLandingPages();
    
    // Get account timezone for proper yesterday calculation
    var accountTimezone = '';
    try {
      accountTimezone = AdsApp.currentAccount().getTimeZone();
      Logger.log('[ADAPTIVE] Account Timezone: ' + accountTimezone);
    } catch (e) {
      Logger.log(' [ADAPTIVE] Could not get timezone, API will use UTC');
    }
    
    var url = SUPABASE_URL + '/functions/v1/get-recommended-interval?offer_name=' + encodeURIComponent(OFFER_NAME);
    url += '&account_id=' + encodeURIComponent(ACCOUNT_ID);
    
    var options = { 
      muteHttpExceptions: true,
      method: 'post',
      contentType: 'application/json'
    };
    
    // If we have yesterday's data, send click count and timezone
    if (yesterdayData && Object.keys(yesterdayData).length > 0) {
      var totalClicks = 0;
      for (var url_key in yesterdayData) {
        totalClicks += yesterdayData[url_key];
      }
      var uniqueLandingPages = Object.keys(yesterdayData).length;
      
      Logger.log('[ADAPTIVE] Sending: ' + totalClicks + ' clicks, ' + uniqueLandingPages + ' unique landing pages + timezone to API');
      options.payload = JSON.stringify({
        yesterday_total_clicks: totalClicks,
        yesterday_unique_landing_pages: uniqueLandingPages,
        account_timezone: accountTimezone
      });
    } else {
      Logger.log('[ADAPTIVE] No yesterday data available, using database fallback');
      options.payload = JSON.stringify({
        yesterday_total_clicks: 0,
        yesterday_unique_landing_pages: 0,
        account_timezone: accountTimezone
      });
    }
    
    var response = UrlFetchApp.fetch(url, options);
    var responseCode = response.getResponseCode();
    var responseText = response.getContentText();
    
    Logger.log('[DEBUG] API Response Code: ' + responseCode);
    Logger.log('[DEBUG] API Response: ' + responseText.substring(0, 500));
    
    if (responseCode === 200) {
      var data = JSON.parse(responseText);
      Logger.log('[DEBUG] Parsed data - interval: ' + data.recommended_interval_ms);
      if (data.recommended_interval_ms) {
        CURRENT_INTERVAL_MS = data.recommended_interval_ms;
        Logger.log(' [ADAPTIVE] Using interval: ' + CURRENT_INTERVAL_MS + 'ms');
        Logger.log('   Data source: ' + (data.data_source || 'database'));
        Logger.log('   Yesterday interval: ' + (data.yesterday_interval_ms || 'none') + 'ms');
        Logger.log('   Yesterday clicks: ' + data.yesterday_clicks);
        Logger.log('   Yesterday landing pages: ' + data.yesterday_landing_pages);
        Logger.log('   Average repeats per page: ' + data.average_repeats);
        Logger.log('   Used fallback: ' + data.used_default_fallback);
        return true;
      } else {
        Logger.log(' [ADAPTIVE] API returned 200 but no recommended_interval_ms in response');
        Logger.log('[DEBUG] Full response: ' + responseText);
      }
    } else {
      Logger.log(' [ADAPTIVE] Failed to fetch interval (status ' + responseCode + '), using default');
      Logger.log('[DEBUG] Response: ' + responseText);
    }
  } catch (error) {
    Logger.log(' [ADAPTIVE] Error fetching interval: ' + error + ', using default');
  }
  
  CURRENT_INTERVAL_MS = DEFAULT_INTERVAL_MS;
  return false;
}

// ============================================
// CONTINUOUS CAMPAIGN UPDATE CONFIGURATION
// ============================================

// Maximum script runtime before timeout (in milliseconds)
// Google Ads limit is 30 minutes (1800000ms)
// Examples:
// - 1500000 = 25 minutes (recommended - safe buffer)
// - 1680000 = 28 minutes (aggressive - tight buffer)
// - 300000 = 5 minutes (for testing)
var MAX_RUNTIME_MS = 1500000;

// NOTE: Delay between individual campaign updates is now fetched dynamically
// from the endpoint via getCurrentIntervalFromAPI() - no hardcoded delay

// Update mode: "always" or "on_change"
// - "always": Update campaigns every cycle regardless of suffix changes
// - "on_change": Only update campaigns when suffix changes
var UPDATE_MODE = 'on_change';

// ============================================
// CAMPAIGN FILTERING OPTIONS (Choose ONE)
// ============================================

// Option 1: Filter by Campaign IDs (recommended - most precise)
// Array of campaign IDs to update. Leave empty [] to disable.
// Example: ['12345678', '87654321', '11223344']
// To find campaign IDs: Go to Campaigns tab, click on campaign, check URL for campaignId=XXXXXXXXXX
var CAMPAIGN_IDS = [];

// Option 2: Filter by Label (fallback if no IDs specified)
// Empty string = all enabled campaigns
// Example: 'auto-update' or 'offer-campaigns'
var CAMPAIGN_LABEL_FILTER = '';

// Dry run mode: Set to true to test without actually updating campaigns
var DRY_RUN_MODE = false;

// ============================================
// STATE TRACKING
// ============================================
var executionState = {
  startTime: new Date().getTime(),
  lastApiCall: 0,
  lastSuffix: '',
  totalApiCalls: 0,
  totalCampaignsUpdated: 0,
  cycleNumber: 0,
  errors: []
};

// Yesterday's data - calculated ONCE at startup, reused for all API calls
var YESTERDAY_DATA_CACHE = null;
var YESTERDAY_TOTAL_CLICKS = 0;
var YESTERDAY_UNIQUE_PAGES = 0;

// ============================================
// DYNAMIC INTERVAL FETCHING
// ============================================
function getCurrentIntervalFromAPI() {
  try {
    // Use cached yesterday data (already calculated at startup)
    var totalClicks = YESTERDAY_TOTAL_CLICKS;
    var uniqueLandingPages = YESTERDAY_UNIQUE_PAGES;
    
    Logger.log('[INTERVAL] Using cached yesterday data: ' + totalClicks + ' clicks, ' + uniqueLandingPages + ' pages (no recalculation)');
    
    if (uniqueLandingPages === 0) {
      Logger.log('[INTERVAL] No landing page data; delegating default to API with constraints. Default=' + DEFAULT_INTERVAL_MS + 'ms');
    }
    
    var accountTimezone = AdsApp.currentAccount().getTimeZone();
    
    // Build URL with offer_name and account_id as query parameters (required by endpoint)
    var url = SUPABASE_URL + '/functions/v1/get-recommended-interval?offer_name=' + encodeURIComponent(OFFER_NAME);
    url += '&account_id=' + encodeURIComponent(ACCOUNT_ID);
    
    // Pass script-level constraints to API (including day-0 default)
    var payload = {
      yesterday_total_clicks: totalClicks,
      yesterday_unique_landing_pages: uniqueLandingPages,
      account_timezone: accountTimezone,
      min_interval_ms: MIN_INTERVAL_MS,
      max_interval_ms: MAX_INTERVAL_MS,
      target_repeat_ratio: TARGET_REPEAT_RATIO,
      min_repeat_ratio: MIN_REPEAT_RATIO,
      call_budget_multiplier: CALL_BUDGET_MULTIPLIER,
      default_interval_ms: DEFAULT_INTERVAL_MS
    };
    
    var options = {
      method: 'post',
      contentType: 'application/json',
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    };
    
    var response = UrlFetchApp.fetch(url, options);
    var responseCode = response.getResponseCode();
    var responseText = response.getContentText();
    
    if (responseCode === 200) {
      var result = JSON.parse(responseText);
      if (result.recommended_interval_ms) {
        var cacheInfo = result.data_source === 'cache' ? ' (from API daily cache)' : ' (newly calculated)';
        Logger.log('[INTERVAL] Fetched: ' + result.recommended_interval_ms + 'ms' + cacheInfo);
        return result.recommended_interval_ms;
      }
    }
    
    Logger.log('[INTERVAL] API call failed, using default: ' + DEFAULT_INTERVAL_MS + 'ms');
    return DEFAULT_INTERVAL_MS;
  } catch (error) {
    Logger.log('[INTERVAL] Error fetching: ' + error + ', using default: ' + DEFAULT_INTERVAL_MS + 'ms');
    return DEFAULT_INTERVAL_MS;
  }
}

// ============================================
// API CALL FUNCTION
// ============================================
function callGetSuffixAPI(campaignCount, intervalToUse) {
  executionState.totalApiCalls++;
  
  campaignCount = campaignCount || 1;
  intervalToUse = intervalToUse || DEFAULT_INTERVAL_MS;
  
  var url = SUPABASE_URL + '/functions/v1/get-suffix?offer_name=' + encodeURIComponent(OFFER_NAME);
  
  // Add account_id parameter for multi-account support
  url += '&account_id=' + encodeURIComponent(ACCOUNT_ID);
  
  // Add campaign_count parameter for batch requests
  if (campaignCount > 1) {
    url += '&campaign_count=' + campaignCount;
    Logger.log('[API] Requesting ' + campaignCount + ' unique suffixes');
  }
  
  // Pass the interval to track actual speed used
  if (intervalToUse > 0) {
    url += '&interval_used=' + intervalToUse;
  }

  var options = {
    'method': 'get',
    'muteHttpExceptions': true
  };

  var maxRetries = 3;
  var retryCount = 0;

  while (retryCount < maxRetries) {
    try {
      var callStart = new Date().getTime();
      var response = UrlFetchApp.fetch(url, options);
      var callEnd = new Date().getTime();
      var json = JSON.parse(response.getContentText());

      if (json.success) {
        Logger.log('[API SUCCESS] Response time: ' + (callEnd - callStart) + 'ms');
        
        return {
          success: true,
          suffix: json.suffix || '',
          suffixes: json.suffixes || [],
          finalUrl: json.final_url,
          changed: json.suffix !== executionState.lastSuffix,
          timestamp: new Date()
        };
      } else {
        Logger.log('[API ERROR] Invalid response: ' + JSON.stringify(json));
      }
    } catch (e) {
      retryCount++;
      Logger.log('[API ERROR] Attempt ' + retryCount + '/' + maxRetries + ': ' + e.toString());

      if (retryCount < maxRetries) {
        Utilities.sleep(2000 * retryCount);
      } else {
        executionState.errors.push({
          type: 'api_error',
          message: e.toString(),
          timestamp: new Date()
        });
      }
    }
  }

  return {
    success: false,
    error: 'Failed after ' + maxRetries + ' attempts'
  };
}

// ============================================
// CAMPAIGN UPDATE FUNCTION
// ============================================
function updateCampaigns(currentInterval) {
  var campaignSelector;

  // Priority 1: Filter by Campaign IDs if provided
  if (CAMPAIGN_IDS && CAMPAIGN_IDS.length > 0) {
    Logger.log('[FILTER] Using Campaign IDs: ' + CAMPAIGN_IDS.join(', '));
    
    // Build ID filter condition
    var idConditions = [];
    for (var i = 0; i < CAMPAIGN_IDS.length; i++) {
      idConditions.push('Id = ' + CAMPAIGN_IDS[i]);
    }
    var idFilter = '(' + idConditions.join(' OR ') + ')';
    
    campaignSelector = AdsApp.campaigns()
      .withCondition('Status = ENABLED')
      .withCondition(idFilter);
  }
  // Priority 2: Filter by Label if no IDs specified
  else if (CAMPAIGN_LABEL_FILTER && CAMPAIGN_LABEL_FILTER !== '') {
    Logger.log('[FILTER] Using Label: ' + CAMPAIGN_LABEL_FILTER);
    campaignSelector = AdsApp.campaigns()
      .withCondition('Status = ENABLED')
      .withCondition('LabelNames CONTAINS_ANY ["' + CAMPAIGN_LABEL_FILTER + '"]');
  }
  // Priority 3: All enabled campaigns
  else {
    Logger.log('[FILTER] Using all enabled campaigns');
    campaignSelector = AdsApp.campaigns()
      .withCondition('Status = ENABLED');
  }

  // First, count campaigns
  var campaigns = campaignSelector.get();
  var campaignList = [];
  while (campaigns.hasNext()) {
    campaignList.push(campaigns.next());
  }
  
  var campaignCount = campaignList.length;
  Logger.log('[INFO] Found ' + campaignCount + ' campaigns to update');
  
  if (campaignCount === 0) {
    return {
      updated: 0,
      failed: 0,
      skipped: 0,
      apiCalls: 0
    };
  }

  var updatedCount = 0;
  var failedCount = 0;
  var skippedCount = 0;

  // Use the interval passed from main loop (already fetched once per cycle)
  Logger.log('[INTERVAL] Using pre-fetched interval: ' + currentInterval + 'ms');

  if (DRY_RUN_MODE) {
    Logger.log('[DRY RUN] Would call API once for ' + campaignCount + ' campaigns');
    for (var i = 0; i < campaignList.length; i++) {
      Logger.log('[DRY RUN] Would update: ' + campaignList[i].getName() + ' (ID: ' + campaignList[i].getId() + ')');
      skippedCount++;
    }
    return {
      updated: 0,
      failed: 0,
      skipped: skippedCount,
      apiCalls: 0
    };
  }

  // Make SINGLE API call requesting multiple unique suffixes
  Logger.log('[API] Calling API once with campaign_count=' + campaignCount);
  var apiResult = callGetSuffixAPI(campaignCount, currentInterval);
  
  if (!apiResult.success) {
    Logger.log('[API ERROR] Failed to get suffixes: ' + (apiResult.error || 'Unknown error'));
    executionState.errors.push({
      type: 'api_error',
      message: apiResult.error || 'Failed to get suffixes from API',
      timestamp: new Date()
    });
    return {
      updated: 0,
      failed: campaignCount,
      skipped: 0,
      apiCalls: 1
    };
  }
  
  // Get suffixes array (or single suffix for backward compatibility)
  var suffixes = [];
  if (apiResult.suffixes && apiResult.suffixes.length > 0) {
    suffixes = apiResult.suffixes;
    Logger.log('[API] Received ' + suffixes.length + ' unique suffixes');
  } else if (apiResult.suffix) {
    // Backward compatibility: single suffix
    suffixes = [{ suffix: apiResult.suffix }];
    Logger.log('[API] Received single suffix (backward compatibility mode)');
  }
  
  if (suffixes.length === 0) {
    Logger.log('[ERROR] No suffixes received from API');
    return {
      updated: 0,
      failed: campaignCount,
      skipped: 0,
      apiCalls: 1
    };
  }

  // Distribute unique suffixes to campaigns
  for (var i = 0; i < campaignList.length; i++) {
    var campaign = campaignList[i];
    
    // Use suffix from array, or reuse last if we run out
    var suffixIndex = Math.min(i, suffixes.length - 1);
    var suffixData = suffixes[suffixIndex];
    var suffix = suffixData.suffix || suffixData;
    
    try {
      campaign.urls().setFinalUrlSuffix(suffix);
      Logger.log('[UPDATED] ' + campaign.getName() + ' (ID: ' + campaign.getId() + ') with unique suffix #' + (suffixIndex + 1));
      updatedCount++;
      
      // No delay between campaigns for maximum speed
    } catch (e) {
      failedCount++;
      Logger.log('[CAMPAIGN ERROR] Failed to update ' + campaign.getName() + ' (ID: ' + campaign.getId() + '): ' + e.toString());
      executionState.errors.push({
        type: 'campaign_update_error',
        campaign: campaign.getName(),
        campaignId: campaign.getId(),
        message: e.toString(),
        timestamp: new Date()
      });
    }
  }

  executionState.totalCampaignsUpdated += updatedCount;

  return {
    updated: updatedCount,
    failed: failedCount,
    skipped: skippedCount,
    apiCalls: 1
  };
}

// ============================================
// TIME CALCULATION HELPERS
// ============================================
function getElapsedMs() {
  return new Date().getTime() - executionState.startTime;
}

function getRemainingMs() {
  return MAX_RUNTIME_MS - getElapsedMs();
}

function hasEnoughTime() {
  // Run until time is up - no buffer for maximum 30-minute utilization
  return getRemainingMs() > 0;
}

function formatMs(ms) {
  var seconds = Math.floor(ms / 1000);
  var minutes = Math.floor(seconds / 60);
  seconds = seconds % 60;
  return minutes + 'm ' + seconds + 's';
}

// ============================================
// LOGGING FUNCTIONS
// ============================================
function logScriptStart() {
  Logger.log('====================================');
  Logger.log('CONTINUOUS CAMPAIGN UPDATER STARTED');
  Logger.log('====================================');
  Logger.log('Configuration:');
  Logger.log('  Offer Name: ' + OFFER_NAME);
  Logger.log('  Max Runtime: ' + formatMs(MAX_RUNTIME_MS));
  Logger.log('  Update Mode: ' + UPDATE_MODE);
  
  // Show filter method
  if (CAMPAIGN_IDS && CAMPAIGN_IDS.length > 0) {
    Logger.log('  Filter Method: Campaign IDs');
    Logger.log('  Campaign IDs: ' + CAMPAIGN_IDS.join(', '));
  } else if (CAMPAIGN_LABEL_FILTER && CAMPAIGN_LABEL_FILTER !== '') {
    Logger.log('  Filter Method: Campaign Label');
    Logger.log('  Campaign Label: ' + CAMPAIGN_LABEL_FILTER);
  } else {
    Logger.log('  Filter Method: All enabled campaigns');
  }
  
  Logger.log('  Dry Run: ' + (DRY_RUN_MODE ? 'YES' : 'NO'));
  Logger.log('  Note: Interval fetched dynamically from endpoint before each delay');
  Logger.log('====================================');
}

function logCycleStart() {
  executionState.cycleNumber++;
  Logger.log('');
  Logger.log('--- CYCLE #' + executionState.cycleNumber + ' ---');
  Logger.log('Time: ' + new Date().toLocaleString());
  Logger.log('Elapsed: ' + formatMs(getElapsedMs()) + ' / ' + formatMs(MAX_RUNTIME_MS));
  Logger.log('Remaining: ' + formatMs(getRemainingMs()));
}

function logFinalSummary() {
  Logger.log('');
  Logger.log('====================================');
  Logger.log('EXECUTION SUMMARY');
  Logger.log('====================================');
  Logger.log('Total Runtime: ' + formatMs(getElapsedMs()));
  Logger.log('Total Cycles: ' + executionState.cycleNumber);
  Logger.log('Total API Calls: ' + executionState.totalApiCalls);
  Logger.log('Total Campaigns Updated: ' + executionState.totalCampaignsUpdated);
  Logger.log('Total Errors: ' + executionState.errors.length);

  if (executionState.errors.length > 0) {
    Logger.log('');
    Logger.log('Error Details:');
    for (var i = 0; i < executionState.errors.length; i++) {
      var error = executionState.errors[i];
      Logger.log('  [' + error.type + '] ' + error.message);
    }
  }

  Logger.log('====================================');
  Logger.log('Script finished at: ' + new Date().toLocaleString());
  Logger.log('====================================');
}

// ============================================
// MAIN EXECUTION LOOP
// ============================================
function main() {
  // Set account ID at startup
  ACCOUNT_ID = getAccountId();
  Logger.log('[STARTUP] Account ID: ' + ACCOUNT_ID);
  
  logScriptStart();

  // Calculate yesterday's data ONCE at startup (expensive query)
  Logger.log('[STARTUP] Calculating yesterday\\'s landing page data (one-time calculation)...');
  YESTERDAY_DATA_CACHE = getYesterdayLandingPages();
  
  if (YESTERDAY_DATA_CACHE) {
    YESTERDAY_TOTAL_CLICKS = 0;
    for (var url in YESTERDAY_DATA_CACHE) {
      YESTERDAY_TOTAL_CLICKS += YESTERDAY_DATA_CACHE[url];
    }
    YESTERDAY_UNIQUE_PAGES = Object.keys(YESTERDAY_DATA_CACHE).length;
    Logger.log('[STARTUP] Cached yesterday data: ' + YESTERDAY_TOTAL_CLICKS + ' clicks, ' + YESTERDAY_UNIQUE_PAGES + ' unique pages');
  } else {
    Logger.log('[STARTUP] No yesterday data available, will use defaults');
    YESTERDAY_TOTAL_CLICKS = 0;
    YESTERDAY_UNIQUE_PAGES = 0;
  }

  // Interval is now fetched dynamically from endpoint before each use
  Logger.log('[STARTUP] Interval will be fetched dynamically from endpoint before each delay');

  try {
    while (hasEnoughTime()) {
      logCycleStart();

      // Fetch interval ONCE at the start of each cycle
      Logger.log('[INTERVAL] Fetching interval for this cycle...');
      var cycleInterval = getCurrentIntervalFromAPI();
      Logger.log('[INTERVAL] Using ' + cycleInterval + 'ms for this entire cycle');

      // Update campaigns - each campaign gets a unique suffix from API
      Logger.log('[UPDATE MODE] Calling API once per campaign for unique parameters');
      var updateResult = updateCampaigns(cycleInterval); // Pass interval to avoid re-fetching
      
      // Log cycle results
      Logger.log('[CYCLE COMPLETE]');
      Logger.log('  API Calls This Cycle: ' + updateResult.apiCalls);
      Logger.log('  Campaigns Updated: ' + updateResult.updated);
      Logger.log('  Campaigns Failed: ' + updateResult.failed);
      Logger.log('  Campaigns Skipped: ' + updateResult.skipped);
      
      executionState.totalApiCalls += updateResult.apiCalls;

      // Use the adaptive interval to pace how often the suffix API is called (one call per cycle)
      if (cycleInterval > 0) {
        Logger.log('[INTERVAL] Waiting ' + cycleInterval + 'ms before next cycle');
        Utilities.sleep(cycleInterval);
      }
    }

    Logger.log('');
    Logger.log('[RUNTIME COMPLETE] Reached 30-minute limit');

  } catch (e) {
    Logger.log('[FATAL ERROR] ' + e.toString());
    executionState.errors.push({
      type: 'fatal_error',
      message: e.toString(),
      timestamp: new Date()
    });
  }

  logFinalSummary();
}

// ============================================
// HELPER FUNCTIONS
// ============================================

/**
 * List all enabled campaigns with their IDs
 * Run this once to find Campaign IDs for the CAMPAIGN_IDS array
 */
function listCampaignIds() {
  Logger.log('\\n' + '='.repeat(60));
  Logger.log('CAMPAIGN ID FINDER');
  Logger.log('='.repeat(60));
  
  var campaigns = AdsApp.campaigns()
    .withCondition('Status = ENABLED')
    .get();
  
  var count = 0;
  while (campaigns.hasNext()) {
    var campaign = campaigns.next();
    count++;
    Logger.log(count + '. ' + campaign.getName());
    Logger.log('   ID: ' + campaign.getId());
    Logger.log('   Status: ' + campaign.getStatsFor('LAST_30_DAYS').getClicks() + ' clicks (30d)');
    Logger.log('');
  }
  
  Logger.log('='.repeat(60));
  Logger.log('Total: ' + count + ' enabled campaigns');
  Logger.log('='.repeat(60));
}`,F=`// =============================================================
// GOOGLE ADS SCRIPT (V5 WEBHOOK ALL-IN)
// Single-webhook-per-offer, offer+account controls, bucket + queue
// 
// FLOW:
// 1. Webhook arrives  Gets suffix from bucket  Triggers trace  Queues (suffix attached)
// 2. Script polls queue  Gets pending webhooks (suffix already populated)
// 3. For each webhook:
//    - Apply suffix to Google Ads campaign
//    - Mark queue item as completed
// 4. Zero-click suffixes (once daily)  Stored in bucket
// 5. Background traces (triggered by webhook)  Update bucket
//
// BUCKET = Single source of truth for all suffixes
// Trace happens in WEBHOOK HANDLER, not in this script
//
// HOW TO USE
// 1) Set SUPABASE_URL to your project URL (already injected here).
// 2) Fill OFFER_BY_CAMPAIGN or OFFER_DEFAULT. Campaign mapping wins.
// 3) Optional: set ALLOWED_CAMPAIGN_IDS to limit updates.
// 4) Schedule hourly (or faster) in Google Ads scripts.
// 5) Trackier calls v5-webhook-conversion  handles trace + bucket + queue
// =============================================================

var SUPABASE_URL = '${r}';
var OFFER_DEFAULT = 'OFFER_NAME'; // used when no campaign-specific mapping found
var ACCOUNT_ID = ''; // auto-set at runtime

// Map Campaign IDs -> Offer names (single webhook per offer)
// Example: {'1234567890': 'OfferA', '2345678901': 'OfferB'}
var OFFER_BY_CAMPAIGN = {};

// Optional allow-list: leave empty to update all enabled campaigns
var ALLOWED_CAMPAIGN_IDS = [];

// Batch controls
var BATCH_SIZE = 15; // how many webhooks per run

// Zero-click fetch controls
var ZERO_CLICK_LOOKBACK_DAYS = 7; // fetch last 7 days
var ZERO_CLICK_FETCH_KEY = 'v5-zero-click-fetch'; // PropertiesService key

// Daily stats cache (repeat ratio helper)
var CACHE_KEY_STATS = 'v5-daily-stats';
var CACHE_TTL_SECONDS = 6 * 60 * 60; // 6 hours cache

// =============================================================
// ENTRY POINT
// =============================================================
function main() {
  ACCOUNT_ID = getAccountId();
  Logger.log('=== V5 WEBHOOK (ALL-IN) ===');
  Logger.log('Account: ' + ACCOUNT_ID);

  // Step 1: Check and fetch zero-click suffixes (once daily)
  checkAndFetchZeroClickSuffixes();

  // Step 2: Collect landing page stats (cached for the day)
  var stats = getCachedLandingPages();
  if (!stats) {
    stats = collectYesterdayLandingPages();
    if (stats) {
      cacheStats(stats);
    }
  }

  // Step 3: Process webhook queue (suffix already attached by webhook handler)
  var webhooks = fetchWebhookQueue(BATCH_SIZE);

  if (webhooks.length === 0) {
    Logger.log('[IDLE] Nothing to process.');
    return;
  }

  var summary = applySuffixes(webhooks);
  if (summary.queueIds.length > 0) {
    markQueueItemsProcessed(summary.queueIds);
  }

  Logger.log('[DONE] Webhooks processed: ' + summary.processed + ', ads updated: ' + summary.updatedAds);
}

// =============================================================
// CORE FLOW
// =============================================================
function fetchWebhookQueue(limit) {
  try {
    var url = SUPABASE_URL + '/functions/v1/v5-fetch-queue?' +
      'account_id=' + encodeURIComponent(ACCOUNT_ID) +
      '&limit=' + encodeURIComponent(limit || BATCH_SIZE);

    var response = UrlFetchApp.fetch(url, { method: 'get', muteHttpExceptions: true });
    var code = response.getResponseCode();
    if (code !== 200) {
      Logger.log('[QUEUE] Non-200 response: ' + code);
      return [];
    }
    var data = JSON.parse(response.getContentText());
    if (!data || !data.success || !data.webhooks) return [];
    Logger.log('[QUEUE] Received ' + data.webhooks.length + ' items');
    
    // Map queue items to expected format with queue_id
    return data.webhooks.map(function(item) {
      return {
        queue_id: item.id,
        campaign_id: item.campaign_id,
        offer_name: item.offer_name,
        new_suffix: item.new_suffix || '', // Will be fetched from bucket if null
        source: 'webhook'
      };
    });
  } catch (e) {
    Logger.log('[QUEUE] Fetch failed: ' + e);
    return [];
  }
}



function applySuffixes(webhooks) {
  var queueIds = [];
  var updatedAds = 0;

  var iterator = getEligibleAds();
  while (iterator.hasNext()) {
    var ad = iterator.next();
    var campaignId = String(ad.getCampaign().getId());
    var match = popNextForCampaign(webhooks, campaignId);
    if (!match) {
      continue;
    }

    // Suffix is already attached by webhook handler
    if (!match.new_suffix) {
      Logger.log('[SKIP] No suffix attached for campaign ' + campaignId);
      continue;
    }
    
    var baseUrl = ad.urls().getFinalUrl();
    var nextUrl = appendSuffix(baseUrl, match.new_suffix);
    if (nextUrl === baseUrl) {
      Logger.log('[SKIP] No change for ad ' + ad.getId());
      continue;
    }

    ad.urls().setFinalUrl(nextUrl);
    updatedAds++;
    Logger.log('[UPDATE] Campaign ' + campaignId + ' updated with suffix: ' + match.new_suffix);

    // Mark queue item for completion
    if (match.queue_id) {
      queueIds.push(match.queue_id);
    }
  }

  return {
    processed: queueIds.length,
    queueIds: queueIds,
    updatedAds: updatedAds
  };
}

function popNextForCampaign(list, campaignId) {
  for (var i = 0; i < list.length; i++) {
    var item = list[i];
    if (item.campaign_id && String(item.campaign_id) !== String(campaignId)) {
      continue;
    }
    list.splice(i, 1);
    return item;
  }
  return null;
}

function getEligibleAds() {
  var selector = AdsApp.ads().withCondition('Status = ENABLED');
  if (ALLOWED_CAMPAIGN_IDS.length > 0) {
    var orParts = ALLOWED_CAMPAIGN_IDS.map(function(id) { return 'CampaignId = ' + id; });
    selector = selector.withCondition(orParts.join(' OR '));
  }
  return selector.get();
}

function resolveOfferName(item, campaignId) {
  if (item.offer_name) return item.offer_name;
  if (OFFER_BY_CAMPAIGN[campaignId]) return OFFER_BY_CAMPAIGN[campaignId];
  return OFFER_DEFAULT;
}

function appendSuffix(url, suffix) {
  if (!url) return url;
  if (!suffix) return url;

  var hasQuery = url.indexOf('?') !== -1;
  var separator = hasQuery ? '&' : '?';
  var cleanedSuffix = suffix.replace(/^?+/, '');
  return url + separator + cleanedSuffix;
}







function markQueueItemsProcessed(queueIds) {
  if (!queueIds || queueIds.length === 0) return;
  try {
    // Call edge function to mark queue items as completed
    var payload = { queue_ids: queueIds, status: 'completed' };
    var options = {
      method: 'post',
      contentType: 'application/json',
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    };
    var resp = UrlFetchApp.fetch(SUPABASE_URL + '/functions/v1/v5-update-queue-status', options);
    Logger.log('[MARK-QUEUE] Response: ' + resp.getResponseCode());
  } catch (e) {
    Logger.log('[MARK-QUEUE] Failed: ' + e);
  }
}



// =============================================================
// ZERO-CLICK SUFFIX FETCHING (DAILY)
// =============================================================
function checkAndFetchZeroClickSuffixes() {
  try {
    var props = PropertiesService.getScriptProperties();
    var lastFetch = props.getProperty(ZERO_CLICK_FETCH_KEY);
    var now = new Date().getTime();
    var ONE_DAY_MS = 24 * 60 * 60 * 1000;

    if (lastFetch) {
      var elapsed = now - parseInt(lastFetch, 10);
      if (elapsed < ONE_DAY_MS) {
        Logger.log('[ZERO-CLICK] Already fetched today. Next fetch in ' + Math.round((ONE_DAY_MS - elapsed) / 3600000) + ' hours');
        return;
      }
    }

    Logger.log('[ZERO-CLICK] Starting daily fetch (last ' + ZERO_CLICK_LOOKBACK_DAYS + ' days)...');

    // Fetch all campaigns (or use ALLOWED_CAMPAIGN_IDS if set)
    var campaignSelector = AdsApp.campaigns().withCondition('Status = ENABLED');
    if (ALLOWED_CAMPAIGN_IDS.length > 0) {
      var orParts = ALLOWED_CAMPAIGN_IDS.map(function(id) { return 'Id = ' + id; });
      campaignSelector = campaignSelector.withCondition(orParts.join(' OR '));
    }
    var campaigns = campaignSelector.get();

    var totalStored = 0;

    while (campaigns.hasNext()) {
      var campaign = campaigns.next();
      var campaignId = String(campaign.getId());
      var offerName = OFFER_BY_CAMPAIGN[campaignId] || OFFER_DEFAULT;

      Logger.log('[ZERO-CLICK] Fetching for campaign ' + campaignId + ' (offer: ' + offerName + ')...');

      var suffixes = fetchZeroClickForCampaign(campaignId);
      if (suffixes.length > 0) {
        var stored = storeZeroClickSuffixes(offerName, suffixes);
        totalStored += stored;
        Logger.log('[ZERO-CLICK] Stored ' + stored + ' suffixes for ' + offerName);
      }
    }

    Logger.log('[ZERO-CLICK] Complete! Total suffixes stored: ' + totalStored);
    props.setProperty(ZERO_CLICK_FETCH_KEY, String(now));

  } catch (e) {
    Logger.log('[ZERO-CLICK] Error: ' + e);
  }
}

function fetchZeroClickForCampaign(campaignId) {
  try {
    var query = 'SELECT EffectiveFinalUrl, Clicks, Impressions ' +
                'FROM FINAL_URL_REPORT ' +
                'WHERE CampaignId = ' + campaignId + ' ' +
                'AND Clicks = 0 ' +
                'AND Impressions > 0 ' +
                'DURING LAST_' + ZERO_CLICK_LOOKBACK_DAYS + '_DAYS';

    var report = AdsApp.report(query);
    var rows = report.rows();
    var suffixes = [];

    while (rows.hasNext()) {
      var row = rows.next();
      var finalUrl = row['EffectiveFinalUrl'] || '';
      var clicks = parseInt(row['Clicks'], 10) || 0;
      var impressions = parseInt(row['Impressions'], 10) || 0;

      if (finalUrl && clicks === 0 && impressions > 0) {
        var suffix = extractSuffixFromUrl(finalUrl);
        if (suffix && suffix.length > 10) {
          suffixes.push(suffix);
        }
      }
    }

    return suffixes;

  } catch (e) {
    Logger.log('[ZERO-CLICK] Fetch error for campaign ' + campaignId + ': ' + e);
    return [];
  }
}

function extractSuffixFromUrl(url) {
  try {
    if (!url || url.indexOf('?') === -1) return null;
    var parts = url.split('?');
    if (parts.length < 2) return null;
    return parts[1]; // Everything after the ?
  } catch (e) {
    return null;
  }
}

function storeZeroClickSuffixes(offerName, suffixes) {
  try {
    var payload = {
      account_id: ACCOUNT_ID,
      offer_name: offerName,
      suffixes: suffixes.map(function(s) {
        return { suffix: s, source: 'zero_click' };
      })
    };
    var options = {
      method: 'post',
      contentType: 'application/json',
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    };
    var resp = UrlFetchApp.fetch(SUPABASE_URL + '/functions/v1/v5-store-traced-suffixes', options);
    var data = JSON.parse(resp.getContentText());
    return (data && data.stored) || 0;
  } catch (e) {
    Logger.log('[STORE-ZERO-CLICK] Failed: ' + e);
    return 0;
  }
}

// =============================================================
// LANDING PAGE STATS (DAILY CACHE)
// =============================================================
function collectYesterdayLandingPages() {
  try {
    var query = 'SELECT EffectiveFinalUrl, Clicks ' +
                'FROM FINAL_URL_REPORT ' +
                'DURING YESTERDAY';
    var report = AdsApp.report(query);
    var rows = report.rows();

    var landingPages = {};
    while (rows.hasNext()) {
      var row = rows.next();
      var url = row['EffectiveFinalUrl'] || '';
      var clicks = parseInt(row['Clicks'], 10) || 0;
      if (url && clicks > 0) {
        landingPages[url] = (landingPages[url] || 0) + clicks;
      }
    }

    if (Object.keys(landingPages).length === 0) return null;
    Logger.log('[STATS] Cached yesterday landing pages: ' + Object.keys(landingPages).length);
    return landingPages;
  } catch (e) {
    Logger.log('[STATS] Failed to collect: ' + e);
    return null;
  }
}

function cacheStats(stats) {
  try {
    var cache = CacheService.getScriptCache();
    cache.put(CACHE_KEY_STATS, JSON.stringify(stats), CACHE_TTL_SECONDS);
  } catch (e) {
    Logger.log('[CACHE] Failed to write: ' + e);
  }
}

function getCachedLandingPages() {
  try {
    var cache = CacheService.getScriptCache();
    var raw = cache.get(CACHE_KEY_STATS);
    if (!raw) return null;
    return JSON.parse(raw);
  } catch (e) {
    Logger.log('[CACHE] Read miss: ' + e);
    return null;
  }
}

// =============================================================
// HELPERS
// =============================================================
function getAccountId() {
  try {
    return AdsApp.currentAccount().getCustomerId();
  } catch (e) {
    return 'unknown';
  }
}`,H=`// ============================================
// MULTI-OFFER ADAPTIVE INTERVAL SCRIPT (V4)
// ============================================
// V4: Multi-offer support with flexible campaign mapping
// - Supports array of offers OR single offer string
// - Manual campaign-to-offer mapping OR automatic round-robin distribution
// - Unique suffix per campaign per call from assigned offer
// - Per-offer interval calculation and statistics tracking
// - Fully backward compatible with single-offer mode

var SUPABASE_URL = '${r}';
var ACCOUNT_ID = ''; // Will be set at startup

// ============================================
// MULTI-OFFER CONFIGURATION
// ============================================

// OFFER_NAMES: Accept array OR single string
// Examples:
//   var OFFER_NAMES = ['offer1', 'offer2', 'offer3'];
//   var OFFER_NAMES = 'single-offer';
var OFFER_NAMES = 'OFFER_NAME'; // Replace with your offer(s)

// CAMPAIGN_MAPPING: Manual mode - explicit campaign ID to offer name mapping
// Leave empty {} or null for automatic round-robin distribution
// Example:
//   var CAMPAIGN_MAPPING = {
//     '12345678': 'offer1',
//     '87654321': 'offer2',
//     '11223344': 'offer3'
//   };
var CAMPAIGN_MAPPING = {};

// ============================================
// INTERVAL CONFIGURATION
// ============================================
var DEFAULT_INTERVAL_MS = 5000;
var MIN_INTERVAL_MS = 1000;
var MAX_INTERVAL_MS = 30000;
var TARGET_REPEAT_RATIO = 5;
var MIN_REPEAT_RATIO = 1.0;

// ============================================
// CALL BUDGET CONFIGURATION
// ============================================
// Max daily API calls = yesterday's clicks  this multiplier
// Example: 100 clicks  10 = 1000 max calls per day
// Database override (per account+offer) takes highest priority
var CALL_BUDGET_MULTIPLIER = 10;

// ============================================
// CAMPAIGN FILTERING
// ============================================
var CAMPAIGN_IDS = []; // Leave empty to process all campaigns
var CAMPAIGN_LABEL_FILTER = '';
var DRY_RUN_MODE = false;

// ============================================
// RUNTIME CONFIGURATION
// ============================================
var MAX_RUNTIME_MS = 1500000; // 25 minutes
var UPDATE_MODE = 'on_change';

// ============================================
// GLOBAL STATE
// ============================================
var executionState = {
  startTime: new Date().getTime(),
  totalApiCalls: 0,
  totalCampaignsUpdated: 0,
  cycleNumber: 0,
  errors: []
};

// Normalized offer names (always an array)
var NORMALIZED_OFFERS = [];

// Campaign to offer assignment map
var campaignToOfferMap = {};

// Per-offer tracking
var perOfferStats = {};

// Per-offer yesterday data cache
var perOfferYesterdayCache = {};

// ============================================
// INITIALIZATION HELPERS
// ============================================

function getAccountId() {
  try {
    return AdsApp.currentAccount().getCustomerId();
  } catch (error) {
    Logger.log(' [ACCOUNT] Failed to get account ID: ' + error);
    return 'unknown';
  }
}

function normalizeOfferNames() {
  // Convert OFFER_NAMES to array format
  if (typeof OFFER_NAMES === 'string') {
    NORMALIZED_OFFERS = [OFFER_NAMES];
    Logger.log('[INIT] Single offer mode: ' + OFFER_NAMES);
  } else if (Array.isArray(OFFER_NAMES)) {
    NORMALIZED_OFFERS = OFFER_NAMES;
    Logger.log('[INIT] Multi-offer mode: ' + NORMALIZED_OFFERS.length + ' offers');
    for (var i = 0; i < NORMALIZED_OFFERS.length; i++) {
      Logger.log('  ' + (i + 1) + '. ' + NORMALIZED_OFFERS[i]);
    }
  } else {
    Logger.log(' [INIT] Invalid OFFER_NAMES format, using default');
    NORMALIZED_OFFERS = ['default-offer'];
  }
  
  // Initialize per-offer stats
  for (var i = 0; i < NORMALIZED_OFFERS.length; i++) {
    var offerName = NORMALIZED_OFFERS[i];
    perOfferStats[offerName] = {
      currentInterval: DEFAULT_INTERVAL_MS,
      totalClicks: 0,
      uniquePages: 0,
      apiCalls: 0,
      campaignsUpdated: 0
    };
  }
}

function getCampaignList() {
  var campaignSelector;

  if (CAMPAIGN_IDS && CAMPAIGN_IDS.length > 0) {
    Logger.log('[FILTER] Using Campaign IDs: ' + CAMPAIGN_IDS.join(', '));
    var idConditions = [];
    for (var i = 0; i < CAMPAIGN_IDS.length; i++) {
      idConditions.push('Id = ' + CAMPAIGN_IDS[i]);
    }
    var idFilter = '(' + idConditions.join(' OR ') + ')';
    campaignSelector = AdsApp.campaigns()
      .withCondition('Status = ENABLED')
      .withCondition(idFilter);
  } else if (CAMPAIGN_LABEL_FILTER && CAMPAIGN_LABEL_FILTER !== '') {
    Logger.log('[FILTER] Using Label: ' + CAMPAIGN_LABEL_FILTER);
    campaignSelector = AdsApp.campaigns()
      .withCondition('Status = ENABLED')
      .withCondition('LabelNames CONTAINS_ANY ["' + CAMPAIGN_LABEL_FILTER + '"]');
  } else {
    Logger.log('[FILTER] Using all enabled campaigns');
    campaignSelector = AdsApp.campaigns()
      .withCondition('Status = ENABLED');
  }

  var campaigns = campaignSelector.get();
  var campaignList = [];
  while (campaigns.hasNext()) {
    campaignList.push(campaigns.next());
  }
  
  return campaignList;
}

function assignCampaignsToOffers(campaignList) {
  Logger.log('[MAPPING] Assigning campaigns to offers...');
  
  // Check if manual mapping provided
  var hasManualMapping = CAMPAIGN_MAPPING && Object.keys(CAMPAIGN_MAPPING).length > 0;
  
  if (hasManualMapping) {
    Logger.log('[MAPPING] Using manual campaign mapping');
    for (var i = 0; i < campaignList.length; i++) {
      var campaign = campaignList[i];
      var campaignId = campaign.getId();
      var assignedOffer = CAMPAIGN_MAPPING[campaignId];
      
      if (assignedOffer) {
        campaignToOfferMap[campaignId] = assignedOffer;
        Logger.log('  Campaign ' + campaignId + ' -> ' + assignedOffer);
      } else {
        Logger.log('   Campaign ' + campaignId + ' has no mapping, skipping');
      }
    }
  } else {
    Logger.log('[MAPPING] Using automatic round-robin distribution');
    var offerCount = NORMALIZED_OFFERS.length;
    
    for (var i = 0; i < campaignList.length; i++) {
      var campaign = campaignList[i];
      var campaignId = campaign.getId();
      var offerIndex = i % offerCount;
      var assignedOffer = NORMALIZED_OFFERS[offerIndex];
      
      campaignToOfferMap[campaignId] = assignedOffer;
      Logger.log('  Campaign ' + campaignId + ' -> ' + assignedOffer + ' (round-robin #' + offerIndex + ')');
    }
  }
  
  // Log summary
  var assignedCount = Object.keys(campaignToOfferMap).length;
  Logger.log('[MAPPING] Total campaigns assigned: ' + assignedCount);
  
  // Count campaigns per offer
  var offerCounts = {};
  for (var campaignId in campaignToOfferMap) {
    var offer = campaignToOfferMap[campaignId];
    offerCounts[offer] = (offerCounts[offer] || 0) + 1;
  }
  
  Logger.log('[MAPPING] Campaigns per offer:');
  for (var offer in offerCounts) {
    Logger.log('  ' + offer + ': ' + offerCounts[offer] + ' campaigns');
  }
}

// ============================================
// YESTERDAY'S DATA COLLECTION (PER-OFFER)
// ============================================

function getYesterdayLandingPagesForOffer(offerName) {
  try {
    Logger.log('[GOOGLE ADS] Collecting yesterday landing pages for offer: ' + offerName);
    
    // Get campaigns assigned to this offer
    var offerCampaignIds = [];
    for (var campaignId in campaignToOfferMap) {
      if (campaignToOfferMap[campaignId] === offerName) {
        offerCampaignIds.push(campaignId);
      }
    }
    
    if (offerCampaignIds.length === 0) {
      Logger.log('[REPORT] No campaigns assigned to offer: ' + offerName);
      return null;
    }
    
    // Build campaign filter
    var campaignFilter = '';
    for (var i = 0; i < offerCampaignIds.length; i++) {
      if (i > 0) campaignFilter += ' OR ';
      campaignFilter += 'CampaignId = ' + offerCampaignIds[i];
    }
    
    var query = 'SELECT EffectiveFinalUrl, Clicks ' +
                'FROM FINAL_URL_REPORT ' +
                'WHERE (' + campaignFilter + ') ' +
                'DURING YESTERDAY';
    
    var report = AdsApp.report(query);
    var rows = report.rows();
    
    var landingPages = {};
    var totalClicks = 0;
    var processedRows = 0;
    
    while (rows.hasNext()) {
      var row = rows.next();
      var url = row['EffectiveFinalUrl'] || '';
      var clicks = parseInt(row['Clicks'], 10) || 0;
      
      if (url && clicks > 0) {
        landingPages[url] = (landingPages[url] || 0) + clicks;
        totalClicks += clicks;
        processedRows++;
      }
    }
    
    var uniquePages = Object.keys(landingPages).length;
    Logger.log('[REPORT] Offer "' + offerName + '" yesterday results:');
    Logger.log('  Rows processed: ' + processedRows);
    Logger.log('  Unique landing pages: ' + uniquePages);
    Logger.log('  Total clicks: ' + totalClicks);

    if (uniquePages > 0 && totalClicks > 0) {
      return {
        landingPages: landingPages,
        totalClicks: totalClicks,
        uniquePages: uniquePages
      };
    }
    return null;
  } catch (error) {
    Logger.log(' [REPORT] Failed to collect yesterday data for ' + offerName + ': ' + error);
    return null;
  }
}

function collectAllOfferYesterdayData() {
  Logger.log('[STARTUP] Collecting yesterday data for all offers...');
  
  for (var i = 0; i < NORMALIZED_OFFERS.length; i++) {
    var offerName = NORMALIZED_OFFERS[i];
    var yesterdayData = getYesterdayLandingPagesForOffer(offerName);
    
    if (yesterdayData) {
      perOfferYesterdayCache[offerName] = yesterdayData;
      perOfferStats[offerName].totalClicks = yesterdayData.totalClicks;
      perOfferStats[offerName].uniquePages = yesterdayData.uniquePages;
      Logger.log('[STARTUP] Cached data for ' + offerName + ': ' + yesterdayData.totalClicks + ' clicks, ' + yesterdayData.uniquePages + ' pages');
    } else {
      Logger.log('[STARTUP] No yesterday data for ' + offerName);
      perOfferStats[offerName].totalClicks = 0;
      perOfferStats[offerName].uniquePages = 0;
    }
  }
}

// ============================================
// PER-OFFER INTERVAL FETCHING
// ============================================

function getIntervalForOffer(offerName) {
  try {
    var stats = perOfferStats[offerName];
    if (!stats) {
      Logger.log(' [INTERVAL] No stats for offer: ' + offerName);
      return DEFAULT_INTERVAL_MS;
    }
    
    Logger.log('[INTERVAL] Fetching interval for offer: ' + offerName);
    
    var accountTimezone = AdsApp.currentAccount().getTimeZone();
    var url = SUPABASE_URL + '/functions/v1/get-recommended-interval?offer_name=' + encodeURIComponent(offerName);
    url += '&account_id=' + encodeURIComponent(ACCOUNT_ID);
    
    var payload = {
      yesterday_total_clicks: stats.totalClicks,
      yesterday_unique_landing_pages: stats.uniquePages,
      account_timezone: accountTimezone,
      min_interval_ms: MIN_INTERVAL_MS,
      max_interval_ms: MAX_INTERVAL_MS,
      target_repeat_ratio: TARGET_REPEAT_RATIO,
      min_repeat_ratio: MIN_REPEAT_RATIO,
      call_budget_multiplier: CALL_BUDGET_MULTIPLIER,
      default_interval_ms: DEFAULT_INTERVAL_MS
    };
    
    var options = {
      method: 'post',
      contentType: 'application/json',
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    };
    
    var response = UrlFetchApp.fetch(url, options);
    var responseCode = response.getResponseCode();
    var responseText = response.getContentText();
    
    if (responseCode === 200) {
      var result = JSON.parse(responseText);
      if (result.recommended_interval_ms) {
        stats.currentInterval = result.recommended_interval_ms;
        Logger.log('[INTERVAL] Offer "' + offerName + '" interval: ' + stats.currentInterval + 'ms');
        Logger.log('  Data source: ' + (result.data_source || 'database'));
        Logger.log('  Yesterday clicks: ' + result.yesterday_clicks);
        Logger.log('  Yesterday pages: ' + result.yesterday_landing_pages);
        Logger.log('  Average repeats: ' + result.average_repeats);
        return stats.currentInterval;
      }
    }
    
    Logger.log(' [INTERVAL] API failed for ' + offerName + ', using default');
    return DEFAULT_INTERVAL_MS;
  } catch (error) {
    Logger.log(' [INTERVAL] Error for ' + offerName + ': ' + error);
    return DEFAULT_INTERVAL_MS;
  }
}

// ============================================
// UNIFIED SUFFIX FETCHING (ALL CAMPAIGNS ONE CALL)
// ============================================

function getAllSuffixesUnified(campaignToOfferMapping, intervalToUse) {
  try {
    Logger.log('[API UNIFIED] Fetching unique suffixes for all campaigns in single call...');
    Logger.log('[API UNIFIED] Campaign count: ' + Object.keys(campaignToOfferMapping).length);
    
    var url = SUPABASE_URL + '/functions/v1/get-suffix-batch';
    url += '?account_id=' + encodeURIComponent(ACCOUNT_ID);
    
    if (intervalToUse > 0) {
      url += '&interval_used=' + intervalToUse;
    }

    var payload = {
      campaign_offer_mapping: campaignToOfferMapping, // { campaignId: offerName, ... }
      campaign_count: Object.keys(campaignToOfferMapping).length
    };

    var options = {
      'method': 'post',
      'contentType': 'application/json',
      'payload': JSON.stringify(payload),
      'muteHttpExceptions': true
    };

    var response = UrlFetchApp.fetch(url, options);
    var responseCode = response.getResponseCode();
    var json = JSON.parse(response.getContentText());

    if (responseCode === 200 && json.success && json.suffixes && json.suffixes.length > 0) {
      Logger.log('[API UNIFIED]  Got ' + json.suffixes.length + ' unique suffixes for ' + Object.keys(campaignToOfferMapping).length + ' campaigns');
      executionState.totalApiCalls++;
      return {
        success: true,
        suffixes: json.suffixes // Array of { campaign_id, suffix, offer_name }
      };
    } else {
      Logger.log('[API ERROR] Unified API failed or returned invalid data');
      return { success: false };
    }
  } catch (e) {
    Logger.log('[API ERROR] Failed unified suffix fetch: ' + e.toString());
    executionState.errors.push({
      type: 'api_error',
      message: 'Unified suffix fetch failed: ' + e.toString(),
      timestamp: new Date()
    });
    return { success: false };
  }
}

// ============================================
// CAMPAIGN UPDATE FUNCTION (UNIFIED CALL)
// ============================================

function updateCampaigns() {
  var campaignList = getCampaignList();
  var totalCampaigns = campaignList.length;
  
  Logger.log('[UPDATE] Processing ' + totalCampaigns + ' campaigns (unified single API call)');
  
  if (totalCampaigns === 0) {
    return {
      updated: 0,
      failed: 0,
      skipped: 0
    };
  }

  var updatedCount = 0;
  var failedCount = 0;
  var skippedCount = 0;

  if (DRY_RUN_MODE) {
    Logger.log('[DRY RUN] Would update ' + totalCampaigns + ' campaigns with unified call');
    for (var i = 0; i < campaignList.length; i++) {
      var campaign = campaignList[i];
      var campaignId = campaign.getId();
      var offerName = campaignToOfferMap[campaignId];
      Logger.log('[DRY RUN] Campaign ' + campaign.getName() + ' (ID: ' + campaignId + ') -> ' + offerName);
      skippedCount++;
    }
    return { updated: 0, failed: 0, skipped: skippedCount };
  }

  // Build campaign ID to offer name mapping for API call
  var campaignMapping = {};
  var campaignListMap = {}; // Keep reference to campaign objects by ID
  
  for (var i = 0; i < campaignList.length; i++) {
    var campaign = campaignList[i];
    var campaignId = campaign.getId();
    var offerName = campaignToOfferMap[campaignId];
    
    if (!offerName) {
      Logger.log('[SKIP] Campaign ' + campaignId + ' has no offer assignment');
      skippedCount++;
      continue;
    }
    
    campaignMapping[campaignId] = offerName;
    campaignListMap[campaignId] = campaign;
  }

  if (Object.keys(campaignMapping).length === 0) {
    Logger.log('[ERROR] No campaigns with offer assignments');
    return { updated: 0, failed: 0, skipped: skippedCount };
  }

  // Calculate average interval for delay between cycles
  var totalInterval = 0;
  for (var i = 0; i < NORMALIZED_OFFERS.length; i++) {
    totalInterval += perOfferStats[NORMALIZED_OFFERS[i]].currentInterval;
  }
  var avgInterval = Math.floor(totalInterval / NORMALIZED_OFFERS.length);

  // SINGLE unified API call for ALL campaigns at once
  var apiResult = getAllSuffixesUnified(campaignMapping, avgInterval);
  
  if (!apiResult.success) {
    Logger.log('[ERROR] Unified API call failed, all campaigns failed');
    return {
      updated: 0,
      failed: Object.keys(campaignMapping).length,
      skipped: skippedCount
    };
  }

  var suffixes = apiResult.suffixes || [];
  Logger.log('[UPDATE] Received ' + suffixes.length + ' suffixes, applying to campaigns...');

  // Apply each suffix to its corresponding campaign
  for (var i = 0; i < suffixes.length; i++) {
    var suffixData = suffixes[i];
    var campaignId = suffixData.campaign_id;
    var suffix = suffixData.suffix;
    var offerName = suffixData.offer_name;
    
    var campaign = campaignListMap[campaignId];
    if (!campaign) {
      Logger.log('[ERROR] Campaign ' + campaignId + ' not found in campaign list');
      failedCount++;
      continue;
    }
    
    try {
      campaign.urls().setFinalUrlSuffix(suffix);
      Logger.log('[UPDATED] ' + campaign.getName() + ' (ID: ' + campaignId + ') with unique suffix from offer: ' + offerName);
      updatedCount++;
      
      // Track per-offer
      if (perOfferStats[offerName]) {
        perOfferStats[offerName].campaignsUpdated++;
        perOfferStats[offerName].apiCalls++; // Count this campaign's portion of the unified call
      }
    } catch (e) {
      failedCount++;
      Logger.log('[ERROR] Failed to update campaign ' + campaignId + ': ' + e.toString());
      executionState.errors.push({
        type: 'campaign_update_error',
        campaign: campaign.getName(),
        campaignId: campaignId,
        offerName: offerName,
        message: e.toString(),
        timestamp: new Date()
      });
    }
  }

  executionState.totalCampaignsUpdated += updatedCount;

  return {
    updated: updatedCount,
    failed: failedCount,
    skipped: skippedCount
  };
}

// ============================================
// TIME HELPERS
// ============================================

function getElapsedMs() {
  return new Date().getTime() - executionState.startTime;
}

function getRemainingMs() {
  return MAX_RUNTIME_MS - getElapsedMs();
}

function hasEnoughTime() {
  return getRemainingMs() > 0;
}

function formatMs(ms) {
  var seconds = Math.floor(ms / 1000);
  var minutes = Math.floor(seconds / 60);
  seconds = seconds % 60;
  return minutes + 'm ' + seconds + 's';
}

// ============================================
// LOGGING
// ============================================

function logScriptStart() {
  Logger.log('====================================');
  Logger.log('MULTI-OFFER CAMPAIGN UPDATER V4');
  Logger.log('====================================');
  Logger.log('Configuration:');
  Logger.log('  Account ID: ' + ACCOUNT_ID);
  Logger.log('  Offers: ' + NORMALIZED_OFFERS.join(', '));
  Logger.log('  Mapping Mode: ' + (Object.keys(CAMPAIGN_MAPPING).length > 0 ? 'Manual' : 'Auto Round-Robin'));
  Logger.log('  Max Runtime: ' + formatMs(MAX_RUNTIME_MS));
  Logger.log('  Update Mode: ' + UPDATE_MODE);
  Logger.log('  Dry Run: ' + (DRY_RUN_MODE ? 'YES' : 'NO'));
  Logger.log('  API Strategy: Unified single call with campaign-offer mapping');
  Logger.log('====================================');
}

function logCycleStart() {
  executionState.cycleNumber++;
  Logger.log('');
  Logger.log('--- CYCLE #' + executionState.cycleNumber + ' ---');
  Logger.log('Time: ' + new Date().toLocaleString());
  Logger.log('Elapsed: ' + formatMs(getElapsedMs()) + ' / ' + formatMs(MAX_RUNTIME_MS));
  Logger.log('Remaining: ' + formatMs(getRemainingMs()));
}

function logFinalSummary() {
  Logger.log('');
  Logger.log('====================================');
  Logger.log('EXECUTION SUMMARY (V4)');
  Logger.log('====================================');
  Logger.log('Total Runtime: ' + formatMs(getElapsedMs()));
  Logger.log('Total Cycles: ' + executionState.cycleNumber);
  Logger.log('Total API Calls: ' + executionState.totalApiCalls);
  Logger.log('Total Campaigns Updated: ' + executionState.totalCampaignsUpdated);
  Logger.log('Total Errors: ' + executionState.errors.length);
  Logger.log('');
  Logger.log('Per-Offer Statistics:');
  for (var i = 0; i < NORMALIZED_OFFERS.length; i++) {
    var offerName = NORMALIZED_OFFERS[i];
    var stats = perOfferStats[offerName];
    Logger.log('  ' + offerName + ':');
    Logger.log('    API Calls: ' + stats.apiCalls);
    Logger.log('    Campaigns Updated: ' + stats.campaignsUpdated);
    Logger.log('    Current Interval: ' + stats.currentInterval + 'ms');
    Logger.log('    Yesterday Clicks: ' + stats.totalClicks);
    Logger.log('    Yesterday Pages: ' + stats.uniquePages);
  }

  if (executionState.errors.length > 0) {
    Logger.log('');
    Logger.log('Error Details:');
    for (var i = 0; i < executionState.errors.length && i < 10; i++) {
      var error = executionState.errors[i];
      Logger.log('  [' + error.type + '] ' + error.message);
    }
    if (executionState.errors.length > 10) {
      Logger.log('  ... and ' + (executionState.errors.length - 10) + ' more errors');
    }
  }

  Logger.log('====================================');
  Logger.log('Script finished at: ' + new Date().toLocaleString());
  Logger.log('====================================');
}

// ============================================
// MAIN EXECUTION LOOP
// ============================================

function main() {
  // Initialize
  ACCOUNT_ID = getAccountId();
  normalizeOfferNames();
  
  logScriptStart();

  // Get all campaigns and assign to offers
  var campaignList = getCampaignList();
  Logger.log('[INIT] Found ' + campaignList.length + ' campaigns');
  
  if (campaignList.length === 0) {
    Logger.log('[ERROR] No campaigns found to process');
    return;
  }
  
  assignCampaignsToOffers(campaignList);
  
  // Collect yesterday's data for all offers (one-time at startup)
  collectAllOfferYesterdayData();
  
  // Fetch initial intervals for all offers
  Logger.log('[STARTUP] Fetching initial intervals for all offers...');
  for (var i = 0; i < NORMALIZED_OFFERS.length; i++) {
    var offerName = NORMALIZED_OFFERS[i];
    getIntervalForOffer(offerName);
  }

  try {
    while (hasEnoughTime()) {
      logCycleStart();

      // Update all campaigns (each gets unique suffix from its assigned offer)
      var updateResult = updateCampaigns();
      
      Logger.log('[CYCLE COMPLETE]');
      Logger.log('  Campaigns Updated: ' + updateResult.updated);
      Logger.log('  Campaigns Failed: ' + updateResult.failed);
      Logger.log('  Campaigns Skipped: ' + updateResult.skipped);
      
      // Calculate average interval across all offers for cycle delay
      var totalInterval = 0;
      for (var i = 0; i < NORMALIZED_OFFERS.length; i++) {
        totalInterval += perOfferStats[NORMALIZED_OFFERS[i]].currentInterval;
      }
      var avgInterval = Math.floor(totalInterval / NORMALIZED_OFFERS.length);
      
      Logger.log('[INTERVAL] Average interval across all offers: ' + avgInterval + 'ms');
      Logger.log('[INTERVAL] Waiting before next cycle...');
      
      if (avgInterval > 0) {
        Utilities.sleep(avgInterval);
      }
      
      // Periodically refresh intervals (every 10 cycles)
      if (executionState.cycleNumber % 10 === 0) {
        Logger.log('[REFRESH] Refreshing intervals for all offers...');
        for (var i = 0; i < NORMALIZED_OFFERS.length; i++) {
          getIntervalForOffer(NORMALIZED_OFFERS[i]);
        }
      }
    }

    Logger.log('');
    Logger.log('[RUNTIME COMPLETE] Reached maximum runtime limit');

  } catch (e) {
    Logger.log('[FATAL ERROR] ' + e.toString());
    executionState.errors.push({
      type: 'fatal_error',
      message: e.toString(),
      timestamp: new Date()
    });
  }

  logFinalSummary();
}

// ============================================
// HELPER FUNCTIONS
// ============================================

/**
 * List all enabled campaigns with their IDs
 * Run this once to find Campaign IDs for the CAMPAIGN_IDS array or CAMPAIGN_MAPPING
 */
function listCampaignIds() {
  Logger.log('\\n' + '='.repeat(60));
  Logger.log('CAMPAIGN ID FINDER');
  Logger.log('='.repeat(60));
  
  var campaigns = AdsApp.campaigns()
    .withCondition('Status = ENABLED')
    .get();
  
  var count = 0;
  while (campaigns.hasNext()) {
    var campaign = campaigns.next();
    count++;
    Logger.log(count + '. ' + campaign.getName());
    Logger.log('   ID: ' + campaign.getId());
    Logger.log('   Status: ' + campaign.getStatsFor('LAST_30_DAYS').getClicks() + ' clicks (30d)');
    Logger.log('');
  }
  
  Logger.log('='.repeat(60));
  Logger.log('Total: ' + count + ' enabled campaigns');
  Logger.log('='.repeat(60));
}`,be=`// ============================================
// ADAPTIVE INTERVAL + AUTO-SCHEDULE (V3)
// ============================================
// V3: Same as V2 but with scheduler check/report for central control
// Also sets expected repeat count to 2 (more aggressive speed optimization)
var CURRENT_INTERVAL_MS = 5000; // Default fallback (will be overridden by API)
var ACCOUNT_ID = ''; // Will be set at startup

// Configuration for interval calculation
var SUPABASE_URL = '${r}';
var OFFER_NAME = 'OFFER_NAME';
var DEFAULT_INTERVAL_MS = 5000;
var MIN_INTERVAL_MS = 1000;     // Minimum speed (never go below)
var MAX_INTERVAL_MS = 30000;    // Maximum speed (never go above)

// ============================================
// ACCOUNT ID HELPER
// ============================================
function getAccountId() {
  try {
    return AdsApp.currentAccount().getCustomerId();
  } catch (error) {
    Logger.log(' [ACCOUNT] Failed to get account ID: ' + error);
    return 'unknown';
  }
}

// ============================================
// SCHEDULER INTEGRATION (CHECK + REPORT)
// ============================================
function schedulerCheck() {
  try {
    var url = SUPABASE_URL + '/functions/v1/schedule-script-execution?action=check';
    var payload = {
      offer_name: OFFER_NAME,
      account_id: ACCOUNT_ID,
      client: 'google_ads',
      version: 'v3'
    };
    var options = {
      method: 'post',
      contentType: 'application/json',
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    };
    var response = UrlFetchApp.fetch(url, options);
    if (response.getResponseCode() === 200) {
      var data = JSON.parse(response.getContentText());
      if (data && data.allow === false) {
        Logger.log('[SCHEDULER] Execution denied by controller. Reason: ' + (data.reason || 'unspecified'));
        if (data.next_allowed_at) {
          Logger.log('[SCHEDULER] Next allowed at: ' + data.next_allowed_at);
        }
        return false;
      }
      Logger.log('[SCHEDULER] Execution allowed.');
      return true;
    }
    Logger.log(' [SCHEDULER] Non-200 response, proceeding by default');
  } catch (e) {
    Logger.log(' [SCHEDULER] Check failed (' + e + '), proceeding');
  }
  return true; // default permissive if scheduler unavailable
}

function schedulerReport(summary) {
  try {
    var url = SUPABASE_URL + '/functions/v1/schedule-script-execution?action=report';
    var payload = {
      offer_name: OFFER_NAME,
      account_id: ACCOUNT_ID,
      client: 'google_ads',
      version: 'v3',
      summary: summary || {}
    };
    var options = {
      method: 'post',
      contentType: 'application/json',
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    };
    var response = UrlFetchApp.fetch(url, options);
    Logger.log('[SCHEDULER] Report sent (' + response.getResponseCode() + ')');
  } catch (e) {
    Logger.log(' [SCHEDULER] Report failed: ' + e);
  }
}

// ============================================
// GET YESTERDAY'S LANDING PAGES WITH CLICKS
// ============================================
function getYesterdayLandingPages() {
  try {
    Logger.log('[GOOGLE ADS] Collecting yesterday landing pages via FINAL_URL_REPORT...');
    
    var query = 'SELECT EffectiveFinalUrl, Clicks ' +
                'FROM FINAL_URL_REPORT ' +
                'DURING YESTERDAY';
    
    var report = AdsApp.report(query);
    var rows = report.rows();
    
    var landingPages = {};
    var totalClicks = 0;
    var processedRows = 0;
    
    while (rows.hasNext()) {
      var row = rows.next();
      var url = row['EffectiveFinalUrl'] || '';
      var clicks = parseInt(row['Clicks'], 10) || 0;
      
      if (url && clicks > 0) {
        landingPages[url] = (landingPages[url] || 0) + clicks;
        totalClicks += clicks;
        processedRows++;
      }
    }
    
    var uniquePages = Object.keys(landingPages).length;
    Logger.log('[REPORT] Yesterday results:');
    Logger.log('  Rows processed: ' + processedRows);
    Logger.log('  Unique landing pages: ' + uniquePages);
    Logger.log('  Total clicks: ' + totalClicks);
    
    // Log each landing page and its click count
    for (var url in landingPages) {
      Logger.log('  [LP] URL: ' + url + ' -> ' + landingPages[url] + ' clicks');
    }

    if (uniquePages > 0 && totalClicks > 0) {
      Logger.log('  Sending landing_page_counts to API');
      return landingPages;
    }
    return null;
  } catch (error) {
    Logger.log(' [REPORT] Failed to collect yesterday data: ' + error);
    return null;
  }
}

// ============================================
// CONTINUOUS CAMPAIGN UPDATE CONFIGURATION
// ============================================

// Maximum script runtime before timeout (in milliseconds)
// Google Ads limit is 30 minutes (1800000ms)
// Examples:
// - 1500000 = 25 minutes (recommended - safe buffer)
// - 1680000 = 28 minutes (aggressive - tight buffer)
// - 300000 = 5 minutes (for testing)
var MAX_RUNTIME_MS = 1500000;

// Update mode: "always" or "on_change"
// - "always": Update campaigns every cycle regardless of suffix changes
// - "on_change": Only update campaigns when suffix changes
var UPDATE_MODE = 'on_change';

// ============================================
// CAMPAIGN FILTERING OPTIONS (Choose ONE)
// ============================================

// Option 1: Filter by Campaign IDs (recommended - most precise)
// Array of campaign IDs to update. Leave empty [] to disable.
// Example: ['12345678', '87654321', '11223344']
// To find campaign IDs: Go to Campaigns tab, click on campaign, check URL for campaignId=XXXXXXXXXX
var CAMPAIGN_IDS = [];

// Option 2: Filter by Label (fallback if no IDs specified)
// Empty string = all enabled campaigns
// Example: 'auto-update' or 'offer-campaigns'
var CAMPAIGN_LABEL_FILTER = '';

// Dry run mode: Set to true to test without actually updating campaigns
var DRY_RUN_MODE = false;

// ============================================
// STATE TRACKING
// ============================================
var executionState = {
  startTime: new Date().getTime(),
  lastApiCall: 0,
  lastSuffix: '',
  totalApiCalls: 0,
  totalCampaignsUpdated: 0,
  cycleNumber: 0,
  errors: []
};

// Yesterday's data - calculated ONCE at startup, reused for all API calls
var YESTERDAY_DATA_CACHE = null;
var YESTERDAY_TOTAL_CLICKS = 0;
var YESTERDAY_UNIQUE_PAGES = 0;

// ============================================
// DYNAMIC INTERVAL FETCHING (TARGET REPEATS = 2)
// ============================================
function getCurrentIntervalFromAPI() {
  try {
    // Use cached yesterday data (already calculated at startup)
    var totalClicks = YESTERDAY_TOTAL_CLICKS;
    var uniqueLandingPages = YESTERDAY_UNIQUE_PAGES;
    
    Logger.log('[INTERVAL] Using cached yesterday data: ' + totalClicks + ' clicks, ' + uniqueLandingPages + ' pages (no recalculation)');
    
    if (uniqueLandingPages === 0) {
      Logger.log('[INTERVAL] No landing page data; delegating default to API with constraints. Default=' + DEFAULT_INTERVAL_MS + 'ms');
    }
    
    var accountTimezone = AdsApp.currentAccount().getTimeZone();
    
    // Build URL with offer_name and account_id as query parameters (required by endpoint)
    var url = SUPABASE_URL + '/functions/v1/get-recommended-interval?offer_name=' + encodeURIComponent(OFFER_NAME);
    url += '&account_id=' + encodeURIComponent(ACCOUNT_ID);
    
    // Pass script-level constraints to API (V3 uses target_average_repeats=2 for more aggressive speed)
    var payload = {
      yesterday_total_clicks: totalClicks,
      yesterday_unique_landing_pages: uniqueLandingPages,
      account_timezone: accountTimezone,
      min_interval_ms: MIN_INTERVAL_MS,
      max_interval_ms: MAX_INTERVAL_MS,
      target_average_repeats: 2,
      default_interval_ms: DEFAULT_INTERVAL_MS
    };
    
    var options = {
      method: 'post',
      contentType: 'application/json',
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    };
    
    var response = UrlFetchApp.fetch(url, options);
    var responseCode = response.getResponseCode();
    var responseText = response.getContentText();
    
    if (responseCode === 200) {
      var result = JSON.parse(responseText);
      if (result.recommended_interval_ms) {
        var cacheInfo = result.data_source === 'cache' ? ' (from API daily cache)' : ' (newly calculated)';
        Logger.log('[INTERVAL V3] Fetched: ' + result.recommended_interval_ms + 'ms' + cacheInfo);
        return result.recommended_interval_ms;
      }
    }
    
    Logger.log('[INTERVAL V3] API call failed, using default: ' + DEFAULT_INTERVAL_MS + 'ms');
    return DEFAULT_INTERVAL_MS;
  } catch (error) {
    Logger.log('[INTERVAL V3] Error fetching: ' + error + ', using default: ' + DEFAULT_INTERVAL_MS + 'ms');
    return DEFAULT_INTERVAL_MS;
  }
}

// ============================================
// API CALL FUNCTION
// ============================================
function callGetSuffixAPI(campaignCount, intervalToUse) {
  executionState.totalApiCalls++;
  
  campaignCount = campaignCount || 1;
  intervalToUse = intervalToUse || DEFAULT_INTERVAL_MS;
  
  var url = SUPABASE_URL + '/functions/v1/get-suffix?offer_name=' + encodeURIComponent(OFFER_NAME);
  
  // Add account_id parameter for multi-account support
  url += '&account_id=' + encodeURIComponent(ACCOUNT_ID);
  
  // Add campaign_count parameter for batch requests
  if (campaignCount > 1) {
    url += '&campaign_count=' + campaignCount;
    Logger.log('[API] Requesting ' + campaignCount + ' unique suffixes');
  }
  
  // Pass the interval to track actual speed used
  if (intervalToUse > 0) {
    url += '&interval_used=' + intervalToUse;
  }

  var options = {
    'method': 'get',
    'muteHttpExceptions': true
  };

  var maxRetries = 3;
  var retryCount = 0;

  while (retryCount < maxRetries) {
    try {
      var callStart = new Date().getTime();
      var response = UrlFetchApp.fetch(url, options);
      var callEnd = new Date().getTime();
      var json = JSON.parse(response.getContentText());

      if (json.success) {
        Logger.log('[API SUCCESS] Response time: ' + (callEnd - callStart) + 'ms');
        
        return {
          success: true,
          suffix: json.suffix || '',
          suffixes: json.suffixes || [],
          finalUrl: json.final_url,
          changed: json.suffix !== executionState.lastSuffix,
          timestamp: new Date()
        };
      } else {
        Logger.log('[API ERROR] Invalid response: ' + JSON.stringify(json));
      }
    } catch (e) {
      retryCount++;
      Logger.log('[API ERROR] Attempt ' + retryCount + '/' + maxRetries + ': ' + e.toString());

      if (retryCount < maxRetries) {
        Utilities.sleep(2000 * retryCount);
      } else {
        executionState.errors.push({
          type: 'api_error',
          message: e.toString(),
          timestamp: new Date()
        });
      }
    }
  }

  return {
    success: false,
    error: 'Failed after ' + maxRetries + ' attempts'
  };
}

// ============================================
// CAMPAIGN UPDATE FUNCTION
// ============================================
function updateCampaigns(currentInterval) {
  var campaignSelector;

  // Priority 1: Filter by Campaign IDs if provided
  if (CAMPAIGN_IDS && CAMPAIGN_IDS.length > 0) {
    Logger.log('[FILTER] Using Campaign IDs: ' + CAMPAIGN_IDS.join(', '));
    
    // Build ID filter condition
    var idConditions = [];
    for (var i = 0; i < CAMPAIGN_IDS.length; i++) {
      idConditions.push('Id = ' + CAMPAIGN_IDS[i]);
    }
    var idFilter = '(' + idConditions.join(' OR ') + ')';
    
    campaignSelector = AdsApp.campaigns()
      .withCondition('Status = ENABLED')
      .withCondition(idFilter);
  }
  // Priority 2: Filter by Label if no IDs specified
  else if (CAMPAIGN_LABEL_FILTER && CAMPAIGN_LABEL_FILTER !== '') {
    Logger.log('[FILTER] Using Label: ' + CAMPAIGN_LABEL_FILTER);
    campaignSelector = AdsApp.campaigns()
      .withCondition('Status = ENABLED')
      .withCondition('LabelNames CONTAINS_ANY ["' + CAMPAIGN_LABEL_FILTER + '"]');
  }
  // Priority 3: All enabled campaigns
  else {
    Logger.log('[FILTER] Using all enabled campaigns');
    campaignSelector = AdsApp.campaigns()
      .withCondition('Status = ENABLED');
  }

  // First, count campaigns
  var campaigns = campaignSelector.get();
  var campaignList = [];
  while (campaigns.hasNext()) {
    campaignList.push(campaigns.next());
  }
  
  var campaignCount = campaignList.length;
  Logger.log('[INFO] Found ' + campaignCount + ' campaigns to update');
  
  if (campaignCount === 0) {
    return {
      updated: 0,
      failed: 0,
      skipped: 0,
      apiCalls: 0
    };
  }

  var updatedCount = 0;
  var failedCount = 0;
  var skippedCount = 0;

  // Use the interval passed from main loop (already fetched once per cycle)
  Logger.log('[INTERVAL] Using pre-fetched interval: ' + currentInterval + 'ms');

  if (DRY_RUN_MODE) {
    Logger.log('[DRY RUN] Would call API once for ' + campaignCount + ' campaigns');
    for (var i = 0; i < campaignList.length; i++) {
      Logger.log('[DRY RUN] Would update: ' + campaignList[i].getName() + ' (ID: ' + campaignList[i].getId() + ')');
      skippedCount++;
    }
    return {
      updated: 0,
      failed: 0,
      skipped: skippedCount,
      apiCalls: 0
    };
  }

  // Make SINGLE API call requesting multiple unique suffixes
  Logger.log('[API] Calling API once with campaign_count=' + campaignCount);
  var apiResult = callGetSuffixAPI(campaignCount, currentInterval);
  
  if (!apiResult.success) {
    Logger.log('[API ERROR] Failed to get suffixes: ' + (apiResult.error || 'Unknown error'));
    executionState.errors.push({
      type: 'api_error',
      message: apiResult.error || 'Failed to get suffixes from API',
      timestamp: new Date()
    });
    return {
      updated: 0,
      failed: campaignCount,
      skipped: 0,
      apiCalls: 1
    };
  }
  
  // Get suffixes array (or single suffix for backward compatibility)
  var suffixes = [];
  if (apiResult.suffixes && apiResult.suffixes.length > 0) {
    suffixes = apiResult.suffixes;
    Logger.log('[API] Received ' + suffixes.length + ' unique suffixes');
  } else if (apiResult.suffix) {
    // Backward compatibility: single suffix
    suffixes = [{ suffix: apiResult.suffix }];
    Logger.log('[API] Received single suffix (backward compatibility mode)');
  }
  
  if (suffixes.length === 0) {
    Logger.log('[ERROR] No suffixes received from API');
    return {
      updated: 0,
      failed: campaignCount,
      skipped: 0,
      apiCalls: 1
    };
  }

  // Distribute unique suffixes to campaigns
  for (var i = 0; i < campaignList.length; i++) {
    var campaign = campaignList[i];
    
    // Use suffix from array, or reuse last if we run out
    var suffixIndex = Math.min(i, suffixes.length - 1);
    var suffixData = suffixes[suffixIndex];
    var suffix = suffixData.suffix || suffixData;
    
    try {
      campaign.urls().setFinalUrlSuffix(suffix);
      Logger.log('[UPDATED] ' + campaign.getName() + ' (ID: ' + campaign.getId() + ') with unique suffix #' + (suffixIndex + 1));
      updatedCount++;
      
      // No delay between campaigns for maximum speed
    } catch (e) {
      failedCount++;
      Logger.log('[CAMPAIGN ERROR] Failed to update ' + campaign.getName() + ' (ID: ' + campaign.getId() + '): ' + e.toString());
      executionState.errors.push({
        type: 'campaign_update_error',
        campaign: campaign.getName(),
        campaignId: campaign.getId(),
        message: e.toString(),
        timestamp: new Date()
      });
    }
  }

  executionState.totalCampaignsUpdated += updatedCount;

  return {
    updated: updatedCount,
    failed: failedCount,
    skipped: skippedCount,
    apiCalls: 1
  };
}

// ============================================
// TIME CALCULATION HELPERS
// ============================================
function getElapsedMs() {
  return new Date().getTime() - executionState.startTime;
}

function getRemainingMs() {
  return MAX_RUNTIME_MS - getElapsedMs();
}

function hasEnoughTime() {
  // Run until time is up - no buffer for maximum 30-minute utilization
  return getRemainingMs() > 0;
}

function formatMs(ms) {
  var seconds = Math.floor(ms / 1000);
  var minutes = Math.floor(seconds / 60);
  seconds = seconds % 60;
  return minutes + 'm ' + seconds + 's';
}

// ============================================
// LOGGING FUNCTIONS
// ============================================
function logScriptStart() {
  Logger.log('====================================');
  Logger.log('CONTINUOUS CAMPAIGN UPDATER (V3)');
  Logger.log('====================================');
  Logger.log('Configuration:');
  Logger.log('  Offer Name: ' + OFFER_NAME);
  Logger.log('  Max Runtime: ' + formatMs(MAX_RUNTIME_MS));
  Logger.log('  Update Mode: ' + UPDATE_MODE);
  Logger.log('  Target Repeats: 2 (more aggressive)');
  
  // Show filter method
  if (CAMPAIGN_IDS && CAMPAIGN_IDS.length > 0) {
    Logger.log('  Filter Method: Campaign IDs');
    Logger.log('  Campaign IDs: ' + CAMPAIGN_IDS.join(', '));
  } else if (CAMPAIGN_LABEL_FILTER && CAMPAIGN_LABEL_FILTER !== '') {
    Logger.log('  Filter Method: Campaign Label');
    Logger.log('  Campaign Label: ' + CAMPAIGN_LABEL_FILTER);
  } else {
    Logger.log('  Filter Method: All enabled campaigns');
  }
  
  Logger.log('  Dry Run: ' + (DRY_RUN_MODE ? 'YES' : 'NO'));
  Logger.log('  Note: Interval fetched dynamically from endpoint before each delay');
  Logger.log('====================================');
}

function logCycleStart() {
  executionState.cycleNumber++;
  Logger.log('');
  Logger.log('--- CYCLE #' + executionState.cycleNumber + ' ---');
  Logger.log('Time: ' + new Date().toLocaleString());
  Logger.log('Elapsed: ' + formatMs(getElapsedMs()) + ' / ' + formatMs(MAX_RUNTIME_MS));
  Logger.log('Remaining: ' + formatMs(getRemainingMs()));
}

function logFinalSummary() {
  Logger.log('');
  Logger.log('====================================');
  Logger.log('EXECUTION SUMMARY (V3)');
  Logger.log('====================================');
  Logger.log('Total Runtime: ' + formatMs(getElapsedMs()));
  Logger.log('Total Cycles: ' + executionState.cycleNumber);
  Logger.log('Total API Calls: ' + executionState.totalApiCalls);
  Logger.log('Total Campaigns Updated: ' + executionState.totalCampaignsUpdated);
  Logger.log('Total Errors: ' + executionState.errors.length);

  if (executionState.errors.length > 0) {
    Logger.log('');
    Logger.log('Error Details:');
    for (var i = 0; i < executionState.errors.length; i++) {
      var error = executionState.errors[i];
      Logger.log('  [' + error.type + '] ' + error.message);
    }
  }

  Logger.log('====================================');
  Logger.log('Script finished at: ' + new Date().toLocaleString());
  Logger.log('====================================');
}

// ============================================
// MAIN EXECUTION LOOP (WITH SCHEDULER)
// ============================================
function main() {
  // Set account ID at startup
  ACCOUNT_ID = getAccountId();
  Logger.log('[STARTUP V3] Account ID: ' + ACCOUNT_ID);
  
  // Scheduler check - exit early if denied
  if (!schedulerCheck()) {
    Logger.log('[EXIT] Scheduler denied execution.');
    return;
  }
  
  var startedAt = new Date();
  
  logScriptStart();

  // Calculate yesterday's data ONCE at startup (expensive query)
  Logger.log('[STARTUP] Calculating yesterday\\'s landing page data (one-time calculation)...');
  YESTERDAY_DATA_CACHE = getYesterdayLandingPages();
  
  if (YESTERDAY_DATA_CACHE) {
    YESTERDAY_TOTAL_CLICKS = 0;
    for (var url in YESTERDAY_DATA_CACHE) {
      YESTERDAY_TOTAL_CLICKS += YESTERDAY_DATA_CACHE[url];
    }
    YESTERDAY_UNIQUE_PAGES = Object.keys(YESTERDAY_DATA_CACHE).length;
    Logger.log('[STARTUP] Cached yesterday data: ' + YESTERDAY_TOTAL_CLICKS + ' clicks, ' + YESTERDAY_UNIQUE_PAGES + ' unique pages');
  } else {
    Logger.log('[STARTUP] No yesterday data available, will use defaults');
    YESTERDAY_TOTAL_CLICKS = 0;
    YESTERDAY_UNIQUE_PAGES = 0;
  }

  // Interval is now fetched dynamically from endpoint before each use
  Logger.log('[STARTUP] Interval will be fetched dynamically from endpoint before each delay');

  try {
    while (hasEnoughTime()) {
      logCycleStart();

      // Fetch interval ONCE at the start of each cycle
      Logger.log('[INTERVAL] Fetching interval for this cycle...');
      var cycleInterval = getCurrentIntervalFromAPI();
      Logger.log('[INTERVAL] Using ' + cycleInterval + 'ms for this entire cycle');

      // Update campaigns - each campaign gets a unique suffix from API
      Logger.log('[UPDATE MODE] Calling API once per campaign for unique parameters');
      var updateResult = updateCampaigns(cycleInterval); // Pass interval to avoid re-fetching
      
      // Log cycle results
      Logger.log('[CYCLE COMPLETE]');
      Logger.log('  API Calls This Cycle: ' + updateResult.apiCalls);
      Logger.log('  Campaigns Updated: ' + updateResult.updated);
      Logger.log('  Campaigns Failed: ' + updateResult.failed);
      Logger.log('  Campaigns Skipped: ' + updateResult.skipped);
      
      executionState.totalApiCalls += updateResult.apiCalls;

      // Use the adaptive interval to pace how often the suffix API is called (one call per cycle)
      if (cycleInterval > 0) {
        Logger.log('[INTERVAL] Waiting ' + cycleInterval + 'ms before next cycle');
        Utilities.sleep(cycleInterval);
      }
    }

    Logger.log('');
    Logger.log('[RUNTIME COMPLETE] Reached 30-minute limit');

  } catch (e) {
    Logger.log('[FATAL ERROR] ' + e.toString());
    executionState.errors.push({
      type: 'fatal_error',
      message: e.toString(),
      timestamp: new Date()
    });
  }

  logFinalSummary();
  
  // Report to scheduler
  var finishedAt = new Date();
  schedulerReport({
    started_at: startedAt.toISOString(),
    finished_at: finishedAt.toISOString(),
    total_api_calls: executionState.totalApiCalls,
    total_campaigns_updated: executionState.totalCampaignsUpdated,
    total_campaigns_failed: executionState.errors.length
  });
}

// ============================================
// HELPER FUNCTIONS
// ============================================

/**
 * List all enabled campaigns with their IDs
 * Run this once to find Campaign IDs for the CAMPAIGN_IDS array
 */
function listCampaignIds() {
  Logger.log('\\n' + '='.repeat(60));
  Logger.log('CAMPAIGN ID FINDER');
  Logger.log('='.repeat(60));
  
  var campaigns = AdsApp.campaigns()
    .withCondition('Status = ENABLED')
    .get();
  
  var count = 0;
  while (campaigns.hasNext()) {
    var campaign = campaigns.next();
    count++;
    Logger.log(count + '. ' + campaign.getName());
    Logger.log('   ID: ' + campaign.getId());
    Logger.log('   Status: ' + campaign.getStatsFor('LAST_30_DAYS').getClicks() + ' clicks (30d)');
    Logger.log('');
  }
  
  Logger.log('='.repeat(60));
  Logger.log('Total: ' + count + ' enabled campaigns');
  Logger.log('='.repeat(60));
}
`,je=`${r}/functions/v1/get-suffix?offer_name=OFFER_NAME&redirect=true`,qe=`<script>
(function() {
  // Replace 'OFFER_NAME' with your actual offer name
  var offerName = 'OFFER_NAME';

  var apiUrl = '${r}/functions/v1/get-suffix?offer_name=' + encodeURIComponent(offerName);

  fetch(apiUrl)
    .then(function(response) { return response.json(); })
    .then(function(data) {
      if (data.success && data.suffix) {
        var redirectUrl = data.final_url + '?' + data.suffix;
        window.location.href = redirectUrl;
      } else {
        console.error('Failed to get tracking parameters');
      }
    })
    .catch(function(error) {
      console.error('Error:', error);
    });
})();
<\/script>`,lt=`<!-- Replace 'OFFER_NAME' with your actual offer name -->
<img src="${r}/functions/v1/track-hit-instant?offer=OFFER_NAME" width="1" height="1" style="display:none" />`,fe=`<!-- Replace 'OFFER_NAME' with your actual offer name -->
<a href="${r}/functions/v1/track-hit-instant?offer=OFFER_NAME&redirect=true">
  Click Here
</a>`,gt=`/**
 * WEBHOOK MASTER SCRIPT - ALL-IN-ONE
 * 
 * This single Google Ads script handles everything:
 * 1. Auto-creates campaign mapping on first run (only once per campaign)
 * 2. Continuously polls webhook queue for Trackier conversion webhooks
 * 3. On every webhook: Updates final URL suffix + triggers new traces
 * 4. Once per day: Fetches last 7 days zero-click suffixes and stores in bucket
 * 
 * SETUP INSTRUCTIONS:
 * 1. Go to Google Ads  Tools & Settings  Bulk Actions  Scripts
 * 2. Click "+ New Script" button
 * 3. Name it "WEBHOOK-MASTER"
 * 4. Paste this entire script
 * 5. Update ONLY the OFFER_NAME below (e.g., 'SURFSHARK_US', 'VPN_OFFER')
 *    - SUPABASE_ANON_KEY and PROXY_SERVICE_URL are pre-configured
 * 6. Click "Preview" to test on one campaign first
 * 7. Click "Save" and then "Run"  "Schedule"  Every 30 minutes
 * 
 * WHAT IT DOES:
 * - First run: Creates mappings for ALL enabled campaigns in your account
 * - Ongoing: Polls queue every 2 seconds for webhook-triggered suffix updates
 * - On webhook: Fetches fresh zero-click suffixes, stores them, updates campaign
 */

// ============================================
// CONFIGURATION - UPDATE THESE 3 VALUES
// ============================================

const CONFIG = {
  // 1. YOUR OFFER NAME (REQUIRED)
  OFFER_NAME: 'YOUR_OFFER_NAME_HERE',  // Replace with your offer (e.g., 'SURFSHARK_US')
  
  // 2. SUPABASE ANON KEY (Pre-configured)
  SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmaHVxZW5udHhpcXVycGxlbmpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NjEwNDgsImV4cCI6MjA4MTUzNzA0OH0.pi_6p2H2nuPfJvdT3pHNGpk0BTI3WQKTSzsj8dxQBA8',
  
  // 3. Supabase URL (Pre-configured)
  SUPABASE_URL: '${r}',
  
  // 4. Proxy Service URL (Pre-configured - your EC2 ALB endpoint)
  PROXY_SERVICE_URL: 'http://url-tracker-proxy-alb-1426409269.us-east-1.elb.amazonaws.com',
  
  // Advanced Settings (usually no need to change)
  QUEUE_POLL_INTERVAL_SECONDS: 2,
  MAX_RUNTIME_MINUTES: 28,
  ZERO_CLICK_LOOKBACK_DAYS: 7,
  SUFFIX_UPDATE_LAST_RUN: 'SUFFIX_UPDATE_LAST_RUN_' // PropertiesService key for daily updates
};

// ============================================
// MAIN EXECUTION
// ============================================

function main() {
  Logger.log('=== WEBHOOK MASTER SCRIPT STARTED ===');
  Logger.log('Time: ' + new Date().toISOString());
  Logger.log('Offer: ' + CONFIG.OFFER_NAME);
  
  // Validate configuration
  if (CONFIG.OFFER_NAME === 'YOUR_OFFER_NAME_HERE') {
    Logger.log(' ERROR: Please update OFFER_NAME in CONFIG');
    return;
  }
  
  // Anon key is pre-configured, no validation needed
  
  const accountId = AdsApp.currentAccount().getCustomerId();
  Logger.log('Account ID: ' + accountId);
  
  // Step 1: Ensure all campaign mappings exist (runs once per campaign)
  Logger.log('\\n--- Step 1: Ensuring Campaign Mappings ---');
  ensureAllCampaignMappings(accountId);
  
  // Step 2: Check if daily zero-click fetch is needed
  Logger.log('\\n--- Step 2: Checking Daily Zero-Click Suffix Fetch ---');
  checkAndFetchDailyZeroClickSuffixes(accountId);
  
  // Step 3: Continuous queue polling (webhooks apply suffixes immediately)
  Logger.log('\\n--- Step 3: Starting Queue Polling ---');
  const startTime = new Date().getTime();
  const maxRuntime = CONFIG.MAX_RUNTIME_MINUTES * 60 * 1000;
  
  let cycleCount = 0;
  
  while (true) {
    const elapsed = new Date().getTime() - startTime;
    if (elapsed > maxRuntime) {
      Logger.log(' Max runtime reached. Script will restart automatically.');
      break;
    }
    
    cycleCount++;
    Logger.log('\\nCycle ' + cycleCount + ' - Polling queue...');
    
    // Process webhooks (applies suffix + traces + stores in bucket)
    const processed = processUpdateQueue(accountId);
    
    if (processed > 0) {
      Logger.log(' Processed ' + processed + ' webhooks (applied + traced + stored)');
    }
    
    Utilities.sleep(CONFIG.QUEUE_POLL_INTERVAL_SECONDS * 1000);
  }
  
  Logger.log('\\n=== WEBHOOK MASTER SCRIPT COMPLETED ===');
}

// ============================================
// AUTO-MAPPING FUNCTIONS
// ============================================

function ensureAllCampaignMappings(accountId) {
  try {
    const campaignIterator = AdsApp.campaigns()
      .withCondition('Status = ENABLED')
      .get();
    
    let checkedCount = 0;
    let createdCount = 0;
    
    while (campaignIterator.hasNext()) {
      const campaign = campaignIterator.next();
      const campaignId = campaign.getId().toString();
      const campaignName = campaign.getName();
      
      checkedCount++;
      
      // Check if mapping already exists
      const exists = checkMappingExists(accountId, campaignId);
      
      if (!exists) {
        Logger.log('Creating mapping for: ' + campaignName + ' (ID: ' + campaignId + ')');
        const created = createMapping(accountId, campaignId, campaignName);
        if (created) {
          createdCount++;
        }
      } else {
        Logger.log(' Mapping exists for: ' + campaignName);
      }
    }
    
    Logger.log('\\nMapping Summary:');
    Logger.log('- Campaigns checked: ' + checkedCount);
    Logger.log('- New mappings created: ' + createdCount);
    
  } catch (error) {
    Logger.log(' Error in ensureAllCampaignMappings: ' + error.message);
  }
}

function checkMappingExists(accountId, campaignId) {
  try {
    const url = CONFIG.PROXY_SERVICE_URL + '/api/webhook-campaign/check' +
                '?account_id=' + encodeURIComponent(accountId) +
                '&campaign_id=' + encodeURIComponent(campaignId);
    
    const response = UrlFetchApp.fetch(url, {
      method: 'GET',
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() === 200) {
      const data = JSON.parse(response.getContentText());
      return data.exists === true;
    }
    
    return false;
  } catch (error) {
    Logger.log(' Error checking mapping: ' + error.message);
    return false;
  }
}

function createMapping(accountId, campaignId, campaignName) {
  try {
    const url = CONFIG.PROXY_SERVICE_URL + '/api/webhook-campaign/auto-create';
    
    const payload = {
      accountId: accountId,
      campaignId: campaignId,
      campaignName: campaignName,
      offerName: CONFIG.OFFER_NAME
    };
    
    const response = UrlFetchApp.fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() === 200) {
      const data = JSON.parse(response.getContentText());
      if (data.success) {
        Logger.log(' Mapping created successfully');
        if (data.trackier && data.trackier.webhookUrl) {
          Logger.log(' Trackier Webhook URL: ' + data.trackier.webhookUrl);
          Logger.log('   (Add this to your Trackier campaign S2S postback)');
        }
        return true;
      }
    }
    
    Logger.log(' Failed to create mapping: HTTP ' + response.getResponseCode());
    return false;
    
  } catch (error) {
    Logger.log(' Error creating mapping: ' + error.message);
    return false;
  }
}

// ============================================
// QUEUE PROCESSING FUNCTIONS
// ============================================

function processUpdateQueue(accountId) {
  try {
    const queueItems = fetchPendingQueueItems(accountId);
    
    if (!queueItems || queueItems.length === 0) {
      return 0;
    }
    
    Logger.log('Found ' + queueItems.length + ' pending webhooks');
    
    let processedCount = 0;
    
    for (var i = 0; i < queueItems.length; i++) {
      const item = queueItems[i];
      
      Logger.log('\\nProcessing webhook for campaign: ' + item.campaign_id);
      Logger.log('Webhook suffix (will be traced): ' + item.new_suffix);
      
      markQueueItemProcessing(item.id);
      
      try {
        const mapping = fetchMappingByIds(accountId, item.campaign_id);
        
        if (!mapping || !mapping.mapping_id) {
          markQueueItemFailed(item.id, 'Mapping not found');
          Logger.log(' Mapping not found for campaign');
          continue;
        }
        
        // Step 1: Get next suffix FROM BUCKET (not from webhook!)
        Logger.log('Step 1: Getting next suffix from bucket...');
        const bucketSuffix = getNextSuffixFromBucket(mapping.mapping_id);
        
        if (!bucketSuffix) {
          Logger.log('  No suffixes in bucket. Will trace webhook suffix and store for next time.');
          
          // Trace webhook suffix and store in bucket for future use
          const tracedSuffixes = triggerTraceAndExtractSuffixes(
            item.new_suffix, 
            mapping.campaign_name,
            CONFIG.OFFER_NAME
          );
          
          if (tracedSuffixes && tracedSuffixes.length > 0) {
            const storedCount = storeSuffixesInBucket(mapping.mapping_id, tracedSuffixes);
            Logger.log(' Stored ' + storedCount + ' traced suffixes for future use');
          }
          
          markQueueItemCompleted(item.id);
          processedCount++;
          continue;
        }
        
        Logger.log(' Got suffix from bucket (ID: ' + bucketSuffix.suffix_id + ')');
        
        // Step 2: Apply BUCKET suffix to campaign
        Logger.log('Step 2: Applying bucket suffix to campaign...');
        const applied = applySuffixUpdate(item.campaign_id, bucketSuffix.suffix);
        
        if (!applied) {
          markQueueItemFailed(item.id, 'Failed to apply bucket suffix to campaign');
          Logger.log(' Failed to apply bucket suffix');
          continue;
        }
        
        // Step 3: Mark bucket suffix as used
        Logger.log('Step 3: Marking bucket suffix as used...');
        markBucketSuffixAsUsed(bucketSuffix.suffix_id);
        
        // Step 4: Trace webhook suffix in background and store results
        Logger.log('Step 4: Tracing webhook suffix and storing results...');
        const tracedSuffixes = triggerTraceAndExtractSuffixes(
          item.new_suffix, 
          mapping.campaign_name,
          CONFIG.OFFER_NAME
        );
        
        if (tracedSuffixes && tracedSuffixes.length > 0) {
          Logger.log(' Traced ' + tracedSuffixes.length + ' suffixes from webhook');
          const storedCount = storeSuffixesInBucket(mapping.mapping_id, tracedSuffixes);
          Logger.log(' Stored ' + storedCount + ' new suffixes in bucket');
        } else {
          Logger.log('  No suffixes traced from webhook');
        }
        
        markQueueItemCompleted(item.id);
        processedCount++;
        Logger.log(' Webhook processed: Campaign updated with bucket suffix, webhook suffix traced & stored');
        
      } catch (error) {
        markQueueItemFailed(item.id, error.message);
        Logger.log(' Error processing webhook: ' + error.message);
      }
    }
    
    return processedCount;
    
  } catch (error) {
    Logger.log(' Error in processUpdateQueue: ' + error.message);
    return 0;
  }
}

function fetchPendingQueueItems(accountId) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/webhook_suffix_update_queue' +
                '?account_id=eq.' + accountId +
                '&status=eq.pending' +
                '&order=webhook_received_at.asc' +
                '&limit=10' +
                '&select=*';
    
    const response = UrlFetchApp.fetch(url, {
      method: 'GET',
      headers: {
        'apikey': CONFIG.SUPABASE_ANON_KEY,
        'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY
      },
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() === 200) {
      return JSON.parse(response.getContentText());
    }
    
    return [];
  } catch (error) {
    Logger.log(' Error fetching queue items: ' + error.message);
    return [];
  }
}

function applySuffixUpdate(campaignId, newSuffix) {
  try {
    const campaign = AdsApp.campaigns()
      .withCondition('Id = ' + campaignId)
      .get()
      .next();
    
    if (!campaign) {
      Logger.log(' Campaign not found: ' + campaignId);
      return false;
    }
    
    // Update FINAL URL SUFFIX at CAMPAIGN LEVEL
    const currentSuffix = campaign.urls().getFinalUrlSuffix() || '';
    
    campaign.urls().setFinalUrlSuffix(newSuffix);
    
    Logger.log(' Updated campaign final URL suffix: ' + newSuffix);
    Logger.log('  Old: ' + (currentSuffix || '(none)'));
    Logger.log('  New: ' + newSuffix);
    
    return true;
    
  } catch (error) {
    Logger.log(' Error applying suffix: ' + error.message);
    return false;
  }
}

// ============================================
// BUCKET HELPER FUNCTIONS (SEQUENTIAL)
// ============================================

function getNextSuffixFromBucket(mappingId) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/webhook_suffix_bucket' +
                '?mapping_id=eq.' + mappingId +
                '&is_valid=eq.true' +
                '&times_used=eq.0' +  // Only get unused suffixes
                '&order=id.asc' +  // Sequential order (oldest first)
                '&limit=1' +
                '&select=id,suffix,times_used';
    
    const response = UrlFetchApp.fetch(url, {
      method: 'GET',
      headers: {
        'apikey': CONFIG.SUPABASE_ANON_KEY,
        'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY
      },
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() === 200) {
      const data = JSON.parse(response.getContentText());
      if (data && data.length > 0) {
        return {
          suffix_id: data[0].id,
          suffix: data[0].suffix,
          times_used: data[0].times_used
        };
      }
    }
    
    return null;
  } catch (error) {
    Logger.log(' Error getting next suffix: ' + error.message);
    return null;
  }
}

function markBucketSuffixAsUsed(suffixId) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/rpc/mark_suffix_used';
    
    const payload = {
      p_suffix_id: suffixId
    };
    
    UrlFetchApp.fetch(url, {
      method: 'POST',
      headers: {
        'apikey': CONFIG.SUPABASE_ANON_KEY,
        'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY,
        'Content-Type': 'application/json'
      },
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    });
    
  } catch (error) {
    Logger.log(' Error marking suffix as used: ' + error.message);
  }
}

function storeSingleSuffixInBucket(mappingId, suffix, source) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/webhook_suffix_bucket';
    
    const payload = {
      mapping_id: mappingId,
      suffix: suffix,
      suffix_hash: Utilities.computeDigest(Utilities.DigestAlgorithm.SHA_256, suffix)
        .map(function(byte) {
          return ('0' + (byte & 0xFF).toString(16)).slice(-2);
        }).join(''),
      source: source,
      is_valid: true
    };
    
    const response = UrlFetchApp.fetch(url, {
      method: 'POST',
      headers: {
        'apikey': CONFIG.SUPABASE_ANON_KEY,
        'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY,
        'Content-Type': 'application/json',
        'Prefer': 'return=minimal'
      },
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    });
    
    return response.getResponseCode() === 201;
    
  } catch (error) {
    // Likely duplicate - that's OK
    return true;
  }
}

// ============================================
// TRACE AND EXTRACT SUFFIXES
// ============================================

function fetchOfferTracerConfig(offerName) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/offers' +
                '?name=eq.' + encodeURIComponent(offerName) +
                '&select=tracer_mode,geo_target_country,luna_api_customer_id,luna_api_username,luna_api_password' +
                '&limit=1';
    
    const response = UrlFetchApp.fetch(url, {
      method: 'GET',
      headers: {
        'apikey': CONFIG.SUPABASE_ANON_KEY,
        'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY
      },
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() === 200) {
      const data = JSON.parse(response.getContentText());
      if (data && data.length > 0) {
        return {
          tracerMode: data[0].tracer_mode || 'http_only',
          geoTarget: data[0].geo_target_country || null,
          lunaCustomerId: data[0].luna_api_customer_id || null,
          lunaUsername: data[0].luna_api_username || null,
          lunaPassword: data[0].luna_api_password || null
        };
      }
    }
    
    // Default to http_only if offer not found
    Logger.log('  Offer config not found, using default: http_only');
    return {
      tracerMode: 'http_only',
      geoTarget: null,
      lunaCustomerId: null,
      lunaUsername: null,
      lunaPassword: null
    };
    
  } catch (error) {
    Logger.log('  Error fetching offer config: ' + error.message + ', using http_only');
    return {
      tracerMode: 'http_only',
      geoTarget: null,
      lunaCustomerId: null,
      lunaUsername: null,
      lunaPassword: null
    };
  }
}

function triggerTraceAndExtractSuffixes(suffix, campaignName, offerName) {
  try {
    // Fetch saved tracer configuration for this offer
    Logger.log('Fetching tracer config for offer: ' + offerName);
    const config = fetchOfferTracerConfig(offerName);
    
    Logger.log('Using tracer mode: ' + config.tracerMode);
    if (config.geoTarget) {
      Logger.log('Using geo target: ' + config.geoTarget);
    }
    
    // Build a test URL with the suffix (use a dummy domain)
    const testUrl = 'https://example.com/click?' + suffix;
    
    Logger.log('Tracing URL: ' + testUrl);
    
    const traceUrl = CONFIG.PROXY_SERVICE_URL + '/trace';
    
    const payload = {
      url: testUrl,
      mode: config.tracerMode,
      metadata: {
        source: 'webhook',
        campaign: campaignName,
        offer: offerName
      }
    };
    
    // Add geo target if configured
    if (config.geoTarget) {
      payload.geoTarget = config.geoTarget;
    }
    
    // Add Luna proxy credentials if configured
    if (config.lunaCustomerId && config.lunaUsername && config.lunaPassword) {
      payload.lunaProxy = {
        customerId: config.lunaCustomerId,
        username: config.lunaUsername,
        password: config.lunaPassword
      };
    }
    
    const response = UrlFetchApp.fetch(traceUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() !== 200) {
      Logger.log('  Trace request failed: HTTP ' + response.getResponseCode());
      return [];
    }
    
    const result = JSON.parse(response.getContentText());
    
    if (!result.success || !result.chain || result.chain.length === 0) {
      Logger.log('  No redirect chain found');
      return [];
    }
    
    Logger.log(' Trace complete. Chain length: ' + result.chain.length);
    
    // Extract suffixes from all URLs in the chain
    const suffixes = [];
    
    for (var i = 0; i < result.chain.length; i++) {
      const step = result.chain[i];
      const url = step.url || '';
      
      if (url) {
        const extractedSuffix = extractSuffixFromUrl(url);
        if (extractedSuffix) {
          suffixes.push({
            suffix: extractedSuffix,
            clicks: 0,
            impressions: 0
          });
        }
      }
    }
    
    Logger.log('Extracted ' + suffixes.length + ' unique suffixes from trace');
    
    return suffixes;
    
  } catch (error) {
    Logger.log(' Error tracing URL: ' + error.message);
    return [];
  }
}

// ============================================
// QUEUE STATUS UPDATE FUNCTIONS
// ============================================

function markQueueItemProcessing(itemId) {
  updateQueueItemStatus(itemId, 'processing', null);
}

function markQueueItemCompleted(itemId) {
  updateQueueItemStatus(itemId, 'completed', null);
}

function markQueueItemFailed(itemId, errorMessage) {
  updateQueueItemStatus(itemId, 'failed', errorMessage);
}

function updateQueueItemStatus(itemId, status, errorMessage) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/webhook_suffix_update_queue?id=eq.' + itemId;
    
    const payload = {
      status: status,
      attempts: 1
    };
    
    if (status === 'processing') {
      payload.processing_started_at = new Date().toISOString();
    }
    
    if (status === 'completed') {
      payload.completed_at = new Date().toISOString();
    }
    
    if (errorMessage) {
      payload.error_message = errorMessage;
      payload.last_error_at = new Date().toISOString();
    }
    
    UrlFetchApp.fetch(url, {
      method: 'PATCH',
      headers: {
        'apikey': CONFIG.SUPABASE_ANON_KEY,
        'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY,
        'Content-Type': 'application/json',
        'Prefer': 'return=minimal'
      },
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    });
    
  } catch (error) {
    Logger.log(' Error updating queue status: ' + error.message);
  }
}

// ============================================
// ZERO-CLICK SUFFIX FETCHING
// ============================================

function checkAndFetchDailyZeroClickSuffixes(accountId) {
  try {
    // Get last fetch timestamp from script property
    const scriptProperties = PropertiesService.getScriptProperties();
    const lastFetchKey = 'ZERO_CLICK_LAST_FETCH_' + accountId;
    const lastFetchTimestamp = scriptProperties.getProperty(lastFetchKey);
    const now = new Date().getTime();
    const ONE_DAY_MS = 24 * 60 * 60 * 1000;
    
    // Check if 24 hours have passed since last fetch
    if (lastFetchTimestamp) {
      const timeSinceLastFetch = now - parseInt(lastFetchTimestamp);
      if (timeSinceLastFetch < ONE_DAY_MS) {
        const hoursRemaining = Math.floor((ONE_DAY_MS - timeSinceLastFetch) / (60 * 60 * 1000));
        Logger.log('  Zero-click fetch already done today. Next run in ~' + hoursRemaining + ' hours');
        return;
      }
    }
    
    Logger.log(' Fetching zero-click suffixes for all mappings...');
    
    // Get all mappings for this account
    const mappings = fetchAllMappingsForAccount(accountId);
    
    if (!mappings || mappings.length === 0) {
      Logger.log('  No mappings found for this account');
      return;
    }
    
    let totalFetched = 0;
    
    for (var i = 0; i < mappings.length; i++) {
      const mapping = mappings[i];
      Logger.log('\\nFetching for campaign: ' + mapping.campaign_name + ' (ID: ' + mapping.campaign_id + ')');
      
      // Clean bucket before fetching: delete used suffixes + old zero-click suffixes
      // This keeps only: unused traced suffixes that were never sent to Google
      Logger.log('  Cleaning old bucket data...');
      cleanOldUsedSuffixes(mapping.mapping_id);
      
      // Now fetch fresh zero-click suffixes from Google
      const count = fetchAndStoreZeroClickSuffixes(mapping.campaign_id, mapping.mapping_id);
      totalFetched += count;
    }
    
    Logger.log('\\n Daily zero-click fetch complete. Total suffixes stored: ' + totalFetched);
    
    // Update last fetch timestamp
    scriptProperties.setProperty(lastFetchKey, now.toString());
    
  } catch (error) {
    Logger.log(' Error in daily zero-click fetch: ' + error.message);
  }
}

// ============================================
// DAILY SEQUENTIAL SUFFIX UPDATE
// ============================================

function checkAndUpdateSuffixesDaily(accountId) {
  try {
    // Get last update timestamp from script property
    const scriptProperties = PropertiesService.getScriptProperties();
    const lastUpdateKey = CONFIG.SUFFIX_UPDATE_LAST_RUN + accountId;
    const lastUpdateTimestamp = scriptProperties.getProperty(lastUpdateKey);
    const now = new Date().getTime();
    const ONE_DAY_MS = 24 * 60 * 60 * 1000;
    
    // Check if 24 hours have passed since last update
    if (lastUpdateTimestamp) {
      const timeSinceLastUpdate = now - parseInt(lastUpdateTimestamp);
      if (timeSinceLastUpdate < ONE_DAY_MS) {
        const hoursRemaining = Math.floor((ONE_DAY_MS - timeSinceLastUpdate) / (60 * 60 * 1000));
        Logger.log('  Sequential suffix update already done today. Next run in ~' + hoursRemaining + ' hours');
        return;
      }
    }
    
    Logger.log(' Running daily sequential suffix update...');
    
    // Update suffixes sequentially and clean old/used ones
    updateCampaignSuffixesSequentially(accountId);
    
    // Update last update timestamp
    scriptProperties.setProperty(lastUpdateKey, now.toString());
    
  } catch (error) {
    Logger.log(' Error in daily suffix update: ' + error.message);
  }
}

function updateCampaignSuffixesSequentially(accountId) {
  try {
    const mappings = fetchAllMappingsForAccount(accountId);
    
    if (!mappings || mappings.length === 0) {
      Logger.log('  No active mappings to update');
      return;
    }
    
    let updatedCount = 0;
    
    for (var i = 0; i < mappings.length; i++) {
      const mapping = mappings[i];
      
      // Get next unused suffix from bucket (sequential order)
      const nextSuffix = getNextSuffixFromBucket(mapping.mapping_id);
      
      if (nextSuffix) {
        Logger.log('\\nUpdating suffix for: ' + mapping.campaign_name);
        Logger.log('  Suffix: ' + nextSuffix.suffix);
        Logger.log('  Sequential ID: ' + nextSuffix.suffix_id);
        
        const success = applySuffixUpdate(mapping.campaign_id, nextSuffix.suffix);
        
        if (success) {
          markBucketSuffixAsUsed(nextSuffix.suffix_id);
          updatedCount++;
        }
      } else {
        Logger.log('  No unused suffixes in bucket for: ' + mapping.campaign_name);
      }
    }
    
    Logger.log('\\n Sequential update complete. Updated ' + updatedCount + ' campaigns');
    
  } catch (error) {
    Logger.log(' Error in sequential suffix update: ' + error.message);
  }
}

// ============================================
// AUTOMATIC CLEANUP (USED + OLD ZERO-CLICK)
// ============================================

function cleanOldUsedSuffixes(mappingId) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/rpc/clean_old_used_suffixes';
    
    const payload = {
      p_mapping_id: mappingId
    };
    
    const response = UrlFetchApp.fetch(url, {
      method: 'POST',
      headers: {
        'apikey': CONFIG.SUPABASE_ANON_KEY,
        'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY,
        'Content-Type': 'application/json'
      },
      payload: JSON.stringify(payload),
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() === 200) {
      const data = JSON.parse(response.getContentText());
      if (data && data.length > 0 && data[0].deleted_count > 0) {
        Logger.log('   Cleaned ' + data[0].deleted_count + ' suffixes (used + old zero-click)');
      }
    }
    
  } catch (error) {
    Logger.log(' Error cleaning bucket: ' + error.message);
  }
}

function fetchAllMappingsForAccount(accountId) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/webhook_campaign_mappings' +
                '?account_id=eq.' + accountId +
                '&is_active=eq.true' +
                '&select=*';
    
    const response = UrlFetchApp.fetch(url, {
      method: 'GET',
      headers: {
        'apikey': CONFIG.SUPABASE_ANON_KEY,
        'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY
      },
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() === 200) {
      return JSON.parse(response.getContentText());
    }
    
    return [];
  } catch (error) {
    Logger.log(' Error fetching mappings: ' + error.message);
    return [];
  }
}

function fetchAndStoreZeroClickSuffixes(campaignId, mappingId) {
  try {
    // Fetch ALL zero-click suffixes from last 7 days
    const lookbackDays = CONFIG.ZERO_CLICK_LOOKBACK_DAYS;
    const startDate = new Date();
    startDate.setDate(startDate.getDate() - lookbackDays);
    const dateString = Utilities.formatDate(startDate, AdsApp.currentAccount().getTimeZone(), 'yyyyMMdd');
    
    const query = 'SELECT EffectiveFinalUrl, Clicks, Impressions ' +
                  'FROM FINAL_URL_REPORT ' +
                  'WHERE CampaignId = ' + campaignId + ' ' +
                  'AND Clicks = 0 ' +
                  'AND Impressions > 0 ' +
                  'DURING ' + dateString + ',' + Utilities.formatDate(new Date(), AdsApp.currentAccount().getTimeZone(), 'yyyyMMdd');
    
    const report = AdsApp.report(query);
    const rows = report.rows();
    
    const suffixes = [];
    while (rows.hasNext()) {
      const row = rows.next();
      const finalUrl = row['EffectiveFinalUrl'] || row['FinalUrls'] || '';
      const clicks = parseInt(row['Clicks']);
      const impressions = parseInt(row['Impressions']);
      
      if (finalUrl && clicks === 0 && impressions > 0) {
        const suffix = extractSuffixFromUrl(finalUrl);
        if (suffix) {
          suffixes.push({
            suffix: suffix,
            clicks: clicks,
            impressions: impressions
          });
        }
      }
    }
    
    Logger.log('Found ' + suffixes.length + ' zero-click suffixes');
    
    if (suffixes.length > 0) {
      return storeSuffixesInBucket(mappingId, suffixes);
    }
    
    return 0;
    
  } catch (error) {
    Logger.log(' Error fetching zero-click suffixes: ' + error.message);
    return 0;
  }
}

function extractSuffixFromUrl(url) {
  try {
    if (!url || url.indexOf('?') === -1) {
      return null;
    }
    
    const parts = url.split('?');
    if (parts.length < 2) {
      return null;
    }
    
    return parts[1];
  } catch (error) {
    return null;
  }
}

function storeSuffixesInBucket(mappingId, suffixes) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/webhook_suffix_bucket';
    
    let storedCount = 0;
    
    for (var i = 0; i < suffixes.length; i++) {
      const item = suffixes[i];
      
      const payload = {
        mapping_id: mappingId,
        suffix: item.suffix,
        suffix_hash: Utilities.computeDigest(Utilities.DigestAlgorithm.SHA_256, item.suffix)
          .map(function(byte) {
            return ('0' + (byte & 0xFF).toString(16)).slice(-2);
          }).join(''),
        original_clicks: item.clicks,
        original_impressions: item.impressions,
        source: 'zero_click',
        is_valid: true
      };
      
      try {
        const response = UrlFetchApp.fetch(url, {
          method: 'POST',
          headers: {
            'apikey': CONFIG.SUPABASE_ANON_KEY,
            'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY,
            'Content-Type': 'application/json',
            'Prefer': 'return=minimal'
          },
          payload: JSON.stringify(payload),
          muteHttpExceptions: true
        });
        
        if (response.getResponseCode() === 201) {
          storedCount++;
        }
      } catch (error) {
        // Likely duplicate - skip
      }
    }
    
    return storedCount;
  } catch (error) {
    Logger.log(' Error storing suffixes: ' + error.message);
    return 0;
  }
}

// ============================================
// HELPER FUNCTIONS
// ============================================

function fetchMappingByIds(accountId, campaignId) {
  try {
    const url = CONFIG.SUPABASE_URL + '/rest/v1/webhook_campaign_mappings' +
                '?account_id=eq.' + accountId +
                '&campaign_id=eq.' + campaignId +
                '&select=*' +
                '&limit=1';
    
    const response = UrlFetchApp.fetch(url, {
      method: 'GET',
      headers: {
        'apikey': CONFIG.SUPABASE_ANON_KEY,
        'Authorization': 'Bearer ' + CONFIG.SUPABASE_ANON_KEY
      },
      muteHttpExceptions: true
    });
    
    if (response.getResponseCode() === 200) {
      const data = JSON.parse(response.getContentText());
      if (data && data.length > 0) {
        return data[0];
      }
    }
    
    return null;
  } catch (error) {
    Logger.log(' Error fetching mapping: ' + error.message);
    return null;
  }
}`,wt=`# Get Suffix (with redirect)
curl "${r}/functions/v1/get-suffix?offer_name=OFFER_NAME&redirect=true"

# Track Hit Instant (with instant redirect - RECOMMENDED)
curl "${r}/functions/v1/track-hit-instant?offer=OFFER_NAME&redirect=true"

# Trace Redirects (via EC2 Proxy Service)
# Note: Configure VITE_EC2_PROXY_URL in .env first
curl -X POST "http://YOUR_EC2_IP:3000/trace" \\
  -H "Content-Type: application/json" \\
  -d '{
    "url": "https://example.com/tracking-url",
    "max_redirects": 20,
    "timeout_ms": 60000
  }'`;return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-50",children:"Integration Scripts"}),a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400 mt-1",children:"Ready-to-use scripts for Google Ads, landing pages, and tracking. Replace 'OFFER_NAME' with your actual offer name."})]}),a.jsxs("div",{className:"bg-gradient-to-r from-brand-50 to-brand-100 dark:from-brand-900/20 dark:to-brand-800/20 border border-brand-200 dark:border-brand-800 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(dl,{className:"text-brand-600 dark:text-brand-400",size:24}),a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Test Redirect Tracer"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Tracer Mode"}),a.jsxs("select",{value:i,onChange:M=>l(M.target.value),className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth",children:[a.jsx("option",{value:"http_only",children:"HTTP-Only (Fast, 2-5s) - Recommended for testing"}),a.jsx("option",{value:"browser",children:"Browser (Complex, 10-30s) - Full JS + Popups"}),a.jsx("option",{value:"anti_cloaking",children:"Anti-Cloaking (Advanced, 15-60s) - Stealth mode"}),a.jsx("option",{value:"interactive",children:"Interactive (Engagement, 20-40s) - Session engagement"}),a.jsx("option",{value:"brightdata_browser",children:"Bright Data Browser (5-15s) - Premium proxy, minimal bandwidth"})]}),a.jsxs("div",{className:"mt-2 space-y-1 text-xs text-neutral-600 dark:text-neutral-400",children:[a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-success-700 dark:text-success-400",children:"HTTP-Only:"}),a.jsx("span",{children:"Simple redirect following. Fast and efficient."})]}),a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-warning-700 dark:text-warning-400",children:"Browser:"}),a.jsx("span",{children:"Full JavaScript execution with popup tracking."})]}),a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-brand-700 dark:text-brand-400",children:"Anti-Cloaking:"}),a.jsx("span",{children:"Bypasses bot detection, decodes obfuscation, tracks popups."})]}),a.jsxs("p",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"font-semibold text-purple-700 dark:text-purple-400",children:"Bright Data Browser:"}),a.jsx("span",{children:"Premium residential proxy with browser automation, minimal bandwidth usage."})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"URL to Trace"}),a.jsx("input",{type:"text",value:n,onChange:M=>s(M.target.value),placeholder:"https://example.com",className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth placeholder-neutral-400 dark:placeholder-neutral-500"}),a.jsx("p",{className:"mt-2 text-xs text-neutral-600 dark:text-neutral-400",children:"Luna Proxy will be automatically used if credentials are configured in Settings"})]}),a.jsx("button",{onClick:N,disabled:o||!n,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth disabled:opacity-50 disabled:cursor-not-allowed",children:o?a.jsxs(a.Fragment,{children:[a.jsx(__,{size:18,className:"animate-spin"}),"Tracing..."]}):a.jsxs(a.Fragment,{children:[a.jsx(dl,{size:18}),"Trace Redirects"]})}),d&&a.jsx("div",{className:`mt-4 p-4 rounded-lg ${d.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:d.success?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"font-medium text-green-900",children:"Success!"}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("span",{className:"text-green-700",children:[d.total_steps," steps in ",d.total_timing_ms,"ms"]}),d.bandwidth_bytes&&a.jsxs("span",{className:"text-green-700 text-xs",children:[" ",d.bandwidth_bytes.toLocaleString()," B"]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[d.mode_used&&a.jsxs("div",{children:[a.jsx("span",{className:"text-green-700 font-medium",children:"Mode Used:"}),a.jsx("span",{className:`ml-2 px-2 py-0.5 rounded font-semibold ${d.mode_used==="http_only"?"bg-green-100 text-green-800":d.mode_used==="browser"?"bg-orange-100 text-orange-800":"bg-purple-100 text-purple-800"}`,children:d.mode_used})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-green-700 font-medium",children:"Proxy Used:"}),a.jsx("span",{className:"ml-2 text-green-900",children:d.proxy_used?"Yes":"No"})]}),d.proxy_ip&&a.jsxs("div",{children:[a.jsx("span",{className:"text-green-700 font-medium",children:"Proxy IP:"}),a.jsx("span",{className:"ml-2 text-green-900",children:d.proxy_ip})]}),((De=d.geo_location)==null?void 0:De.country)&&a.jsxs("div",{children:[a.jsx("span",{className:"text-green-700 font-medium",children:"Location:"}),a.jsxs("span",{className:"ml-2 text-green-900",children:[d.geo_location.city,", ",d.geo_location.country]})]}),d.total_popups>0&&a.jsxs("div",{children:[a.jsx("span",{className:"text-green-700 font-medium",children:"Popups Detected:"}),a.jsx("span",{className:"ml-2 text-green-900",children:d.total_popups})]}),d.aggressiveness_level&&a.jsxs("div",{children:[a.jsx("span",{className:"text-green-700 font-medium",children:"Aggressiveness:"}),a.jsx("span",{className:"ml-2 text-green-900",children:d.aggressiveness_level})]})]}),d.cloaking_indicators&&d.cloaking_indicators.length>0&&a.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded p-2",children:[a.jsx("p",{className:"text-xs font-semibold text-orange-900 mb-1",children:" Cloaking Indicators Detected:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:d.cloaking_indicators.map((M,oe)=>a.jsx("span",{className:"text-xs px-2 py-0.5 bg-orange-100 text-orange-800 rounded",children:M},oe))})]}),a.jsxs("div",{className:"border-t border-green-200 pt-3",children:[a.jsx("p",{className:"text-xs font-medium text-green-700 mb-2",children:"Redirect Chain:"}),a.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:(nt=d.chain)==null?void 0:nt.map((M,oe)=>a.jsxs("div",{className:"bg-white p-2 rounded text-xs",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"font-mono text-green-700",children:["#",oe+1]}),a.jsx("span",{className:`px-2 py-0.5 rounded ${M.status>=200&&M.status<300?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:M.status}),a.jsx("span",{className:"text-gray-600",children:M.redirect_type})]}),a.jsx("div",{className:"mt-1 text-gray-700 truncate",children:M.url}),M.timing_ms&&a.jsxs("div",{className:"text-gray-500 mt-1",children:[M.timing_ms,"ms"]})]},oe))})]}),d.popup_chains&&d.popup_chains.length>0&&a.jsxs("div",{className:"border-t border-green-200 pt-3",children:[a.jsxs("p",{className:"text-xs font-medium text-green-700 mb-2",children:[" Popup Windows (",d.popup_chains.length,"):"]}),a.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:d.popup_chains.map((M,oe)=>a.jsxs("div",{className:"bg-purple-50 border border-purple-200 p-2 rounded text-xs",children:[a.jsxs("div",{className:"font-semibold text-purple-900 mb-1",children:["Popup #",M.popup_index]}),a.jsxs("div",{className:"text-gray-700",children:[a.jsx("span",{className:"font-medium",children:"From:"})," ",a.jsx("span",{className:"truncate block",children:M.opener_url})]}),a.jsxs("div",{className:"text-gray-700 mt-1",children:[a.jsx("span",{className:"font-medium",children:"Final:"})," ",a.jsx("span",{className:"truncate block",children:M.final_url})]}),M.chain&&M.chain.length>0&&a.jsxs("div",{className:"mt-1 text-gray-600",children:[M.chain.length," redirect step",M.chain.length!==1?"s":""," inside popup"]})]},oe))})]}),d.obfuscated_urls&&d.obfuscated_urls.length>0&&a.jsxs("div",{className:"border-t border-green-200 pt-3",children:[a.jsxs("p",{className:"text-xs font-medium text-green-700 mb-2",children:[" Obfuscated URLs Found (",d.obfuscated_urls.length,"):"]}),a.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:d.obfuscated_urls.map((M,oe)=>a.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-2 rounded text-xs",children:[a.jsxs("div",{className:"font-semibold text-yellow-900 mb-1",children:["Type: ",M.type]}),M.encoded&&a.jsxs("div",{className:"text-gray-600 truncate",children:[a.jsx("span",{className:"font-medium",children:"Encoded:"})," ",M.encoded]}),M.decoded&&a.jsxs("div",{className:"text-gray-700 truncate mt-1",children:[a.jsx("span",{className:"font-medium",children:"Decoded:"})," ",M.decoded]}),M.url&&a.jsxs("div",{className:"text-gray-700 truncate mt-1",children:[a.jsx("span",{className:"font-medium",children:"URL:"})," ",M.url]})]},oe))})]})]}):a.jsxs("div",{className:"text-sm text-red-900",children:[a.jsx("p",{className:"font-medium",children:"Error:"}),a.jsx("p",{children:d.error})]})})]})]}),a.jsx("div",{className:"bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800 rounded-lg p-4",children:a.jsxs("p",{className:"text-sm text-brand-900 dark:text-brand-300",children:[a.jsx("strong",{children:"Important:"})," Replace 'OFFER_NAME' in all scripts with your actual offer name from the Offers page. The scripts will fetch fresh parameters on each call."]})}),a.jsxs("div",{className:"grid gap-6",children:[a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-indigo-200 dark:border-indigo-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 px-6 py-4 border-b border-indigo-200 dark:border-indigo-800",children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Script Scheduler Control"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Pause/resume and set minimum interval (seconds) per offer/account"})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Offer Name"}),a.jsx("input",{value:h,onChange:M=>p(M.target.value),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Account ID"}),a.jsx("input",{value:v,onChange:M=>g(M.target.value),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 items-end",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Min Interval (seconds)"}),a.jsx("input",{type:"number",min:60,step:60,value:k,onChange:M=>b(Number(M.target.value)),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850"})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{id:"pauseToggle",type:"checkbox",checked:m,onChange:M=>x(M.target.checked)}),a.jsx("label",{htmlFor:"pauseToggle",className:"text-sm text-neutral-800 dark:text-neutral-200",children:"Pause execution"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{id:"autoScheduleToggle",type:"checkbox",checked:f,onChange:M=>j(M.target.checked)}),a.jsx("label",{htmlFor:"autoScheduleToggle",className:"text-sm text-neutral-800 dark:text-neutral-200",children:"Auto-schedule (24/7)"})]})]}),a.jsxs("div",{className:"flex gap-2 justify-end",children:[a.jsx("button",{onClick:_,disabled:C,className:"px-3 py-2 text-sm rounded bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600",children:C?"Loading":"Load"}),a.jsx("button",{onClick:D,disabled:C,className:"px-3 py-2 text-sm rounded bg-indigo-600 text-white hover:bg-indigo-700",children:C?"Saving":"Save"})]})]}),T&&a.jsxs("div",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:[a.jsx("strong",{children:"Next Run:"})," ",new Date(T).toLocaleString()]}),Q&&a.jsx("div",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:Q}),a.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Auto-schedule (24/7):"})," When enabled, script automatically calculates next run = start time + min interval (e.g., starts at 10:00, next at 10:30)."]}),a.jsxs("p",{children:[a.jsx("strong",{children:"How to use:"})," Set Google Ads trigger to run every 5-10 minutes. Scheduler will allow execution only at calculated times."]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-indigo-200 dark:border-indigo-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 px-6 py-4 border-b border-indigo-200 dark:border-indigo-800",children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Script Execution Status"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Recent runs for the selected offer/account"})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:q,disabled:pe,className:"px-3 py-2 text-sm rounded bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600",children:pe?"Loading":"Refresh"}),me&&a.jsx("div",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:me})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left border-b border-neutral-200 dark:border-neutral-800",children:[a.jsx("th",{className:"py-2 pr-4",children:"Started"}),a.jsx("th",{className:"py-2 pr-4",children:"Finished"}),a.jsx("th",{className:"py-2 pr-4",children:"Client"}),a.jsx("th",{className:"py-2 pr-4",children:"Version"}),a.jsx("th",{className:"py-2 pr-4",children:"API Calls"}),a.jsx("th",{className:"py-2 pr-4",children:"Updated"}),a.jsx("th",{className:"py-2 pr-4",children:"Failed"})]})}),a.jsx("tbody",{children:ne.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"py-3 text-neutral-600 dark:text-neutral-400",children:"No runs yet"})}):ne.map((M,oe)=>a.jsxs("tr",{className:"border-b border-neutral-200 dark:border-neutral-800",children:[a.jsx("td",{className:"py-2 pr-4",children:M.started_at?new Date(M.started_at).toLocaleString():"-"}),a.jsx("td",{className:"py-2 pr-4",children:M.finished_at?new Date(M.finished_at).toLocaleString():"-"}),a.jsx("td",{className:"py-2 pr-4",children:M.client||"-"}),a.jsx("td",{className:"py-2 pr-4",children:M.version||"-"}),a.jsx("td",{className:"py-2 pr-4",children:M.total_api_calls??"-"}),a.jsx("td",{className:"py-2 pr-4",children:M.total_campaigns_updated??"-"}),a.jsx("td",{className:"py-2 pr-4",children:M.total_campaigns_failed??"-"})]},M.id||oe))})]})})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(mi,{className:"text-emerald-600 dark:text-emerald-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Webhook Master Script (All-in-One) "}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Single script that auto-creates mappings + polls webhooks + fetches zero-click suffixes + updates campaigns"})]})]}),a.jsx("button",{onClick:()=>V(gt,"webhook-master"),className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 dark:bg-emerald-500 text-white rounded-lg hover:bg-emerald-700 dark:hover:bg-emerald-600 transition-smooth",children:e==="webhook-master"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:20}),a.jsx("span",{children:"Copied!"})]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:20}),a.jsx("span",{children:"Copy Script"})]})})]}),a.jsx("div",{className:"px-6 py-4",children:a.jsx("pre",{className:"bg-neutral-50 dark:bg-neutral-950 p-4 rounded-lg overflow-x-auto text-sm border border-neutral-200 dark:border-neutral-800",children:a.jsx("code",{className:"text-neutral-800 dark:text-neutral-200",children:gt})})})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-brand-200 dark:border-brand-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-gradient-to-r from-brand-50 to-orange-50 dark:from-brand-900/20 dark:to-orange-900/20 px-6 py-4 border-b border-brand-200 dark:border-brand-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Xa,{className:"text-brand-600 dark:text-brand-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Google Ads Script (V5 Webhook All-In) "}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Single webhook per offer, offer+account controls, queue + bucket + zero-click fallback, daily stats cache"})]})]}),a.jsx("button",{onClick:()=>V(F,"google-ads-v5"),className:"flex items-center gap-2 px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth",children:e==="google-ads-v5"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:18}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:18}),"Copy"]})})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{className:"bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-brand-900 dark:text-brand-300 mb-2",children:" V5 Flow"}),a.jsxs("div",{className:"text-sm text-brand-800 dark:text-brand-300 space-y-1",children:[a.jsx("p",{children:"1) Polls webhook queue (offer + account scoped) then updates matching campaigns."}),a.jsx("p",{children:"2) Falls back to bucket (zero-click + traced) when queue is empty."}),a.jsx("p",{children:"3) Marks used suffix IDs and re-stores suffixes to bucket for inventory."}),a.jsx("p",{children:"4) Caches yesterday landing page stats to avoid repeated report fetch."})]})]}),a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto max-h-96",children:F})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Xa,{className:"text-neutral-600 dark:text-neutral-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Google Ads Script (Baseline - Constant Delay)"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Fallback option: Simple script with fixed delay (5 seconds) - use if adaptive script fails"})]})]}),a.jsx("button",{onClick:()=>V(B,"google-ads"),className:"flex items-center gap-2 px-4 py-2 bg-neutral-600 dark:bg-neutral-500 text-white rounded-lg hover:bg-neutral-700 dark:hover:bg-neutral-600 transition-smooth",children:e==="google-ads"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:18}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:18}),"Copy"]})})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:" When to Use This Script"}),a.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-400 space-y-2",children:[a.jsx("p",{children:"Use this baseline script if:"}),a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsx("li",{children:"The adaptive script (below) fails or encounters errors"}),a.jsx("li",{children:"You want a simple, predictable constant delay"}),a.jsx("li",{children:"You're testing and want no dynamic interval calculation"}),a.jsx("li",{children:"You don't have data history yet (fresh offer)"})]})]})]}),a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto max-h-96",children:B}),a.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-warning-900 dark:text-warning-300 mb-2",children:" Rate Control Configuration"}),a.jsxs("div",{className:"text-sm text-warning-800 dark:text-warning-400 space-y-2",children:[a.jsxs("p",{children:["The ",a.jsx("code",{className:"bg-warning-100 dark:bg-warning-900/30 px-1 py-0.5 rounded",children:"DELAY_MS"})," variable controls how fast the script calls your API endpoint."]}),a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"0 ms"})," - No delay (fastest, for testing)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"1000 ms"})," - 1 second between calls (60 calls/min)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"2000 ms"})," - 2 seconds between calls (30 calls/min)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"5000 ms"})," - 5 seconds between calls (12 calls/min, default)"]})]}),a.jsx("p",{className:"pt-1",children:"Adjust based on your API limits and campaign requirements. Higher delays = slower API calls = lower server load."})]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-success-200 dark:border-success-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-gradient-to-r from-success-50 to-emerald-50 dark:from-success-900/20 dark:to-emerald-900/20 px-6 py-4 border-b border-success-200 dark:border-success-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Xa,{className:"text-success-600 dark:text-success-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Google Ads Script (Adaptive V2 - Multi-Account) "}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"RECOMMENDED: Script collects & sends real landing page data with multi-account support for superior accuracy"})]})]}),a.jsx("button",{onClick:()=>V(U,"google-ads-scheduled"),className:"flex items-center gap-2 px-4 py-2 bg-success-600 dark:bg-success-500 text-white rounded-lg hover:bg-success-700 dark:hover:bg-success-600 transition-smooth",children:e==="google-ads-scheduled"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:18}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:18}),"Copy"]})})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{className:"bg-success-50 dark:bg-success-900/20 border border-success-300 dark:border-success-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-success-900 dark:text-success-300 mb-2",children:" How Adaptive V2 Works (Better!)"}),a.jsxs("div",{className:"text-sm text-success-800 dark:text-success-400 space-y-2",children:[a.jsx("p",{className:"font-semibold",children:"Yesterday's Performance Data:"}),a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"Historical Data:"})," Queries yesterday's AD_PERFORMANCE_REPORT for expanded landing pages"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Click Aggregation:"})," Groups clicks by landing page URL (sums duplicates)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Formula:"})," next_interval = previous_interval  (5 / max_duplicates)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Example Evolution:"})," Day1 5000ms  15 dup  1666ms  10 dup  833ms  6 dup  694ms  5 dup (stabilizes)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Multi-Account:"})," Uses account_id to track multiple accounts running same offer"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Daily Update:"})," Recalculates each morning using previous day's performance"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Result:"})," Adaptive interval based on yesterday's actual click distribution!"]})]}),a.jsx("p",{className:"pt-2 font-semibold text-success-900 dark:text-success-300",children:" Uses AD_PERFORMANCE_REPORT - real yesterday's data with click metrics!"})]})]}),a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto max-h-96",children:U}),a.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-warning-900 dark:text-warning-300 mb-3",children:" Configuration Variables"}),a.jsxs("div",{className:"text-sm text-warning-800 dark:text-warning-400 space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"OFFER_NAME"}),a.jsx("p",{className:"ml-4",children:"Your offer name (required)"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"MAX_RUNTIME_MS"}),a.jsx("p",{className:"ml-4",children:"How often to call API in milliseconds (default: 300000 = 5 minutes)"}),a.jsx("p",{className:"ml-4 text-xs mt-1",children:"Examples: 60000=1m, 300000=5m, 600000=10m, 900000=15m"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"MAX_RUNTIME_MS"}),a.jsx("p",{className:"ml-4",children:"Maximum runtime in milliseconds (default: 1500000 = 25 minutes)"}),a.jsx("p",{className:"ml-4 text-xs mt-1",children:"Examples: 300000=5m, 1500000=25m, 1680000=28m"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"UPDATE_MODE"}),a.jsx("p",{className:"ml-4",children:'"always" = Update every cycle | "on_change" = Only when suffix changes'})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"CAMPAIGN_LABEL_FILTER"}),a.jsx("p",{className:"ml-4",children:"Optional: Filter campaigns by label (empty = all campaigns)"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"DRY_RUN_MODE"}),a.jsx("p",{className:"ml-4",children:"Set to true to test without actually updating campaigns"})]}),a.jsxs("div",{className:"bg-success-100 dark:bg-success-900/30 rounded p-2",children:[a.jsx("p",{className:"font-semibold text-success-900 dark:text-success-200",children:" Smart Delay Calculation"}),a.jsxs("p",{className:"ml-4 text-xs mt-1 text-success-900 dark:text-success-300",children:["Script calculates: ",a.jsx("code",{children:"max(1000, min(30000, yesterday_interval  (5 / max_duplicates)))"})]}),a.jsx("p",{className:"ml-4 text-xs mt-1 text-success-900 dark:text-success-300",children:"Constraint: Between 1000ms (never overload) and 30000ms (max cap)"})]})]})]}),a.jsxs("div",{className:"bg-success-50 dark:bg-success-900/20 border border-success-200 dark:border-success-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-success-900 dark:text-success-300 mb-2",children:" Expected Performance"}),a.jsxs("div",{className:"text-sm text-success-800 dark:text-success-400 space-y-2",children:[a.jsx("p",{children:"With default settings (MAX_RUNTIME_MS = 1500000):"}),a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"~5 API calls"})," during single execution (5 min intervals over 25 min)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"~5 campaign updates"})," with dynamic intervals"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Automatic data collection:"})," Each API call records the interval used"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Daily optimization:"})," Tomorrow's interval recalculated from today's data"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Detailed logs:"})," Shows actual interval used, API response times, campaign updates"]})]}),a.jsx("p",{className:"pt-2",children:"Schedule this script every 30 minutes in Google Ads for continuous optimization!"})]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-purple-200 dark:border-purple-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 px-6 py-4 border-b border-purple-200 dark:border-purple-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Xa,{className:"text-purple-600 dark:text-purple-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Google Ads Script (Multi-Offer V4) "}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"NEW: Multiple offers with flexible campaign mapping - manual or automatic distribution"})]})]}),a.jsx("button",{onClick:()=>V(H,"google-ads-v4"),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 dark:bg-purple-500 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 transition-smooth",children:e==="google-ads-v4"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:18}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:18}),"Copy"]})})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-300 dark:border-purple-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-purple-900 dark:text-purple-300 mb-2",children:" Multi-Offer Magic (V4)"}),a.jsxs("div",{className:"text-sm text-purple-800 dark:text-purple-400 space-y-2",children:[a.jsx("p",{className:"font-semibold",children:"What makes V4 special:"}),a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"Multiple Offers:"})," Pass array of offer names OR single string (backward compatible)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Flexible Mapping:"})," Manual campaignoffer mapping OR automatic round-robin"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Unique Per Campaign:"})," Each campaign gets unique suffix from its assigned offer"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Per-Offer Stats:"})," Independent interval calculation for each offer"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Per-Offer Tracking:"})," Yesterday's data collected separately per offer"]})]})]})]}),a.jsxs("div",{className:"bg-violet-50 dark:bg-violet-900/20 border border-violet-200 dark:border-violet-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-violet-900 dark:text-violet-300 mb-2",children:" Two Mapping Modes"}),a.jsxs("div",{className:"text-sm text-violet-800 dark:text-violet-400 space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"1. Manual Mode (Explicit Control)"}),a.jsx("pre",{className:"bg-violet-100 dark:bg-violet-950 text-violet-900 dark:text-violet-300 p-2 rounded mt-1 text-xs",children:`var CAMPAIGN_MAPPING = {
  '12345678': 'offer1',
  '87654321': 'offer2',
  '11223344': 'offer3'
};`}),a.jsx("p",{className:"ml-4 mt-1",children:"Map specific campaign IDs to specific offers. Full control."})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"2. Auto Mode (Round-Robin)"}),a.jsx("pre",{className:"bg-violet-100 dark:bg-violet-950 text-violet-900 dark:text-violet-300 p-2 rounded mt-1 text-xs",children:"var CAMPAIGN_MAPPING = {}; // Empty = auto mode"}),a.jsx("p",{className:"ml-4 mt-1",children:"Automatically distribute campaigns evenly across all offers."})]})]})]}),a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto max-h-96",children:H}),a.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-warning-900 dark:text-warning-300 mb-3",children:" V4 Configuration Variables"}),a.jsxs("div",{className:"text-sm text-warning-800 dark:text-warning-400 space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"OFFER_NAMES (Flexible Format)"}),a.jsx("p",{className:"ml-4",children:"Accept array OR single string:"}),a.jsx("pre",{className:"bg-warning-100 dark:bg-warning-950 text-warning-900 dark:text-warning-300 p-2 rounded mt-1 text-xs",children:`// Multi-offer mode
var OFFER_NAMES = ['offer1', 'offer2', 'offer3'];

// Single-offer mode (backward compatible)
var OFFER_NAMES = 'single-offer';`})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"CAMPAIGN_MAPPING (Optional)"}),a.jsx("p",{className:"ml-4",children:"Manual: Map campaign IDs to offers"}),a.jsxs("p",{className:"ml-4",children:["Auto: Leave empty "," for round-robin"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"Per-Offer Intervals"}),a.jsx("p",{className:"ml-4",children:"Each offer has independent MIN_INTERVAL_MS, MAX_INTERVAL_MS, TARGET_REPEAT_RATIO, MIN_REPEAT_RATIO"}),a.jsx("p",{className:"ml-4 text-xs mt-1",children:"Defaults: MIN=1000ms, MAX=30000ms, TARGET=5x, MIN=1.0x"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"MAX_RUNTIME_MS"}),a.jsx("p",{className:"ml-4",children:"Maximum runtime in milliseconds (default: 1500000 = 25 minutes)"})]})]})]}),a.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-purple-900 dark:text-purple-300 mb-2",children:" Example Scenarios"}),a.jsxs("div",{className:"text-sm text-purple-800 dark:text-purple-400 space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"Scenario 1: Single Offer (Backward Compatible)"}),a.jsx("pre",{className:"bg-purple-100 dark:bg-purple-950 text-purple-900 dark:text-purple-300 p-2 rounded mt-1 text-xs",children:`var OFFER_NAMES = 'my-offer';
var CAMPAIGN_MAPPING = {};
// Result: All campaigns get suffixes from 'my-offer'`})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"Scenario 2: Three Offers, Auto Distribution"}),a.jsx("pre",{className:"bg-purple-100 dark:bg-purple-950 text-purple-900 dark:text-purple-300 p-2 rounded mt-1 text-xs",children:`var OFFER_NAMES = ['offer-a', 'offer-b', 'offer-c'];
var CAMPAIGN_MAPPING = {};
// Result: 10 campaigns  Campaign 1,4,7,10offer-a, 2,5,8offer-b, 3,6,9offer-c`})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",children:"Scenario 3: Three Offers, Manual Mapping"}),a.jsx("pre",{className:"bg-purple-100 dark:bg-purple-950 text-purple-900 dark:text-purple-300 p-2 rounded mt-1 text-xs",children:`var OFFER_NAMES = ['premium', 'standard', 'budget'];
var CAMPAIGN_MAPPING = {
  '11111111': 'premium',
  '22222222': 'premium',
  '33333333': 'standard',
  '44444444': 'budget'
};
// Result: Full control - high-value campaigns get 'premium' offer`})]})]})]}),a.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-purple-900 dark:text-purple-300 mb-2",children:" How It Works"}),a.jsxs("div",{className:"text-sm text-purple-800 dark:text-purple-400 space-y-2",children:[a.jsx("p",{children:a.jsx("strong",{children:"Startup Phase:"})}),a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsx("li",{children:"Normalize OFFER_NAMES to array format"}),a.jsx("li",{children:"Get all enabled campaigns from Google Ads"}),a.jsx("li",{children:"Assign campaigns to offers (manual mapping or round-robin)"}),a.jsx("li",{children:"Collect yesterday's data for each offer separately (filtered by assigned campaigns)"}),a.jsx("li",{children:"Fetch initial recommended interval for each offer"})]}),a.jsx("p",{className:"pt-2",children:a.jsx("strong",{children:"Update Cycle:"})}),a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsx("li",{children:"For each campaign: Determine assigned offer"}),a.jsx("li",{children:"Call get-suffix API for that offer (unique suffix per campaign)"}),a.jsx("li",{children:"Update campaign with unique suffix from its assigned offer"}),a.jsx("li",{children:"Track per-offer statistics (API calls, campaigns updated, etc.)"}),a.jsx("li",{children:"Wait average interval across all offers before next cycle"})]}),a.jsx("p",{className:"pt-2",children:a.jsx("strong",{children:"Per-Offer Intelligence:"})}),a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsx("li",{children:"Each offer maintains independent interval calculation"}),a.jsx("li",{children:"Yesterday's data collected per offer (only campaigns assigned to that offer)"}),a.jsx("li",{children:"Three-scenario speedup/stable/slowdown logic per offer"}),a.jsx("li",{children:"Detailed per-offer statistics logged at end"})]})]})]}),a.jsxs("div",{className:"bg-violet-50 dark:bg-violet-900/20 border border-violet-200 dark:border-violet-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-violet-900 dark:text-violet-300 mb-2",children:" Pro Tips"}),a.jsx("div",{className:"text-sm text-violet-800 dark:text-violet-400 space-y-2",children:a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"Find Campaign IDs:"})," Run the ",a.jsx("code",{className:"bg-violet-100 dark:bg-violet-950 px-1 py-0.5 rounded",children:"listCampaignIds()"})," helper function"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Test First:"})," Set ",a.jsx("code",{className:"bg-violet-100 dark:bg-violet-950 px-1 py-0.5 rounded",children:"DRY_RUN_MODE = true"})," to preview without updating"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Start Small:"})," Test with 2 offers and 4 campaigns before scaling up"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Monitor Logs:"})," Check per-offer statistics at end of execution"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"API Volume:"})," V4 makes N API calls per cycle (N = number of campaigns)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Backward Compatible:"})," Single offer mode works exactly like V2"]})]})})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-indigo-200 dark:border-indigo-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 px-6 py-4 border-b border-indigo-200 dark:border-indigo-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Xa,{className:"text-indigo-600 dark:text-indigo-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Google Ads Script (Adaptive V3 + Auto-Schedule)"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Uses scheduler check/report, no sleeps, target repeats = 2 for faster optimization"})]})]}),a.jsx("button",{onClick:()=>V(be,"google-ads-v3"),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 dark:bg-indigo-500 text-white rounded-lg hover:bg-indigo-700 dark:hover:bg-indigo-600 transition-smooth",children:e==="google-ads-v3"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:18}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:18}),"Copy"]})})]}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-indigo-900 dark:text-indigo-300 mb-2",children:" Auto-Scheduler + Aggressive Targeting"}),a.jsx("div",{className:"text-sm text-indigo-800 dark:text-indigo-400 space-y-2",children:a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsx("li",{children:"Checks central scheduler before running; reports summary after"}),a.jsx("li",{children:"No sleeps anywhere (even between retries)"}),a.jsx("li",{children:"Adaptive interval uses target repeats = 2"}),a.jsx("li",{children:"Passes min/max/default constraints to the API"})]})})]}),a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto max-h-96",children:be})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(mi,{className:"text-success-600 dark:text-success-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Tracking Template (Direct)"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Paste directly into Google Ads tracking template field"})]})]}),a.jsx("button",{onClick:()=>V(je,"tracking-template"),className:"flex items-center gap-2 px-4 py-2 bg-success-600 dark:bg-success-500 text-white rounded-lg hover:bg-success-700 dark:hover:bg-success-600 transition-smooth",children:e==="tracking-template"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:18}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:18}),"Copy"]})})]}),a.jsx("div",{className:"p-6",children:a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto",children:je})})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(y_,{className:"text-brand-600 dark:text-brand-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"JavaScript Redirect Snippet"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Add to landing page for client-side redirect with fresh parameters"})]})]}),a.jsx("button",{onClick:()=>V(qe,"js-snippet"),className:"flex items-center gap-2 px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth",children:e==="js-snippet"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:18}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:18}),"Copy"]})})]}),a.jsx("div",{className:"p-6",children:a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto",children:qe})})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(mi,{className:"text-warning-600 dark:text-warning-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Tracking Pixel & Redirect Link"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Use for visitor tracking (pixel) or redirect links"})]})]})}),a.jsxs("div",{className:"p-6 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Tracking Pixel (No Redirect)"}),a.jsx("button",{onClick:()=>V(lt,"pixel"),className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-warning-600 dark:bg-warning-500 text-white rounded-lg hover:bg-warning-700 dark:hover:bg-warning-600 transition-smooth",children:e==="pixel"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:16}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:16}),"Copy"]})})]}),a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto",children:lt})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Redirect Link"}),a.jsx("button",{onClick:()=>V(fe,"redirect-link"),className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-warning-600 dark:bg-warning-500 text-white rounded-lg hover:bg-warning-700 dark:hover:bg-warning-600 transition-smooth",children:e==="redirect-link"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:16}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:16}),"Copy"]})})]}),a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto",children:fe})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(mi,{className:"text-neutral-600 dark:text-neutral-400",size:24}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"cURL Examples"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"API testing and integration examples"})]})]}),a.jsx("button",{onClick:()=>V(wt,"curl"),className:"flex items-center gap-2 px-4 py-2 bg-neutral-600 dark:bg-neutral-500 text-white rounded-lg hover:bg-neutral-700 dark:hover:bg-neutral-600 transition-smooth",children:e==="curl"?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:18}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:18}),"Copy"]})})]}),a.jsx("div",{className:"p-6",children:a.jsx("pre",{className:"bg-neutral-900 dark:bg-neutral-950 text-neutral-100 dark:text-neutral-200 text-sm p-4 rounded overflow-x-auto",children:wt})})]})]}),a.jsxs("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-warning-900 dark:text-warning-300 mb-2",children:"API Endpoints"}),a.jsxs("div",{className:"space-y-2 text-sm text-warning-800 dark:text-warning-400",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"GET /functions/v1/get-suffix"}),a.jsx("p",{className:"ml-4",children:"Fetches fresh tracking parameters for an offer"}),a.jsx("p",{className:"ml-4 text-xs",children:"Parameters: offer_name (required), redirect (optional)"})]}),a.jsxs("div",{children:[a.jsx("strong",{children:"GET /functions/v1/track-hit-instant"}),a.jsx("p",{className:"ml-4",children:"Instant redirect with background trace processing (RECOMMENDED)"}),a.jsx("p",{className:"ml-4 text-xs",children:"Parameters: offer (required), gclid/fbclid (Google/Facebook tracking)"}),a.jsx("p",{className:"ml-4 text-xs mt-1",children:"Response time: < 200ms, processes traces asynchronously"})]}),a.jsxs("div",{children:[a.jsx("strong",{children:"POST /trace (EC2 Proxy Service)"}),a.jsx("p",{className:"ml-4",children:"Traces complete redirect chain with Luna residential proxy and dynamic user agents"}),a.jsx("p",{className:"ml-4 text-xs",children:"Body: url, mode (http_only/browser), max_redirects, timeout_ms, proxy_ip (optional)"}),a.jsx("p",{className:"ml-4 text-xs mt-1",children:"Modes: http_only (fast, 2-5s), browser (full rendering, 10-30s)"})]})]})]})]})}const Ka=50;function nw(){const[e,t]=y.useState([]),[r,n]=y.useState(!0),[s,i]=y.useState("all"),[l,o]=y.useState(""),[c,d]=y.useState(null),[u,h]=y.useState(null),[p,v]=y.useState(1);y.useEffect(()=>{g(),k()},[]),y.useEffect(()=>{v(1)},[l,s]);const g=async()=>{n(!0);try{const{data:A,error:ne}=await J.from("daily_trace_counts").select("*, offers(offer_name)").order("date",{ascending:!1}).order("created_at",{ascending:!1});if(ne)throw ne;const te=(A||[]).map(me=>{var K;return{...me,offer_name:((K=me.offers)==null?void 0:K.offer_name)||me.offer_id,total_clicks:me.total_clicks||0,unique_landing_pages:me.unique_landing_pages||0,average_repeats:me.unique_landing_pages&&me.total_clicks?me.total_clicks/me.unique_landing_pages:0}});t(te)}catch(A){console.error("Error fetching interval history:",A),alert("Failed to fetch interval history: "+A.message)}finally{n(!1)}},k=async()=>{try{const A=new Date;A.setDate(A.getDate()-7);const ne=A.toISOString().split("T")[0];await J.from("daily_trace_counts").delete().lt("date",ne)}catch(A){console.error("Error cleaning old data:",A)}},b=A=>{d({offer_id:A.offer_id,account_id:A.account_id,date:A.date,interval_used_ms:A.interval_used_ms,total_clicks:A.total_clicks||0,unique_landing_pages:A.unique_landing_pages||0,min_interval_override_ms:A.min_interval_override_ms||null,max_interval_override_ms:A.max_interval_override_ms||null,target_repeat_ratio:A.target_repeat_ratio||null,min_repeat_ratio:A.min_repeat_ratio||null,call_budget_multiplier:A.call_budget_multiplier||null})},m=()=>{d(null)},x=async()=>{if(c){console.log(" Saving edit for:",{offer_id:c.offer_id,account_id:c.account_id,date:c.date,interval_used_ms:c.interval_used_ms});try{const{error:A,data:ne}=await J.from("daily_trace_counts").update({interval_used_ms:c.interval_used_ms,total_clicks:c.total_clicks,unique_landing_pages:c.unique_landing_pages,min_interval_override_ms:c.min_interval_override_ms,max_interval_override_ms:c.max_interval_override_ms,target_repeat_ratio:c.target_repeat_ratio,min_repeat_ratio:c.min_repeat_ratio,call_budget_multiplier:c.call_budget_multiplier}).eq("offer_id",c.offer_id).eq("account_id",c.account_id).eq("date",c.date).select();if(console.log(" Update result:",{error:A,data:ne,rowsUpdated:ne==null?void 0:ne.length}),A)throw A;d(null),g(),alert(" Successfully updated interval data")}catch(A){console.error("Error updating interval:",A),alert("Failed to update: "+A.message)}}},f=async(A,ne,te)=>{if((u==null?void 0:u.offer_id)===A&&(u==null?void 0:u.account_id)===ne&&(u==null?void 0:u.date)===te)try{const{error:me}=await J.from("daily_trace_counts").delete().eq("offer_id",A).eq("account_id",ne).eq("date",te);if(me)throw me;h(null),g(),alert(" Successfully deleted interval record")}catch(me){console.error("Error deleting interval:",me),alert("Failed to delete: "+me.message)}else h({offer_id:A,account_id:ne,date:te}),setTimeout(()=>h(null),3e3)},j=["all",...new Set(e.map(A=>A.offer_name||A.offer_id))];let T=s==="all"?e:e.filter(A=>(A.offer_name||A.offer_id)===s);if(l.trim()){const A=l.toLowerCase();T=T.filter(ne=>{try{const te=(ne.offer_name||ne.offer_id||"").toLowerCase(),me=(ne.account_id||"").toLowerCase(),K=(ne.date||"").toLowerCase();return te.includes(A)||me.includes(A)||K.includes(A)}catch{return!1}})}const L=Math.ceil(T.length/Ka),C=T.slice((p-1)*Ka,p*Ka),O=A=>new Date(A).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Q=A=>A<1e3?`${A}ms`:`${(A/1e3).toFixed(1)}s`,W=(A,ne,te)=>(c==null?void 0:c.offer_id)===A&&(c==null?void 0:c.account_id)===ne&&(c==null?void 0:c.date)===te,pe=(A,ne,te)=>(u==null?void 0:u.offer_id)===A&&(u==null?void 0:u.account_id)===ne&&(u==null?void 0:u.date)===te;return r?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-600"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col gap-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-50",children:"Interval History"}),a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400 mt-1",children:"Daily delay speeds calculated per offer based on landing page frequency"})]}),a.jsx("div",{className:"flex items-center gap-3",children:a.jsxs("button",{onClick:g,disabled:r,className:"flex items-center gap-2 px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 hover:bg-neutral-50 dark:hover:bg-neutral-800 transition-smooth disabled:opacity-50",children:[a.jsx(yt,{size:16,className:r?"animate-spin":""}),"Refresh"]})})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative flex-1 max-w-md",children:[a.jsx(fg,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),a.jsx("input",{type:"text",value:l,onChange:A=>o(A.target.value),placeholder:"Search by offer, account ID, date, or interval...",className:"w-full pl-10 pr-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 placeholder-neutral-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"})]}),a.jsx("select",{value:s,onChange:A=>i(A.target.value),className:"px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none",children:j.map(A=>a.jsx("option",{value:A,children:A==="all"?"All Offers":A},A))}),(l||s!=="all")&&a.jsx("button",{onClick:()=>{o(""),i("all")},className:"px-3 py-2 text-sm text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-50 transition-smooth",children:"Clear Filters"})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-850 border-b border-neutral-200 dark:border-neutral-800",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Date"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Offer"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Account ID"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Interval"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Clicks"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Landing Pages"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Avg Repeats"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-brand-600 dark:text-brand-400 uppercase tracking-wider",title:"Min interval (click to edit override)",children:"Min Interval"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-brand-600 dark:text-brand-400 uppercase tracking-wider",title:"Max interval (click to edit override)",children:"Max Interval"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-brand-600 dark:text-brand-400 uppercase tracking-wider",title:"Target ratio (click to edit override)",children:"Target Ratio"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-brand-600 dark:text-brand-400 uppercase tracking-wider",title:"Min ratio (click to edit override)",children:"Min Ratio"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-brand-600 dark:text-brand-400 uppercase tracking-wider",title:"Budget multiplier (click to edit override)",children:"Budget Mult."}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Trend"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:C.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:13,className:"px-6 py-8 text-center text-neutral-500 dark:text-neutral-400",children:T.length===0?"No interval history available":"No results found"})}):C.map((A,ne)=>{var D,q,N,B;const te=(p-1)*Ka+ne,me=T[te+1],K=me?A.interval_used_ms-me.interval_used_ms:0,V=W(A.offer_id,A.account_id,A.date),_=pe(A.offer_id,A.account_id,A.date);return a.jsxs("tr",{className:`hover:bg-neutral-50 dark:hover:bg-neutral-850 ${_?"bg-error-50 dark:bg-error-900/20":""}`,children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900 dark:text-neutral-50",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Gd,{size:14,className:"text-neutral-400"}),O(A.date)]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-neutral-900 dark:text-neutral-50",children:A.offer_name}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-600 dark:text-neutral-400 font-mono",children:A.account_id}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:V?a.jsx("input",{type:"number",value:(c==null?void 0:c.interval_used_ms)||0,onChange:U=>c&&d({...c,interval_used_ms:parseInt(U.target.value)||0}),className:"w-24 px-2 py-1 text-right border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}):a.jsx("span",{className:"font-semibold text-brand-600 dark:text-brand-400",children:Q(A.interval_used_ms)})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900 dark:text-neutral-50 text-right",children:V?a.jsx("input",{type:"number",value:(c==null?void 0:c.total_clicks)||0,onChange:U=>c&&d({...c,total_clicks:parseInt(U.target.value)||0}),className:"w-20 px-2 py-1 text-right border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}):A.total_clicks}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900 dark:text-neutral-50 text-right",children:V?a.jsx("input",{type:"number",value:(c==null?void 0:c.unique_landing_pages)||0,onChange:U=>c&&d({...c,unique_landing_pages:parseInt(U.target.value)||0}),className:"w-20 px-2 py-1 text-right border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}):A.unique_landing_pages}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900 dark:text-neutral-50 text-right",children:V?a.jsxs("span",{className:"text-neutral-600 dark:text-neutral-400",children:[c&&c.unique_landing_pages>0?(c.total_clicks/c.unique_landing_pages).toFixed(2):"0.00","x"]}):`${A.average_repeats.toFixed(2)}x`}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:V?a.jsx("input",{type:"number",value:(c==null?void 0:c.min_interval_override_ms)??"",onChange:U=>c&&d({...c,min_interval_override_ms:U.target.value?parseInt(U.target.value):null}),placeholder:((D=A.script_min_interval_ms)==null?void 0:D.toString())||"",className:"w-24 px-2 py-1 text-right border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}):a.jsx("span",{className:A.min_interval_override_ms?"font-semibold text-brand-600 dark:text-brand-400":"text-neutral-900 dark:text-neutral-50",title:A.min_interval_override_ms?"Override active":A.script_min_interval_ms?"Script default":"Not set",children:A.min_interval_override_ms?Q(A.min_interval_override_ms)+" ":A.script_min_interval_ms?Q(A.script_min_interval_ms):""})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:V?a.jsx("input",{type:"number",value:(c==null?void 0:c.max_interval_override_ms)??"",onChange:U=>c&&d({...c,max_interval_override_ms:U.target.value?parseInt(U.target.value):null}),placeholder:((q=A.script_max_interval_ms)==null?void 0:q.toString())||"",className:"w-24 px-2 py-1 text-right border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}):a.jsx("span",{className:A.max_interval_override_ms?"font-semibold text-brand-600 dark:text-brand-400":"text-neutral-900 dark:text-neutral-50",title:A.max_interval_override_ms?"Override active":A.script_max_interval_ms?"Script default":"Not set",children:A.max_interval_override_ms?Q(A.max_interval_override_ms)+" ":A.script_max_interval_ms?Q(A.script_max_interval_ms):""})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:V?a.jsx("input",{type:"number",step:"0.1",value:(c==null?void 0:c.target_repeat_ratio)??"",onChange:U=>c&&d({...c,target_repeat_ratio:U.target.value?parseFloat(U.target.value):null}),placeholder:((N=A.script_target_repeat_ratio)==null?void 0:N.toString())||"",className:"w-20 px-2 py-1 text-right border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}):a.jsx("span",{className:A.target_repeat_ratio?"font-semibold text-brand-600 dark:text-brand-400":"text-neutral-900 dark:text-neutral-50",title:A.target_repeat_ratio?"Override active":A.script_target_repeat_ratio?"Script default":"Not set",children:A.target_repeat_ratio?`${A.target_repeat_ratio.toFixed(1)}x `:A.script_target_repeat_ratio?`${A.script_target_repeat_ratio.toFixed(1)}x`:""})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:V?a.jsx("input",{type:"number",step:"0.1",value:(c==null?void 0:c.min_repeat_ratio)??"",onChange:U=>c&&d({...c,min_repeat_ratio:U.target.value?parseFloat(U.target.value):null}),placeholder:((B=A.script_min_repeat_ratio)==null?void 0:B.toString())||"",className:"w-20 px-2 py-1 text-right border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}):a.jsx("span",{className:A.min_repeat_ratio?"font-semibold text-brand-600 dark:text-brand-400":"text-neutral-900 dark:text-neutral-50",title:A.min_repeat_ratio?"Override active":A.script_min_repeat_ratio?"Script default":"Not set",children:A.min_repeat_ratio?`${A.min_repeat_ratio.toFixed(1)}x `:A.script_min_repeat_ratio?`${A.script_min_repeat_ratio.toFixed(1)}x`:""})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:V?a.jsx("input",{type:"number",step:"0.5",min:"1",max:"20",value:(c==null?void 0:c.call_budget_multiplier)??"",onChange:U=>c&&d({...c,call_budget_multiplier:U.target.value?parseFloat(U.target.value):null}),placeholder:"5.0",className:"w-20 px-2 py-1 text-right border border-neutral-300 dark:border-neutral-700 rounded bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none",title:"Max daily calls = yesterday clicks  this multiplier. Default: 10x"}):a.jsx("span",{className:A.call_budget_multiplier?"font-semibold text-brand-600 dark:text-brand-400":"text-neutral-900 dark:text-neutral-50",title:A.call_budget_multiplier?`DB override: ${A.call_budget_multiplier}x budget multiplier`:"Using script default (10x)",children:A.call_budget_multiplier?`${A.call_budget_multiplier.toFixed(1)}x `:"10.0x"})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:K===0?a.jsx("span",{className:"text-neutral-400",children:""}):K>0?a.jsxs("span",{className:"flex items-center justify-end gap-1 text-warning-600 dark:text-warning-400",children:[a.jsx(Hd,{size:14}),"+",Q(Math.abs(K))]}):a.jsxs("span",{className:"flex items-center justify-end gap-1 text-success-600 dark:text-success-400",children:[a.jsx(L_,{size:14}),"-",Q(Math.abs(K))]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:V?a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx("button",{onClick:x,className:"p-1.5 text-success-600 dark:text-success-400 hover:bg-success-50 dark:hover:bg-success-900/20 rounded transition-smooth",title:"Save changes",children:a.jsx(Ca,{size:16})}),a.jsx("button",{onClick:m,className:"p-1.5 text-neutral-600 dark:text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded transition-smooth",title:"Cancel",children:a.jsx(dr,{size:16})})]}):a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx("button",{onClick:()=>b(A),className:"p-1.5 text-brand-600 dark:text-brand-400 hover:bg-brand-50 dark:hover:bg-brand-900/20 rounded transition-smooth",title:"Edit",children:a.jsx(pg,{size:16})}),a.jsx("button",{onClick:()=>f(A.offer_id,A.account_id,A.date),className:`p-1.5 rounded transition-smooth ${_?"bg-error-600 text-white hover:bg-error-700":"text-error-600 dark:text-error-400 hover:bg-error-50 dark:hover:bg-error-900/20"}`,title:_?"Click again to confirm":"Delete",children:a.jsx(Ds,{size:16})})]})})]},`${A.offer_id}-${A.date}-${A.created_at}`)})})]})}),L>1&&a.jsxs("div",{className:"px-6 py-4 border-t border-neutral-200 dark:border-neutral-800 flex items-center justify-between",children:[a.jsxs("div",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:["Showing ",(p-1)*Ka+1," to ",Math.min(p*Ka,T.length)," of ",T.length," results"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>v(A=>Math.max(1,A-1)),disabled:p===1,className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 hover:bg-neutral-50 dark:hover:bg-neutral-800 transition-smooth disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:[a.jsx(ug,{size:16}),"Previous"]}),a.jsxs("span",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:["Page ",p," of ",L]}),a.jsxs("button",{onClick:()=>v(A=>Math.min(L,A+1)),disabled:p===L,className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 hover:bg-neutral-50 dark:hover:bg-neutral-800 transition-smooth disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:["Next",a.jsx(Vd,{size:16})]})]})]})]}),a.jsxs("div",{className:"bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800 rounded-lg p-4",children:[a.jsx("h4",{className:"font-semibold text-brand-900 dark:text-brand-300 mb-2",children:" How Intervals Work"}),a.jsxs("div",{className:"text-sm text-brand-800 dark:text-brand-400 space-y-2",children:[a.jsx("p",{children:"The system calculates optimal delay intervals based on daily call budget and landing page frequency:"}),a.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"Call Budget Safety Net:"})," maxDailyCalls = yesterdayClicks  budgetMultiplier (default 5x)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Budget Baseline:"})," budgetInterval = 86400000ms / maxDailyCalls"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Three-Scenario Adjustments:"}),a.jsxs("ul",{className:"list-circle ml-5 mt-1",children:[a.jsx("li",{children:"Scenario 1: ratio  TARGET  SPEEDUP (faster than budget baseline)"}),a.jsx("li",{children:"Scenario 2: MIN  ratio < TARGET  STABLE (keep budget baseline)"}),a.jsx("li",{children:"Scenario 3: ratio < MIN  SLOWDOWN (slower than budget baseline)"})]})]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Formula:"})," averageRepeats = clicks / unique_landing_pages"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Default Values:"})," BUDGET=5x, TARGET=5x, MIN=1.0x, MIN_INTERVAL=1000ms, MAX_INTERVAL=30000ms"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Budget Multiplier:"})," Controls daily API call limit. Higher = more calls, lower = fewer calls."]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Effective Values:"})," Shows script default OR override ( = override active)"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Edit to Override:"})," Click Edit, enter new value to override script defaults"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Clear Override:"})," Empty the field to revert to script default"]})]})]})]})]})}function Ng(e,t){return function(){return e.apply(t,arguments)}}const{toString:sw}=Object.prototype,{getPrototypeOf:Kd}=Object,{iterator:Pl,toStringTag:jg}=Symbol,Ol=(e=>t=>{const r=sw.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),fr=e=>(e=e.toLowerCase(),t=>Ol(t)===e),Ul=e=>t=>typeof t===e,{isArray:Un}=Array,An=Ul("undefined");function Gs(e){return e!==null&&!An(e)&&e.constructor!==null&&!An(e.constructor)&&Dt(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Sg=fr("ArrayBuffer");function iw(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Sg(e.buffer),t}const lw=Ul("string"),Dt=Ul("function"),Eg=Ul("number"),Vs=e=>e!==null&&typeof e=="object",ow=e=>e===!0||e===!1,Ri=e=>{if(Ol(e)!=="object")return!1;const t=Kd(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(jg in e)&&!(Pl in e)},cw=e=>{if(!Vs(e)||Gs(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},dw=fr("Date"),uw=fr("File"),hw=fr("Blob"),pw=fr("FileList"),fw=e=>Vs(e)&&Dt(e.pipe),gw=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Dt(e.append)&&((t=Ol(e))==="formdata"||t==="object"&&Dt(e.toString)&&e.toString()==="[object FormData]"))},mw=fr("URLSearchParams"),[xw,bw,yw,vw]=["ReadableStream","Request","Response","Headers"].map(fr),kw=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Hs(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,s;if(typeof e!="object"&&(e=[e]),Un(e))for(n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else{if(Gs(e))return;const i=r?Object.getOwnPropertyNames(e):Object.keys(e),l=i.length;let o;for(n=0;n<l;n++)o=i[n],t.call(null,e[o],o,e)}}function Cg(e,t){if(Gs(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n=r.length,s;for(;n-- >0;)if(s=r[n],t===s.toLowerCase())return s;return null}const Aa=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ag=e=>!An(e)&&e!==Aa;function Uc(){const{caseless:e,skipUndefined:t}=Ag(this)&&this||{},r={},n=(s,i)=>{const l=e&&Cg(r,i)||i;Ri(r[l])&&Ri(s)?r[l]=Uc(r[l],s):Ri(s)?r[l]=Uc({},s):Un(s)?r[l]=s.slice():(!t||!An(s))&&(r[l]=s)};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&Hs(arguments[s],n);return r}const _w=(e,t,r,{allOwnKeys:n}={})=>(Hs(t,(s,i)=>{r&&Dt(s)?e[i]=Ng(s,r):e[i]=s},{allOwnKeys:n}),e),ww=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Nw=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},jw=(e,t,r,n)=>{let s,i,l;const o={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),i=s.length;i-- >0;)l=s[i],(!n||n(l,e,t))&&!o[l]&&(t[l]=e[l],o[l]=!0);e=r!==!1&&Kd(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},Sw=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},Ew=e=>{if(!e)return null;if(Un(e))return e;let t=e.length;if(!Eg(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},Cw=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&Kd(Uint8Array)),Aw=(e,t)=>{const n=(e&&e[Pl]).call(e);let s;for(;(s=n.next())&&!s.done;){const i=s.value;t.call(e,i[0],i[1])}},Tw=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},Rw=fr("HTMLFormElement"),Iw=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,s){return n.toUpperCase()+s}),n0=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Lw=fr("RegExp"),Tg=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Hs(r,(s,i)=>{let l;(l=t(s,i,e))!==!1&&(n[i]=l||s)}),Object.defineProperties(e,n)},Pw=e=>{Tg(e,(t,r)=>{if(Dt(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(Dt(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Ow=(e,t)=>{const r={},n=s=>{s.forEach(i=>{r[i]=!0})};return Un(e)?n(e):n(String(e).split(t)),r},Uw=()=>{},Dw=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function Fw(e){return!!(e&&Dt(e.append)&&e[jg]==="FormData"&&e[Pl])}const Mw=e=>{const t=new Array(10),r=(n,s)=>{if(Vs(n)){if(t.indexOf(n)>=0)return;if(Gs(n))return n;if(!("toJSON"in n)){t[s]=n;const i=Un(n)?[]:{};return Hs(n,(l,o)=>{const c=r(l,s+1);!An(c)&&(i[o]=c)}),t[s]=void 0,i}}return n};return r(e,0)},$w=fr("AsyncFunction"),Bw=e=>e&&(Vs(e)||Dt(e))&&Dt(e.then)&&Dt(e.catch),Rg=((e,t)=>e?setImmediate:t?((r,n)=>(Aa.addEventListener("message",({source:s,data:i})=>{s===Aa&&i===r&&n.length&&n.shift()()},!1),s=>{n.push(s),Aa.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Dt(Aa.postMessage)),zw=typeof queueMicrotask<"u"?queueMicrotask.bind(Aa):typeof process<"u"&&process.nextTick||Rg,qw=e=>e!=null&&Dt(e[Pl]),R={isArray:Un,isArrayBuffer:Sg,isBuffer:Gs,isFormData:gw,isArrayBufferView:iw,isString:lw,isNumber:Eg,isBoolean:ow,isObject:Vs,isPlainObject:Ri,isEmptyObject:cw,isReadableStream:xw,isRequest:bw,isResponse:yw,isHeaders:vw,isUndefined:An,isDate:dw,isFile:uw,isBlob:hw,isRegExp:Lw,isFunction:Dt,isStream:fw,isURLSearchParams:mw,isTypedArray:Cw,isFileList:pw,forEach:Hs,merge:Uc,extend:_w,trim:kw,stripBOM:ww,inherits:Nw,toFlatObject:jw,kindOf:Ol,kindOfTest:fr,endsWith:Sw,toArray:Ew,forEachEntry:Aw,matchAll:Tw,isHTMLForm:Rw,hasOwnProperty:n0,hasOwnProp:n0,reduceDescriptors:Tg,freezeMethods:Pw,toObjectSet:Ow,toCamelCase:Iw,noop:Uw,toFiniteNumber:Dw,findKey:Cg,global:Aa,isContextDefined:Ag,isSpecCompliantForm:Fw,toJSONObject:Mw,isAsyncFn:$w,isThenable:Bw,setImmediate:Rg,asap:zw,isIterable:qw};function ye(e,t,r,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}R.inherits(ye,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:R.toJSONObject(this.config),code:this.code,status:this.status}}});const Ig=ye.prototype,Lg={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Lg[e]={value:e}});Object.defineProperties(ye,Lg);Object.defineProperty(Ig,"isAxiosError",{value:!0});ye.from=(e,t,r,n,s,i)=>{const l=Object.create(Ig);R.toFlatObject(e,l,function(u){return u!==Error.prototype},d=>d!=="isAxiosError");const o=e&&e.message?e.message:"Error",c=t==null&&e?e.code:t;return ye.call(l,o,c,r,n,s),e&&l.cause==null&&Object.defineProperty(l,"cause",{value:e,configurable:!0}),l.name=e&&e.name||"Error",i&&Object.assign(l,i),l};const Gw=null;function Dc(e){return R.isPlainObject(e)||R.isArray(e)}function Pg(e){return R.endsWith(e,"[]")?e.slice(0,-2):e}function s0(e,t,r){return e?e.concat(t).map(function(s,i){return s=Pg(s),!r&&i?"["+s+"]":s}).join(r?".":""):t}function Vw(e){return R.isArray(e)&&!e.some(Dc)}const Hw=R.toFlatObject(R,{},null,function(t){return/^is[A-Z]/.test(t)});function Dl(e,t,r){if(!R.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=R.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(k,b){return!R.isUndefined(b[k])});const n=r.metaTokens,s=r.visitor||u,i=r.dots,l=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&R.isSpecCompliantForm(t);if(!R.isFunction(s))throw new TypeError("visitor must be a function");function d(g){if(g===null)return"";if(R.isDate(g))return g.toISOString();if(R.isBoolean(g))return g.toString();if(!c&&R.isBlob(g))throw new ye("Blob is not supported. Use a Buffer instead.");return R.isArrayBuffer(g)||R.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function u(g,k,b){let m=g;if(g&&!b&&typeof g=="object"){if(R.endsWith(k,"{}"))k=n?k:k.slice(0,-2),g=JSON.stringify(g);else if(R.isArray(g)&&Vw(g)||(R.isFileList(g)||R.endsWith(k,"[]"))&&(m=R.toArray(g)))return k=Pg(k),m.forEach(function(f,j){!(R.isUndefined(f)||f===null)&&t.append(l===!0?s0([k],j,i):l===null?k:k+"[]",d(f))}),!1}return Dc(g)?!0:(t.append(s0(b,k,i),d(g)),!1)}const h=[],p=Object.assign(Hw,{defaultVisitor:u,convertValue:d,isVisitable:Dc});function v(g,k){if(!R.isUndefined(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+k.join("."));h.push(g),R.forEach(g,function(m,x){(!(R.isUndefined(m)||m===null)&&s.call(t,m,R.isString(x)?x.trim():x,k,p))===!0&&v(m,k?k.concat(x):[x])}),h.pop()}}if(!R.isObject(e))throw new TypeError("data must be an object");return v(e),t}function i0(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Yd(e,t){this._pairs=[],e&&Dl(e,this,t)}const Og=Yd.prototype;Og.append=function(t,r){this._pairs.push([t,r])};Og.toString=function(t){const r=t?function(n){return t.call(this,n,i0)}:i0;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};function Ww(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ug(e,t,r){if(!t)return e;const n=r&&r.encode||Ww;R.isFunction(r)&&(r={serialize:r});const s=r&&r.serialize;let i;if(s?i=s(t,r):i=R.isURLSearchParams(t)?t.toString():new Yd(t,r).toString(n),i){const l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class l0{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){R.forEach(this.handlers,function(n){n!==null&&t(n)})}}const Dg={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Kw=typeof URLSearchParams<"u"?URLSearchParams:Yd,Yw=typeof FormData<"u"?FormData:null,Jw=typeof Blob<"u"?Blob:null,Qw={isBrowser:!0,classes:{URLSearchParams:Kw,FormData:Yw,Blob:Jw},protocols:["http","https","file","blob","url","data"]},Jd=typeof window<"u"&&typeof document<"u",Fc=typeof navigator=="object"&&navigator||void 0,Xw=Jd&&(!Fc||["ReactNative","NativeScript","NS"].indexOf(Fc.product)<0),Zw=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",eN=Jd&&window.location.href||"http://localhost",tN=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Jd,hasStandardBrowserEnv:Xw,hasStandardBrowserWebWorkerEnv:Zw,navigator:Fc,origin:eN},Symbol.toStringTag,{value:"Module"})),kt={...tN,...Qw};function rN(e,t){return Dl(e,new kt.classes.URLSearchParams,{visitor:function(r,n,s,i){return kt.isNode&&R.isBuffer(r)?(this.append(n,r.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function aN(e){return R.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function nN(e){const t={},r=Object.keys(e);let n;const s=r.length;let i;for(n=0;n<s;n++)i=r[n],t[i]=e[i];return t}function Fg(e){function t(r,n,s,i){let l=r[i++];if(l==="__proto__")return!0;const o=Number.isFinite(+l),c=i>=r.length;return l=!l&&R.isArray(s)?s.length:l,c?(R.hasOwnProp(s,l)?s[l]=[s[l],n]:s[l]=n,!o):((!s[l]||!R.isObject(s[l]))&&(s[l]=[]),t(r,n,s[l],i)&&R.isArray(s[l])&&(s[l]=nN(s[l])),!o)}if(R.isFormData(e)&&R.isFunction(e.entries)){const r={};return R.forEachEntry(e,(n,s)=>{t(aN(n),s,r,0)}),r}return null}function sN(e,t,r){if(R.isString(e))try{return(t||JSON.parse)(e),R.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const Ws={transitional:Dg,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",s=n.indexOf("application/json")>-1,i=R.isObject(t);if(i&&R.isHTMLForm(t)&&(t=new FormData(t)),R.isFormData(t))return s?JSON.stringify(Fg(t)):t;if(R.isArrayBuffer(t)||R.isBuffer(t)||R.isStream(t)||R.isFile(t)||R.isBlob(t)||R.isReadableStream(t))return t;if(R.isArrayBufferView(t))return t.buffer;if(R.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return rN(t,this.formSerializer).toString();if((o=R.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Dl(o?{"files[]":t}:t,c&&new c,this.formSerializer)}}return i||s?(r.setContentType("application/json",!1),sN(t)):t}],transformResponse:[function(t){const r=this.transitional||Ws.transitional,n=r&&r.forcedJSONParsing,s=this.responseType==="json";if(R.isResponse(t)||R.isReadableStream(t))return t;if(t&&R.isString(t)&&(n&&!this.responseType||s)){const l=!(r&&r.silentJSONParsing)&&s;try{return JSON.parse(t,this.parseReviver)}catch(o){if(l)throw o.name==="SyntaxError"?ye.from(o,ye.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:kt.classes.FormData,Blob:kt.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};R.forEach(["delete","get","head","post","put","patch"],e=>{Ws.headers[e]={}});const iN=R.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),lN=e=>{const t={};let r,n,s;return e&&e.split(`
`).forEach(function(l){s=l.indexOf(":"),r=l.substring(0,s).trim().toLowerCase(),n=l.substring(s+1).trim(),!(!r||t[r]&&iN[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},o0=Symbol("internals");function Wn(e){return e&&String(e).trim().toLowerCase()}function Ii(e){return e===!1||e==null?e:R.isArray(e)?e.map(Ii):String(e)}function oN(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const cN=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function wo(e,t,r,n,s){if(R.isFunction(n))return n.call(this,t,r);if(s&&(t=r),!!R.isString(t)){if(R.isString(n))return t.indexOf(n)!==-1;if(R.isRegExp(n))return n.test(t)}}function dN(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function uN(e,t){const r=R.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(s,i,l){return this[n].call(this,t,s,i,l)},configurable:!0})})}let Ft=class{constructor(t){t&&this.set(t)}set(t,r,n){const s=this;function i(o,c,d){const u=Wn(c);if(!u)throw new Error("header name must be a non-empty string");const h=R.findKey(s,u);(!h||s[h]===void 0||d===!0||d===void 0&&s[h]!==!1)&&(s[h||c]=Ii(o))}const l=(o,c)=>R.forEach(o,(d,u)=>i(d,u,c));if(R.isPlainObject(t)||t instanceof this.constructor)l(t,r);else if(R.isString(t)&&(t=t.trim())&&!cN(t))l(lN(t),r);else if(R.isObject(t)&&R.isIterable(t)){let o={},c,d;for(const u of t){if(!R.isArray(u))throw TypeError("Object iterator must return a key-value pair");o[d=u[0]]=(c=o[d])?R.isArray(c)?[...c,u[1]]:[c,u[1]]:u[1]}l(o,r)}else t!=null&&i(r,t,n);return this}get(t,r){if(t=Wn(t),t){const n=R.findKey(this,t);if(n){const s=this[n];if(!r)return s;if(r===!0)return oN(s);if(R.isFunction(r))return r.call(this,s,n);if(R.isRegExp(r))return r.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Wn(t),t){const n=R.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||wo(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let s=!1;function i(l){if(l=Wn(l),l){const o=R.findKey(n,l);o&&(!r||wo(n,n[o],o,r))&&(delete n[o],s=!0)}}return R.isArray(t)?t.forEach(i):i(t),s}clear(t){const r=Object.keys(this);let n=r.length,s=!1;for(;n--;){const i=r[n];(!t||wo(this,this[i],i,t,!0))&&(delete this[i],s=!0)}return s}normalize(t){const r=this,n={};return R.forEach(this,(s,i)=>{const l=R.findKey(n,i);if(l){r[l]=Ii(s),delete r[i];return}const o=t?dN(i):String(i).trim();o!==i&&delete r[i],r[o]=Ii(s),n[o]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return R.forEach(this,(n,s)=>{n!=null&&n!==!1&&(r[s]=t&&R.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(s=>n.set(s)),n}static accessor(t){const n=(this[o0]=this[o0]={accessors:{}}).accessors,s=this.prototype;function i(l){const o=Wn(l);n[o]||(uN(s,l),n[o]=!0)}return R.isArray(t)?t.forEach(i):i(t),this}};Ft.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);R.reduceDescriptors(Ft.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});R.freezeMethods(Ft);function No(e,t){const r=this||Ws,n=t||r,s=Ft.from(n.headers);let i=n.data;return R.forEach(e,function(o){i=o.call(r,i,s.normalize(),t?t.status:void 0)}),s.normalize(),i}function Mg(e){return!!(e&&e.__CANCEL__)}function Dn(e,t,r){ye.call(this,e??"canceled",ye.ERR_CANCELED,t,r),this.name="CanceledError"}R.inherits(Dn,ye,{__CANCEL__:!0});function $g(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new ye("Request failed with status code "+r.status,[ye.ERR_BAD_REQUEST,ye.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function hN(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function pN(e,t){e=e||10;const r=new Array(e),n=new Array(e);let s=0,i=0,l;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),u=n[i];l||(l=d),r[s]=c,n[s]=d;let h=i,p=0;for(;h!==s;)p+=r[h++],h=h%e;if(s=(s+1)%e,s===i&&(i=(i+1)%e),d-l<t)return;const v=u&&d-u;return v?Math.round(p*1e3/v):void 0}}function fN(e,t){let r=0,n=1e3/t,s,i;const l=(d,u=Date.now())=>{r=u,s=null,i&&(clearTimeout(i),i=null),e(...d)};return[(...d)=>{const u=Date.now(),h=u-r;h>=n?l(d,u):(s=d,i||(i=setTimeout(()=>{i=null,l(s)},n-h)))},()=>s&&l(s)]}const hl=(e,t,r=3)=>{let n=0;const s=pN(50,250);return fN(i=>{const l=i.loaded,o=i.lengthComputable?i.total:void 0,c=l-n,d=s(c),u=l<=o;n=l;const h={loaded:l,total:o,progress:o?l/o:void 0,bytes:c,rate:d||void 0,estimated:d&&o&&u?(o-l)/d:void 0,event:i,lengthComputable:o!=null,[t?"download":"upload"]:!0};e(h)},r)},c0=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},d0=e=>(...t)=>R.asap(()=>e(...t)),gN=kt.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,kt.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(kt.origin),kt.navigator&&/(msie|trident)/i.test(kt.navigator.userAgent)):()=>!0,mN=kt.hasStandardBrowserEnv?{write(e,t,r,n,s,i,l){if(typeof document>"u")return;const o=[`${e}=${encodeURIComponent(t)}`];R.isNumber(r)&&o.push(`expires=${new Date(r).toUTCString()}`),R.isString(n)&&o.push(`path=${n}`),R.isString(s)&&o.push(`domain=${s}`),i===!0&&o.push("secure"),R.isString(l)&&o.push(`SameSite=${l}`),document.cookie=o.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function xN(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function bN(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function Bg(e,t,r){let n=!xN(t);return e&&(n||r==!1)?bN(e,t):t}const u0=e=>e instanceof Ft?{...e}:e;function Fa(e,t){t=t||{};const r={};function n(d,u,h,p){return R.isPlainObject(d)&&R.isPlainObject(u)?R.merge.call({caseless:p},d,u):R.isPlainObject(u)?R.merge({},u):R.isArray(u)?u.slice():u}function s(d,u,h,p){if(R.isUndefined(u)){if(!R.isUndefined(d))return n(void 0,d,h,p)}else return n(d,u,h,p)}function i(d,u){if(!R.isUndefined(u))return n(void 0,u)}function l(d,u){if(R.isUndefined(u)){if(!R.isUndefined(d))return n(void 0,d)}else return n(void 0,u)}function o(d,u,h){if(h in t)return n(d,u);if(h in e)return n(void 0,d)}const c={url:i,method:i,data:i,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:o,headers:(d,u,h)=>s(u0(d),u0(u),h,!0)};return R.forEach(Object.keys({...e,...t}),function(u){const h=c[u]||s,p=h(e[u],t[u],u);R.isUndefined(p)&&h!==o||(r[u]=p)}),r}const zg=e=>{const t=Fa({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:i,headers:l,auth:o}=t;if(t.headers=l=Ft.from(l),t.url=Ug(Bg(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&l.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),R.isFormData(r)){if(kt.hasStandardBrowserEnv||kt.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(R.isFunction(r.getHeaders)){const c=r.getHeaders(),d=["content-type","content-length"];Object.entries(c).forEach(([u,h])=>{d.includes(u.toLowerCase())&&l.set(u,h)})}}if(kt.hasStandardBrowserEnv&&(n&&R.isFunction(n)&&(n=n(t)),n||n!==!1&&gN(t.url))){const c=s&&i&&mN.read(i);c&&l.set(s,c)}return t},yN=typeof XMLHttpRequest<"u",vN=yN&&function(e){return new Promise(function(r,n){const s=zg(e);let i=s.data;const l=Ft.from(s.headers).normalize();let{responseType:o,onUploadProgress:c,onDownloadProgress:d}=s,u,h,p,v,g;function k(){v&&v(),g&&g(),s.cancelToken&&s.cancelToken.unsubscribe(u),s.signal&&s.signal.removeEventListener("abort",u)}let b=new XMLHttpRequest;b.open(s.method.toUpperCase(),s.url,!0),b.timeout=s.timeout;function m(){if(!b)return;const f=Ft.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),T={data:!o||o==="text"||o==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:f,config:e,request:b};$g(function(C){r(C),k()},function(C){n(C),k()},T),b=null}"onloadend"in b?b.onloadend=m:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(m)},b.onabort=function(){b&&(n(new ye("Request aborted",ye.ECONNABORTED,e,b)),b=null)},b.onerror=function(j){const T=j&&j.message?j.message:"Network Error",L=new ye(T,ye.ERR_NETWORK,e,b);L.event=j||null,n(L),b=null},b.ontimeout=function(){let j=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const T=s.transitional||Dg;s.timeoutErrorMessage&&(j=s.timeoutErrorMessage),n(new ye(j,T.clarifyTimeoutError?ye.ETIMEDOUT:ye.ECONNABORTED,e,b)),b=null},i===void 0&&l.setContentType(null),"setRequestHeader"in b&&R.forEach(l.toJSON(),function(j,T){b.setRequestHeader(T,j)}),R.isUndefined(s.withCredentials)||(b.withCredentials=!!s.withCredentials),o&&o!=="json"&&(b.responseType=s.responseType),d&&([p,g]=hl(d,!0),b.addEventListener("progress",p)),c&&b.upload&&([h,v]=hl(c),b.upload.addEventListener("progress",h),b.upload.addEventListener("loadend",v)),(s.cancelToken||s.signal)&&(u=f=>{b&&(n(!f||f.type?new Dn(null,e,b):f),b.abort(),b=null)},s.cancelToken&&s.cancelToken.subscribe(u),s.signal&&(s.signal.aborted?u():s.signal.addEventListener("abort",u)));const x=hN(s.url);if(x&&kt.protocols.indexOf(x)===-1){n(new ye("Unsupported protocol "+x+":",ye.ERR_BAD_REQUEST,e));return}b.send(i||null)})},kN=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,s;const i=function(d){if(!s){s=!0,o();const u=d instanceof Error?d:this.reason;n.abort(u instanceof ye?u:new Dn(u instanceof Error?u.message:u))}};let l=t&&setTimeout(()=>{l=null,i(new ye(`timeout ${t} of ms exceeded`,ye.ETIMEDOUT))},t);const o=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),e=null)};e.forEach(d=>d.addEventListener("abort",i));const{signal:c}=n;return c.unsubscribe=()=>R.asap(o),c}},_N=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let n=0,s;for(;n<r;)s=n+t,yield e.slice(n,s),n=s},wN=async function*(e,t){for await(const r of NN(e))yield*_N(r,t)},NN=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},h0=(e,t,r,n)=>{const s=wN(e,t);let i=0,l,o=c=>{l||(l=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:u}=await s.next();if(d){o(),c.close();return}let h=u.byteLength;if(r){let p=i+=h;r(p)}c.enqueue(new Uint8Array(u))}catch(d){throw o(d),d}},cancel(c){return o(c),s.return()}},{highWaterMark:2})},p0=64*1024,{isFunction:xi}=R,jN=(({Request:e,Response:t})=>({Request:e,Response:t}))(R.global),{ReadableStream:f0,TextEncoder:g0}=R.global,m0=(e,...t)=>{try{return!!e(...t)}catch{return!1}},SN=e=>{e=R.merge.call({skipUndefined:!0},jN,e);const{fetch:t,Request:r,Response:n}=e,s=t?xi(t):typeof fetch=="function",i=xi(r),l=xi(n);if(!s)return!1;const o=s&&xi(f0),c=s&&(typeof g0=="function"?(g=>k=>g.encode(k))(new g0):async g=>new Uint8Array(await new r(g).arrayBuffer())),d=i&&o&&m0(()=>{let g=!1;const k=new r(kt.origin,{body:new f0,method:"POST",get duplex(){return g=!0,"half"}}).headers.has("Content-Type");return g&&!k}),u=l&&o&&m0(()=>R.isReadableStream(new n("").body)),h={stream:u&&(g=>g.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!h[g]&&(h[g]=(k,b)=>{let m=k&&k[g];if(m)return m.call(k);throw new ye(`Response type '${g}' is not supported`,ye.ERR_NOT_SUPPORT,b)})});const p=async g=>{if(g==null)return 0;if(R.isBlob(g))return g.size;if(R.isSpecCompliantForm(g))return(await new r(kt.origin,{method:"POST",body:g}).arrayBuffer()).byteLength;if(R.isArrayBufferView(g)||R.isArrayBuffer(g))return g.byteLength;if(R.isURLSearchParams(g)&&(g=g+""),R.isString(g))return(await c(g)).byteLength},v=async(g,k)=>{const b=R.toFiniteNumber(g.getContentLength());return b??p(k)};return async g=>{let{url:k,method:b,data:m,signal:x,cancelToken:f,timeout:j,onDownloadProgress:T,onUploadProgress:L,responseType:C,headers:O,withCredentials:Q="same-origin",fetchOptions:W}=zg(g),pe=t||fetch;C=C?(C+"").toLowerCase():"text";let A=kN([x,f&&f.toAbortSignal()],j),ne=null;const te=A&&A.unsubscribe&&(()=>{A.unsubscribe()});let me;try{if(L&&d&&b!=="get"&&b!=="head"&&(me=await v(O,m))!==0){let N=new r(k,{method:"POST",body:m,duplex:"half"}),B;if(R.isFormData(m)&&(B=N.headers.get("content-type"))&&O.setContentType(B),N.body){const[U,F]=c0(me,hl(d0(L)));m=h0(N.body,p0,U,F)}}R.isString(Q)||(Q=Q?"include":"omit");const K=i&&"credentials"in r.prototype,V={...W,signal:A,method:b.toUpperCase(),headers:O.normalize().toJSON(),body:m,duplex:"half",credentials:K?Q:void 0};ne=i&&new r(k,V);let _=await(i?pe(ne,W):pe(k,V));const D=u&&(C==="stream"||C==="response");if(u&&(T||D&&te)){const N={};["status","statusText","headers"].forEach(H=>{N[H]=_[H]});const B=R.toFiniteNumber(_.headers.get("content-length")),[U,F]=T&&c0(B,hl(d0(T),!0))||[];_=new n(h0(_.body,p0,U,()=>{F&&F(),te&&te()}),N)}C=C||"text";let q=await h[R.findKey(h,C)||"text"](_,g);return!D&&te&&te(),await new Promise((N,B)=>{$g(N,B,{data:q,headers:Ft.from(_.headers),status:_.status,statusText:_.statusText,config:g,request:ne})})}catch(K){throw te&&te(),K&&K.name==="TypeError"&&/Load failed|fetch/i.test(K.message)?Object.assign(new ye("Network Error",ye.ERR_NETWORK,g,ne),{cause:K.cause||K}):ye.from(K,K&&K.code,g,ne)}}},EN=new Map,qg=e=>{let t=e&&e.env||{};const{fetch:r,Request:n,Response:s}=t,i=[n,s,r];let l=i.length,o=l,c,d,u=EN;for(;o--;)c=i[o],d=u.get(c),d===void 0&&u.set(c,d=o?new Map:SN(t)),u=d;return d};qg();const Qd={http:Gw,xhr:vN,fetch:{get:qg}};R.forEach(Qd,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const x0=e=>`- ${e}`,CN=e=>R.isFunction(e)||e===null||e===!1;function AN(e,t){e=R.isArray(e)?e:[e];const{length:r}=e;let n,s;const i={};for(let l=0;l<r;l++){n=e[l];let o;if(s=n,!CN(n)&&(s=Qd[(o=String(n)).toLowerCase()],s===void 0))throw new ye(`Unknown adapter '${o}'`);if(s&&(R.isFunction(s)||(s=s.get(t))))break;i[o||"#"+l]=s}if(!s){const l=Object.entries(i).map(([c,d])=>`adapter ${c} `+(d===!1?"is not supported by the environment":"is not available in the build"));let o=r?l.length>1?`since :
`+l.map(x0).join(`
`):" "+x0(l[0]):"as no adapter specified";throw new ye("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s}const Gg={getAdapter:AN,adapters:Qd};function jo(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Dn(null,e)}function b0(e){return jo(e),e.headers=Ft.from(e.headers),e.data=No.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Gg.getAdapter(e.adapter||Ws.adapter,e)(e).then(function(n){return jo(e),n.data=No.call(e,e.transformResponse,n),n.headers=Ft.from(n.headers),n},function(n){return Mg(n)||(jo(e),n&&n.response&&(n.response.data=No.call(e,e.transformResponse,n.response),n.response.headers=Ft.from(n.response.headers))),Promise.reject(n)})}const Vg="1.13.2",Fl={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Fl[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const y0={};Fl.transitional=function(t,r,n){function s(i,l){return"[Axios v"+Vg+"] Transitional option '"+i+"'"+l+(n?". "+n:"")}return(i,l,o)=>{if(t===!1)throw new ye(s(l," has been removed"+(r?" in "+r:"")),ye.ERR_DEPRECATED);return r&&!y0[l]&&(y0[l]=!0,console.warn(s(l," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(i,l,o):!0}};Fl.spelling=function(t){return(r,n)=>(console.warn(`${n} is likely a misspelling of ${t}`),!0)};function TN(e,t,r){if(typeof e!="object")throw new ye("options must be an object",ye.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let s=n.length;for(;s-- >0;){const i=n[s],l=t[i];if(l){const o=e[i],c=o===void 0||l(o,i,e);if(c!==!0)throw new ye("option "+i+" must be "+c,ye.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new ye("Unknown option "+i,ye.ERR_BAD_OPTION)}}const Li={assertOptions:TN,validators:Fl},yr=Li.validators;let Ia=class{constructor(t){this.defaults=t||{},this.interceptors={request:new l0,response:new l0}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Fa(this.defaults,r);const{transitional:n,paramsSerializer:s,headers:i}=r;n!==void 0&&Li.assertOptions(n,{silentJSONParsing:yr.transitional(yr.boolean),forcedJSONParsing:yr.transitional(yr.boolean),clarifyTimeoutError:yr.transitional(yr.boolean)},!1),s!=null&&(R.isFunction(s)?r.paramsSerializer={serialize:s}:Li.assertOptions(s,{encode:yr.function,serialize:yr.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Li.assertOptions(r,{baseUrl:yr.spelling("baseURL"),withXsrfToken:yr.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let l=i&&R.merge(i.common,i[r.method]);i&&R.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),r.headers=Ft.concat(l,i);const o=[];let c=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(r)===!1||(c=c&&k.synchronous,o.unshift(k.fulfilled,k.rejected))});const d=[];this.interceptors.response.forEach(function(k){d.push(k.fulfilled,k.rejected)});let u,h=0,p;if(!c){const g=[b0.bind(this),void 0];for(g.unshift(...o),g.push(...d),p=g.length,u=Promise.resolve(r);h<p;)u=u.then(g[h++],g[h++]);return u}p=o.length;let v=r;for(;h<p;){const g=o[h++],k=o[h++];try{v=g(v)}catch(b){k.call(this,b);break}}try{u=b0.call(this,v)}catch(g){return Promise.reject(g)}for(h=0,p=d.length;h<p;)u=u.then(d[h++],d[h++]);return u}getUri(t){t=Fa(this.defaults,t);const r=Bg(t.baseURL,t.url,t.allowAbsoluteUrls);return Ug(r,t.params,t.paramsSerializer)}};R.forEach(["delete","get","head","options"],function(t){Ia.prototype[t]=function(r,n){return this.request(Fa(n||{},{method:t,url:r,data:(n||{}).data}))}});R.forEach(["post","put","patch"],function(t){function r(n){return function(i,l,o){return this.request(Fa(o||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:l}))}}Ia.prototype[t]=r(),Ia.prototype[t+"Form"]=r(!0)});let RN=class Hg{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(i){r=i});const n=this;this.promise.then(s=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](s);n._listeners=null}),this.promise.then=s=>{let i;const l=new Promise(o=>{n.subscribe(o),i=o}).then(s);return l.cancel=function(){n.unsubscribe(i)},l},t(function(i,l,o){n.reason||(n.reason=new Dn(i,l,o),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new Hg(function(s){t=s}),cancel:t}}};function IN(e){return function(r){return e.apply(null,r)}}function LN(e){return R.isObject(e)&&e.isAxiosError===!0}const Mc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Mc).forEach(([e,t])=>{Mc[t]=e});function Wg(e){const t=new Ia(e),r=Ng(Ia.prototype.request,t);return R.extend(r,Ia.prototype,t,{allOwnKeys:!0}),R.extend(r,t,null,{allOwnKeys:!0}),r.create=function(s){return Wg(Fa(e,s))},r}const Ke=Wg(Ws);Ke.Axios=Ia;Ke.CanceledError=Dn;Ke.CancelToken=RN;Ke.isCancel=Mg;Ke.VERSION=Vg;Ke.toFormData=Dl;Ke.AxiosError=ye;Ke.Cancel=Ke.CanceledError;Ke.all=function(t){return Promise.all(t)};Ke.spread=IN;Ke.isAxiosError=LN;Ke.mergeConfig=Fa;Ke.AxiosHeaders=Ft;Ke.formToJSON=e=>Fg(R.isHTMLForm(e)?new FormData(e):e);Ke.getAdapter=Gg.getAdapter;Ke.HttpStatusCode=Mc;Ke.default=Ke;const{Axios:$N,AxiosError:BN,CanceledError:zN,isCancel:qN,CancelToken:GN,VERSION:VN,all:HN,Cancel:WN,isAxiosError:KN,spread:YN,toFormData:JN,AxiosHeaders:QN,HttpStatusCode:XN,formToJSON:ZN,getAdapter:ej,mergeConfig:tj}=Ke,v0="http://url-tracker-proxy-alb-1426409269.us-east-1.elb.amazonaws.com",PN=()=>{const[e,t]=y.useState([]),[r,n]=y.useState(!1),[s,i]=y.useState(null),[l,o]=y.useState(!1),[c,d]=y.useState([]),[u,h]=y.useState([]),[p,v]=y.useState(!1),[g,k]=y.useState("all"),[b,m]=y.useState(new Set),[x,f]=y.useState(!1),[j,T]=y.useState({accountId:"",campaignId:"",campaignName:"",offerName:"",offerId:""});y.useEffect(()=>{L(),C()},[]),y.useEffect(()=>{if(j.offerName){const _=c.filter(D=>D.toLowerCase().includes(j.offerName.toLowerCase()));h(_)}else h(c)},[j.offerName,c]);const L=async()=>{try{const{data:_,error:D}=await J.from("offers").select("offer_name").order("offer_name");if(D)throw D;const q=[...new Set(_.map(N=>N.offer_name))];d(q),h(q)}catch(_){console.error("Error loading offers:",_)}},C=async()=>{try{n(!0),i(null);const{data:_,error:D}=await J.from("webhook_campaign_mappings").select("*").order("created_at",{ascending:!1});if(D)throw D;t(_||[])}catch(_){i(_.message||"Failed to load mappings"),console.error("Error loading mappings:",_)}finally{n(!1)}},O=async _=>{var D,q,N,B;if(_.preventDefault(),!j.accountId||!j.campaignId||!j.offerName){i("Please fill in all required fields");return}try{n(!0),i(null);const U=await Ke.post(`${v0}/api/webhook-campaign/create`,{accountId:j.accountId,campaignId:j.campaignId,campaignName:j.campaignName||`Campaign ${j.campaignId}`,offerName:j.offerName,offerId:j.offerId||null,createdBy:"user"});U.data.success&&(alert(` Campaign mapping created!

Webhook URL:
${U.data.trackier.webhookUrl}

Add this URL to Trackier S2S postback for Campaign ID ${U.data.trackier.campaignId}`),T({accountId:"",campaignId:"",campaignName:"",offerName:"",offerId:""}),o(!1),await C())}catch(U){i(((q=(D=U.response)==null?void 0:D.data)==null?void 0:q.error)||U.message),alert(` Error: ${((B=(N=U.response)==null?void 0:N.data)==null?void 0:B.error)||U.message}`)}finally{n(!1)}},Q=async _=>{var D,q;try{const N=await Ke.patch(`${v0}/api/webhook-campaign/${_}/toggle`);N.data.success&&t(B=>B.map(U=>U.mapping_id===_?{...U,is_active:N.data.is_active}:U))}catch(N){alert(`Error toggling status: ${((q=(D=N.response)==null?void 0:D.data)==null?void 0:q.error)||N.message}`)}},W=_=>{navigator.clipboard.writeText(_),alert(" Copied to clipboard!")},pe=_=>{m(D=>{const q=new Set(D);return q.has(_)?q.delete(_):q.add(_),q})},A=()=>{m(new Set(K.map(_=>_.mapping_id)))},ne=()=>{m(new Set)},te=()=>{const _=e.filter(H=>b.has(H.mapping_id)),D=`Campaign Name,Offer Name,Account ID,Campaign ID,Trackier Campaign ID,Webhook URL,Tracking Template,Status,Created At
`,q=_.map(H=>{const be=`https://nebula.gotrackier.com/click?campaign_id=${H.trackier_campaign_id}&pub_id=2&force_transparent=true&url={lpurl}`;return[H.campaign_name||"",H.offer_name,H.account_id,H.campaign_id,H.trackier_campaign_id,H.trackier_webhook_url,be,H.is_active?"Active":"Inactive",new Date(H.created_at).toISOString()].map(qe=>`"${qe}"`).join(",")}).join(`
`),N=D+q,B=new Blob([N],{type:"text/csv"}),U=URL.createObjectURL(B),F=document.createElement("a");F.href=U,F.download=`webhook-mappings-${new Date().toISOString().split("T")[0]}.csv`,F.click(),URL.revokeObjectURL(U)},me=async()=>{if(confirm(`Delete ${b.size} mapping(s)? This cannot be undone.`))try{n(!0);const _=Array.from(b).map(D=>J.from("webhook_campaign_mappings").delete().eq("mapping_id",D));await Promise.all(_),await C(),m(new Set),f(!1)}catch(_){alert(`Error deleting mappings: ${_.message}`)}finally{n(!1)}},K=e.filter(_=>g==="configured"?_.webhook_configured:g==="pending"?!_.webhook_configured:!0),V=e.filter(_=>!_.webhook_configured).length;return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-50",children:"Webhook Campaign Mapper"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:"Manage webhook-triggered suffix updates for Google Ads campaigns"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>o(!l),className:"px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth disabled:opacity-50",disabled:r,children:l?"Cancel":"+ New Mapping"}),e.length>0&&a.jsx("button",{onClick:()=>{f(!x),m(new Set)},className:`px-4 py-2 rounded-lg transition-smooth ${x?"bg-neutral-600 text-white hover:bg-neutral-700":"bg-neutral-200 dark:bg-neutral-700 text-neutral-900 dark:text-neutral-50 hover:bg-neutral-300 dark:hover:bg-neutral-600"}`,children:x?"Cancel Selection":"Select"})]})]}),x&&b.size>0&&a.jsxs("div",{className:"p-4 bg-brand-50 dark:bg-brand-900/20 border-2 border-brand-300 dark:border-brand-700 rounded-lg flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("span",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-50",children:[b.size," selected"]}),a.jsxs("button",{onClick:A,className:"text-sm text-brand-600 dark:text-brand-400 hover:underline",children:["Select All (",K.length,")"]}),a.jsx("button",{onClick:ne,className:"text-sm text-neutral-600 dark:text-neutral-400 hover:underline",children:"Deselect All"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:te,className:"px-4 py-2 bg-success-600 text-white rounded-lg hover:bg-success-700 transition-smooth flex items-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download CSV"]}),a.jsxs("button",{onClick:me,className:"px-4 py-2 bg-error-600 text-white rounded-lg hover:bg-error-700 transition-smooth flex items-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Selected"]})]})]}),e.length>0&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Filter:"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>k("all"),className:`px-3 py-1.5 text-sm rounded-lg transition-smooth ${g==="all"?"bg-brand-600 text-white":"bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-200 dark:hover:bg-neutral-700"}`,children:["All (",e.length,")"]}),a.jsxs("button",{onClick:()=>k("configured"),className:`px-3 py-1.5 text-sm rounded-lg transition-smooth ${g==="configured"?"bg-success-600 text-white":"bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-200 dark:hover:bg-neutral-700"}`,children:[" Configured (",e.length-V,")"]}),a.jsxs("button",{onClick:()=>k("pending"),className:`px-3 py-1.5 text-sm rounded-lg transition-smooth ${g==="pending"?"bg-warning-600 text-white":"bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-200 dark:hover:bg-neutral-700"}`,children:[" Pending (",V,")"]})]})]}),s&&a.jsx("div",{className:"p-4 bg-error-50 dark:bg-error-900/20 border border-error-200 dark:border-error-800 rounded-lg text-error-700 dark:text-error-300",children:s}),l&&a.jsxs("form",{onSubmit:O,className:"p-6 bg-neutral-50 dark:bg-neutral-850 rounded-lg border border-neutral-200 dark:border-neutral-800",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4 text-neutral-900 dark:text-neutral-50",children:"Create New Campaign Mapping"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Google Ads Account ID *"}),a.jsx("input",{type:"text",value:j.accountId,onChange:_=>T({...j,accountId:_.target.value}),placeholder:"123-456-7890",className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 dark:focus:border-brand-400 transition-smooth",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Google Ads Campaign ID *"}),a.jsx("input",{type:"text",value:j.campaignId,onChange:_=>T({...j,campaignId:_.target.value}),placeholder:"12345678",className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 dark:focus:border-brand-400 transition-smooth",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Campaign Name"}),a.jsx("input",{type:"text",value:j.campaignName,onChange:_=>T({...j,campaignName:_.target.value}),placeholder:"My Campaign",className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 dark:focus:border-brand-400 transition-smooth"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Offer Name *"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:j.offerName,onChange:_=>{T({...j,offerName:_.target.value}),v(!0)},onFocus:()=>v(!0),placeholder:"Search or type offer name...",className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 dark:focus:border-brand-400 transition-smooth",required:!0}),p&&u.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:u.slice(0,20).map(_=>a.jsx("div",{onClick:()=>{T({...j,offerName:_}),v(!1)},className:"px-3 py-2 hover:bg-brand-50 dark:hover:bg-brand-900/20 cursor-pointer text-sm text-neutral-700 dark:text-neutral-300",children:_},_))})]})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Offer ID (Optional)"}),a.jsx("input",{type:"text",value:j.offerId,onChange:_=>T({...j,offerId:_.target.value}),placeholder:"offer_123",className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 dark:focus:border-brand-400 transition-smooth"})]})]}),a.jsxs("div",{className:"mt-4 flex gap-3",children:[a.jsx("button",{type:"submit",disabled:r,className:"px-6 py-2 bg-success-600 text-white rounded-lg hover:bg-success-700 transition-smooth disabled:opacity-50 font-medium",children:r?"Creating...":"Create Mapping"}),a.jsx("button",{type:"button",onClick:()=>{o(!1),v(!1)},className:"px-6 py-2 bg-neutral-400 dark:bg-neutral-600 text-white rounded-lg hover:bg-neutral-500 dark:hover:bg-neutral-700 transition-smooth font-medium",children:"Cancel"})]})]}),a.jsx("div",{className:"space-y-4",children:r&&e.length===0?a.jsx("div",{className:"text-center py-8 text-neutral-500 dark:text-neutral-400",children:"Loading mappings..."}):K.length===0?a.jsx("div",{className:"text-center py-8 text-neutral-500 dark:text-neutral-400 p-6 bg-neutral-50 dark:bg-neutral-850 rounded-lg border border-neutral-200 dark:border-neutral-800",children:g==="all"?"No campaign mappings yet. Create one to get started!":`No ${g} mappings found.`}):K.map(_=>a.jsxs("div",{className:`p-5 rounded-lg border-2 ${x&&b.has(_.mapping_id)?"border-brand-500 dark:border-brand-400 bg-brand-50 dark:bg-brand-900/30":_.is_active?"border-success-300 dark:border-success-700 bg-success-50 dark:bg-success-900/20":"border-neutral-300 dark:border-neutral-700 bg-neutral-50 dark:bg-neutral-850"}`,children:[a.jsxs("div",{className:"flex justify-between items-start mb-3",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[x&&a.jsx("input",{type:"checkbox",checked:b.has(_.mapping_id),onChange:()=>pe(_.mapping_id),className:"w-5 h-5 mt-1 rounded border-neutral-300 dark:border-neutral-600 text-brand-600 focus:ring-brand-500 focus:ring-2"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:_.offer_name}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:_.campaign_name||`Campaign ${_.campaign_id}`})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${_.is_active?"bg-success-600 dark:bg-success-500 text-white":"bg-neutral-400 dark:bg-neutral-600 text-white"}`,children:_.is_active?"Active":"Inactive"}),!_.webhook_configured&&a.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-warning-600 dark:bg-warning-500 text-white animate-pulse",children:" Webhook Pending"}),_.webhook_configured&&_.first_webhook_received_at&&a.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-brand-600 dark:bg-brand-500 text-white",title:`First webhook: ${new Date(_.first_webhook_received_at).toLocaleString()}`,children:" Configured"}),a.jsx("button",{onClick:()=>Q(_.mapping_id),className:"px-3 py-1 bg-brand-500 text-white text-sm rounded hover:bg-brand-600 transition-smooth",children:"Toggle"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm mb-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-neutral-700 dark:text-neutral-300",children:"Account ID:"}),a.jsx("span",{className:"ml-2 text-neutral-600 dark:text-neutral-400",children:_.account_id})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-neutral-700 dark:text-neutral-300",children:"Campaign ID:"}),a.jsx("span",{className:"ml-2 text-neutral-600 dark:text-neutral-400",children:_.campaign_id})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-neutral-700 dark:text-neutral-300",children:"Trackier Campaign:"}),a.jsx("span",{className:"ml-2 text-neutral-600 dark:text-neutral-400",children:_.trackier_campaign_id})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-neutral-700 dark:text-neutral-300",children:"Created:"}),a.jsx("span",{className:"ml-2 text-neutral-600 dark:text-neutral-400",children:new Date(_.created_at).toLocaleDateString()})]})]}),_.bucket_stats&&a.jsx("div",{className:"mb-3 p-3 bg-white dark:bg-neutral-900 rounded border border-neutral-200 dark:border-neutral-700",children:a.jsxs("div",{className:"grid grid-cols-4 gap-3 text-sm",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 text-xs",children:"Total Suffixes"}),a.jsx("div",{className:"text-lg font-semibold text-neutral-800 dark:text-neutral-200",children:_.bucket_stats.total_suffixes})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 text-xs",children:"Valid Suffixes"}),a.jsx("div",{className:"text-lg font-semibold text-success-600 dark:text-success-400",children:_.bucket_stats.valid_suffixes})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 text-xs",children:"Total Usage"}),a.jsx("div",{className:"text-lg font-semibold text-brand-600 dark:text-brand-400",children:_.bucket_stats.total_usage})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 text-xs",children:"Last Fetch"}),a.jsx("div",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:_.bucket_stats.last_fetch?new Date(_.bucket_stats.last_fetch).toLocaleDateString():"Never"})]})]})}),a.jsxs("div",{className:"bg-neutral-100 dark:bg-neutral-800 p-3 rounded border border-neutral-300 dark:border-neutral-700",children:[a.jsxs("div",{className:"flex justify-between items-center mb-1",children:[a.jsxs("span",{className:"text-xs font-medium text-neutral-600 dark:text-neutral-400",children:["Trackier S2S Webhook URL:",!_.webhook_configured&&a.jsx("span",{className:"ml-2 text-warning-600 dark:text-warning-400 font-semibold",children:" Add this to Trackier!"})]}),a.jsx("button",{onClick:()=>W(_.trackier_webhook_url),className:"text-xs px-2 py-1 bg-neutral-600 dark:bg-neutral-500 text-white rounded hover:bg-neutral-700 dark:hover:bg-neutral-600 transition-smooth",children:"Copy"})]}),a.jsx("code",{className:"text-xs text-neutral-800 dark:text-neutral-200 break-all font-mono",children:_.trackier_webhook_url}),!_.webhook_configured&&a.jsxs("div",{className:"mt-2 p-2 bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded text-xs text-warning-800 dark:text-warning-300",children:[a.jsx("strong",{children:"Setup Instructions:"}),a.jsx("br",{}),"1. Copy webhook URL above",a.jsx("br",{}),"2. Log in to Trackier dashboard",a.jsx("br",{}),"3. Go to Campaign #",_.trackier_campaign_id,a.jsx("br",{}),"4. Add S2S Postback with this URL",a.jsx("br",{}),"5. System will auto-detect first webhook"]}),_.webhook_configured&&_.first_webhook_received_at&&a.jsxs("div",{className:"mt-2 p-2 bg-success-50 dark:bg-success-900/20 border border-success-200 dark:border-success-800 rounded text-xs text-success-800 dark:text-success-300",children:[" Webhook configured and working! First webhook received: ",new Date(_.first_webhook_received_at).toLocaleString()]})]}),a.jsxs("div",{className:"bg-neutral-100 dark:bg-neutral-800 p-3 rounded border border-neutral-300 dark:border-neutral-700",children:[a.jsxs("div",{className:"flex justify-between items-center mb-1",children:[a.jsx("span",{className:"text-xs font-medium text-neutral-600 dark:text-neutral-400",children:"Google Ads Tracking Template:"}),a.jsx("button",{onClick:()=>W(`https://nebula.gotrackier.com/click?campaign_id=${_.trackier_campaign_id}&pub_id=2&force_transparent=true&url={lpurl}`),className:"text-xs px-2 py-1 bg-neutral-600 dark:bg-neutral-500 text-white rounded hover:bg-neutral-700 dark:hover:bg-neutral-600 transition-smooth",children:"Copy"})]}),a.jsxs("code",{className:"text-xs text-neutral-800 dark:text-neutral-200 break-all font-mono",children:["https://nebula.gotrackier.com/click?campaign_id=",_.trackier_campaign_id,"&pub_id=2&force_transparent=true&url=","{lpurl}"]}),a.jsxs("div",{className:"mt-2 p-2 bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800 rounded text-xs text-brand-800 dark:text-brand-300",children:[a.jsx("strong",{children:" Add to Google Ads:"}),a.jsx("br",{}),"1. Copy tracking template above",a.jsx("br",{}),"2. Go to Google Ads campaign settings",a.jsx("br",{}),'3. Paste in "Tracking template" field at campaign level',a.jsx("br",{}),"4. Save changes"]})]})]},_.mapping_id))}),a.jsx("div",{className:"text-center",children:a.jsx("button",{onClick:C,disabled:r,className:"px-6 py-2 bg-neutral-600 dark:bg-neutral-500 text-white rounded-lg hover:bg-neutral-700 dark:hover:bg-neutral-600 transition-smooth disabled:opacity-50 font-medium",children:r?"Refreshing...":" Refresh Mappings"})})]})};function ON(){const[e,t]=y.useState(""),[r,n]=y.useState(!1),[s,i]=y.useState([]),[l,o]=y.useState([]),[c,d]=y.useState([]),[u,h]=y.useState([]),[p,v]=y.useState({}),[g,k]=y.useState([]),[b,m]=y.useState([]),[x,f]=y.useState(!1),[j,T]=y.useState(!1),[L,C]=y.useState(""),[O,Q]=y.useState([]),[W,pe]=y.useState(""),[A,ne]=y.useState(!1),[te,me]=y.useState(new Set),[K,V]=y.useState(""),[_,D]=y.useState("all"),[q,N]=y.useState(1),[B]=y.useState(10),[U,F]=y.useState(!1),[H,be]=y.useState(null),[je,qe]=y.useState({}),lt=(S,Y)=>{const E=oe(S,Y),P=je[E]||p[E],z=60;if(!P)return{base:z,min:Math.round(z*.7),max:Math.round(z*1.3)};const re=P.traces_per_day??null,le=P.speed_multiplier??1,he=re&&re>0?1440/re:z/(le||1),Ee=Math.max(he,5);return{base:Math.round(Ee),min:Math.round(Ee*.7),max:Math.round(Ee*1.3)}},[fe,gt]=y.useState({account_id:"",google_campaign_id:"",offer_name:"",campaign_name:""});y.useEffect(()=>{wt()},[]),y.useEffect(()=>{let S=b;if(K.trim()){const Y=K.toLowerCase();S=S.filter(E=>{var P;return E.offer_name.toLowerCase().includes(Y)||E.campaign_id.toLowerCase().includes(Y)||((P=E.campaign_name)==null?void 0:P.toLowerCase().includes(Y))||E.account_id.toLowerCase().includes(Y)})}_!=="all"&&(S=S.filter(Y=>_==="active"?Y.is_active:!Y.is_active)),k(S),N(1)},[K,_,b]);const wt=async()=>{F(!0);try{const[S,Y,E]=await Promise.all([J.from("v5_campaign_offer_mapping").select("*").order("created_at",{ascending:!1}),J.from("v5_trackier_campaigns").select("*"),J.from("v5_trace_overrides").select("*")]),P={};(Y.data||[]).forEach(re=>{P[re.mapping_id]=re});const z={};if((E.data||[]).forEach(re=>{const le=`${re.account_id}||${re.offer_name}`;z[le]=re}),v(z),h(E.data||[]),!S.error&&S.data){const re=S.data.map(le=>{const he=P[le.id];return{...le,trackier:he?{campaignId:he.trackier_campaign_id,campaignName:he.trackier_campaign_name,webhookUrl:he.webhook_url,webhookUrlWithParams:`${he.webhook_url}?account_id=${le.account_id}&campaign_id={p1}&offer_name=${le.offer_name}&suffix={transaction_id}`,trackingTemplate:he.tracking_template,redirectType:he.redirect_type,instructions:[]}:null}});m(re)}}catch(S){console.error("Load mappings error:",S)}finally{F(!1)}};y.useEffect(()=>{let S=!0;return(async()=>{if(!W||W.length<2){Q([]);return}ne(!0);try{const{data:E,error:P}=await J.from("offers").select("offer_name").ilike("offer_name",`%${W}%`).limit(20);if(P)throw P;if(!S)return;const z=Array.from(new Set((E||[]).map(re=>re.offer_name)));Q(z)}catch(E){S&&console.error("Failed to search offers",E)}finally{S&&ne(!1)}})(),()=>{S=!1}},[W]);const De=async()=>{if(!e.trim()){alert("Please enter an Account ID");return}n(!0);try{const{data:S,error:Y}=await J.rpc("v5_get_queue_stats",{p_account_id:e});!Y&&S&&i(S);const{data:E,error:P}=await J.rpc("v5_get_bucket_inventory",{p_account_id:e});!P&&E&&o(E);const{data:z,error:re}=await J.from("v5_daily_offer_stats").select("*").eq("account_id",e).order("stats_date",{ascending:!1}).limit(10);!re&&z&&d(z);const{data:le,error:he}=await J.from("v5_trace_overrides").select("*").eq("account_id",e);if(!he&&le&&h(le),!he&&le){const we={};le.forEach(ke=>{const Re=`${ke.account_id}||${ke.offer_name}`;we[Re]=ke}),v(ke=>({...ke,...we}))}const{data:Ee,error:Ae}=await J.from("v5_campaign_offer_mapping").select("*").eq("account_id",e).order("offer_name",{ascending:!0});if(!Ae&&Ee){const we=await Promise.all(Ee.map(async ke=>{const{data:Re}=await J.from("v5_trackier_campaigns").select("*").eq("mapping_id",ke.id).maybeSingle();return{...ke,trackier:Re?{campaignId:Re.trackier_campaign_id,campaignName:Re.trackier_campaign_name,webhookUrl:Re.webhook_url,webhookUrlWithParams:`${Re.webhook_url}?account_id=${e}&campaign_id={p1}&offer_name=${ke.offer_name}&suffix={transaction_id}`,trackingTemplate:Re.tracking_template,redirectType:Re.redirect_type,instructions:[]}:null}}));k(we)}}catch(S){console.error("Load error:",S),alert("Failed to load data")}finally{n(!1)}},nt=async S=>{S.preventDefault();const Y=fe.account_id||e;if(!Y.trim()||!fe.google_campaign_id||!fe.offer_name){alert("Please fill in all required fields");return}T(!0);try{const{data:{user:E}}=await J.auth.getUser();if(!E){alert("Please log in to create mappings");return}const{data:P}=await J.from("settings").select("trackier_api_key, trackier_api_url").eq("user_id",E.id).single();if(!(P!=null&&P.trackier_api_key)){alert("Please configure Trackier API key in Settings first");return}const le=await(await fetch("https://rfhuqenntxiqurplenjn.supabase.co/functions/v1/v5-create-mapping",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account_id:Y,google_campaign_id:fe.google_campaign_id,offer_name:fe.offer_name,campaign_name:fe.campaign_name||`V5-${fe.offer_name}-GA${fe.google_campaign_id}`,trackier_api_key:P.trackier_api_key,trackier_api_url:P.trackier_api_url||"https://api.trackier.com"})})).json();if(!le.success){alert(`Failed to create mapping: ${le.error||"Unknown error"}`);return}alert(` Mapping created successfully!

Next steps:
1. Copy Tracking Template to Google Ads
2. Copy Postback URL to Trackier campaign`),gt({account_id:"",google_campaign_id:"",offer_name:"",campaign_name:""}),pe(""),f(!1),await wt(),e&&await De()}catch(E){console.error("Create mapping error:",E),alert(`Error: ${E.message}`)}finally{T(!1)}},M=(S,Y)=>{navigator.clipboard.writeText(S),C(Y),setTimeout(()=>C(""),2e3)},oe=(S,Y)=>`${S}||${Y}`,Ge=(S,Y)=>{const E=oe(S,Y),P=je[E]||p[E];return P?{enabled:P.enabled,traces_per_day:P.traces_per_day??null,speed_multiplier:P.speed_multiplier??null,trace_also_on_webhook:P.trace_also_on_webhook}:{enabled:!1,traces_per_day:null,speed_multiplier:null,trace_also_on_webhook:!0}},ot=(S,Y,E)=>{const P=oe(S,Y);qe(z=>({...z,[P]:{...Ge(S,Y),...E}}))},Dr=async(S,Y)=>{const E=oe(S,Y),P=Ge(S,Y);be(E);try{const{error:z,data:re}=await J.from("v5_trace_overrides").upsert({account_id:S,offer_name:Y,enabled:P.enabled,traces_per_day:P.traces_per_day,speed_multiplier:P.speed_multiplier,trace_also_on_webhook:P.trace_also_on_webhook},{onConflict:"account_id,offer_name"}).select().maybeSingle();if(z)throw z;v(le=>({...le,[E]:re})),h(le=>{const he=le.filter(Ee=>oe(Ee.account_id,Ee.offer_name)!==E);return re?[...he,re]:he})}catch(z){console.error("Save override error:",z),alert("Failed to save override")}finally{be(null)}},Yt=S=>{const Y=new Set(te);Y.has(S)?Y.delete(S):Y.add(S),me(Y)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(ds,{className:"text-brand-600 dark:text-brand-400",size:24}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-50",children:"V5 Webhook System"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Auto-create Trackier campaigns with 200_hrf redirects and manage mappings"})]})]}),a.jsxs("button",{onClick:()=>f(!0),disabled:r,className:"flex items-center gap-2 px-4 py-2 bg-success-600 dark:bg-success-500 text-white rounded-lg hover:bg-success-700 dark:hover:bg-success-600 transition-smooth disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx(Yr,{size:16}),"Create Mapping"]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("input",{type:"text",value:e,onChange:S=>t(S.target.value),placeholder:"Enter Account ID (e.g., 1234567890)",className:"flex-1 px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 dark:focus:ring-brand-400/20 focus:border-brand-500 dark:focus:border-brand-400 outline-none transition-smooth"}),a.jsx("button",{onClick:De,disabled:r,className:"flex items-center gap-2 px-4 py-2 bg-brand-600 dark:bg-brand-500 text-white rounded-lg hover:bg-brand-700 dark:hover:bg-brand-600 transition-smooth disabled:opacity-50",children:r?a.jsxs(a.Fragment,{children:[a.jsx(yt,{size:16,className:"animate-spin"}),"Loading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Jh,{size:16}),"Load Data"]})})]})]}),x&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-neutral-200 dark:border-neutral-800",children:[a.jsx("h3",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-50",children:"Create V5 Mapping"}),a.jsx("button",{onClick:()=>f(!1),className:"p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-lg transition-smooth",children:a.jsx(dr,{size:20})})]}),a.jsxs("form",{onSubmit:nt,className:"p-6 space-y-4",children:[a.jsxs("div",{className:"bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800 rounded-lg p-4 space-y-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-brand-900 dark:text-brand-200 mb-1",children:"Account ID *"}),a.jsx("input",{type:"text",value:fe.account_id||e,onChange:S=>gt({...fe,account_id:S.target.value}),placeholder:"1234567890",required:!0,className:"w-full px-4 py-2 border border-brand-200 dark:border-brand-700 rounded-lg bg-white dark:bg-neutral-900 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"})]}),a.jsx("p",{className:"text-xs text-brand-700 dark:text-brand-400",children:"This will create a Trackier campaign with redirectType: 200_hrf and auto-generate tracking URLs"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Google Ads Campaign ID *"}),a.jsx("input",{type:"text",value:fe.google_campaign_id,onChange:S=>gt({...fe,google_campaign_id:S.target.value}),placeholder:"1234567890",required:!0,className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"The campaign ID from Google Ads (not Trackier)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Offer Name *"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("input",{type:"text",value:W,onChange:S=>pe(S.target.value),placeholder:"Type 2+ chars to search offers",className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}),a.jsxs("div",{className:"max-h-40 overflow-y-auto border border-neutral-200 dark:border-neutral-800 rounded-lg divide-y divide-neutral-200 dark:divide-neutral-800 bg-white dark:bg-neutral-900",children:[A&&a.jsx("div",{className:"px-3 py-2 text-sm text-neutral-500",children:"Searching..."}),!A&&O.length===0&&W.length>=2&&a.jsx("div",{className:"px-3 py-2 text-sm text-neutral-500",children:"No offers found"}),O.map(S=>a.jsx("button",{type:"button",onClick:()=>{gt({...fe,offer_name:S}),pe(S)},className:`w-full text-left px-3 py-2 text-sm hover:bg-neutral-50 dark:hover:bg-neutral-800 ${fe.offer_name===S?"bg-brand-50 dark:bg-brand-900/30 text-brand-700 dark:text-brand-300":"text-neutral-800 dark:text-neutral-200"}`,children:S},S))]}),a.jsx("input",{type:"hidden",value:fe.offer_name,required:!0,onChange:()=>{}}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"Search and select an offer (no full preload)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:"Campaign Name (Optional)"}),a.jsx("input",{type:"text",value:fe.campaign_name,onChange:S=>gt({...fe,campaign_name:S.target.value}),placeholder:`V5-${fe.offer_name||"Offer"}-GA${fe.google_campaign_id||"ID"}`,className:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850 text-neutral-900 dark:text-neutral-50 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Auto-generated if left empty"})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg hover:bg-neutral-50 dark:hover:bg-neutral-800 transition-smooth",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:j,className:"flex-1 px-4 py-2 bg-success-600 dark:bg-success-500 text-white rounded-lg hover:bg-success-700 dark:hover:bg-success-600 transition-smooth disabled:opacity-50",children:j?"Creating...":"Create Mapping"})]})]})]})}),s.length>0&&a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800",children:a.jsxs("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50 flex items-center gap-2",children:[a.jsx(wa,{size:20}),"Webhook Queue Status"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-800",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-850",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Offer"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Pending"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Processing"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Completed"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Failed"})]})}),a.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:s.map((S,Y)=>a.jsxs("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-850/50",children:[a.jsx("td",{className:"px-6 py-4 text-sm font-medium text-neutral-900 dark:text-neutral-50",children:S.offer_name}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-neutral-600 dark:text-neutral-400",children:S.pending_count}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-warning-600 dark:text-warning-400",children:S.processing_count}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-success-600 dark:text-success-400",children:S.completed_count}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-error-600 dark:text-error-400",children:S.failed_count})]},Y))})]})})]}),l.length>0&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-brand-500 to-brand-600 rounded-lg p-4 text-white",children:[a.jsx("div",{className:"text-sm opacity-90 mb-1",children:"Total Suffixes"}),a.jsx("div",{className:"text-3xl font-bold",children:l.reduce((S,Y)=>S+Y.total_suffixes,0)})]}),a.jsxs("div",{className:"bg-gradient-to-br from-success-500 to-success-600 rounded-lg p-4 text-white",children:[a.jsx("div",{className:"text-sm opacity-90 mb-1",children:"Unused (Available)"}),a.jsx("div",{className:"text-3xl font-bold",children:l.reduce((S,Y)=>S+Y.unused_suffixes,0)})]}),a.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-4 text-white",children:[a.jsx("div",{className:"text-sm opacity-90 mb-1",children:"Zero-Click"}),a.jsx("div",{className:"text-3xl font-bold",children:l.reduce((S,Y)=>S+Y.zero_click_count,0)})]}),a.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg p-4 text-white",children:[a.jsx("div",{className:"text-sm opacity-90 mb-1",children:"Traced"}),a.jsx("div",{className:"text-3xl font-bold",children:l.reduce((S,Y)=>S+Y.traced_count,0)})]})]}),l.length>0&&a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800",children:a.jsxs("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50 flex items-center gap-2",children:[a.jsx(Jh,{size:20}),"Suffix Bucket Inventory (Detailed)"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-800",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-850",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Offer"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Total"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Unused"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Used"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Traced"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Zero-Click"})]})}),a.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:l.map((S,Y)=>a.jsxs("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-850/50",children:[a.jsx("td",{className:"px-6 py-4 text-sm font-medium text-neutral-900 dark:text-neutral-50",children:S.offer_name}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-neutral-600 dark:text-neutral-400",children:S.total_suffixes}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-success-600 dark:text-success-400",children:S.unused_suffixes}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-neutral-500 dark:text-neutral-500",children:S.used_suffixes}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-brand-600 dark:text-brand-400",children:S.traced_count}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-purple-600 dark:text-purple-400",children:S.zero_click_count})]},Y))})]})})]}),c.length>0&&a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800",children:a.jsxs("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50 flex items-center gap-2",children:[a.jsx(Hd,{size:20}),"Daily Statistics"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-800",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-850",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Offer"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Date"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Clicks"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Unique LPs"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Repeat Ratio"})]})}),a.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:c.map((S,Y)=>a.jsxs("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-850/50",children:[a.jsx("td",{className:"px-6 py-4 text-sm font-medium text-neutral-900 dark:text-neutral-50",children:S.offer_name}),a.jsx("td",{className:"px-6 py-4 text-sm text-neutral-600 dark:text-neutral-400",children:new Date(S.stats_date).toLocaleDateString()}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-neutral-600 dark:text-neutral-400",children:S.total_clicks}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-neutral-600 dark:text-neutral-400",children:S.unique_landing_pages}),a.jsx("td",{className:"px-6 py-4 text-sm text-right",children:S.repeat_ratio!==null&&S.repeat_ratio!==void 0?a.jsx("span",{className:`px-3 py-1 rounded-full font-semibold ${S.repeat_ratio<.5?"bg-success-100 text-success-700 dark:bg-success-900/30 dark:text-success-400":S.repeat_ratio<.8?"bg-warning-100 text-warning-700 dark:bg-warning-900/30 dark:text-warning-400":"bg-danger-100 text-danger-700 dark:bg-danger-900/30 dark:text-danger-400"}`,children:S.repeat_ratio.toFixed(2)}):a.jsx("span",{className:"text-neutral-400 dark:text-neutral-500 italic",children:"calculating..."})})]},Y))})]})})]}),u.length>0&&a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800",children:a.jsxs("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50 flex items-center gap-2",children:[a.jsx(gg,{size:20}),"Trace Overrides"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-800",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-850",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Offer"}),a.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Enabled"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Traces/Day"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Speed x"}),a.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Trace on Webhook"}),a.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:u.map(S=>a.jsxs("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-850/50",children:[a.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-neutral-900 dark:text-neutral-50",children:[a.jsx("div",{className:"font-mono text-xs text-neutral-500",children:S.account_id}),S.offer_name]}),a.jsx("td",{className:"px-6 py-4 text-center",children:a.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${S.enabled?"bg-success-100 text-success-800 dark:bg-success-900/30 dark:text-success-400":"bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400"}`,children:S.enabled?"Yes":"No"})}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-neutral-600 dark:text-neutral-400",children:S.traces_per_day??"-"}),a.jsx("td",{className:"px-6 py-4 text-sm text-right text-neutral-600 dark:text-neutral-400",children:S.speed_multiplier??"-"}),a.jsx("td",{className:"px-6 py-4 text-center text-sm text-neutral-600 dark:text-neutral-400",children:S.trace_also_on_webhook?"":"-"}),a.jsx("td",{className:"px-6 py-4 text-center text-xs text-neutral-500 dark:text-neutral-400",children:"View/edit in mapping card"})]},S.id))})]})})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 rounded-lg shadow-xs dark:shadow-none border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:[a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-b border-neutral-200 dark:border-neutral-800",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50",children:"Campaign Mappings & Trackier Integration"}),a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"All V5 mappings with Trackier campaigns"})]}),a.jsxs("button",{onClick:()=>wt(),disabled:U,className:"flex items-center gap-2 px-3 py-2 text-sm rounded-lg bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-smooth disabled:opacity-50",children:[a.jsx(yt,{size:14,className:U?"animate-spin":""}),"Refresh"]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"text",value:K,onChange:S=>V(S.target.value),placeholder:"Search by offer, campaign ID, account...",className:"flex-1 px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-900 focus:ring-2 focus:ring-brand-500/20 outline-none"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>D("all"),className:`px-3 py-2 text-sm rounded-lg transition-smooth ${_==="all"?"bg-brand-600 text-white":"bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300"}`,children:["All (",b.length,")"]}),a.jsxs("button",{onClick:()=>D("active"),className:`px-3 py-2 text-sm rounded-lg transition-smooth ${_==="active"?"bg-success-600 text-white":"bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300"}`,children:["Active (",b.filter(S=>S.is_active).length,")"]}),a.jsxs("button",{onClick:()=>D("inactive"),className:`px-3 py-2 text-sm rounded-lg transition-smooth ${_==="inactive"?"bg-neutral-500 text-white":"bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300"}`,children:["Inactive (",b.filter(S=>!S.is_active).length,")"]})]})]})]}),U?a.jsxs("div",{className:"p-12 text-center",children:[a.jsx(yt,{size:32,className:"animate-spin mx-auto text-brand-500 mb-3"}),a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Loading mappings..."})]}):g.length===0?a.jsxs("div",{className:"p-12 text-center",children:[a.jsx(ds,{size:48,className:"mx-auto text-neutral-400 mb-3"}),a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:K||_!=="all"?"No mappings match your filters":"No mappings created yet"}),!K&&_==="all"&&a.jsx("button",{onClick:()=>f(!0),className:"mt-4 px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 transition-smooth",children:"Create Your First Mapping"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:g.slice((q-1)*B,q*B).map(S=>{var E,P;const Y=te.has(S.id);return a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between cursor-pointer hover:bg-neutral-50 dark:hover:bg-neutral-850/50 -m-6 p-6 rounded-lg transition-smooth",onClick:()=>Yt(S.id),children:[a.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[a.jsx("div",{className:"flex-shrink-0",children:Y?a.jsx(Cn,{size:20,className:"text-brand-600 dark:text-brand-400"}):a.jsx(Vd,{size:20,className:"text-neutral-400"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"text-base font-medium text-neutral-900 dark:text-neutral-50 truncate",children:S.offer_name}),a.jsxs("div",{className:"mt-1 flex items-center gap-4 text-sm text-neutral-500 dark:text-neutral-400",children:[a.jsx("span",{className:"font-mono",children:S.campaign_id}),S.trackier&&a.jsxs(a.Fragment,{children:[a.jsx("span",{children:""}),a.jsxs("span",{className:"font-mono text-brand-600 dark:text-brand-400",children:["Trackier #",S.trackier.campaignId]})]}),a.jsx("span",{children:""}),a.jsx("span",{className:"text-xs",children:S.account_id})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.jsx("span",{className:`px-3 py-1 text-xs rounded-full ${S.is_active?"bg-success-100 text-success-800 dark:bg-success-900/30 dark:text-success-400":"bg-neutral-100 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-400"}`,children:S.is_active?"Active":"Inactive"}),S.auto_created&&a.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",children:"Auto"}),S.trackier&&a.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-success-100 text-success-800 dark:bg-success-900/30 dark:text-success-400",children:S.trackier.redirectType})]})]}),Y&&S.trackier&&a.jsxs("div",{className:"mt-6 space-y-3 pt-6 border-t border-neutral-200 dark:border-neutral-800",onClick:z=>z.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between bg-neutral-50 dark:bg-neutral-850 rounded-lg p-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-neutral-800 dark:text-neutral-200",children:"Manual trace (account scope)"}),a.jsxs("p",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["Runs v5_trigger_manual_trace for account ",S.account_id]})]}),a.jsxs("button",{onClick:async()=>{try{const{error:z}=await J.rpc("v5_trigger_manual_trace",{p_account_id:S.account_id});if(z)throw z;alert("Manual trace triggered")}catch(z){console.error("Manual trace error:",z),alert("Failed to trigger manual trace")}},className:"flex items-center gap-2 px-3 py-2 bg-purple-600 dark:bg-purple-500 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 transition-smooth",children:[a.jsx(ds,{size:14}),"Trigger"]})]}),a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:"Tracking Template (Add to Google Ads)"}),a.jsx("button",{onClick:()=>{var z;return M(((z=S.trackier)==null?void 0:z.trackingTemplate)||"",`template-${S.id}`)},className:"flex items-center gap-1 px-2 py-1 text-xs rounded bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-smooth",children:L===`template-${S.id}`?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:14}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:14}),"Copy"]})})]}),a.jsx("div",{className:"bg-white dark:bg-neutral-900 rounded border border-neutral-200 dark:border-neutral-800 p-3",children:a.jsx("code",{className:"text-xs text-neutral-600 dark:text-neutral-400 break-all",children:(E=S.trackier)==null?void 0:E.trackingTemplate})}),a.jsxs("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-2",children:[" Contains p1=","{"," campaignid","}"," to pass Google campaign ID to Trackier"]})]}),a.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-850 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:["Postback URL (Add to Trackier Campaign ",(P=S.trackier)==null?void 0:P.campaignId,")"]}),a.jsx("button",{onClick:()=>{var z;return M(((z=S.trackier)==null?void 0:z.webhookUrlWithParams)||"",`webhook-${S.id}`)},className:"flex items-center gap-1 px-2 py-1 text-xs rounded bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-smooth",children:L===`webhook-${S.id}`?a.jsxs(a.Fragment,{children:[a.jsx(Ye,{size:14}),"Copied"]}):a.jsxs(a.Fragment,{children:[a.jsx(ht,{size:14}),"Copy"]})})]}),a.jsx("div",{className:"bg-white dark:bg-neutral-900 rounded border border-neutral-200 dark:border-neutral-800 p-3",children:a.jsx("code",{className:"text-xs text-neutral-600 dark:text-neutral-400 break-all",children:S.trackier.webhookUrlWithParams})}),a.jsxs("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-2",children:[" Contains ","{"," p1","}"," and ","{"," transaction_id","}"," macros - Trackier will replace these"]})]}),a.jsxs("div",{className:"bg-brand-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-800 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm font-medium text-brand-900 dark:text-brand-300 mb-2",children:"Setup Flow:"}),a.jsxs("ol",{className:"text-xs text-brand-800 dark:text-brand-400 space-y-1 list-decimal list-inside",children:[a.jsxs("li",{children:["Copy Tracking Template  paste in Google Ads Campaign ",S.campaign_id]}),a.jsxs("li",{children:["Copy Postback URL  paste in Trackier Campaign ",S.trackier.campaignId," S2S settings"]}),a.jsx("li",{children:"Verify: Google click  Trackier (with p1)  Webhook (campaign_id from p1)  V5 Queue"})]})]}),a.jsxs("div",{className:"bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-neutral-900 dark:text-neutral-50",children:"Trace override (account + offer)"}),a.jsxs("p",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["Randomized cadence for ",S.account_id," / ",S.offer_name," (non-periodic with jitter)"]})]}),a.jsx("button",{onClick:()=>Dr(S.account_id,S.offer_name),disabled:H===oe(S.account_id,S.offer_name),className:"px-3 py-2 text-sm rounded-lg bg-brand-600 text-white hover:bg-brand-700 transition-smooth disabled:opacity-50",children:H===oe(S.account_id,S.offer_name)?"Saving...":"Save Override"})]}),a.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 mb-3",children:"Cadence uses jitter (70%130% of base) to avoid periodic traces."}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm text-neutral-700 dark:text-neutral-300",children:[a.jsx("input",{type:"checkbox",checked:Ge(S.account_id,S.offer_name).enabled,onChange:z=>ot(S.account_id,S.offer_name,{enabled:z.target.checked})}),"Enabled"]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mb-1",children:"Traces per day"}),a.jsx("input",{type:"number",min:0,className:"w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850",value:Ge(S.account_id,S.offer_name).traces_per_day??"",onChange:z=>ot(S.account_id,S.offer_name,{traces_per_day:z.target.value===""?null:Number(z.target.value)})})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mb-1",children:"Speed multiplier"}),a.jsx("input",{type:"number",step:"0.1",min:0,className:"w-full px-3 py-2 text-sm border border-neutral-300 dark:border-neutral-700 rounded-lg bg-white dark:bg-neutral-850",value:Ge(S.account_id,S.offer_name).speed_multiplier??"",onChange:z=>ot(S.account_id,S.offer_name,{speed_multiplier:z.target.value===""?null:Number(z.target.value)})})]}),a.jsxs("label",{className:"flex items-center gap-2 text-sm text-neutral-700 dark:text-neutral-300",children:[a.jsx("input",{type:"checkbox",checked:Ge(S.account_id,S.offer_name).trace_also_on_webhook,onChange:z=>ot(S.account_id,S.offer_name,{trace_also_on_webhook:z.target.checked})}),"Trace on webhook"]})]}),a.jsx("div",{className:"mt-3 text-xs text-neutral-600 dark:text-neutral-400",children:(()=>{const z=lt(S.account_id,S.offer_name);return`Approx gap: ~${z.base} min (range ${z.min}${z.max} min) with jitter`})()})]})]}),!S.trackier&&Y&&a.jsx("div",{className:"bg-warning-50 dark:bg-warning-900/20 border border-warning-200 dark:border-warning-800 rounded-lg p-4 mt-6 pt-6 border-t border-neutral-200 dark:border-neutral-800",children:a.jsx("p",{className:"text-sm text-warning-900 dark:text-warning-300",children:" Trackier campaign not yet created. This mapping may have been created manually."})})]},S.id)})}),g.length>B&&a.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-850 px-6 py-4 border-t border-neutral-200 dark:border-neutral-800",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:["Showing ",(q-1)*B+1," to ",Math.min(q*B,g.length)," of ",g.length," mappings"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>N(S=>Math.max(1,S-1)),disabled:q===1,className:"px-3 py-2 text-sm rounded-lg bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed transition-smooth",children:"Previous"}),a.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.ceil(g.length/B)},(S,Y)=>Y+1).map(S=>a.jsx("button",{onClick:()=>N(S),className:`px-3 py-2 text-sm rounded-lg transition-smooth ${q===S?"bg-brand-600 text-white":"bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-700"}`,children:S},S))}),a.jsx("button",{onClick:()=>N(S=>Math.min(Math.ceil(g.length/B),S+1)),disabled:q===Math.ceil(g.length/B),className:"px-3 py-2 text-sm rounded-lg bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed transition-smooth",children:"Next"})]})]})})]})]}),!r&&s.length===0&&l.length===0&&a.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-850 border border-neutral-200 dark:border-neutral-800 rounded-lg p-8 text-center",children:a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:'Enter an Account ID and click "Load Data" to view V5 system status'})})]})}function UN(){const[e,t]=y.useState(null),[r,n]=y.useState(!0),{theme:s,toggleTheme:i}=D_(),{role:l,loading:o}=xg(),c=On();y.useEffect(()=>{J.auth.getSession().then(({data:{session:v}})=>{t((v==null?void 0:v.user)??null),n(!1)});const{data:{subscription:p}}=J.auth.onAuthStateChange((v,g)=>{t((g==null?void 0:g.user)??null)});return()=>p.unsubscribe()},[]);const d=async()=>{await J.auth.signOut()};if(r||o)return a.jsx("div",{className:"min-h-screen bg-neutral-50 dark:bg-neutral-950 flex items-center justify-center transition-colors",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-2 border-brand-500 border-t-transparent mx-auto mb-3"}),a.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Loading..."})]})});if(!e)return a.jsx(F_,{});if(!l)return a.jsx("div",{className:"min-h-screen bg-neutral-50 dark:bg-neutral-950 flex items-center justify-center transition-colors",children:a.jsxs("div",{className:"text-center max-w-md p-6",children:[a.jsx("div",{className:"mb-4 text-error-500",children:a.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),a.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-50 mb-2",children:"No User Role Assigned"}),a.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-4",children:"Your account doesn't have a role assigned yet. Please contact an administrator."}),a.jsx("button",{onClick:d,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 transition-smooth text-sm font-medium",children:"Logout"})]})});const u=p=>c.pathname===p,h=l==="admin";return a.jsxs("div",{className:"min-h-screen bg-neutral-50 dark:bg-neutral-950 transition-colors",children:[a.jsx("nav",{className:"sticky top-0 z-50 bg-white/90 dark:bg-neutral-900/90 backdrop-blur-xl border-b border-neutral-200 dark:border-neutral-800/50 shadow-sm dark:shadow-none",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-12",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"flex items-center justify-center w-7 h-7 bg-brand-600 rounded-lg",children:a.jsx(sa,{className:"text-white",size:14})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h1",{className:"text-sm font-semibold text-neutral-900 dark:text-neutral-50 tracking-tight",children:"URL Tracker"}),a.jsxs("div",{className:`px-1.5 py-0.5 rounded-md text-[10px] font-medium flex items-center gap-1 ${h?"bg-brand-500/10 text-brand-600 dark:text-brand-400 border border-brand-500/20":"bg-success-500/10 text-success-600 dark:text-success-400 border border-success-500/20"}`,children:[h?a.jsx(Ti,{size:9}):a.jsx(Lc,{size:9}),h?"ADMIN":"VIEWER"]})]})]}),a.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[h&&a.jsxs(fa,{to:"/",className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-xs font-medium transition-smooth ${u("/")?"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-50":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-50 dark:hover:bg-neutral-850 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:[a.jsx(sa,{size:14}),a.jsx("span",{className:"hidden lg:inline",children:"Offers"})]}),h&&a.jsxs(fa,{to:"/scripts",className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-xs font-medium transition-smooth ${u("/scripts")?"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-50":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-50 dark:hover:bg-neutral-850 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:[a.jsx(Xa,{size:14}),a.jsx("span",{className:"hidden lg:inline",children:"Scripts"})]}),h&&a.jsxs(fa,{to:"/webhooks",className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-xs font-medium transition-smooth ${u("/webhooks")?"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-50":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-50 dark:hover:bg-neutral-850 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:[a.jsx(ds,{size:14}),a.jsx("span",{className:"hidden lg:inline",children:"Webhooks"})]}),h&&a.jsxs(fa,{to:"/v5",className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-xs font-medium transition-smooth ${u("/v5")?"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-50":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-50 dark:hover:bg-neutral-850 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:[a.jsx(ds,{size:14}),a.jsx("span",{className:"hidden lg:inline",children:"V5"})]}),h&&a.jsxs(fa,{to:"/intervals",className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-xs font-medium transition-smooth ${u("/intervals")?"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-50":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-50 dark:hover:bg-neutral-850 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:[a.jsx(Ll,{size:14}),a.jsx("span",{className:"hidden lg:inline",children:"Intervals"})]}),a.jsxs(fa,{to:"/analytics",className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-xs font-medium transition-smooth ${u("/analytics")?"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-50":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-50 dark:hover:bg-neutral-850 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:[a.jsx(wa,{size:14}),a.jsx("span",{className:"hidden lg:inline",children:"Analytics"})]}),h&&a.jsxs(fa,{to:"/settings",className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-xs font-medium transition-smooth ${u("/settings")?"bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-50":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-50 dark:hover:bg-neutral-850 hover:text-neutral-900 dark:hover:text-neutral-200"}`,children:[a.jsx(gg,{size:14}),a.jsx("span",{className:"hidden lg:inline",children:"Settings"})]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:i,className:"p-1.5 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 hover:text-neutral-900 dark:hover:text-neutral-50 rounded-md transition-smooth",title:`Switch to ${s==="light"?"dark":"light"} mode`,"aria-label":"Toggle theme",children:s==="light"?a.jsx(S_,{size:14}):a.jsx(R_,{size:14})}),a.jsxs("button",{onClick:d,className:"flex items-center gap-1.5 px-2.5 py-1.5 text-neutral-600 dark:text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 hover:text-neutral-900 dark:hover:text-neutral-50 rounded-md transition-smooth text-xs font-medium","aria-label":"Logout",children:[a.jsx(N_,{size:14}),a.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})]})]})})}),a.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:a.jsxs(Sy,{children:[h?a.jsxs(a.Fragment,{children:[a.jsx(ar,{path:"/",element:a.jsx(J_,{})}),a.jsx(ar,{path:"/scripts",element:a.jsx(aw,{})}),a.jsx(ar,{path:"/webhooks",element:a.jsx(PN,{})}),a.jsx(ar,{path:"/v5",element:a.jsx(ON,{})}),a.jsx(ar,{path:"/intervals",element:a.jsx(nw,{})}),a.jsx(ar,{path:"/analytics",element:a.jsx(a0,{})}),a.jsx(ar,{path:"/settings",element:a.jsx(rw,{})})]}):a.jsxs(a.Fragment,{children:[a.jsx(ar,{path:"/",element:a.jsx(_h,{to:"/analytics",replace:!0})}),a.jsx(ar,{path:"/analytics",element:a.jsx(a0,{})})]}),a.jsx(ar,{path:"*",element:a.jsx(_h,{to:h?"/":"/analytics",replace:!0})})]})})]})}function DN(){return a.jsx(U_,{children:a.jsx(Ly,{children:a.jsx(UN,{})})})}So.createRoot(document.getElementById("root")).render(a.jsx(R0.StrictMode,{children:a.jsx(DN,{})}));
